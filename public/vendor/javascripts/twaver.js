(function (e, t) {
    var i = {};
    var r = {isDeserializing: false, isCalculatingBus: false, images: {}, registerImage: function (e, t, n, a) {
        r.images[e] = new i.ImageAsset(e, t, n, a)
    }, unregisterImage: function (e) {
        delete r.images[e]
    }, getImageAsset: function (e) {
        return r.images[e]
    }, showVersion: function (e) {
        if (r.isCtrlDown(e) && e.shiftKey && e.keyCode == 76) {
            alert("TWaver HTML5 " + i.Util.getVersion() + "\n" + a)
        }
    }, callLater: function (e, t, i, n) {
        return setTimeout(function () {
            e.apply(t, i)
        }, n || x.CALL_LATER_DELAY)
    }, isEmptyObject: function (e) {
        for (var t in e) {
            return false
        }
        return true
    }, xml: function (t) {
        if (e.DOMParser) {
            return(new DOMParser).parseFromString(t, "text/xml")
        } else {
            var i = new ActiveXObject("Microsoft.XmlDOM");
            i.async = false;
            i.loadXml(t);
            return i
        }
    }, num: function (e) {
        return typeof e === "number" && !isNaN(e) && isFinite(e)
    }, getter: function (e) {
        var t = e.charAt(0).toUpperCase() + e.slice(1);
        var i = /ble$/.test(e) || /ed$/.test(e) ? "is" : "get";
        return i + t
    }, setter: function (e) {
        var t = e.charAt(0).toUpperCase() + e.slice(1);
        return"set" + t
    }, _id: ["0", "1", "2", "3", "4", "5", "6", "7", "8", "9", "A", "B", "C", "D", "E", "F"], id: function () {
        var e = [];
        for (var t = 0; t < 32; t++) {
            e[t] = this._id[Math.floor(Math.random() * 16)]
        }
        e[12] = "4";
        e[16] = this._id[e[16] & 3 | 8];
        return e.join("")
    }, keys: function (e) {
        var t = new C;
        for (var i in e) {
            t.add(i)
        }
        return t
    }, es: ["toString", "toLocaleString", "valueOf"], ip: function (e, t) {
        var i = "_" + t;
        e[r.getter(t)] = function () {
            return this[i]
        };
        e[r.setter(t)] = function (e) {
            var n = this[i];
            this[i] = e;
            this.firePropertyChange(t, n, e)
        }
    }, validateLicense: function (e) {
        a = e
    }, ibool: function (e, t) {
        var i = "_" + t;
        var n = t.charAt(0).toUpperCase() + t.slice(1);
        e["is" + n] = function () {
            return this[i]
        };
        e[r.setter(t)] = function (e) {
            var n = this[i];
            this[i] = e;
            this.firePropertyChange(t, n, e)
        }
    }, getValue: function (e, t, i) {
        var n = t.charAt(0).toUpperCase() + t.slice(1), r = "get" + n, a = "is" + n;
        if (i) {
            if (i === "boolean") {
                return e[a]()
            } else {
                return e[r]()
            }
        } else {
            if (e[r]) {
                return e[r]()
            } else if (e[a]) {
                return e[a]()
            } else {
                return e[t]
            }
        }
    }, setValue: function (e, t, i) {
        e["set" + t.charAt(0).toUpperCase() + t.slice(1)](i)
    }, clone: function (e) {
        if (!e) {
            return null
        }
        var t = {};
        for (var i in e) {
            t[i] = e[i]
        }
        return t
    }, classCache: {}, getClass: function (t) {
        var i = r.classCache[t];
        if (!i) {
            var n = t.split(".");
            var a = n.length;
            i = e;
            for (var o = 0; o < a; o++) {
                i = i[n[o]]
            }
            r.classCache[t] = i
        }
        return i
    }, newInstance: function (e) {
        var t = r.getClass(e);
        if (!t) {
            return null
        }
        var i = arguments.length;
        var n = arguments;
        if (i === 1) {
            return new t
        } else if (i === 2) {
            return new t(n[1])
        } else if (i === 3) {
            return new t(n[1], n[2])
        } else if (i === 4) {
            return new t(n[1], n[2], n[3])
        } else if (i === 5) {
            return new t(n[1], n[2], n[3], n[4])
        } else if (i === 6) {
            return new t(n[1], n[2], n[3], n[4], n[5])
        } else if (i === 7) {
            return new t(n[1], n[2], n[3], n[4], n[5], n[6])
        } else if (i === 8) {
            return new t(n[1], n[2], n[3], n[4], n[5], n[6], n[7])
        }
        throw"don't support args more than 7"
    }, addMethod: function (e, t) {
        var i = e.prototype;
        for (var n in t) {
            i[n] = t[n]
        }
    }, ext: function (e, t, i) {
        var n;
        if (typeof e === "string") {
            n = e;
            e = r.getClass(e)
        }
        if (t) {
            var a = function () {
            };
            a.prototype = t.prototype;
            e.prototype = new a;
            e.prototype.constructor = e;
            e.superClass = t.prototype;
            if (t.prototype.constructor == Object.prototype.constructor) {
                t.prototype.constructor = t
            }
        }
        if (n) {
            e.prototype.getClassName = function () {
                return n
            }
        }
        if (i) {
            var o = e.prototype;
            for (var A in i) {
                s.ext(A, o, i)
            }
            var l = r.es.length;
            for (var h = 0; h < l; h++) {
                A = r.es[h];
                if (i.hasOwnProperty(A) && !i.propertyIsEnumerable(A)) {
                    o[A] = i[A]
                }
            }
        }
    }, setViewBounds: function (e, t) {
        if (!e) {
            return
        }
        if (e.adjustBounds) {
            e.adjustBounds(t)
        } else {
            var i = e.style;
            if (!i && e.getView()) {
                i = e.getView().style
            }
            if (i) {
                i.position = "absolute";
                i.left = t.x + "px";
                i.top = t.y + "px";
                i.width = t.width + "px";
                i.height = t.height + "px"
            }
        }
    }, getImageSrc: function (e) {
        var t = r.getImageAsset(e);
        if (t) {
            if (t.getSrc()) {
                return t.getSrc()
            } else {
                return t.getImage().getAttribute("src")
            }
        } else {
            return e
        }
    }, nextColorCount: 0, nextColor: function () {
        if (r.nextColorCount >= x.COLORS.length) {
            r.nextColorCount = 0
        }
        return x.COLORS[r.nextColorCount++]
    }, isCtrlDown: function (e) {
        return e.ctrlKey || e.metaKey
    }, setText: function (e, t, i) {
        if (i) {
            if (o.isFirefox) {
                e.textContent = t
            } else {
                e.innerText = t
            }
        } else {
            e.innerHTML = t
        }
    }, fillDescendant: function (e, t) {
        t.add(e);
        if (e.hasChildren()) {
            e.getChildren().forEach(function (e) {
                r.fillDescendant(e, t)
            })
        }
    }};
    var a = "This license applies to the evaluation version of TWaver. " + "The License is limited to noncommercial use. Noncommercial use relates only " + "to educational, research, personal or evaluation purposes. Any other use is " + "commercial use. You may not use the Software in connection with any business " + "activities.And You are not permitted to modify the software or attempt to " + "decipher, decompile, disassemble or reverse engineer this Software.";
    e.twaver = i;
    e._twaver = r;
    i.animate = {};
    i.network = {};
    i.network.interaction = {};
    i.controls = {};
    i.charts = {};
    i.layout = {};
    var o = function () {
        var e = {};
        var t = navigator.userAgent.toLowerCase();
        e.isOpera = /opera/.test(t);
        e.isIE = /msie/.test(t);
        e.isFirefox = /firefox/i.test(t);
        e.isChrome = /chrome/i.test(t);
        e.isSafari = !e.isChrome && /safari/i.test(t);
        e.isIPhone = /iphone/.test(t);
        e.isIPod = /ipod/.test(t);
        e.isIPad = /ipad/.test(t);
        e.isAndroid = /android/i.test(t);
        e.isWebOS = /webos/i.test(t);
        e.isMSToucheable = navigator.msMaxTouchPoints && navigator.msMaxTouchPoints > 1;
        e.isTouchable = "ontouchend"in document || e.isMSToucheable;
        return e
    }();
    r.ua = o;
    var s = {__accessor: function (e, t) {
        var i = t["__accessor"];
        var n = i.length;
        for (var a = 0; a < n; a++) {
            r.ip(e, i[a])
        }
    }, __bool: function (e, t) {
        var i = t["__bool"];
        var n = i.length;
        for (var a = 0; a < n; a++) {
            r.ibool(e, i[a])
        }
    }, __client: function (e, t) {
        e.getClient = function (e) {
            return this._clientMap[e]
        };
        e.setClient = function (e, t) {
            var i = this._clientMap[e];
            if (t == null) {
                delete this._clientMap[e]
            } else {
                this._clientMap[e] = t
            }
            if (this.firePropertyChange("C:" + e, i, t)) {
                this.onClientChanged(e, i, t)
            }
            return this
        };
        e.getClientProperties = function () {
            return r.keys(this._clientMap)
        };
        e.onClientChanged = function (e, t, i) {
        }
    }, __style: function (e, n) {
        e.getStyle = function (e, n) {
            var r = this._styleMap[e];
            if (n === t) {
                n = true
            }
            if (r == null && n) {
                return i.Styles.getStyle(e)
            } else {
                return r
            }
        };
        e.setStyle = function (e, t) {
            var i = this._styleMap[e];
            if (t == null) {
                delete this._styleMap[e]
            } else {
                this._styleMap[e] = t
            }
            if (this.firePropertyChange("S:" + e, i, t)) {
                this.onStyleChanged(e, i, t)
            }
            return this
        };
        e.getStyleProperties = function () {
            return r.keys(this._styleMap)
        };
        e.onStyleChanged = function (e, t, i) {
        }
    }, __new: function (e, t) {
        e.newInstance = function () {
            var e = r.getClass(this.getClassName());
            if (!e) {
                return null
            }
            var t = arguments.length;
            var i = arguments;
            if (t === 0) {
                return new e
            } else if (t === 1) {
                return new e(i[0])
            } else if (t === 2) {
                return new e(i[0], i[1])
            } else if (t === 3) {
                return new e(i[0], i[1], i[2])
            } else if (t === 4) {
                return new e(i[0], i[1], i[2], i[3])
            } else if (t === 5) {
                return new e(i[0], i[1], i[2], i[3], i[4])
            } else if (t === 6) {
                return new e(i[0], i[1], i[2], i[3], i[4], i[5])
            } else if (t === 7) {
                return new e(i[0], i[1], i[2], i[3], i[4], i[5], i[6])
            }
            throw"don't support args more than 7"
        }
    }, __property: function (e, t) {
        e.getValue = function (e, t) {
            if (this._propertyType === "accessor") {
                return r.getValue(e, this._propertyName)
            } else if (this._propertyType === "style" && e.getStyle) {
                return e.getStyle(this._propertyName)
            } else if (this._propertyType === "client" && e.getClient) {
                return e.getClient(this._propertyName)
            } else if (this._propertyType === "field") {
                return e[this._propertyName]
            }
            return null
        };
        e.setValue = function (e, t, i) {
            if (this._propertyType === "accessor") {
                e[r.setter(this._propertyName)](t)
            } else if (this._propertyType === "style" && e.setStyle) {
                return e.setStyle(this._propertyName, t)
            } else if (this._propertyType === "client" && e.setClient) {
                return e.setClient(this._propertyName, t)
            } else if (this._propertyType === "field") {
                e[this._propertyName] = t
            }
        }
    }, map: {__accessor: 1, __bool: 1, __client: 1, __style: 1, __new: 1, __tree: 1, __property: 1}, ext: function (e, t, i) {
        if (s.map[e] === 1) {
            s[e](t, i)
        } else {
            t[e] = i[e]
        }
    }};
    r.extend = s;
    var A = function (e, t, i, n, r, a) {
        this._m11 = e;
        this._m12 = t;
        this._m21 = i;
        this._m22 = n;
        this._offsetX = r;
        this._offsetY = a;
        this._type = 0;
        if (this._m21 != 0 || this._m12 != 0) {
            this._type = 4
        } else {
            if (this._m11 != 1 || this._m22 != 1) {
                this._type = 2
            }
            if (this._offsetX != 0 || this._offsetY != 0) {
                this._type |= 1
            }
            if ((this._type & (2 | 1)) == 0) {
                this._type = 0
            }
        }
    };
    A.prototype.transform = function () {
        var e;
        if (arguments.length === 2) {
            e = {x: arguments[0], y: arguments[1]}
        } else {
            e = arguments[0]
        }
        if (!e || !r.num(e.x) || !r.num(e.y)) {
            throw"arguments should contain x, y"
        }
        switch (this._type) {
            case 0:
                return{x: e.x, y: e.y};
            case 1:
                return{x: this._offsetX + e.x, y: this._offsetY + e.y};
            case 2:
                return{x: e.x * this._m11, y: e.y * this._m22};
            case 3:
                return{x: e.x * this._m11 + this._offsetX, y: e.y * this._m22 + this._offsetY}
        }
        return{x: this._m11 * e.x + e.y * this._m21 + this._offsetX, y: this._m22 * e.y + e.x * this._m12 + this._offsetY}
    };
    var l = {getDistance: function (e, t) {
        var i = t.x - e.x;
        var n = t.y - e.y;
        return Math.sqrt(i * i + n * n)
    }, getCenterPoint: function (e, t) {
        return{x: (e.x + t.x) / 2, y: (e.y + t.y) / 2}
    }, isPointInPolygon: function (e, t) {
        e = e._as;
        var i = 0, n = 0, r = false, a = e.length;
        for (i = 0, n = a - 1; i < a; n = i++) {
            var o = e[i];
            var s = e[n];
            if (o.y > t.y != s.y > t.y && t.x < (s.x - o.x) * (t.y - o.y) / (s.y - o.y) + o.x) {
                r = !r
            }
        }
        return r
    }, unionRect: function (e, t) {
        if (e && !t) {
            return r.clone(e)
        }
        if (!e && t) {
            return r.clone(t)
        }
        if (e && t) {
            var i = {};
            i.x = Math.min(e.x, t.x);
            i.y = Math.min(e.y, t.y);
            i.width = Math.max(e.x + e.width, t.x + t.width) - i.x;
            i.height = Math.max(e.y + e.height, t.y + t.height) - i.y;
            return i
        }
        return null
    }, intersects: function (e, t) {
        if (!e || !t) {
            return false
        }
        var i = t.width;
        var n = t.height;
        var r = e.width;
        var a = e.height;
        if (r <= 0 || a <= 0 || i <= 0 || n <= 0) {
            return false
        }
        var o = t.x;
        var s = t.y;
        var A = e.x;
        var l = e.y;
        r += A;
        a += l;
        i += o;
        n += s;
        return(r < A || r > o) && (a < l || a > s) && (i < o || i > A) && (n < s || n > l)
    }, intersection: function (e, t) {
        if (!e || !t) {
            return false
        }
        var i = t.x;
        var n = t.y;
        var r = e.x;
        var a = e.y;
        var o = i;
        o += t.width;
        var s = n;
        s += t.height;
        var A = r;
        A += e.width;
        var l = a;
        l += e.height;
        if (i < r)i = r;
        if (n < a)n = a;
        if (o > A)o = A;
        if (s > l)s = l;
        o -= i;
        s -= n;
        if (o === 0 || s === 0) {
            return null
        }
        return{x: i, y: n, width: o, height: s}
    }, contains: function (e, t) {
        var i = t.x, n = t.y, r = t.width, a = t.height;
        var o = e.width;
        var s = e.height;
        if ((o | s | r | a) < 0) {
            return false
        }
        var A = e.x;
        var l = e.y;
        if (i < A || n < l) {
            return false
        }
        o += A;
        r += i;
        if (r <= i) {
            if (o >= A || r > o)return false
        } else {
            if (o >= A && r > o)return false
        }
        s += l;
        a += n;
        if (a <= n) {
            if (s >= l || a > s)return false
        } else {
            if (s >= l && a > s)return false
        }
        return true
    }, getLinePoints: function (e) {
        if (!e) {
            return null
        }
        var t = new C;
        e.forEach(function (e) {
            t.addAll(e)
        });
        return t
    }, getLineRect: function (e) {
        var t = l.getLinePoints(e);
        return l.getRect(t)
    }, getRect: function (e) {
        if (!e) {
            return null
        }
        if (e._as) {
            e = e._as
        }
        var t = e.length;
        if (t <= 0) {
            return null
        }
        var i = e[0];
        var n = {x: i.x, y: i.y, width: 0, height: 0};
        for (var r = 1; r < t; r++) {
            i = e[r];
            var a = Math.min(n.x, i.x);
            var o = Math.max(n.x + n.width, i.x);
            var s = Math.min(n.y, i.y);
            var A = Math.max(n.y + n.height, i.y);
            n.x = a;
            n.y = s;
            n.width = o - a;
            n.height = A - s
        }
        return n
    }, addPadding: function (e, t, i, n) {
        if (arguments.length === 3) {
            n = -1
        }
        var r = t.getStyle(i) * n;
        if (r != 0) {
            l.grow(e, r, r)
        }
        r = t.getStyle(i + ".left") * n;
        if (r != 0) {
            e.x -= r;
            e.width += r
        }
        r = t.getStyle(i + ".right") * n;
        if (r != 0) {
            e.width += r
        }
        r = t.getStyle(i + ".top") * n;
        if (r != 0) {
            e.y -= r;
            e.height += r
        }
        r = t.getStyle(i + ".bottom") * n;
        if (r != 0) {
            e.height += r
        }
        if (e.width < 0) {
            e.width = -e.width;
            e.x -= e.width
        }
        if (e.height < 0) {
            e.height = -e.height;
            e.y -= e.height
        }
    }, grow: function (e, t, i) {
        var n = e.width + t + t;
        if (n < 0) {
            return
        }
        var r = e.height + i + i;
        if (r < 0) {
            return
        }
        e.x -= t;
        e.y -= i;
        e.width = n;
        e.height = r
    }, containsPoint: function (e, t, i) {
        if (arguments.length < 3) {
            i = t.y;
            t = t.x
        }
        if (!e || t < e.x || i < e.y || t > e.x + e.width || i > e.y + e.height) {
            return false
        }
        return true
    }, getHotSpot: function (e, t, i, n, r) {
        if (r === "oval") {
            var a = .35;
            return{x: e + i * .5 + i * a, y: t + n / 2 - Math.sqrt(.25 - a * a) * n}
        }
        if (r === "circle") {
            var o = e + i / 2;
            var s = t + n / 2;
            var A = Math.min(i, n) / 2;
            e = o - A;
            t = s - A;
            i = A * 2;
            n = A * 2;
            var l = i / 2;
            var h = n / 2;
            var u = l * h / Math.sqrt(l * l + h * h);
            return{x: e + i / 2 + u, y: t + n / 2 - u}
        }
        var f = {x: e + i, y: t};
        if (i > 3) {
            f.x -= 3
        }
        if (n > 3) {
            f.y += 3
        }
        return f
    }, getCircleRect: function (e) {
        var t = Math.min(e.width, e.height) / 2;
        return{x: e.x + e.width / 2 - t, y: e.y + e.height / 2 - t, width: t * 2, height: t * 2}
    }, getEllipsePoint: function (e, t) {
        if (!e || !t) {
            return null
        }
        var i = e.x + e.width / 2;
        var n = e.y + e.height / 2;
        var r = t.x - i;
        var a = t.y - n;
        var o = e.width / 2;
        var s = e.height / 2;
        var A = Math.sqrt(1 / (1 / o / o + a * a / r / r / s / s));
        if (r < 0) {
            A = -A
        }
        var l;
        if (r == 0) {
            if (a > 0) {
                l = s
            } else {
                l = -s
            }
        } else {
            l = A * a / r
        }
        return{x: i + A, y: n + l}
    }, createMatrix: function (e, t, i) {
        var n = Math.sin(e);
        var r = Math.cos(e);
        var a = t * (1 - r) + i * n;
        var o = i * (1 - r) - t * n;
        return new A(r, n, -n, r, a, o)
    }, calculatePointInfoAlongLineBySegments: function (e, t, i, n, r) {
        return l.calculatePointInfoAlongLine(l.getPointObject(e, t), i, n, r)
    }, calculatePointInfoAlongLine: function (e, i, n, r) {
        i = i === t ? true : i;
        n = n || 0;
        r = r || 0;
        if (!e || e.size() < 2) {
            throw"must more than two points"
        }
        if (!i) {
            var a = l.reversePath(e);
            return l.calculatePointInfoAlongLine(a, true, n, r)
        }
        if (e._as) {
            e = e._as
        }
        var o, s, A = 0, h = 0, u, f, c = e.length, d;
        for (f = 0; f < c; f++) {
            d = e[f];
            if (f == 0) {
                s = d;
                continue
            }
            if (n <= 0) {
                u = l.calculatePointInfoOnStraightLine(l._getPoint(s), l._getControlPoint(d), n, r);
                o = u;
                break
            }
            h = l._getLength(d, s);
            if (A + h > n) {
                u = l.getPathInfo(d, s, n - A, r, h);
                o = u;
                break
            }
            A += h;
            s = d
        }
        if (o == null) {
            var g, _;
            s = e[c - 1];
            _ = l._getPoint(s);
            if (s instanceof C) {
                s = s._as
            }
            g = s instanceof Array ? l._getControlPoint(s) : l._getPoint(e[c - 2]);
            var m = Math.atan2(_.y - g.y, _.x - g.x);
            u = l.transformPoint(_, m, n - A, r);
            u.angle = m;
            o = u
        }
        return o
    }, reversePath: function (e) {
        var t = new C;
        var i = null, n;
        if (e._as) {
            e = e._as
        }
        for (var r = e.length - 1; r >= 0; r--) {
            n = e[r];
            t.add(l._getReversePath(n, i));
            i = n
        }
        return t
    }, _getPoint: function (e) {
        if (e._as) {
            e = e._as
        }
        if (e instanceof Array) {
            return e[e.length - 1]
        } else {
            return e
        }
    }, _getControlPoint: function (e) {
        if (e._as) {
            e = e._as
        }
        if (e instanceof Array) {
            return e[e.length - 2]
        } else {
            return e
        }
    }, _getReversePath: function (e, t) {
        var i = l._getPoint(e);
        if (t && t._as) {
            t = t._as
        }
        if (t == null || !(t instanceof Array)) {
            return i
        }
        if (t.length == 2) {
            return new C([t[0], i])
        } else {
            return new C([t[1], t[0], i])
        }
    }, _getLength: function (e, t) {
        var i = l._getPoint(t);
        var n = l._getPoint(e);
        if (e instanceof C) {
            e = e._as
        }
        if (e instanceof Array) {
            return l.calculateCurveLength(i, e, 1)
        } else {
            var r = n.y - i.y;
            var a = n.x - i.x;
            return Math.sqrt(a * a + r * r)
        }
    }, getPathInfo: function (e, t, i, n, r) {
        var a = l._getPoint(t);
        var o = l._getPoint(e);
        var s;
        if (e instanceof C) {
            e = e._as
        }
        if (e instanceof Array) {
            if (r < 0) {
                r = l._getLength(e, t)
            }
            var A = i / r;
            var h = l.calculatePointInfoOnCurveLine(a, e, A);
            a = h.point;
            s = h.angle;
            i = 0
        } else {
            s = Math.atan2(o.y - a.y, o.x - a.x)
        }
        return l.transformPoint(a, s, i, n)
    }, transformPoint: function (e, t, i, n) {
        var r = {x: i, y: n};
        var a = l.createMatrix(t, 0, 0);
        r = a.transform(r);
        r.x += e.x;
        r.y += e.y;
        return{point: r, angle: t}
    }, calculatePointInfoOnStraightLine: function (e, t, i, n) {
        var r = Math.atan2(t.y - e.y, t.x - e.x);
        return l.transformPoint(e, r, i, n)
    }, calculatePointInfoOnCurveLine: function (e, t, i) {
        if (i < 0 || i > 1) {
            throw"Illegal arguments"
        }
        if (t._as) {
            t = t._as
        }
        if (t.length == 2) {
            return l._calculatePointInfoOnCurveLine2(e, t[0], t[1], i)
        } else {
            return l._calculatePointInfoOnCurveLine3(e, t[0], t[1], t[2], i)
        }
    }, _calculatePointInfoOnCurveLine2: function (e, t, i, n) {
        var r = 2 * (e.x + i.x - 2 * t.x) * n + 2 * t.x - 2 * e.x;
        var a = 2 * (e.y + i.y - 2 * t.y) * n + 2 * t.y - 2 * e.y;
        var o = Math.atan2(a, r);
        var s = (e.x + i.x - 2 * t.x) * n * n + (2 * t.x - 2 * e.x) * n + e.x;
        var A = (e.y + i.y - 2 * t.y) * n * n + (2 * t.y - 2 * e.y) * n + e.y;
        return{point: {x: s, y: A}, angle: o}
    }, _calculatePointInfoOnCurveLine3: function (e, t, i, n, r) {
        var a, o, s;
        a = 1 - r;
        o = a * a * a;
        s = r * r * r;
        var A = o * e.x + 3 * r * a * a * t.x + 3 * r * r * a * i.x + s * n.x;
        var h = o * e.y + 3 * r * a * a * t.y + 3 * r * r * a * i.y + s * n.y;
        return{point: {x: A, y: h}, angle: Math.atan2(l._bezeSpeedY(e, t, i, n, r), l._bezeSpeedX(e, t, i, n, r))}
    }, calculateCurveLength: function (e, t, i) {
        if (t._as) {
            t = t._as
        }
        if (t.length == 2) {
            return l._calculateCurveLength(e, t[0], t[1], i)
        } else {
            return l._calculateBezierCurveLength(e, t[0], t[1], t[2], i)
        }
    }, _calculateCurveLength: function (e, t, i, n) {
        if (n <= 0 || n > 1) {
            return 0
        }
        var r = Math.floor(n * (Math.sqrt((e.x - t.x) * (e.x - t.x) + (e.y - t.y) * (e.y - t.y)) + Math.sqrt((i.x - t.x) * (i.x - t.x) + (i.y - t.y) * (i.y - t.y))) / 2);
        var a = 0;
        if (r <= 0) {
            r = 1
        }
        var o = n / r;
        var s, A;
        var l = 0;
        for (var h = 0; h < r; h++) {
            l = o * h;
            s = 2 * (e.x + i.x - 2 * t.x) * l + 2 * t.x - 2 * e.x;
            A = 2 * (e.y + i.y - 2 * t.y) * l + 2 * t.y - 2 * e.y;
            s *= o;
            A *= o;
            a += Math.sqrt(s * s + A * A)
        }
        return a
    }, _calculateBezierCurveLength: function (e, t, i, n, r) {
        if (r <= 0 || r > 1) {
            return 0
        }
        var a = 1e4;
        var o = Math.floor(a * r);
        if ((o & 1) == 1)o++;
        if (o == 0)return 0;
        var s = Math.floor(o / 2);
        var A = 0, h = 0;
        var u = r / o;
        var f;
        for (f = 0; f < s; f++) {
            A += l._bezeSpeed(e, t, i, n, (2 * f + 1) * u)
        }
        for (f = 1; f < s; f++) {
            h += l._bezeSpeed(e, t, i, n, 2 * f * u)
        }
        return(l._bezeSpeed(e, t, i, n, 0) + l._bezeSpeed(e, t, i, n, 1) + 2 * h + 4 * A) * u / 3
    }, _bezeSpeedX: function (e, t, i, n, r) {
        var a = 1 - r;
        return-3 * e.x * a * a + 3 * t.x * a * a - 6 * t.x * a * r + 6 * i.x * a * r - 3 * i.x * r * r + 3 * n.x * r * r
    }, _bezeSpeedY: function (e, t, i, n, r) {
        var a = 1 - r;
        return-3 * e.y * a * a + 3 * t.y * a * a - 6 * t.y * a * r + 6 * i.y * a * r - 3 * i.y * r * r + 3 * n.y * r * r
    }, _bezeSpeed: function (e, t, i, n, r) {
        var a = l._bezeSpeedX(e, t, i, n, r);
        var o = l._bezeSpeedY(e, t, i, n, r);
        return Math.sqrt(a * a + o * o)
    }, getPointObject: function (e, t) {
        if (!t || t.size() == 0) {
            return e
        } else {
            var i = new C;
            t = t._as;
            e = e._as;
            var n = 0, r, a, o = t.length, s = e.length;
            for (r = 0; r < o; r++) {
                a = t[r];
                if (n == s) {
                    break
                }
                if ("cubicto" === a) {
                    if (n < s - 2) {
                        i.add([e[n++], e[n++], e[n++]])
                    }
                } else if ("quadto" === a) {
                    if (n < s - 1) {
                        i.add([e[n++], e[n++]])
                    }
                } else {
                    if (n < s) {
                        i.add(e[n++])
                    }
                }
            }
            for (; n < s; n++) {
                i.add(e[n])
            }
            return i
        }
    }, calculateLineLength: function (e, t) {
        if (!e || e.size() < 2) {
            return 0
        }
        if (t) {
            return l.calculateLineLength(l.getPointObject(e, t))
        }
        e = e._as;
        var i, n = e.length, r, a, o, s, A, h, u = 0;
        for (i = 0; i < n; i++) {
            o = e[i];
            if (i == 0) {
                r = o;
                continue
            }
            a = o;
            if (a instanceof C) {
                a = a._as
            }
            if (a instanceof Array) {
                s = l.calculateCurveLength(r, a, 1);
                r = a[a.length - 1]
            } else {
                h = o.y - r.y;
                A = o.x - r.x;
                s = Math.sqrt(A * A + h * h);
                r = a
            }
            u += s
        }
        return u
    }, toDegrees: function (e) {
        return e * 180 / Math.PI
    }, toRadians: function (e) {
        return e / 180 * Math.PI
    }, getRadiansBetweenLines: function (e, t) {
        return Math.atan2(t.y - e.y, t.x - e.x)
    }};
    r.math = l;
    var h = {getPoints: function (e) {
        var t = new C;
        e.forEach(function (e) {
            t.add({x: e.x, y: e.y});
            t.add({x: e.x + e.width, y: e.y + e.height});
            t.add({x: e.x + e.width, y: e.y});
            t.add({x: e.x, y: e.y + e.height})
        });
        return t
    }, rectangle: function (e) {
        var t;
        e.forEach(function (e) {
            t = l.unionRect(t, e)
        });
        return t
    }, oval: function (e) {
        var t = h.rectangle(e);
        var i = 0;
        var n = t.height / t.width;
        var r = n * n;
        var a = t.x + t.width / 2;
        var o = t.y + t.height / 2;
        var s = h.getPoints(e);
        s.forEach(function (e) {
            var t = e.x - a;
            var n = e.y - o;
            var s = t * t + n * n / r;
            if (s > i) {
                i = s
            }
        });
        i = Math.sqrt(i);
        var A = n * i;
        return{x: a - i, y: o - A, width: i * 2, height: A * 2}
    }, circle: function (e) {
        var t = h.rectangle(e);
        var i = 0;
        var n = t.x + t.width / 2;
        var r = t.y + t.height / 2;
        var a = h.getPoints(e);
        a.forEach(function (e) {
            var t = e.x - n;
            var a = e.y - r;
            var o = t * t + a * a;
            if (o > i) {
                i = o
            }
        });
        i = Math.sqrt(i);
        return{x: n - i, y: r - i, width: i * 2, height: i * 2}
    }, roundrect: function (e) {
        var t = h.rectangle(e);
        var i = Math.min(t.width, t.height) / 16;
        l.grow(t, i, i);
        return t
    }, star: function (e) {
        var t = h.rectangle(e);
        l.grow(t, t.width, t.height);
        return t
    }, triangle: function (e) {
        var t = h.rectangle(e);
        t.x -= t.width / 2;
        t.width *= 2;
        t.y -= t.height;
        t.height *= 2;
        return t
    }, hexagon: function (e) {
        var t = h.rectangle(e);
        t.x -= t.width / 2;
        t.width *= 2;
        return t
    }, pentagon: function (e) {
        var t = h.rectangle(e);
        t.x -= t.width / 6;
        t.width += t.width / 3;
        t.y -= t.height / 4;
        t.height += t.height / 4;
        return t
    }, diamond: function (e) {
        var t = h.rectangle(e);
        t.x -= t.width / 2;
        t.width += t.width;
        t.y -= t.height / 2;
        t.height += t.height;
        return t
    }};
    r.group = h;
    var u = {"topleft.topleft": function (e, t) {
        return{x: e.x - t.width, y: e.y - t.height}
    }, "topleft.topright": function (e, t) {
        return{x: e.x, y: e.y - t.height}
    }, "top.top": function (e, t) {
        return{x: e.x + e.width / 2 - t.width / 2, y: e.y - t.height}
    }, "topright.topleft": function (e, t) {
        return{x: e.x + e.width - t.width, y: e.y - t.height}
    }, "topright.topright": function (e, t) {
        return{x: e.x + e.width, y: e.y - t.height}
    }, topleft: function (e, t) {
        return{x: e.x - t.width / 2, y: e.y - t.height / 2}
    }, top: function (e, t) {
        return{x: e.x - t.width / 2 + e.width / 2, y: e.y - t.height / 2}
    }, topright: function (e, t) {
        return{x: e.x - t.width / 2 + e.width, y: e.y - t.height / 2}
    }, "topleft.bottomleft": function (e, t) {
        return{x: e.x - t.width, y: e.y}
    }, "topleft.bottomright": function (e, t) {
        return{x: e.x, y: e.y}
    }, "top.bottom": function (e, t) {
        return{x: e.x + e.width / 2 - t.width / 2, y: e.y}
    }, "topright.bottomleft": function (e, t) {
        return{x: e.x - t.width + e.width, y: e.y}
    }, "topright.bottomright": function (e, t) {
        return{x: e.x + e.width, y: e.y}
    }, "left.left": function (e, t) {
        return{x: e.x - t.width, y: e.y + e.height / 2 - t.height / 2}
    }, left: function (e, t) {
        return{x: e.x - t.width / 2, y: e.y + e.height / 2 - t.height / 2}
    }, "left.right": function (e, t) {
        return{x: e.x, y: e.y + e.height / 2 - t.height / 2}
    }, center: function (e, t) {
        return{x: e.x + e.width / 2 - t.width / 2, y: e.y + e.height / 2 - t.height / 2}
    }, "right.left": function (e, t) {
        return{x: e.x + e.width - t.width, y: e.y + e.height / 2 - t.height / 2}
    }, right: function (e, t) {
        return{x: e.x + e.width - t.width / 2, y: e.y + e.height / 2 - t.height / 2}
    }, "right.right": function (e, t) {
        return{x: e.x + e.width, y: e.y + e.height / 2 - t.height / 2}
    }, "bottomleft.topleft": function (e, t) {
        return{x: e.x - t.width, y: e.y + e.height - t.height}
    }, "bottomleft.topright": function (e, t) {
        return{x: e.x, y: e.y + e.height - t.height}
    }, "bottom.top": function (e, t) {
        return{x: e.x + e.width / 2 - t.width / 2, y: e.y + e.height - t.height}
    }, "bottomright.topleft": function (e, t) {
        return{x: e.x + e.width - t.width, y: e.y + e.height - t.height}
    }, "bottomright.topright": function (e, t) {
        return{x: e.x + e.width, y: e.y + e.height - t.height}
    }, bottomleft: function (e, t) {
        return{x: e.x - t.width / 2, y: e.y + e.height - t.height / 2}
    }, bottom: function (e, t) {
        return{x: e.x + e.width / 2 - t.width / 2, y: e.y + e.height - t.height / 2}
    }, bottomright: function (e, t) {
        return{x: e.x + e.width - t.width / 2, y: e.y + e.height - t.height / 2}
    }, "bottomleft.bottomleft": function (e, t) {
        return{x: e.x - t.width, y: e.y + e.height}
    }, "bottomleft.bottomright": function (e, t) {
        return{x: e.x, y: e.y + e.height}
    }, "bottom.bottom": function (e, t) {
        return{x: e.x + e.width / 2 - t.width / 2, y: e.y + e.height}
    }, "bottomright.bottomleft": function (e, t) {
        return{x: e.x + e.width - t.width, y: e.y + e.height}
    }, "bottomright.bottomright": function (e, t) {
        return{x: e.x + e.width, y: e.y + e.height}
    }, get: function (e, t, i) {
        if (!t) {
            throw"refRect can not be null"
        }
        if (!i) {
            i = {width: 0, height: 0}
        }
        var n = u[e];
        if (n) {
            return n(t, i)
        }
        throw"Can not resolve '" + e + "' position"
    }};
    r.position = u;
    var f = {preventDefault: function (e) {
        if (x.KEEP_DEFAULT_FUNCTION(e)) {
            return
        }
        if (e.preventDefault) {
            e.preventDefault()
        }
        if (e.preventManipulation) {
            e.preventManipulation()
        } else {
            e.returnValue = false
        }
    }, insertAfter: function (e, t) {
        if (t) {
            t.parentNode.insertBefore(e, t.nextSibling)
        } else {
            e.parentNode.insertBefore(e, e.parentNode.firstChild)
        }
        return e
    }, forEach: function (e, t, i) {
        if (!f.isVisible(e)) {
            return
        }
        var n = e.childNodes.length;
        for (var r = 0; r < n; r++) {
            f.forEach(e.childNodes[r], t, i)
        }
        if (i) {
            t.call(i, e)
        } else {
            t(e)
        }
    }, setVisible: function (e, t) {
        e.style.display = t ? "block" : "none"
    }, isVisible: function (e) {
        return"style"in e && e.style.display !== "none"
    }, release: function (e) {
        var t = e.childNodes.length;
        for (var i = 0; i < t; i++) {
            f.release(e.childNodes[i])
        }
        if (t > 0) {
            f.clear(e)
        }
        if (e._pool) {
            e._pool.release(e)
        }
    }, clear: function (e) {
        while (e.firstChild) {
            e.removeChild(e.firstChild)
        }
    }, setZoom: function (e, t) {
        var i = e.style;
        if (i.setProperty) {
            if (o.isFirefox) {
                i.setProperty("-moz-transform", "scale(" + t + ")", null);
                i.setProperty("-moz-transform-origin", "0 0", null)
            } else if (o.isOpera) {
                i.setProperty("-o-transform", "scale(" + t + ")", null);
                i.setProperty("-o-transform-origin", "0 0", null)
            } else if (o.isChrome || o.isSafari) {
                i.setProperty("-webkit-transform", "scale(" + t + ")", null);
                i.setProperty("-webkit-transform-origin", "0 0", null);
                var n = null;
                if (e._webkitInvaildateDiv) {
                    n = e._webkitInvaildateDiv
                } else {
                    n = document.createElement("div");
                    e._webkitInvaildateDiv = n
                }
                if (!n.parentNode || n.parentNode != e) {
                    e.appendChild(n)
                } else {
                    e.removeChild(n)
                }
            } else if (o.isIE) {
                i.setProperty("-ms-transform", "scale(" + t + ")", null);
                i.setProperty("-ms-transform-origin", "0 0", null)
            } else {
                i.setProperty("transform", "scale(" + t + ")", null);
                i.setProperty("transform-origin", "0 0", null)
            }
        }
    }, setCSSStyle: function (e, t, i) {
        e.style.setProperty(t, i, null)
    }, removeCSSStyle: function (e, t) {
        e.style.removeProperty(t)
    }, getCSSStyle: function (e, t) {
        return e.style.getPropertyValue(t)
    }, setBorderRaidus: function (e, t) {
        if (o.isFirefox) {
            e.style.MozBorderRadius = t
        } else {
            e.style.borderRadius = t
        }
    }, createSelect: function (e, t) {
        var i = document.createElement("select"), n, r, a;
        if (e.values) {
            for (n = 0; n < e.values.length; n++) {
                r = e.values[n];
                a = document.createElement("option");
                a.innerHTML = e.map[r];
                a.setAttribute("value", r);
                if (r === t) {
                    a.setAttribute("selected", "true")
                }
                i.appendChild(a)
            }
        } else {
            for (n = 0; n < e.length; n++) {
                r = e[n];
                a = document.createElement("option");
                a.innerHTML = r;
                a.setAttribute("value", r);
                if (r === t) {
                    a.setAttribute("selected", "true")
                }
                i.appendChild(a)
            }
        }
        return i
    }, createImg: function (e) {
        var t = document.createElement("img");
        t.style.position = "absolute";
        if (typeof e === "string") {
            t.setAttribute("src", e)
        }
        return t
    }, createView: function (e, t) {
        var i = document.createElement("div");
        i.style.position = x.VIEW_POSITION;
        i.style.fontSize = x.VIEW_FONT_SIZE;
        i.style.fontFamily = x.VIEW_FONT_FAMILY;
        i.style.cursor = "default";
        i.style.outline = "none";
        i.style.textAlign = "left";
        i.style.msTouchAction = "none";
        i.tabIndex = 0;
        if (t) {
        } else {
            i.onmousedown = f.preventDefault
        }
        if (i.style.setProperty) {
            i.style.setProperty("-khtml-user-select", "none", null);
            i.style.setProperty("-webkit-user-select", "none", null);
            i.style.setProperty("-moz-user-select", "none", null);
            i.style.setProperty("-webkit-tap-highlight-color", "rgba(0, 0, 0, 0)", null)
        }
        if (e) {
            i.style.overflow = e
        }
        return i
    }, createDiv: function () {
        var e = document.createElement("div");
        e.style.position = "absolute";
        e.style.msTouchAction = "none";
        return e
    }, createCanvas: function () {
        var e = document.createElement("canvas");
        e.style.position = "absolute";
        e.style.msTouchAction = "none";
        return e
    }, setCanvas: function (e, t, i, n, r) {
        if (arguments.length === 2) {
            i = t.y;
            n = t.width;
            r = t.height;
            t = t.x
        }
        e.style.left = t + "px";
        e.style.top = i + "px";
        e.setAttribute("width", n);
        e.setAttribute("height", r);
        e._viewRect = {x: t, y: i, width: n, height: r};
        var a = e.getContext("2d");
        if (a.shadowBlur !== 0) {
            a.shadowOffsetX = 0;
            a.shadowOffsetY = 0;
            a.shadowBlur = 0;
            a.shadowColor = "rgba(0,0,0,0.0)"
        }
        a.clearRect(0, 0, n, r);
        a.translate(-t, -i);
        return a
    }, setImg: function (e, t, i) {
        e.setAttribute("src", t);
        e.style.left = i.x + "px";
        e.style.top = i.y + "px";
        e.style.width = i.width + "px";
        e.style.height = i.height + "px";
        e._viewRect = r.clone(i)
    }, setDiv: function (e, t, i, n, a) {
        n = r.num(n) ? n : 0;
        e.style.left = t.x - n + "px";
        e.style.top = t.y - n + "px";
        e.style.width = t.width + "px";
        e.style.height = t.height + "px";
        e._viewRect = r.clone(t);
        if (i) {
            e.style.backgroundColor = i
        } else {
            e.style.backgroundColor = ""
        }
        if (n > 0) {
            e.style.border = n + "px " + a + " solid"
        } else {
            e.style.border = ""
        }
    }, addEventListener: function (e, t, i, n) {
        var r = "_" + e + "_";
        if (n[r]) {
            return
        }
        var a = function (e) {
            arguments.callee.instance[arguments.callee.method](e)
        };
        a.method = t;
        a.instance = n;
        n[r] = a;
        i.addEventListener(e, a, false)
    }, removeEventListener: function (e, t, i) {
        var n = "_" + e + "_";
        var r = i[n];
        if (r) {
            t.removeEventListener(e, r, false);
            delete i[n]
        }
    }, isValidEvent: function (e, t) {
        if (!t) {
            return false
        }
        if (t.target === e) {
            if (o.isFirefox) {
                if (e.clientHeight < e.scrollHeight && t.layerX < 25) {
                    return false
                }
                if (e.clientWidth < e.scrollWidth && t.layerY < 25) {
                    return false
                }
            } else {
                if (t.offsetX > e.clientWidth || t.offsetY > e.clientHeight) {
                    return false
                }
            }
        }
        return true
    }, getLogicalPoint: function (e, t, i, n) {
        i = i ? i : 1;
        var r;
        var a = e.getBoundingClientRect();
        if (o.isTouchable && t.changedTouches && t.changedTouches.length > 0) {
            var s = t.changedTouches[0];
            var A = o.isAndroid ? 0 : p.scrollLeft();
            var l = o.isAndroid ? 0 : p.scrollTop();
            r = {x: (s.clientX + e.scrollLeft - a.left - A) / i, y: (s.clientY + e.scrollTop - a.top - l) / i}
        } else {
            if (!f.isValidEvent(e, t)) {
                return null
            }
            r = {x: (t.clientX - a.left + e.scrollLeft) / i, y: (t.clientY - a.top + e.scrollTop) / i}
        }
        return r
    }, handle_mousedown: function (t, i) {
        if (f.target) {
            f.handle_mouseup(i)
        }
        e.addEventListener("mousemove", f.handle_mousemove, false);
        e.addEventListener("mouseup", f.handle_mouseup, false);
        f.target = t
    }, handle_mousemove: function (e) {
        if (f.target.handle_mousemove) {
            f.target.handle_mousemove(e)
        }
        if (f.target.handleMouseMove) {
            f.target.handleMouseMove(e)
        }
    }, handle_mouseup: function (t) {
        if (f.target.handle_mouseup) {
            f.target.handle_mouseup(t)
        }
        if (f.target.handleMouseUp) {
            f.target.handleMouseUp(t)
        }
        e.removeEventListener("mousemove", f.handle_mousemove, false);
        e.removeEventListener("mouseup", f.handle_mouseup, false);
        delete f.target
    }, getClientPoint: function (e) {
        return{x: e.clientX, y: e.clientY}
    }, windowWidth: function () {
        if (typeof e.innerWidth === "number") {
            return e.innerWidth
        }
        if (document.documentElement && document.documentElement.clientWidth) {
            return document.documentElement.clientWidth
        }
        if (document.body && document.body.clientWidth) {
            return document.body.clientWidth
        }
        return 0
    }, windowHeight: function () {
        if (typeof e.innerHeight === "number") {
            return e.innerHeight
        }
        if (document.documentElement && document.documentElement.clientHeight) {
            return document.documentElement.clientHeight
        }
        if (document.body && document.body.clientHeight) {
            return document.body.clientHeight
        }
        return 0
    }};
    r.html = f;
    var c = {cache: {}, g: document.createElement("canvas").getContext("2d"), getTextSize: function (e, t) {
        c.g.font = e ? e : x.FONT;
        var i = c.cache[c.g.font];
        if (!i) {
            i = c.g.measureText("e").width * 2 + 4;
            c.cache[c.g.font] = i
        }
        return{width: c.g.measureText(t).width + 4, height: i}
    }, drawText: function (e, i, n, r, a) {
        if (!r) {
            r = x.FONT
        }
        e.font = r;
        e.fillStyle = a;
        e.textAlign = "center";
        e.textBaseline = "middle";
        var s, A;
        if (!n) {
            s = 0;
            A = 0
        } else if (n.width === t) {
            s = n.x;
            A = n.y
        } else {
            s = n.x + n.width / 2;
            A = n.y + n.height / 2
        }
        if (o.isOpera) {
            A -= 2
        }
        e.fillText(i, s, A)
    }, drawArc: function (e, t, i, n, r, a, o, s) {
        var A;
        var l;
        var h;
        var u;
        var f;
        var c;
        var d;
        var g;
        var _;
        var m;
        var v;
        if (Math.abs(r) > 2 * Math.PI) {
            r = 2 * Math.PI
        }
        f = Math.ceil(Math.abs(r) / (Math.PI / 4));
        A = r / f;
        l = -A;
        h = -n;
        if (f > 0) {
            c = t + Math.cos(n) * a;
            d = i + Math.sin(-n) * o;
            if (s) {
                e.lineTo(c, d)
            } else {
                e.moveTo(c, d)
            }
            for (var p = 0; p < f; p++) {
                h += l;
                u = h - l / 2;
                g = t + Math.cos(h) * a;
                _ = i + Math.sin(h) * o;
                m = t + Math.cos(u) * (a / Math.cos(l / 2));
                v = i + Math.sin(u) * (o / Math.cos(l / 2));
                e.quadraticCurveTo(m, v, g, _)
            }
        }
    }, dashedLine: function (e, t, i, n, r, a, o) {
        var s = a - n;
        var A = o - r;
        var l = Math.sqrt(s * s + A * A);
        if (l == 0) {
            return
        }
        s /= l;
        A /= l;
        var h = l;
        var u = -i.offset;
        var f = i.drawing;
        var c = i.patternIndex;
        while (u < h) {
            u += t[c];
            if (u >= h) {
                i.offset = t[c] - (u - h);
                i.patternIndex = c;
                i.drawing = f;
                u = h
            }
            if (f) {
                e.lineTo(n + u * s, r + u * A)
            } else {
                e.moveTo(n + u * s, r + u * A)
            }
            f = !f;
            c = (c + 1) % t.length
        }
    }, drawLinePoints: function (e, t, i, n, r) {
        var a = 0, o, s, A, l, h, u = 0, f, c = t.size();
        if (i && i.length > 0) {
            f = new d(e, i[0], i.length > 1 ? i[1] : i[0])
        } else {
            f = e
        }
        if (n) {
            for (u = 0, h = n.size(); u < h; u++) {
                o = n.get(u);
                if ("moveto" === o && a < c) {
                    s = t.get(a++);
                    f.moveTo(s.x, s.y)
                } else if ("lineto" === o && a < c) {
                    s = t.get(a++);
                    f.lineTo(s.x, s.y)
                } else if ("cubicto" === o && a < c - 2) {
                    s = t.get(a++);
                    A = t.get(a++);
                    l = t.get(a++);
                    f.bezierCurveTo(s.x, s.y, A.x, A.y, l.x, l.y)
                } else if ("quadto" === o && a < c - 1) {
                    s = t.get(a++);
                    A = t.get(a++);
                    f.quadraticCurveTo(s.x, s.y, A.x, A.y)
                } else {
                    throw"Can not resolve segment '" + o + "'"
                }
            }
        } else {
            this._drawLine(t, f)
        }
        if (r) {
            f.closePath()
        }
    }, _drawLine: function (e, t) {
        var i = 0, n, r, a, o, s, A = e.size();
        n = e.get(0);
        t.moveTo(n.x, n.y);
        for (i = 1; i < A; i++) {
            s = e.get(i);
            if (s.size) {
                o = s.size();
                if (o === 2) {
                    n = s.get(0);
                    r = s.get(1);
                    t.quadraticCurveTo(n.x, n.y, r.x, r.y)
                } else if (o === 3) {
                    n = s.get(0);
                    r = s.get(1);
                    a = s.get(2);
                    t.bezierCurveTo(n.x, n.y, r.x, r.y, a.x, a.y)
                }
            } else {
                t.lineTo(s.x, s.y)
            }
        }
    }, drawRoundRect: function (e, t, i, n, r, a, o, s, A) {
        if (arguments.length === 6) {
            o = a;
            s = a;
            A = a
        }
        var l = t + n;
        var h = i + r;
        var u = n < r ? n * 2 : r * 2;
        a = a < u ? a : u;
        o = o < u ? o : u;
        s = s < u ? s : u;
        A = A < u ? A : u;
        var f = A * .292893218813453;
        var c = A * .585786437626905;
        e.moveTo(l, h - A);
        e.quadraticCurveTo(l, h - c, l - f, h - f);
        e.quadraticCurveTo(l - c, h, l - A, h);
        f = s * .292893218813453;
        c = s * .585786437626905;
        e.lineTo(t + s, h);
        e.quadraticCurveTo(t + c, h, t + f, h - f);
        e.quadraticCurveTo(t, h - c, t, h - s);
        f = a * .292893218813453;
        c = a * .585786437626905;
        e.lineTo(t, i + a);
        e.quadraticCurveTo(t, i + c, t + f, i + f);
        e.quadraticCurveTo(t + c, i, t + a, i);
        f = o * .292893218813453;
        c = o * .585786437626905;
        e.lineTo(l - o, i);
        e.quadraticCurveTo(l - c, i, l - f, i + f);
        e.quadraticCurveTo(l, i + c, l, i + o);
        e.lineTo(l, h - A)
    }, drawVector: function (e, t, i, n, r, a, o) {
        if (arguments.length === 4) {
            r = n.y;
            a = n.width;
            o = n.height;
            n = n.x
        }
        var s = c["_" + t];
        if (s) {
            e.beginPath();
            if (i && i.length > 0) {
                e = new d(e, i[0], i.length > 1 ? i[1] : i[0])
            }
            s(e, n, r, a, o)
        }
    }, _rectangle: function (e, t, i, n, r) {
        e.rect(t, i, n, r)
    }, _circle: function (e, t, i, n, r) {
        var a = t + n / 2, o = i + r / 2, s = Math.min(n, r) / 2;
        if (e instanceof d) {
            c.drawArc(e, a, o, 0, Math.PI * 2, s, s, false)
        } else {
            e.arc(a, o, s, 0, Math.PI * 2, true)
        }
    }, _oval: function (e, t, i, n, r) {
        if (e instanceof d) {
            c.drawArc(e, t + n / 2, i + r / 2, 0, Math.PI * 2, n / 2, r / 2, false)
        } else {
            var a = .5522848, o = n / 2 * a, s = r / 2 * a, A = t + n, l = i + r, h = t + n / 2, u = i + r / 2;
            e.moveTo(t, u);
            e.bezierCurveTo(t, u - s, h - o, i, h, i);
            e.bezierCurveTo(h + o, i, A, u - s, A, u);
            e.bezierCurveTo(A, u + s, h + o, l, h, l);
            e.bezierCurveTo(h - o, l, t, u + s, t, u)
        }
    }, _roundrect: function (e, t, i, n, r) {
        c.drawRoundRect(e, t, i, n, r, Math.min(Math.min(n, r) / 4, 10))
    }, _star: function (e, t, i, n, r) {
        var a = n * 2;
        var o = r * 2;
        var s = t + n / 2;
        var A = i + r / 2;
        e.moveTo(s - a / 4, A - o / 12);
        e.lineTo(t + n * .306, i + r * .579);
        e.lineTo(s - a / 6, A + o / 4);
        e.lineTo(t + n / 2, i + r * .733);
        e.lineTo(s + a / 6, A + o / 4);
        e.lineTo(t + n * .693, i + r * .579);
        e.lineTo(s + a / 4, A - o / 12);
        e.lineTo(t + n * .611, i + r * .332);
        e.lineTo(s + 0, A - o / 4);
        e.lineTo(t + n * .388, i + r * .332);
        e.closePath()
    }, _triangle: function (e, t, i, n, r) {
        e.moveTo(t + n / 2, i);
        e.lineTo(t + n, i + r);
        e.lineTo(t, i + r);
        e.closePath()
    }, _hexagon: function (e, t, i, n, r) {
        e.moveTo(t, i + r / 2);
        e.lineTo(t + n / 4, i + r);
        e.lineTo(t + n * 3 / 4, +i + r);
        e.lineTo(t + n, i + r / 2);
        e.lineTo(t + n * 3 / 4, i);
        e.lineTo(t + n / 4, i);
        e.closePath()
    }, _pentagon: function (e, t, i, n, r) {
        var a = n * 2;
        var o = r * 2;
        var s = t + n / 2;
        var A = i + r / 2;
        e.moveTo(s - a / 4, A - o / 12);
        e.lineTo(s - a / 6, A + o / 4);
        e.lineTo(s + a / 6, A + o / 4);
        e.lineTo(s + a / 4, A - o / 12);
        e.lineTo(s + 0, A - o / 4);
        e.closePath()
    }, _diamond: function (e, t, i, n, r) {
        e.moveTo(t + n / 2, i);
        e.lineTo(t, i + r / 2);
        e.lineTo(t + n / 2, i + r);
        e.lineTo(t + n, i + r / 2);
        e.closePath()
    }, fill: function (e, t, i, n, r, a, o, s) {
        var A = c[i];
        if (A) {
            if (arguments.length === 5) {
                e.fillStyle = A(e, t, n, r.x, r.y, r.width, r.height)
            } else {
                e.fillStyle = A(e, t, n, r, a, o, s)
            }
        } else {
            e.fillStyle = t
        }
    }, "linear.southwest": function (e, t, i, n, r, a, o) {
        var s = e.createLinearGradient(n, r + o, n + a, r);
        s.addColorStop(0, i);
        s.addColorStop(1, t);
        return s
    }, "linear.southeast": function (e, t, i, n, r, a, o) {
        var s = e.createLinearGradient(n + a, r + o, n, r);
        s.addColorStop(0, i);
        s.addColorStop(1, t);
        return s
    }, "linear.northwest": function (e, t, i, n, r, a, o) {
        var s = e.createLinearGradient(n + a, r + o, n, r);
        s.addColorStop(0, t);
        s.addColorStop(1, i);
        return s
    }, "linear.northeast": function (e, t, i, n, r, a, o) {
        var s = e.createLinearGradient(n + a, r, n, r + o);
        s.addColorStop(0, i);
        s.addColorStop(1, t);
        return s
    }, "linear.north": function (e, t, i, n, r, a, o) {
        var s = e.createLinearGradient(n, r, n, r + o);
        s.addColorStop(0, i);
        s.addColorStop(1, t);
        return s
    }, "linear.south": function (e, t, i, n, r, a, o) {
        var s = e.createLinearGradient(n, r, n, r + o);
        s.addColorStop(0, t);
        s.addColorStop(1, i);
        return s
    }, "linear.west": function (e, t, i, n, r, a, o) {
        var s = e.createLinearGradient(n, r, n + a, r);
        s.addColorStop(0, i);
        s.addColorStop(1, t);
        return s
    }, "linear.east": function (e, t, i, n, r, a, o) {
        var s = e.createLinearGradient(n, r, n + a, r);
        s.addColorStop(0, t);
        s.addColorStop(1, i);
        return s
    }, "radial.center": function (e, t, i, n, r, a, o) {
        return c.createRadialGradient(e, t, i, n, r, a, o, .5, .5)
    }, "radial.southwest": function (e, t, i, n, r, a, o) {
        return c.createRadialGradient(e, t, i, n, r, a, o, .75, .25)
    }, "radial.southeast": function (e, t, i, n, r, a, o) {
        return c.createRadialGradient(e, t, i, n, r, a, o, .75, .75)
    }, "radial.northwest": function (e, t, i, n, r, a, o) {
        return c.createRadialGradient(e, t, i, n, r, a, o, .25, .25)
    }, "radial.northeast": function (e, t, i, n, r, a, o) {
        return c.createRadialGradient(e, t, i, n, r, a, o, .75, .25)
    }, "radial.north": function (e, t, i, n, r, a, o) {
        return c.createRadialGradient(e, t, i, n, r, a, o, .5, .25)
    }, "radial.south": function (e, t, i, n, r, a, o) {
        return c.createRadialGradient(e, t, i, n, r, a, o, .5, .75)
    }, "radial.west": function (e, t, i, n, r, a, o) {
        return c.createRadialGradient(e, t, i, n, r, a, o, .25, .5)
    }, "radial.east": function (e, t, i, n, r, a, o) {
        return c.createRadialGradient(e, t, i, n, r, a, o, .75, .5)
    }, "spread.horizontal": function (e, t, i, n, r, a, o) {
        var s = e.createLinearGradient(n, r, n + a, r);
        s.addColorStop(0, t);
        s.addColorStop(.5, i);
        s.addColorStop(1, t);
        return s
    }, "spread.vertical": function (e, t, i, n, r, a, o) {
        var s = e.createLinearGradient(n, r, n, r + o);
        s.addColorStop(0, t);
        s.addColorStop(.5, i);
        s.addColorStop(1, t);
        return s
    }, "spread.diagonal": function (e, t, i, n, r, a, o) {
        var s = e.createLinearGradient(n + a, r, n, r + o);
        s.addColorStop(0, t);
        s.addColorStop(.5, i);
        s.addColorStop(1, t);
        return s
    }, "spread.antidiagonal": function (e, t, i, n, r, a, o) {
        var s = e.createLinearGradient(n, r, n + a, r + o);
        s.addColorStop(0, t);
        s.addColorStop(.5, i);
        s.addColorStop(1, t);
        return s
    }, "spread.north": function (e, t, i, n, r, a, o) {
        var s = e.createLinearGradient(n, r - o / 4, n, r + o + o / 4);
        s.addColorStop(0, t);
        s.addColorStop(1 / 3, i);
        s.addColorStop(2 / 3, t);
        s.addColorStop(1, i);
        return s
    }, "spread.south": function (e, t, i, n, r, a, o) {
        var s = e.createLinearGradient(n, r - o / 4, n, r + o + o / 4);
        s.addColorStop(0, i);
        s.addColorStop(1 / 3, t);
        s.addColorStop(2 / 3, i);
        s.addColorStop(1, t);
        return s
    }, "spread.west": function (e, t, i, n, r, a, o) {
        var s = e.createLinearGradient(n - a / 4, r, n + a + a / 4, r);
        s.addColorStop(0, t);
        s.addColorStop(1 / 3, i);
        s.addColorStop(2 / 3, t);
        s.addColorStop(1, i);
        return s
    }, "spread.east": function (e, t, i, n, r, a, o) {
        var s = e.createLinearGradient(n - a / 4, r, n + a + a / 4, r);
        s.addColorStop(0, i);
        s.addColorStop(1 / 3, t);
        s.addColorStop(2 / 3, i);
        s.addColorStop(1, t);
        return s
    }, createRadialGradient: function (e, t, i, n, r, a, o, s, A) {
        var l = e.createRadialGradient(n + a * s, r + o * A, Math.min(a, o) / 24, n + a / 2, r + o / 2, Math.max(a, o) / 2);
        l.addColorStop(0, i);
        l.addColorStop(1, t);
        return l
    }, drawPath: function (e, t, i, n, a, o, s, A) {
        var h = e._element;
        var u = e.getBodyRect();
        if (n) {
            l.addPadding(u, h, i + ".padding", 1)
        }
        var f = r.clone(u);
        var d = h.getStyle(i + ".outline.width");
        if (d > 0) {
            l.grow(f, d / 2, d / 2)
        }
        var _ = e.setShadow(e, t, f);
        var m = h.getStyle(i + ".fill");
        var v;
        if (m) {
            if (e._innerColor && !g.hasDefault(e._element)) {
                v = e._innerColor
            } else {
                v = h.getStyle(i + ".fill.color")
            }
            var p = h.getStyle(i + ".gradient");
            if (p) {
                c.fill(_, v, p, h.getStyle(i + ".gradient.color"), u)
            } else {
                _.fillStyle = v
            }
        }
        var y = h.getStyle(i + ".shape");
        if (m) {
            _.beginPath();
            if (o) {
                c.drawLinePoints(_, o, null, s, A)
            } else {
                c.drawVector(_, y, null, u)
            }
            _.fill()
        }
        if (d > 0) {
            _.lineWidth = d;
            _.lineCap = h.getStyle(i + ".cap");
            _.lineJoin = h.getStyle(i + ".join");
            _.strokeStyle = h.getStyle(i + ".outline.color");
            _.beginPath();
            if (o) {
                c.drawLinePoints(_, o, a, s, A)
            } else {
                c.drawVector(_, y, a, u)
            }
            _.stroke()
        }
        return f
    }, draw3DRect: function (e, t, i, n, r, a, o) {
        if (i === 0) {
            return
        }
        if (arguments.length <= 4) {
            o = n.height;
            a = n.width;
            r = n.y;
            n = n.x
        }
        var s = i > 0;
        i = Math.abs(i);
        var A;
        var l;
        e.lineWidth = 1;
        e.lineCap = "square";
        if (i === 1) {
            A = c.brighter(t);
            l = c.darker(t);
            e.strokeStyle = s ? A : l;
            e.beginPath();
            e.moveTo(n, r);
            e.lineTo(n, r + o);
            e.moveTo(n, r);
            e.lineTo(n + a, r);
            e.closePath();
            e.stroke();
            e.strokeStyle = s ? l : A;
            e.beginPath();
            e.moveTo(n, r + o);
            e.lineTo(n + a, r + o);
            e.moveTo(n + a, r);
            e.lineTo(n + a, r + o);
            e.closePath();
            e.stroke()
        } else {
            var h = i * 2;
            var u = 50 / h;
            for (var f = 0; f < h; f++) {
                A = c.brighter(t, 50 - f * u);
                l = c.darker(t, 50 - f * u);
                n += .5;
                r += .5;
                a -= 1;
                o -= 1;
                e.strokeStyle = s ? A : l;
                e.beginPath();
                e.moveTo(n, r);
                e.lineTo(n, r + o);
                e.moveTo(n, r);
                e.lineTo(n + a, r);
                e.closePath();
                e.stroke();
                e.strokeStyle = s ? l : A;
                e.beginPath();
                e.moveTo(n, r + o);
                e.lineTo(n + a, r + o);
                e.moveTo(n + a, r);
                e.lineTo(n + a, r + o);
                e.closePath();
                e.stroke()
            }
        }
    }, brighter: function (e, t) {
        if (!t) {
            t = 50
        }
        return c.adjustBrightness2(e, t)
    }, darker: function (e, t) {
        if (!t) {
            t = 50
        }
        return c.adjustBrightness2(e, -t)
    }, adjustBrightness2: function (e, t) {
        var n, r, a;
        if (t === 0)return o;
        var o = i.ImageAsset._getValue(e);
        if (t < 0) {
            t = (100 + t) / 100;
            n = Math.ceil((o >> 16 & 255) * t);
            r = Math.ceil((o >> 8 & 255) * t);
            a = Math.ceil((o & 255) * t)
        } else {
            t /= 100;
            n = o >> 16 & 255;
            r = o >> 8 & 255;
            a = o & 255;
            n += (255 - n) * t;
            r += (255 - r) * t;
            a += (255 - a) * t;
            n = Math.min(Math.ceil(n), 255);
            r = Math.min(Math.ceil(r), 255);
            a = Math.min(Math.ceil(a), 255)
        }
        return"rgba(" + n + "," + r + "," + a + ",1)"
    }, getColorArray: function (e) {
        var t = i.ImageAsset._canvas;
        t.width = 3;
        t.height = 3;
        var n = t.getContext("2d");
        n.clearRect(0, 0, 3, 3);
        n.fillStyle = e;
        n.beginPath();
        n.rect(0, 0, 3, 3);
        n.closePath();
        n.fill();
        return n.getImageData(1, 1, 1, 1).data
    }, hit: function (e, t, i, n) {
        if (!e) {
            return false
        }
        var r = e._viewRect;
        if (!r) {
            return false
        }
        t -= r.x;
        i -= r.y;
        if (t < 0 || i < 0 || t >= r.width || i >= r.height) {
            return false
        }
        try {
            var a = e.getContext("2d").getImageData(t, i, 1, 1);
            var o = a.data;
            for (var s = 0, A = o.length; s < A; s += 4) {
                if (o[s + 3] !== 0) {
                    return true
                }
            }
        } catch (l) {
            return true
        }
        return false
    }, intersects: function (e, t) {
        if (!e) {
            return false
        }
        t = l.intersection(t, e._viewRect);
        if (!t) {
            return false
        }
        t.x -= e._viewRect.x;
        t.y -= e._viewRect.y;
        try {
            var i = e.getContext("2d").getImageData(t.x, t.y, t.width, t.height);
            var r = i.data;
            for (var a = 0; n = r.length, a < n; a += 4) {
                if (r[a + 3] !== 0) {
                    return true
                }
            }
        } catch (o) {
        }
        return false
    }};
    r.g = c;
    var d = function (e, t, i) {
        this.g = e;
        this.onLength = t;
        this.offLength = i;
        this.isLine = true;
        this.overflow = 0;
        this.dashLength = t + i;
        this.pen = {x: 0, y: 0}
    };
    r.ext(d, Object, {_curveaccuracy: 6, moveTo: function (e, t) {
        this.pen = {x: e, y: t};
        this.g.moveTo(e, t);
        if (!this.start) {
            this.start = {x: e, y: t}
        }
    }, lineTo: function (e, t) {
        var i = e - this.pen.x, n = t - this.pen.y;
        var r = Math.atan2(n, i);
        var a = Math.cos(r), o = Math.sin(r);
        var s = this.lineLength(this.pen.x, this.pen.y, e, t);
        if (this.overflow) {
            if (this.overflow > s) {
                if (this.isLine)this._lineTo(e, t); else this.moveTo(e, t);
                this.overflow -= s;
                return
            }
            if (this.isLine)this._lineTo(this.pen.x + a * this.overflow, this.pen.y + o * this.overflow); else this.moveTo(this.pen.x + a * this.overflow, this.pen.y + o * this.overflow);
            s -= this.overflow;
            this.overflow = 0;
            this.isLine = !this.isLine;
            if (!s)return
        }
        var A = Math.floor(s / this.dashLength);
        if (A) {
            var l = a * this.onLength, h = o * this.onLength;
            var u = a * this.offLength, f = o * this.offLength;
            for (var c = 0; c < A; c++) {
                if (this.isLine) {
                    this._lineTo(this.pen.x + l, this.pen.y + h);
                    this.moveTo(this.pen.x + u, this.pen.y + f)
                } else {
                    this.moveTo(this.pen.x + u, this.pen.y + f);
                    this._lineTo(this.pen.x + l, this.pen.y + h)
                }
            }
            s -= this.dashLength * A
        }
        if (this.isLine) {
            if (s > this.onLength) {
                this._lineTo(this.pen.x + a * this.onLength, this.pen.y + o * this.onLength);
                this.moveTo(e, t);
                this.overflow = this.offLength - (s - this.onLength);
                this.isLine = false
            } else {
                this._lineTo(e, t);
                if (s == this.onLength) {
                    this.overflow = 0;
                    this.isLine = !this.isLine
                } else {
                    this.overflow = this.onLength - s;
                    this.moveTo(e, t)
                }
            }
        } else {
            if (s > this.offLength) {
                this.moveTo(this.pen.x + a * this.offLength, this.pen.y + o * this.offLength);
                this._lineTo(e, t);
                this.overflow = this.onLength - (s - this.offLength);
                this.isLine = true
            } else {
                this.moveTo(e, t);
                if (s == this.offLength) {
                    this.overflow = 0;
                    this.isLine = !this.isLine
                } else this.overflow = this.offLength - s
            }
        }
    }, quadraticCurveTo: function (e, t, i, n) {
        var r = this.pen.x;
        var a = this.pen.y;
        var o = this.curveLength(r, a, e, t, i, n);
        var s = 0;
        var A = 0;
        var l;
        if (this.overflow) {
            if (this.overflow > o) {
                if (this.isLine)this._curveTo(e, t, i, n); else this.moveTo(i, n);
                this.overflow -= o;
                return
            }
            s = this.overflow / o;
            l = this.curveSliceUpTo(r, a, e, t, i, n, s);
            if (this.isLine)this._curveTo(l[2], l[3], l[4], l[5]); else this.moveTo(l[4], l[5]);
            this.overflow = 0;
            this.isLine = !this.isLine;
            if (!o)return
        }
        var h = o - o * s;
        var u = Math.floor(h / this.dashLength);
        var f = this.onLength / o;
        var c = this.offLength / o;
        if (u) {
            for (var d = 0; d < u; d++) {
                if (this.isLine) {
                    A = s + f;
                    l = this.curveSlice(r, a, e, t, i, n, s, A);
                    this._curveTo(l[2], l[3], l[4], l[5]);
                    s = A;
                    A = s + c;
                    l = this.curveSlice(r, a, e, t, i, n, s, A);
                    this.moveTo(l[4], l[5])
                } else {
                    A = s + c;
                    l = this.curveSlice(r, a, e, t, i, n, s, A);
                    this.moveTo(l[4], l[5]);
                    s = A;
                    A = s + f;
                    l = this.curveSlice(r, a, e, t, i, n, s, A);
                    this._curveTo(l[2], l[3], l[4], l[5])
                }
                s = A
            }
        }
        h = o - o * s;
        if (this.isLine) {
            if (h > this.onLength) {
                A = s + f;
                l = this.curveSlice(r, a, e, t, i, n, s, A);
                this._curveTo(l[2], l[3], l[4], l[5]);
                this.moveTo(i, n);
                this.overflow = this.offLength - (h - this.onLength);
                this.isLine = false
            } else {
                l = this.curveSliceFrom(r, a, e, t, i, n, s);
                this._curveTo(l[2], l[3], l[4], l[5]);
                if (o == this.onLength) {
                    this.overflow = 0;
                    this.isLine = !this.isLine
                } else {
                    this.overflow = this.onLength - h;
                    this.moveTo(i, n)
                }
            }
        } else {
            if (h > this.offLength) {
                A = s + c;
                l = this.curveSlice(r, a, e, t, i, n, s, A);
                this.moveTo(l[4], l[5]);
                l = this.curveSliceFrom(r, a, e, t, i, n, A);
                this._curveTo(l[2], l[3], l[4], l[5]);
                this.overflow = this.onLength - (h - this.offLength);
                this.isLine = true
            } else {
                this.moveTo(i, n);
                if (h == this.offLength) {
                    this.overflow = 0;
                    this.isLine = !this.isLine
                } else this.overflow = this.offLength - h
            }
        }
    }, bezierCurveTo: function (e, t, i, t, n, r) {
        this.pen = {x: n, y: r};
        this.g.bezierCurveTo(e, t, i, t, n, r)
    }, rect: function (e, t, i, n) {
        this.pen = {x: e, y: t};
        this.moveTo(e, t);
        this.lineTo(e, t + n);
        this.lineTo(e + i, t + n);
        this.lineTo(e + i, t);
        this.lineTo(e, t)
    }, closePath: function () {
        this.lineTo(this.start.x, this.start.y)
    }, lineLength: function (e, t, i, n) {
        var r = i - e;
        var a = n - t;
        return Math.sqrt(r * r + a * a)
    }, curveLength: function (e, t, i, n, r, a, o) {
        var s = 0;
        var A = e;
        var l = t;
        var h, u, f, c, d, g, _;
        var m = o > 0 ? o : this._curveaccuracy;
        for (var v = 1; v <= m; v++) {
            f = v / m;
            c = 1 - f;
            d = c * c;
            g = 2 * f * c;
            _ = f * f;
            h = d * e + g * i + _ * r;
            u = d * t + g * n + _ * a;
            s += this.lineLength(A, l, h, u);
            A = h;
            l = u
        }
        return s
    }, curveSlice: function (e, t, i, n, r, a, o, s) {
        if (o == 0)return this.curveSliceUpTo(e, t, i, n, r, a, s); else if (s == 1)return this.curveSliceFrom(e, t, i, n, r, a, o);
        var A = this.curveSliceUpTo(e, t, i, n, r, a, s);
        A.push(o / s);
        return this.curveSliceFrom.apply(this, A)
    }, curveSliceUpTo: function (e, t, i, n, r, a, o) {
        if (o != 1) {
            var s = i + (r - i) * o;
            var A = n + (a - n) * o;
            i = e + (i - e) * o;
            n = t + (n - t) * o;
            r = i + (s - i) * o;
            a = n + (A - n) * o
        }
        return[e, t, i, n, r, a]
    }, curveSliceFrom: function (e, t, i, n, r, a, o) {
        if (o != 1) {
            var s = e + (i - e) * o;
            var A = t + (n - t) * o;
            i = i + (r - i) * o;
            n = n + (a - n) * o;
            e = s + (i - s) * o;
            t = A + (n - A) * o
        }
        return[e, t, i, n, r, a]
    }, _lineTo: function (e, t) {
        if (e == this.pen.x && t == this.pen.y)return;
        this.pen = {x: e, y: t};
        this.g.lineTo(e, t)
    }, _curveTo: function (e, t, i, n) {
        if (e == i && t == n && i == this.pen.x && n == this.pen.y)return;
        this.pen = {x: i, y: n};
        this.g.quadraticCurveTo(e, t, i, n)
    }});
    r.Dashline = d;
    var g = {DEFAULTS: {"default": 1, "default.vector": 1, "vector.default": 1}, VECTORS: {vector: 1, "default.vector": 1, "vector.default": 1}, hasDefault: function (e) {
        if (e instanceof w) {
            var t = e.getStyle("body.type");
            return g.DEFAULTS[t] === 1
        }
        return true
    }, hasVector: function (e) {
        if (e instanceof w) {
            var t = e.getStyle("body.type");
            return g.VECTORS[t] === 1
        }
        return false
    }, hasAgentLinks: function (e) {
        var t = e.getChildrenSize();
        for (var i = 0; i < t; i++) {
            var n = e.getChildAt(i);
            if (n instanceof w && g.hasAgentLinks(n)) {
                return true
            }
        }
        return e.hasAgentLinks()
    }, getParents: function (e, t, i) {
        if (!i) {
            i = true
        }
        var n = new C;
        var r = e.getParent();
        while (r != null && r !== t) {
            n.add(r, 0);
            r = r.getParent()
        }
        if (i && r != null && r === t) {
            n.add(r, 0)
        }
        return n
    }, getSubNetwork: function (e) {
        if (!e) {
            return null
        }
        if (e instanceof i.Link) {
            var t = e.getFromAgent();
            var n = e.getToAgent();
            if (!t || !n) {
                return null
            }
            var r = g.getSubNetwork(t);
            var a = g.getSubNetwork(n);
            if (r === a) {
                return r
            }
            return null
        }
        var o = e.getParent();
        if (!o) {
            return null
        }
        while (o instanceof i.Link && !o.ISubNetwork) {
            o = o.getParent()
        }
        if (o.ISubNetwork) {
            return o
        } else {
            return g.getSubNetwork(o)
        }
    }, figureSameSubNetworkAgent: function (e) {
        if (!e) {
            return null
        }
        var t = e.getParent();
        while (t instanceof I) {
            if (t.getParent()instanceof I) {
                if (!t.isExpanded()) {
                    e = t
                }
                t = t.getParent()
            } else {
                if (t.isExpanded()) {
                    return e
                } else {
                    return t
                }
            }
        }
        return e
    }, figureSpanSubNetworkAgent: function (e, t) {
        if (!e || !t) {
            return null
        }
        var i = g.getSubNetwork(e);
        var n = g.getSubNetwork(t);
        if (i != n) {
            while (n != null && i != n) {
                n = g.getSubNetwork(n)
            }
            if (i === n) {
                return e
            }
            var r = new C;
            r.add(e, 0);
            var a = e.getParent();
            while (a instanceof w) {
                if (!t.isDescendantOf(a)) {
                    r.add(a, 0);
                    a = a.getParent()
                } else {
                    break
                }
            }
            var o = r.size();
            for (var s = 0; s < o; s++) {
                var A = r.get(s);
                if (A instanceof I && !A.isExpanded()) {
                    return A
                }
                if (A.ISubNetwork) {
                    return A
                }
            }
            return e
        }
        return e
    }, figureFromAgent: function (e) {
        if (e.isLooped()) {
            return e.getFromNode()
        }
        var t = g.figureSameSubNetworkAgent(e.getFromNode());
        var i = g.figureSameSubNetworkAgent(e.getToNode());
        if (t === i) {
            return e.getFromNode()
        }
        return g.figureSpanSubNetworkAgent(t, i)
    }, figureToAgent: function (e) {
        if (e.isLooped()) {
            return e.getToNode()
        }
        var t = g.figureSameSubNetworkAgent(e.getFromNode());
        var i = g.figureSameSubNetworkAgent(e.getToNode());
        if (t === i) {
            return e.getToNode()
        }
        return g.figureSpanSubNetworkAgent(i, t)
    }, getBundleLinks: function (e, t) {
        if (!e || !t) {
            return null
        }
        var i;
        var n;
        var r;
        var a;
        if (e === t) {
            a = e.getLoopedLinks();
            if (a) {
                a = new C(a)
            } else {
                return null
            }
        } else {
            var o = e.getAgentLinks();
            var s = t.getAgentLinks();
            if (!o || !s) {
                return null
            }
            n = o.size();
            for (i = 0; i < n; i++) {
                r = o.get(i);
                if (s.contains(r)) {
                    if (!a) {
                        a = new C
                    }
                    a.add(r)
                }
            }
        }
        if (a != null) {
            for (i = 0; i < a.size(); i++) {
                r = a.get(i);
                if (!r.getStyle("link.bundle.enable")) {
                    r._setBundleLinks(null);
                    a.removeAt(i);
                    i--
                }
            }
        }
        return a
    }, resetBundleLinks: function (e, t) {
        var n = g.getBundleLinks(e, t);
        if (!n || n.size() === 0) {
            return
        }
        var r = null;
        if (n.size() === 1) {
            r = n.get(0);
            r._setBundleLinks(null);
            return
        }
        var a;
        var o;
        var s = new C;
        for (a = 0; a < n.size(); a++) {
            r = n.get(a);
            o = r.getStyle("link.bundle.id");
            if (s.indexOf(o) < 0) {
                s.add(o)
            }
        }
        s.sort();
        var A;
        var l = new C;
        var h;
        for (h = 0; h < s.size(); h++) {
            o = s.get(h);
            var u = new C;
            for (a = 0; a < n.size(); a++) {
                r = n.get(a);
                if (o === r.getStyle("link.bundle.id")) {
                    u.add(r)
                }
            }
            A = new i.BundleLinks(u, l);
            l.add(A)
        }
        for (h = 0; h < l.size(); h++) {
            A = l.get(h);
            for (a = 0; a < A.getLinks().size(); a++) {
                r = A.getLinks().get(a);
                r._setBundleLinks(A)
            }
        }
    }, moveElements: function (e, t, i, n) {
        var r = g.filterMovingElements(e, n);
        var a = r.size();
        for (var o = 0; o < a; o++) {
            r.get(o).translate(t, i)
        }
    }, filterMovingElements: function (e, t) {
        var n = new C;
        var r = e.size();
        for (var a = 0; a < r; a++) {
            var o = e.get(a);
            if (!(o instanceof w)) {
                continue
            }
            if (t && !t(o)) {
                continue
            }
            var s = true;
            var A = n.toArray();
            for (var l = 0; l < A.length; l++) {
                var h = A[l];
                if (s && h instanceof i.Follower && o instanceof i.Follower && o.isLoopedHostOn(h)) {
                    s = false
                } else if (h instanceof i.Follower && h.isHostOn(o)) {
                    n.remove(h)
                } else if (s && o instanceof i.Follower && h instanceof w && o.isHostOn(h)) {
                    s = false
                } else if (g.isDescendantOfGroup(h, o)) {
                    n.remove(h)
                } else if (s && g.isDescendantOfGroup(o, h)) {
                    s = false
                }
            }
            if (s) {
                n.add(o)
            }
        }
        return n
    }, isDescendantOfGroup: function (e, t) {
        if (!e || !(t instanceof I)) {
            return false
        }
        if (!t.hasChildren()) {
            return false
        }
        e = e.getParent();
        while (e instanceof I) {
            if (e === t) {
                return true
            } else {
                e = e.getParent()
            }
        }
        return false
    }};
    r.element = g;
    var _ = {between: function (e, t, i) {
        if (i >= e && i <= t) {
            return true
        }
        if (i >= t && i <= e) {
            return true
        }
        return false
    }, considerEast: function (e, t, i) {
        if (!t) {
            return true
        }
        if (_.between(t.x, i.x, e.x)) {
            return i.x > t.x
        } else {
            return Math.abs(t.x - e.x) > Math.abs(i.x - e.x)
        }
    }, considerWest: function (e, t, i) {
        if (!t) {
            return true
        }
        if (_.between(t.x, i.x, e.x)) {
            return i.x < t.x
        } else {
            return Math.abs(t.x - e.x) > Math.abs(i.x - e.x)
        }
    }, considerNorth: function (e, t, i) {
        if (!t) {
            return true
        }
        if (_.between(t.y, i.y, e.y)) {
            return i.y < t.y
        } else {
            return Math.abs(t.y - e.y) > Math.abs(i.y - e.y)
        }
    }, considerSouth: function (e, t, i) {
        if (!t) {
            return true
        }
        if (_.between(t.y, i.y, e.y)) {
            return i.y > t.y
        } else {
            return Math.abs(t.y - e.y) > Math.abs(i.y - e.y)
        }
    }, getHorizontalPoint: function (e, t, i) {
        if (_.between(t.x, i.x, e.x)) {
            return{x: e.x, y: t.y}
        } else {
            if (Math.abs(e.x - t.x) < Math.abs(e.x - i.x)) {
                return{x: t.x, y: t.y}
            } else {
                return{x: i.x, y: i.y}
            }
        }
    }, getVerticalPoint: function (e, t, i) {
        if (_.between(t.y, i.y, e.y)) {
            return{x: t.x, y: e.y}
        } else {
            if (Math.abs(e.y - t.y) < Math.abs(e.y - i.y)) {
                return{x: t.x, y: t.y}
            } else {
                return{x: i.x, y: i.y}
            }
        }
    }, getPoint: function (e, t, i, n, r) {
        var a = Math.abs(n.x - i.x) > Math.abs(n.y - i.y);
        if ("south" === r) {
            if (a && _.considerSouth(t, e, i)) {
                return _.getHorizontalPoint(t, i, n)
            }
            return null
        } else if ("north" === r) {
            if (a && _.considerNorth(t, e, i)) {
                return _.getHorizontalPoint(t, i, n)
            }
            return null
        } else if ("west" === r) {
            if (!a && _.considerWest(t, e, i)) {
                return _.getVerticalPoint(t, i, n)
            }
            return null
        } else if ("east" === r) {
            if (!a && _.considerEast(t, e, i)) {
                return _.getVerticalPoint(t, i, n)
            }
            return null
        } else if ("nearby" === r) {
            var o;
            if (a) {
                o = _.getHorizontalPoint(t, i, n)
            } else {
                o = _.getVerticalPoint(t, i, n)
            }
            if (!e || l.getDistance(e, t) > l.getDistance(o, t)) {
                return o
            }
            return null
        }
        return null
    }, getBusPoint: function (e, t, i) {
        var n;
        var r = e.size();
        if (r > 0) {
            var a = e.get(0);
            for (var o = 1; o < r; o++) {
                var s = e.get(o);
                var A = _.getPoint(n, t, a, s, i);
                if (A) {
                    n = A
                }
                a = s
            }
            if (!n) {
                n = {x: a.x, y: a.y}
            }
        }
        return n
    }};
    r.bus = _;
    var m = {createFromPoint: function (e) {
        var t = e._element;
        if (!t.getFromAgent()) {
            return{x: 0, y: 0}
        }
        var n = t.getStyle("link.from.position");
        var a = t.getStyle("link.from.xoffset");
        var o = t.getStyle("link.from.yoffset");
        var s;
        if (!r.isCalculatingBus) {
            r.isCalculatingBus = true;
            if (t.getFromAgent()instanceof i.Bus) {
                var A = t.getFromAgent();
                if (g.hasVector(A)) {
                    var h = A.getStyle("vector.shape");
                    if (h === "oval") {
                        s = l.getEllipsePoint(A.getRect(), m.createToPoint(e))
                    } else if (h === "circle") {
                        s = l.getEllipsePoint(l.getCircleRect(A.getRect()), m.createToPoint(e))
                    } else if (h === "rectangle" || h === "roundrect") {
                        var u = new C;
                        u.add({x: A.x, y: A.y});
                        u.add({x: A.x + A.width, y: A.y});
                        u.add({x: A.x + A.width, y: A.y + A.height});
                        u.add({x: A.x, y: A.y + A.height});
                        u.add({x: A.x, y: A.y});
                        s = _.getBusPoint(u, m.createToPoint(e), A.getStyle("bus.style"))
                    }
                } else {
                    s = _.getBusPoint(A.getPoints(), m.createToPoint(e), A.getStyle("bus.style"))
                }
            }
            r.isCalculatingBus = false
        }
        if (!s) {
            s = e._network.getPosition(n, t.getFromAgent(), null, a, o)
        } else {
            s.x += a;
            s.y += o
        }
        return s
    }, createToPoint: function (e) {
        var t = e._element;
        if (!t.getToAgent()) {
            return{x: 0, y: 0}
        }
        var n = t.getStyle("link.to.position");
        var a = t.getStyle("link.to.xoffset");
        var o = t.getStyle("link.to.yoffset");
        var s;
        if (!r.isCalculatingBus) {
            r.isCalculatingBus = true;
            if (t.getToAgent()instanceof i.Bus) {
                var A = t.getToAgent();
                if (g.hasVector(A)) {
                    var h = A.getStyle("vector.shape");
                    if (h === "oval") {
                        s = l.getEllipsePoint(A.getRect(), m.createFromPoint(e))
                    } else if (h === "circle") {
                        s = l.getEllipsePoint(l.getCircleRect(A.getRect()), m.createFromPoint(e))
                    } else if (h === "rectangle" || h === "roundrect") {
                        var u = new C;
                        u.add({x: A.x, y: A.y});
                        u.add({x: A.x + A.width, y: A.y});
                        u.add({x: A.x + A.width, y: A.y + A.height});
                        u.add({x: A.x, y: A.y + A.height});
                        u.add({x: A.x, y: A.y});
                        s = _.getBusPoint(u, m.createFromPoint(e), A.getStyle("bus.style"))
                    }
                } else {
                    s = _.getBusPoint(A.getPoints(), m.createFromPoint(e), A.getStyle("bus.style"))
                }
            }
            r.isCalculatingBus = false
        }
        if (!s) {
            s = e._network.getPosition(n, t.getToAgent(), null, a, o)
        } else {
            s.x += a;
            s.y += o
        }
        return s
    }, fillLoopedPoints: function (e, t, i) {
        var n;
        var r = m.getBundleGap(e, true);
        var a = r;
        var o = e.getStyle("link.looped.type");
        var s = e.getStyle("link.looped.direction");
        if (s === "north") {
            if (o === "arc") {
                m.drawArc(t.x + t.width / 2, t.y, 0, Math.PI, r, r, false, i)
            } else {
                n = {x: t.x + t.width / 2, y: t.y};
                i.add({x: n.x + a, y: n.y});
                i.add({x: n.x + a, y: n.y - r});
                i.add({x: n.x - a, y: n.y - r});
                i.add({x: n.x - a, y: n.y})
            }
            return{x: t.x + t.width / 2, y: t.y - r}
        } else if (s === "northeast") {
            if (o === "arc") {
                m.drawArc(t.x + t.width, t.y, Math.PI * 1.5, Math.PI * 1.5, r, r, false, i)
            } else {
                n = {x: t.x + t.width, y: t.y};
                i.add({x: n.x, y: n.y + a});
                i.add({x: n.x + a, y: n.y + a});
                i.add({x: n.x + a, y: n.y - r});
                i.add({x: n.x - a, y: n.y - r});
                i.add({x: n.x - a, y: n.y})
            }
            return{x: t.x + t.width + r * .707, y: t.y - r * .707}
        } else if (s === "east") {
            if (o === "arc") {
                m.drawArc(t.x + t.width, t.y + t.height / 2, Math.PI * 1.5, Math.PI, r, r, false, i)
            } else {
                n = {x: t.x + t.width, y: t.y + t.height / 2};
                i.add({x: n.x, y: n.y - a});
                i.add({x: n.x + r, y: n.y - a});
                i.add({x: n.x + r, y: n.y + a});
                i.add({x: n.x, y: n.y + a})
            }
            return{x: t.x + t.width + r, y: t.y + t.height / 2}
        } else if (s === "southeast") {
            if (o === "arc") {
                m.drawArc(t.x + t.width, t.y + t.height, Math.PI, Math.PI * 1.5, r, r, false, i)
            } else {
                n = {x: t.x + t.width, y: t.y + t.height};
                i.add({x: n.x, y: n.y - a});
                i.add({x: n.x + a, y: n.y - a});
                i.add({x: n.x + a, y: n.y + r});
                i.add({x: n.x - a, y: n.y + r});
                i.add({x: n.x - a, y: n.y})
            }
            return{x: t.x + t.width + r * .707, y: t.y + t.height + r * .707}
        } else if (s === "south") {
            if (o === "arc") {
                m.drawArc(t.x + t.width / 2, t.y + t.height, Math.PI, Math.PI, r, r, false, i)
            } else {
                n = {x: t.x + t.width / 2, y: t.y + t.height};
                i.add({x: n.x - a, y: n.y});
                i.add({x: n.x - a, y: n.y + r});
                i.add({x: n.x + a, y: n.y + r});
                i.add({x: n.x + a, y: n.y})
            }
            return{x: t.x + t.width / 2, y: t.y + t.height + r}
        } else if (s === "southwest") {
            if (o === "arc") {
                m.drawArc(t.x, t.y + t.height, Math.PI * .5, Math.PI * 1.5, r, r, false, i)
            } else {
                n = {x: t.x, y: t.y + t.height};
                i.add({x: n.x, y: n.y - a});
                i.add({x: n.x - a, y: n.y - a});
                i.add({x: n.x - a, y: n.y + r});
                i.add({x: n.x + a, y: n.y + r});
                i.add({x: n.x + a, y: n.y})
            }
            return{x: t.x - r * .707, y: t.y + t.height + r * .707}
        } else if (s === "west") {
            if (o === "arc") {
                m.drawArc(t.x, t.y + t.height / 2, Math.PI * .5, Math.PI, r, r, false, i)
            } else {
                n = {x: t.x, y: t.y + t.height / 2};
                i.add({x: n.x, y: n.y - a});
                i.add({x: n.x - r, y: n.y - a});
                i.add({x: n.x - r, y: n.y + a});
                i.add({x: n.x, y: n.y + a})
            }
            return{x: t.x - r, y: t.y + t.height / 2}
        } else if (s === "northwest") {
            if (o === "arc") {
                m.drawArc(t.x, t.y, 0, Math.PI * 1.5, r, r, false, i)
            } else {
                n = {x: t.x, y: t.y};
                i.add({x: n.x, y: n.y + a});
                i.add({x: n.x - a, y: n.y + a});
                i.add({x: n.x - a, y: n.y - r});
                i.add({x: n.x + a, y: n.y - r});
                i.add({x: n.x + a, y: n.y})
            }
            return{x: t.x - r * .707, y: t.y - r * .707}
        }
        throw"Can not resolve link looped direction '" + s + "'"
    }, drawArc: function (e, t, i, n, r, a, o, s) {
        var A;
        var l;
        var h;
        var u;
        var f;
        var c;
        var d;
        var g;
        var _;
        var m;
        var v;
        if (Math.abs(n) > 2 * Math.PI) {
            n = 2 * Math.PI
        }
        f = Math.ceil(Math.abs(n) / (Math.PI / 4));
        A = n / f;
        l = -A;
        h = -i;
        if (f > 0) {
            c = e + Math.cos(i) * r;
            d = t + Math.sin(-i) * a;
            s.add({x: c, y: d});
            for (var p = 0; p < f; p++) {
                h += l;
                u = h - l / 2;
                g = e + Math.cos(h) * r;
                _ = t + Math.sin(h) * a;
                m = e + Math.cos(u) * (r / Math.cos(l / 2));
                v = t + Math.sin(u) * (a / Math.cos(l / 2));
                var y = new C;
                y.add({x: m, y: v});
                y.add({x: g, y: _});
                s.add(y)
            }
        }
    }, fillBundlePoints: function (e, t, i, n, r) {
        var a = e._element.getBundleCount();
        var o = e._element.getBundleIndex();
        var s = e.getStyle("link.bundle.expanded");
        var A = m.getBundleGap(e, false);
        if (A === 0 && t !== "parallel") {
            r.add(i);
            r.add(n);
            return l.getCenterPoint(i, n)
        } else {
            var h = m.getBundleOffset(e);
            var u = l.getDistance(i, n);
            if (t === "arc" || t === "triangle") {
                r.add({x: 0, y: 0})
            }
            if (t === "arc") {
                r.add({x: 0, y: A})
            }
            r.add({x: h, y: A});
            r.add({x: u - h, y: A});
            if (t === "arc") {
                r.add({x: u, y: A})
            }
            if (t === "arc" || t === "triangle") {
                r.add({x: u, y: 0})
            }
            var f = Math.atan2(n.y - i.y, n.x - i.x);
            var c = l.createMatrix(f, 0, 0);
            for (var d = 0, g = r.size(); d < g; d++) {
                var _ = r.get(d);
                _ = c.transform(_);
                _.x += i.x;
                _.y += i.y;
                r.set(d, _)
            }
            if (t === "arc") {
                var v = l.getCenterPoint(r.get(2), r.get(3));
                var p = new C;
                p.add(r.get(1));
                p.add(r.get(2));
                r.set(1, p);
                p = new C;
                p.add(r.get(4));
                p.add(r.get(5));
                r.set(4, p);
                r.removeAt(5);
                r.removeAt(2);
                return v
            } else {
                return m.calculateCenterPoint(r)
            }
        }
    }, calculateCenterPoint: function (e) {
        var t = e.size();
        if (e == null || t < 1) {
            return{x: 0, y: 0}
        }
        if (t % 2 === 0) {
            var i = t / 2;
            var n = e.get(i - 1);
            var r = e.get(i);
            return{x: (n.x + r.x) / 2, y: (n.y + r.y) / 2}
        } else {
            return e.get((t - 1) / 2)
        }
    }, getBundleOffset: function (e) {
        var t = l.getDistance(e.getFromPoint(), e.getToPoint());
        var i = e.getStyle("link.bundle.offset");
        return t > i * 2 ? i : t / 2
    }, getBundleGap: function (e, t) {
        var i = e._element;
        if (!i.getBundleLinks()) {
            if (t) {
                return i.getStyle("link.looped.gap")
            } else {
                return 0
            }
        }
        var n = t ? "link.looped.gap" : "link.bundle.gap";
        var r = null;
        var a = 0;
        var o = 0;
        var s = i.getBundleLinks().getSiblings();
        var A = 0;
        var l = i.getStyle("link.bundle.independent");
        for (var h = 0, u = s.size(); h < u; h++) {
            var f = s.get(h);
            if (l && f !== i.getBundleLinks()) {
                continue
            }
            for (var c = 0, d = f.getLinks().size(); c < d; c++) {
                var g = f.getLinks().get(c);
                if (l !== g.getStyle("link.bundle.independent")) {
                    continue
                }
                if (e._network.isVisible(g)) {
                    if (r == null) {
                        r = g;
                        A = g.getStyle(n)
                    } else {
                        var _ = g.getStyle(n);
                        o += A / 2 + _ / 2;
                        A = _
                    }
                    if (g === i) {
                        a = o
                    }
                }
            }
        }
        if (t) {
            return o - a + A
        }
        var m = a - o / 2;
        if (r != null && i.getFromAgent() !== r.getFromAgent()) {
            m = -m
        }
        return m
    }, isTargetPriority: function (e, t, i) {
        if (e) {
            if (t.height < i.height) {
                return t.height + i.height < Math.max(t.y + t.height, i.y + i.height) - Math.min(t.y, i.y) + t.height / 2
            }
        } else {
            if (t.width < i.width) {
                return t.width + i.width < Math.max(t.x + t.width, i.x + i.width) - Math.min(t.x, i.x) + t.width / 2
            }
        }
        return true
    }, calculateOrthogonalAndFlexionalLinkPoints: function (e, t, i, n) {
        var r = m.isHorizontal(e, t, i, n);
        var a = new C;
        if (m.isFlexionalTypeLink(e)) {
            m.flexional(r, t, i, a, n.getStyle("link.extend"))
        } else {
            m.orthogonal(e, t, i, a, r, n);
            var o = m.isSplitByPercent(e, n);
            var s = o ? m.calculateSplitValueByPercent(e, r, t, i, n.getStyle("link.split.percent")) : n.getStyle("link.split.value");
            if (s === 0) {
                r = !r
            }
        }
        var A;
        if (a.size() === 0) {
            if (m.isTargetPriority(r, t, i)) {
                A = {x: i.x + i.width / 2, y: i.y + i.height / 2};
                a.add(m.rectanglePerimeter(t, true, A));
                a.add(m.rectanglePerimeter(i, false, a.get(a.size() - 1)))
            } else {
                A = {x: t.x + t.width / 2, y: t.y + t.height / 2};
                A = m.rectanglePerimeter(i, false, A);
                a.add(m.rectanglePerimeter(t, true, A));
                a.add(A)
            }
        } else {
            A = a.get(0);
            a.add(m.rectanglePerimeter(t, true, A), 0);
            a.add(m.rectanglePerimeter(i, false, a.get(a.size() - 1)))
        }
        var l = a.size();
        if (l < 2) {
            return a
        }
        var h = a.get(0);
        for (var u = 1; u < l - 1; u++) {
            var f = a.get(u);
            if (f.x === h.x && f.y === h.y) {
                a.remove(f);
                l--;
                u--
            }
            h = f
        }
        return a
    }, isHorizontal: function (e, t, i, n) {
        if (e) {
            if (e === "flexional.horizontal" || e === "orthogonal.horizontal" || e === "orthogonal.H.V" || e === "extend.left" || e === "extend.right") {
                return true
            } else if (e === "flexional.vertical" || e === "orthogonal.vertical" || e === "orthogonal.V.H" || e === "extend.top" || e === "extend.bottom") {
                return false
            }
        }
        var r = m.calculateXGap(t, i);
        var a = m.calculateYGap(t, i);
        return r >= a
    }, flexional: function (e, t, i, n, r) {
        e ? m.flexionalHorizontal(t, i, n, r) : m.flexionalVertical(t, i, n, r)
    }, isSplitByPercent: function (e, t) {
        return t.getStyle("link.split.by.percent")
    }, isExtendTypeLink: function (e) {
        return e && (e === "extend.top" || e === "extend.left" || e === "extend.bottom" || e === "extend.right")
    }, isFlexionalTypeLink: function (e) {
        return e && (e === "flexional" || e === "flexional.horizontal" || e === "flexional.vertical")
    }, calculateControlPoint: function (e, t, i, n, r) {
        if (e === "orthogonal.H.V" || e === "orthogonal.V.H") {
            return{x: n.x + n.width / 2, y: n.y + n.height / 2}
        }
        var a;
        if (m.isExtendTypeLink(e)) {
            var o = Math.min(i.y, n.y);
            var s = Math.min(i.x, n.x);
            var A = Math.max(i.y + i.height, n.y + n.height);
            var l = Math.max(i.x + i.width, n.x + n.width);
            a = r.getStyle("link.extend");
            if (e === "extend.top") {
                return{x: (s + l) / 2, y: o - a}
            }
            if (e === "extend.left") {
                return{x: s - a, y: (o + A) / 2}
            }
            if (e === "extend.bottom") {
                return{x: (s + l) / 2, y: A + a}
            }
            if (e === "extend.right") {
                return{x: l + a, y: (o + A) / 2}
            }
        }
        var h = m.isSplitByPercent(e, r);
        a = h ? m.calculateSplitValueByPercent(e, t, i, n, r.getStyle("link.split.percent")) : r.getStyle("link.split.value");
        if (a === Number.NEGATIVE_INFINITY || a === Number.POSITIVE_INFINITY) {
            return{x: n.x + n.width / 2, y: n.y + n.height / 2}
        }
        if (a === 0) {
            return{x: i.x + i.width / 2, y: i.y + i.height / 2}
        }
        if (t) {
            var u = i.x + i.x + i.width < n.x + n.x + n.width;
            return{x: m.calculateSplitLocation(u, a, i.x, i.width), y: i.y + i.height / 2}
        }
        var f = i.y + i.y + i.height < n.y + n.y + n.height;
        return{x: i.x + i.width / 2, y: m.calculateSplitLocation(f, a, i.y, i.height)}
    }, calculateGap: function (e, t, i, n) {
        var r = Math.max(t, n) - Math.min(e, i);
        return r - (t - e + n - i)
    }, calculateXGap: function (e, t) {
        var i = Math.max(e.x + e.width, t.x + t.width) - Math.min(e.x, t.x);
        return i - e.width - t.width
    }, calculateYGap: function (e, t) {
        var i = Math.max(e.y + e.height, t.y + t.height) - Math.min(e.y, t.y);
        return i - e.height - t.height
    }, calculateSplitValueByPercent: function (e, t, i, n, r) {
        var a = m.calculateSplitGapByPercent(r, t, i, n);
        return a * r
    }, calculateSplitGapByPercent: function (e, t, i, n, r) {
        if (t) {
            return m._calculateSplitGapByPercent(e, i.x, i.x + i.width, n.x, n.x + n.width)
        } else {
            return m._calculateSplitGapByPercent(e, i.y, i.y + i.height, n.y, n.y + n.height)
        }
    }, _calculateSplitGapByPercent: function (e, t, i, n, r) {
        var a = m.calculateGap(t, i, n, r);
        var o = t + i < n + r;
        if (a > 0) {
            if (e === 1) {
                return a + (r - n) / 2
            }
            if (e >= 0 && e < 1) {
                return a
            }
            if (e < 0) {
                if (o) {
                    return n - t
                }
                return i - r
            }
        }
        if (o && e > 0 || !o && e < 0) {
            return Math.abs(i - r)
        }
        return Math.abs(t - n)
    }, calculateSplitPercentByControlPoint: function (e, t, i, n) {
        if (t) {
            return m.calculateSplitPercent(e.x, i.x, i.x + i.width, n.x, n.x + n.width)
        } else {
            return m.calculateSplitPercent(e.y, i.y, i.y + i.height, n.y, n.y + n.height)
        }
    }, calculateSplitPercent: function (e, t, i, n, r) {
        if (e >= t && e <= i) {
            return 0
        }
        var a = m.calculateGap(t, i, n, r);
        if (a > 0 && e >= n && e <= r) {
            return 1
        }
        var o = t + i < n + r;
        if (a > 0) {
            if (e > Math.min(i, r) && e < Math.max(t, n)) {
                return Math.abs(e - (o ? i : t)) / a
            }
            if (o) {
                if (e < t) {
                    return(e - t) / (n - t)
                }
            } else {
                if (e > i) {
                    return(i - e) / (i - r)
                }
            }
        }
        if (e > i) {
            return(o ? e - i : i - e) / Math.abs(i - r)
        }
        return(o ? e - t : t - e) / Math.abs(t - n)
    }, calculateSplitLocation: function (e, t, i, n) {
        if (e === t > 0) {
            return i + n + Math.abs(t)
        } else {
            return i - Math.abs(t)
        }
    }, calculateAngle: function (e, t) {
        if (e !== 0 && t !== 0) {
            return Math.atan2(e, t)
        }
        if (e === 0) {
            if (t > 0) {
                return 0
            }
            if (t < 0) {
                return Math.PI
            }
        }
        if (e > 0) {
            return Math.PI / 2
        }
        return-Math.PI / 2
    }, drawCorner: function (e, t) {
        var i = e.size();
        if (i < 3) {
            return
        }
        var n = t.getStyle("link.corner");
        if (n === "none") {
            return
        }
        var r = t.getStyle("link.xradius");
        var a = t.getStyle("link.yradius");
        var o, s;
        var A = e.get(0);
        var l = e.get(1);
        var h, u;
        for (var f = 2; f < i; f++) {
            var c = e.get(f);
            var d = l.x - A.x;
            var g = l.y - A.y;
            var _ = c.x - l.x;
            var m = c.y - l.y;
            var v = g === 0;
            if (d === 0 && m === 0 || g === 0 && _ === 0) {
                if (v) {
                    o = Math.min(f === 2 ? Math.abs(d) : Math.abs(d) / 2, r);
                    s = Math.min(f === i - 1 ? Math.abs(m) : Math.abs(m) / 2, a);
                    h = {x: l.x - (d > 0 ? o : -o), y: l.y};
                    u = {x: l.x, y: l.y + (m > 0 ? s : -s)}
                } else {
                    o = Math.min(f === i - 1 ? Math.abs(_) : Math.abs(_) / 2, r);
                    s = Math.min(f === 2 ? Math.abs(g) : Math.abs(g) / 2, a);
                    h = {x: l.x, y: l.y - (g > 0 ? s : -s)};
                    u = {x: l.x + (_ > 0 ? o : -o), y: l.y}
                }
                e.remove(l);
                f--;
                i--;
                if (h.x !== A.x || h.y !== A.y) {
                    e.add(h, f);
                    f++;
                    i++
                }
                if (n === "bevel") {
                    e.add(u, f);
                    f++;
                    i++
                } else if (n === "round") {
                    var p = new C;
                    p.add(l);
                    p.add(u);
                    e.add(p, f);
                    f++;
                    i++
                }
            }
            A = l;
            l = c
        }
        if (u && u.x === l.x && u.y === l.y) {
            e.remove(l)
        }
    }, orthogonal: function (e, t, i, n, r, a) {
        var o = a.getStyle("link.control.point");
        var s = o == null;
        if (o) {
            var A = l.unionRect(t, i);
            if (!l.containsPoint(A, o)) {
                r = m.calculateIsHorizontalByControlPoint(o.x, o.y, A.y, A.x, A.y + A.height, A.x + A.width)
            }
        } else {
            o = m.calculateControlPoint(e, r, t, i, a)
        }
        if (r) {
            m.sideToSide(t, i, o, n, s)
        } else {
            m.topToBottom(t, i, o, n, s)
        }
    }, calculateIsHorizontalByControlPoint: function (e, t, i, n, r, a) {
        if (t < i && i - t > n - e && i - t > e - a || t > r && t - r > n - e && t - r > e - a) {
            return false
        }
        return true
    }, contains: function (e, t, i) {
        return t >= e.x && t <= e.x + e.width && i >= e.y && i <= e.y + e.height
    }, topToBottom: function (e, t, i, n, r) {
        var a = Math.max(e.y, t.y);
        var o = Math.min(e.y + e.height, t.y + t.height);
        var s = i ? i.y : o + (a - o) / 2;
        var A = e.x + e.width / 2;
        var l = t.x + t.width / 2;
        if (!r && i) {
            if (i.x >= e.x && i.x <= e.x + e.width) {
                A = i.x
            }
            if (i.x >= t.x && i.x <= t.x + t.width) {
                l = i.x
            }
        }
        if (!m.contains(t, A, s) && !m.contains(e, A, s)) {
            n.add({x: A, y: s})
        }
        if (!m.contains(t, l, s) && !m.contains(e, l, s)) {
            n.add({x: l, y: s})
        }
        if (n.size() === 0) {
            if (i) {
                if (!m.contains(t, i.x, s) && !m.contains(e, i.x, s)) {
                    n.add({x: i.x, y: s})
                }
            } else {
                var h = Math.max(e.x, t.x);
                var u = Math.min(e.x + e.width, t.x + t.width);
                n.add({x: h + (u - h) / 2, y: s})
            }
        }
    }, sideToSide: function (e, t, i, n, r) {
        var a = Math.max(e.x, t.x);
        var o = Math.min(e.x + e.width, t.x + t.width);
        var s = i ? i.x : o + (a - o) / 2;
        var A = e.y + e.height / 2;
        var l = t.y + t.height / 2;
        if (!r && i) {
            if (i.y >= e.y && i.y <= e.y + e.height) {
                A = i.y
            }
            if (i.y >= t.y && i.y <= t.y + t.height) {
                l = i.y
            }
        }
        if (!m.contains(t, s, A) && !m.contains(e, s, A)) {
            n.add({x: s, y: A})
        }
        if (!m.contains(t, s, l) && !m.contains(e, s, l)) {
            n.add({x: s, y: l})
        }
        if (n.size() === 0) {
            if (i) {
                if (!m.contains(t, s, i.y) && !m.contains(e, s, i.y)) {
                    n.add({x: s, y: i.y})
                }
            } else {
                var h = Math.max(e.y, t.y);
                var u = Math.min(e.y + e.height, t.y + t.height);
                n.add({x: s, y: h + (u - h) / 2})
            }
        }
    }, flexionalHorizontal: function (e, t, i, n) {
        var r = t.x + t.width < e.x;
        var a = e.x + e.width < t.x;
        var o = r ? e.x : e.x + e.width;
        var s = e.y + e.height / 2;
        var A = a ? t.x : t.x + t.width;
        var l = t.y + t.height / 2;
        var h = n;
        var u = r ? -h : h;
        var f = {x: o + u, y: s};
        u = a ? -h : h;
        var c = {x: A + u, y: l};
        if (r === a) {
            var d = r ? Math.min(o, A) - n : Math.max(o, A) + n;
            i.add({x: d, y: s});
            i.add({x: d, y: l})
        } else if (f.x < c.x === r) {
            var g = s + (l - s) / 2;
            i.add(f);
            i.add({x: f.x, y: g});
            i.add({x: c.x, y: g});
            i.add(c)
        } else {
            i.add(f);
            i.add(c)
        }
    }, flexionalVertical: function (e, t, i, n) {
        var r = t.y + t.height < e.y;
        var a = e.y + e.height < t.y;
        var o = e.x + e.width / 2;
        var s = r ? e.y : e.y + e.height;
        var A = t.x + t.width / 2;
        var l = a ? t.y : t.y + t.height;
        var h = n;
        var u = r ? -h : h;
        var f = {x: o, y: s + u};
        u = a ? -h : h;
        var c = {x: A, y: l + u};
        if (r === a) {
            var d = r ? Math.min(s, l) - n : Math.max(s, l) + n;
            i.add({x: o, y: d});
            i.add({x: A, y: d})
        } else if (f.y < c.y === r) {
            var g = o + (A - o) / 2;
            i.add(f);
            i.add({x: g, y: f.y});
            i.add({x: g, y: c.y});
            i.add(c)
        } else {
            i.add(f);
            i.add(c)
        }
    }, rectanglePerimeter: function (e, t, i) {
        var n = e.x + e.width / 2;
        var r = e.y + e.height / 2;
        var a = i.x - n;
        var o = i.y - r;
        var s = Math.atan2(o, a);
        var A = {x: 0, y: 0};
        var l = Math.PI;
        var h = Math.PI / 2;
        var u = h - s;
        var f = Math.atan2(e.height, e.width);
        if (s < -l + f || s > l - f) {
            A.x = e.x;
            A.y = r - e.width * Math.tan(s) / 2
        } else if (s < -f) {
            A.y = e.y;
            A.x = n - e.height * Math.tan(u) / 2
        } else if (s < f) {
            A.x = e.x + e.width;
            A.y = r + e.width * Math.tan(s) / 2
        } else {
            A.y = e.y + e.height;
            A.x = n + e.height * Math.tan(u) / 2
        }
        if (i.x >= e.x && i.x <= e.x + e.width) {
            A.x = i.x
        } else if (i.y >= e.y && i.y <= e.y + e.height) {
            A.y = i.y
        }
        if (i.x < e.x) {
            A.x = e.x
        } else if (i.x > e.x + e.width) {
            A.x = e.x + e.width
        }
        if (i.y < e.y) {
            A.y = e.y
        } else if (i.y > e.y + e.height) {
            A.y = e.y + e.height
        }
        return A
    }, isSplitTypeLink: function (e) {
        return e && (e === "orthogonal" || e === "orthogonal.horizontal" || e === "orthogonal.vertical")
    }, isOrthogonalOrFlexionalLink: function (e) {
        if (e instanceof i.ShapeLink) {
            return false
        }
        if (e.isLooped()) {
            return false
        }
        var t = e.getStyle("link.type");
        return m.isOrthogonalOrFlexionalType(t)
    }, isOrthogonalLink: function (e) {
        if (e instanceof i.ShapeLink) {
            return false
        }
        if (e.isLooped()) {
            return false
        }
        var t = e.getStyle("link.type");
        return m.isOrthogonalType(t)
    }, isOrthogonalOrFlexionalType: function (e) {
        return e === "orthogonal" || e === "orthogonal.horizontal" || e === "orthogonal.H.V" || e === "orthogonal.vertical" || e === "orthogonal.V.H" || e === "extend.top" || e === "extend.left" || e === "extend.bottom" || e === "extend.right" || e === "flexional" || e === "flexional.horizontal" || e === "flexional.vertical"
    }, isOrthogonalType: function (e) {
        return e === "orthogonal" || e === "orthogonal.horizontal" || e === "orthogonal.H.V" || e === "orthogonal.vertical" || e === "orthogonal.V.H" || e === "extend.top" || e === "extend.left" || e === "extend.bottom" || e === "extend.right"
    }, hasControlPoint: function (e) {
        return e === "orthogonal" || e === "orthogonal.horizontal" || e === "orthogonal.vertical" || e === "extend.bottom" || e === "extend.left" || e === "extend.right" || e === "extend.top"
    }, getControlPoint: function (e, t) {
        if (!e) {
            throw"link can't be null"
        }
        var i = e.getStyle("link.type");
        if (!m.hasControlPoint(i)) {
            return null
        }
        var n = e.getStyle("link.control.point");
        if (n) {
            return n
        } else {
            var r, a;
            if (t == null) {
                r = e.getFromAgent().getRect();
                a = e.getToAgent().getRect()
            } else {
                r = m.getLinkSourceBounds(t);
                a = m.getLinkTargetBounds(t)
            }
            if (r == null || a == null) {
                return null
            }
            var o = m.isHorizontal(i, r, a, e);
            return m.calculateControlPoint(e.getStyle("link.type"), o, r, a, e)
        }
    }, getSplitValueByControlPoint: function (e, t, i, n, r) {
        if (t === "extend.top") {
            return Math.min(i.y, n.y) - e.y
        }
        if (t === "extend.left") {
            return Math.min(i.x, n.x) - e.x
        }
        if (t === "extend.bottom") {
            return e.y - Math.max(i.y + i.height, n.y + n.height)
        }
        if (t === "extend.right") {
            return e.x - Math.max(i.x + i.width, n.x + n.width)
        }
        var a;
        if (r) {
            var o = i.x + i.x + i.width < n.x + n.x + n.width;
            a = o ? e.x - i.x + i.width : i.x - e.x;
            if (a > 0) {
                return a
            }
            if (a > -i.width) {
                return 0
            }
            return a + i.width
        }
        var s = i.y + i.y + i.height < n.y + n.y + n.height;
        a = s ? e.y - i.y - i.height : i.y - e.y;
        if (a > 0) {
            return a
        }
        if (a > -i.height) {
            return 0
        }
        return a + i.height
    }, isHorizontalByControlPoint: function (e, t, i, n, r) {
        var a = l.unionRect(i, n);
        if (!l.containsPoint(a, e)) {
            return m.calculateIsHorizontalByControlPoint(e.x, e.y, a.y, a.x, a.y + a.height, a.x + a.width)
        }
        return m.isHorizontal(t, i, n, r)
    }, setParamsByControlPoint: function (e, t, i, n, r) {
        var a = m.isHorizontalByControlPoint(e, n, t, i, r);
        var o = r.getStyle("link.control.point");
        if (o || n === "orthogonal" || n === "orthogonal.horizontal" || n === "orthogonal.vertical") {
            r.setStyle("link.type", a ? "orthogonal.horizontal" : "orthogonal.vertical")
        }
        if (o) {
            r.setStyle("link.control.point", e);
            return
        }
        var s = m.getSplitValueByControlPoint(e, n, t, i, a);
        if (m.isExtendTypeLink(n)) {
            r.setStyle("link.extend", s);
            return
        }
        var A = m.isSplitByPercent(n, r);
        if (!A) {
            r.setStyle("link.split.value", s);
            return
        }
        if (s === 0) {
            r.setStyle("link.split.percent", 0);
            return
        }
        r.setStyle("link.split.percent", m.calculateSplitPercentByControlPoint(e, a, t, i))
    }, getLinkNodeBounds: function (e, t, i, n, r) {
        if (e == null) {
            return null
        }
        var a;
        if (!n) {
            var o = e.getNetwork().getPosition(r, e, null, t, i);
            a = {x: o.x, y: o.y, width: 1, height: 1}
        } else {
            a = e.getBodyRect();
            a.x += t;
            a.y += i
        }
        return a
    }, getLinkSourceBounds: function (e) {
        var t = e._element;
        var i = e.getNetwork().getElementUI(t.getFromAgent());
        if (i == null) {
            return null
        }
        var n = t.getStyle("link.from.position");
        var r = t.getStyle("link.from.xoffset");
        var a = t.getStyle("link.from.yoffset");
        var o = t.getStyle("link.from.at.edge");
        return m.getLinkNodeBounds(i, r, a, o, n)
    }, getLinkTargetBounds: function (e) {
        var t = e._element;
        var i = e.getNetwork().getElementUI(t.getToAgent());
        if (i == null) {
            return null
        }
        var n = t.getStyle("link.to.position");
        var r = t.getStyle("link.to.xoffset");
        var a = t.getStyle("link.to.yoffset");
        var o = t.getStyle("link.to.at.edge");
        return m.getLinkNodeBounds(i, r, a, o, n)
    }, orthogonalAndFlexional: function (e, t) {
        var i = m.getLinkSourceBounds(e);
        if (i == null) {
            return null
        }
        var n = m.getLinkTargetBounds(e);
        if (n == null) {
            return null
        }
        var r = m.calculateOrthogonalAndFlexionalLinkPoints(t, i, n, e._element);
        m.offsetLink(e, r);
        e.setHotSpot(m.calculateCenterPoint(r));
        if (t !== "flexional") {
            m.drawCorner(r, e._element)
        }
        return r
    }, offsetLink: function (e, t) {
        var i = e._element;
        var n = i.isBundleAgent();
        if (n) {
            return
        }
        var a = m.getBundleGap(e, false);
        if (a === 0) {
            return
        }
        var o, s;
        var A = false, l = false;
        var h = t.get(0);
        var u = r.clone(h);
        for (var f = 1, c = t.size(); f < c; f++) {
            var d = t.get(f);
            var g = d.x - u.x;
            var _ = d.y - u.y;
            u = r.clone(d);
            s = m.calculateAngle(g, _);
            if (g === 0) {
                if ((s - o) % Math.PI === 0 && (s - o) % (2 * Math.PI) !== 0) {
                    A = !A;
                    if (A) {
                        _ = -_
                    }
                }
                if ((s - o) % Math.PI !== 0) {
                    h.x += _ < 0 ? a : -a
                }
                d.x += _ < 0 ? a : -a
            } else if (_ === 0) {
                if ((s - o) % Math.PI === 0 && (s - o) % (2 * Math.PI) !== 0) {
                    l = !l;
                    if (l) {
                        g = -g
                    }
                }
                if (!o || (s - o) % Math.PI !== 0) {
                    h.y -= g < 0 ? a : -a
                }
                d.y -= g < 0 ? a : -a
            }
            o = s;
            h = d
        }
    }};
    r.link = m;
    var v = {findMoveToBottomDatas: function (e, t, i) {
        for (var n = 0; n < i.size(); n++) {
            var r = i.get(n);
            if (e.contains(r)) {
                t.add(r)
            }
        }
        for (n = 0; n < i.size(); n++) {
            r = i.get(n);
            v.findMoveToBottomDatas(e, t, r.getChildren())
        }
    }, findMoveToTopDatas: function (e, t, i) {
        for (var n = 0; n < i.size(); n++) {
            var r = i.get(i.size() - 1 - n);
            if (e.contains(r)) {
                t.add(r)
            }
        }
        for (n = 0; n < i.size(); n++) {
            r = i.get(n);
            v.findMoveToTopDatas(e, t, r.getChildren())
        }
    }, findMoveUpDatas: function (e, t, i) {
        var n = false;
        for (var r = 0; r < i.size(); r++) {
            var a = i.get(r);
            if (e.contains(a)) {
                if (n) {
                    t.add(a)
                }
            } else {
                n = true
            }
        }
        for (r = 0; r < i.size(); r++) {
            a = i.get(r);
            v.findMoveUpDatas(e, t, a.getChildren())
        }
    }, findMoveDownDatas: function (e, t, i) {
        var n = false;
        for (var r = 0; r < i.size(); r++) {
            var a = i.get(i.size() - 1 - r);
            if (e.contains(a)) {
                if (n) {
                    t.add(a)
                }
            } else {
                n = true
            }
        }
        for (r = 0; r < i.size(); r++) {
            a = i.get(r);
            v.findMoveDownDatas(e, t, a.getChildren())
        }
    }};
    r.box = v;
    var p = {scrollLeft: function () {
        return p._filterResults(e.pageXOffset ? e.pageXOffset : 0, document.documentElement ? document.documentElement.scrollLeft : 0, document.body ? document.body.scrollLeft : 0)
    }, scrollTop: function () {
        return p._filterResults(e.pageYOffset ? e.pageYOffset : 0, document.documentElement ? document.documentElement.scrollTop : 0, document.body ? document.body.scrollTop : 0)
    }, _filterResults: function (e, t, i) {
        var n = e ? e : 0;
        if (t && (!n || n > t))n = t;
        return i && (!n || n > i) ? i : n
    }, isSingleTouch: function (e) {
        return e.touches && e.touches.length == 1
    }, isMultiTouch: function (e) {
        return e.touches && e.touches.length > 1
    }, getDistance: function (e) {
        if (!p.isMultiTouch(e)) {
            return 0
        }
        var t = e.touches[0];
        var i = e.touches[1];
        return Math.sqrt(Math.pow(t.clientX - i.clientX, 2) + Math.pow(t.clientY - i.clientY, 2))
    }};
    r.touch = p;
    var y = {_string: function (e, t, i, n) {
        var a = i._stringPool.get();
        a.style.whiteSpace = "nowrap";
        a.style.verticalAlign = "middle";
        a.style.padding = "0px 2px";
        r.setText(a, e, n);
        a.setAttribute("title", e);
        t.appendChild(a)
    }, _boolean: function (e, t, i) {
        var n = i._booleanPool.get();
        if (t._editInfo) {
            n._editInfo = t._editInfo;
            delete t._editInfo;
            n.disabled = false
        } else {
            n.disabled = true
        }
        n.keepDefault = true;
        n.type = "checkbox";
        n.style.margin = "0px 2px";
        n.style.verticalAlign = "middle";
        n.checked = e;
        t.appendChild(n);
        if (t.style.textAlign === "") {
            t.style.textAlign = "center"
        }
    }, _color: function (e, t, i) {
        var n = i._colorPool.get();
        n.style.width = "100%";
        n.style.height = "100%";
        n.style.backgroundColor = e;
        n.setAttribute("title", e);
        t.appendChild(n)
    }, render: function (e, t, i, n, r) {
        if (t == null) {
            return
        }
        var a = y["_" + e];
        if (a) {
            a(t, i, n, r)
        } else {
            if (typeof t === "boolean") {
                y._boolean(t, i, n, r)
            } else {
                y._string(t, i, n, r)
            }
        }
    }};
    r.render = y;
    var E = {toolTipDiv: null, getToolTipDiv: function () {
        if (!E.toolTipDiv) {
            E.toolTipDiv = document.createElement("div");
            var e = x;
            var t = E.toolTipDiv.style;
            t.position = "absolute";
            t.color = e.TOOLTIP_COLOR;
            t.background = e.TOOLTIP_BACKGROUND;
            t.fontSize = e.TOOLTIP_FONT_SIZE;
            t.padding = e.TOOLTIP_PADDING;
            t.border = e.TOOLTIP_BORDER;
            t.borderRadius = e.TOOLTIP_BORDER_RADIUS;
            t.boxShadow = e.TOOLTIP_BOX_SHADOW;
            t.zIndex = 1e5;
            if (t.setProperty) {
                t.setProperty("-webkit-box-shadow", e.TOOLTIP_BOX_SHADOW, null)
            }
        }
        return E.toolTipDiv
    }, isToolTipVisible: function () {
        return E.getToolTipDiv().parentNode ? true : false
    }, hideToolTip: function () {
        var e = E.getToolTipDiv();
        if (e.parentNode) {
            e.parentNode.removeChild(e)
        }
    }, showToolTip: function (e, t) {
        if (!e || !t) {
            E.hideToolTip();
            return
        }
        var i, n, r;
        if (e.target) {
            i = e.clientX;
            n = e.clientY
        } else {
            i = e.x;
            n = e.y
        }
        r = E.getToolTipDiv();
        r.innerHTML = t;
        r.style.left = i + x.TOOLTIP_XOFFSET + "px";
        r.style.top = n + x.TOOLTIP_YOFFSET + "px";
        if (!r.parentNode) {
            document.body.appendChild(r)
        }
    }};
    r.popup = E;
    var T = {handleClicked: function (e, t, i) {
        if (i) {
            e.fireInteractionEvent({kind: "clickElement", event: t, element: i})
        } else {
            e.fireInteractionEvent({kind: "clickBackground", event: t})
        }
    }, handleDoubleClicked: function (e, t, n) {
        if (e.isEditingElement()) {
            return
        }
        if (n) {
            e.fireInteractionEvent({kind: "doubleClickElement", event: t, element: n})
        } else {
            e.fireInteractionEvent({kind: "doubleClickBackground", event: t})
        }
        if (n) {
            if (n instanceof i.Link && e.isDoubleClickToLinkBundle()) {
                if (n.ISubNetwork && e.isDoubleClickToSubNetwork() && !r.isCtrlDown(t)) {
                    if (e.isDoubleClickToEmptySubNetwork() || n.getChildrenSize() > 0) {
                        e.setCurrentSubNetwork(n, e.isSubNetworkAnimate(), function () {
                            e.fireInteractionEvent({kind: "enterSubNetwork", event: t, element: n})
                        })
                    }
                } else {
                    if (n.reverseBundleExpanded()) {
                        e.fireInteractionEvent({kind: "bundleLink", event: t, element: n})
                    }
                }
            } else if (n.ISubNetwork && e.isDoubleClickToSubNetwork()) {
                if (e.isDoubleClickToEmptySubNetwork() || n.getChildrenSize() > 0) {
                    e.setCurrentSubNetwork(n, e.isSubNetworkAnimate(), function () {
                        e.fireInteractionEvent({kind: "enterSubNetwork", event: t, element: n})
                    })
                }
            } else if (n instanceof I && e.isDoubleClickToGroupExpand()) {
                n.reverseExpanded();
                e.fireInteractionEvent({kind: "expandGroup", event: t, element: n})
            }
        } else {
            if (e.isDoubleClickToUpSubNetwork()) {
                e.upSubNetwork(e.isSubNetworkAnimate(), function () {
                    e.fireInteractionEvent({kind: "upSubNetwork", event: t})
                })
            }
        }
    }, handleKeyDown: function (e, t) {
        if (r.isCtrlDown(t) && t.keyCode == 65) {
            if (e.isKeyboardSelectEnabled() && e.selectAll().size() > 0) {
                e.fireInteractionEvent({kind: "selectAll"})
            }
            f.preventDefault(t)
        } else if (t.keyCode == 46) {
            if (e.isKeyboardRemoveEnabled() && e.removeSelection()) {
                e.fireInteractionEvent({kind: "removeElement"})
            }
            f.preventDefault(t)
        } else {
            r.showVersion(t)
        }
    }};
    r.interaction = T;
    i.Pool = function (e, t) {
        if (typeof e === "string") {
            this.func = function () {
                return document.createElement(e)
            }
        } else {
            this.func = e
        }
        this.tagName = e;
        if (t != null) {
            this.redundancy = t
        }
    };
    r.ext("twaver.Pool", Object, {redundancy: 2, currentIndex: -1, get: function () {
        this.currentIndex++;
        if (this.currentIndex === this.size()) {
            var e = this.func();
            e._pool = this;
            e.style.margin = "0px";
            e.style.padding = "0px";
            if (!this.list) {
                this.list = new C
            }
            this.list.add(e);
            return e
        }
        return this.list.get(this.currentIndex)
    }, release: function (e) {
        if (this.list && this.list.remove(e) >= 0) {
            delete e._selectData;
            delete e._expandData;
            delete e._checkData;
            delete e._editInfo;
            delete e.keepDefault;
            e.style.margin = "0px";
            e.style.padding = "0px";
            e.style.backgroundColor = "";
            e.removeAttribute("title");
            if (this.tagName === "img" && e.removeAttribute) {
                e.removeAttribute("width");
                e.removeAttribute("height");
                e.removeAttribute("src")
            }
            this.list.add(e);
            this.currentIndex--
        }
    }, reset: function () {
        this.currentIndex = -1
    }, clear: function () {
        if (this.list) {
            while (this.redundancy + this.currentIndex < this.list.size() - 1) {
                delete this.list.removeAt(this.list.size() - 1)._pool
            }
        }
    }, size: function () {
        return this.list ? this.list.size() : 0
    }});
    i.Util = {getVersion: function () {
        return"1.4.0"
    }, registerImage: function (e, t, i, n) {
        r.registerImage(e, t, i, n)
    }, unregisterImage: function (e) {
        r.unregisterImage(e)
    }, getImageAsset: function (e) {
        return r.getImageAsset(e)
    }, validateLicense: function (e) {
        r.validateLicense(e)
    }, moveElements: function (e, t, n, r, a) {
        if (t === 0 && n === 0) {
            return
        }
        if (!e || e.isEmpty()) {
            return
        }
        var o = i.animate.AnimateManager, s, A;
        o.endAnimate();
        e = g.filterMovingElements(e);
        if (r) {
            s = new C;
            A = new C
        }
        e.forEach(function (e) {
            if (e instanceof w) {
                if (r) {
                    s.add(e);
                    A.add({x: e.getX() + t, y: e.getY() + n})
                } else {
                    e.translate(t, n)
                }
            }
        });
        if (r) {
            o.start(new i.animate.AnimateLocation(s, A, a))
        } else {
            if (a) {
                a()
            }
        }
    }, isTypeOf: function (e, t) {
        if (e === t) {
            return true
        }
        var i = e.superClass;
        while (i) {
            if (i === t.prototype) {
                return true
            }
            i = i.constructor.superClass
        }
        return false
    }, setFocus: function (e) {
        if (document.activeElement === e) {
            return
        }
        var t, i;
        var n = document.documentElement;
        var r = document.body;
        var a;
        if (n && (o.isIE || o.isOpera || n.scrollLeft || n.scrollTop)) {
            t = n.scrollLeft;
            i = n.scrollTop;
            a = n
        } else if (r) {
            t = r.scrollLeft;
            i = r.scrollTop;
            a = r
        }
        e.focus();
        if (a) {
            a.scrollLeft = t;
            a.scrollTop = i
        }
    }, isOpera: o.isOpera, isIE: o.isIE, isFirefox: o.isFirefox, isChrome: o.isChrome, isSafari: o.isSafari, isIPhone: o.isIPhone, isIPod: o.isIPod, isIPad: o.isIPad, isAndroid: o.isAndroid, isWebOS: o.isWebOS, isTouchable: o.isTouchable, ext: function (e, t, i) {
        r.ext(e, t, i)
    }, getValue: function (e, t, i) {
        return r.getValue(e, t, i)
    }, setValue: function (e, t, i) {
        r.setValue(e, t, i)
    }, grow: function (e, t, i) {
        l.grow(e, t, i)
    }, containsPoint: function (e, t, i) {
        return l.containsPoint.apply(null, arguments)
    }, intersects: function (e, t) {
        return l.intersects(e, t)
    }, getRect: function (e) {
        return l.getRect(e)
    }, unionRect: function (e, t) {
        return l.unionRect(e, t)
    }, createDiv: function () {
        return f.createDiv()
    }, createCanvas: function () {
        return f.createCanvas()
    }, setCanvas: function (e, t, i, n, r) {
        return f.setCanvas.apply(null, arguments)
    }, drawVector: function (e, t, i, n, r, a, o) {
        c.drawVector.apply(null, arguments)
    }, fill: function (e, t, i, n, r, a, o, s) {
        c.fill.apply(null, arguments)
    }, getClass: function (e) {
        return r.getClass(e)
    }, getAllClassNames: function () {
        var e = [], t;
        for (t in r.classCache) {
            e.push(t)
        }
        return e
    }, newInstance: function (e) {
        return r.newInstance.apply(null, arguments)
    }, isDeserializing: function () {
        return r.isDeserializing
    }, addEventListener: function (e, t, i, n) {
        f.addEventListener(e, t, i, n)
    }, removeEventListener: function (e, t, i) {
        f.removeEventListener(e, t, i)
    }, drawArrow: function (e, t, i, n, r, a, o, s, A, l, h, u) {
        L.drawArrow.apply(null, arguments)
    }, calculatePointAngleAlongLine: function (e, t, i, n, r) {
        return l.calculatePointInfoAlongLineBySegments(e, t, i, n, r)
    }, getSubNetwork: function (e) {
        return g.getSubNetwork(e)
    }, transformPoint: function (e, t, i, n) {
        return l.transformPoint(e, t, i, n)
    }, getToolTipDiv: function () {
        return E.getToolTipDiv()
    }, showToolTip: function (e, t) {
        E.showToolTip(e, t)
    }, hideToolTip: function () {
        E.hideToolTip()
    }, setCSSStyle: function (e, t, i) {
        f.setCSSStyle(e, t, i)
    }, removeCSSStyle: function (e, t) {
        f.removeCSSStyle(e, t)
    }, getCSSStyle: function (e, t) {
        return f.getCSSStyle(e, t)
    }, toDegrees: function (e) {
        return l.toDegrees(e)
    }, toRadians: function (e) {
        return l.toDegrees(e)
    }, getRadiansBetweenLines: function (e, t) {
        return l.getRadiansBetweenLines(e, t)
    }};
    r.ext("twaver.Util", Object, {});
    var C = function () {
        this._as = [];
        if (arguments.length === 1) {
            var e = arguments[0];
            if (e instanceof C) {
                e = e._as
            }
            if (e instanceof Array) {
                var t = e.length;
                for (var i = 0; i < t; i++) {
                    this._as.push(e[i])
                }
            } else if (e != null) {
                this._as.push(e)
            }
        } else if (arguments.length > 1) {
            t = arguments.length;
            for (i = 0; i < t; i++) {
                this._as.push(arguments[i])
            }
        }
    };
    i.List = C;
    r.ext("twaver.List", Object, {size: function () {
        return this._as.length
    }, isEmpty: function () {
        return this._as.length === 0
    }, add: function (e, i) {
        if (i === t) {
            return this._as.push(e)
        } else {
            return this._as.splice(i, 0, e)
        }
    }, addAll: function (e) {
        if (e instanceof C) {
            e = e._as
        }
        if (e instanceof Array) {
            var t = e.length;
            for (var i = 0; i < t; i++) {
                this._as.push(e[i])
            }
        } else {
            this._as.push(e)
        }
    }, get: function (e) {
        return this._as[e]
    }, remove: function (e) {
        var t = this._as.indexOf(e);
        if (t >= 0 && t < this._as.length) {
            this.removeAt(t)
        }
        return t
    }, removeAt: function (e) {
        return this._as.splice(e, 1)[0]
    }, set: function (e, t) {
        return this._as[e] = t
    }, clear: function () {
        return this._as.splice(0, this._as.length)
    }, contains: function (e) {
        return this.indexOf(e) >= 0
    }, indexOf: function (e) {
        return this._as.indexOf(e)
    }, forEach: function (e, t) {
        var i = this._as.length;
        for (var n = 0; n < i; n++) {
            var r = this._as[n];
            if (t) {
                e.call(t, r)
            } else {
                e(r)
            }
        }
    }, forEachReverse: function (e, t) {
        var i = this._as.length;
        for (var n = i - 1; n >= 0; n--) {
            var r = this._as[n];
            if (t) {
                e.call(t, r)
            } else {
                e(r)
            }
        }
    }, toArray: function (e, t) {
        if (e) {
            var i = [];
            var n = this._as.length;
            for (var r = 0; r < n; r++) {
                var a = this._as[r];
                if (t) {
                    if (e.call(t, a)) {
                        i.push(a)
                    }
                } else {
                    if (e(a)) {
                        i.push(a)
                    }
                }
            }
            return i
        } else {
            return this._as.concat()
        }
    }, toList: function (e, t) {
        if (e) {
            var i = new C;
            var n = this._as.length;
            for (var r = 0; r < n; r++) {
                var a = this._as[r];
                if (t) {
                    if (e.call(t, a)) {
                        i.add(a)
                    }
                } else {
                    if (e(a)) {
                        i.add(a)
                    }
                }
            }
            return i
        } else {
            return new C(this)
        }
    }, sort: function (e) {
        if (e) {
            this._as.sort(e)
        } else {
            this._as.sort()
        }
        return this
    }, toString: function () {
        return this._as.toString()
    }});
    var L = {shapeMap: {}, init: function () {
        L.register("arrow.standard", L.createStandardArrow());
        L.register("arrow.delta", L.createDeltaArrow());
        L.register("arrow.diamond", L.createDiamondArrow());
        L.register("arrow.short", L.createShortArrow());
        L.register("arrow.slant", L.createSlantArrow())
    }, createStandardArrow: function () {
        var e = new C;
        e.add({x: -1, y: -5 / 9});
        e.add({x: -9 / 12, y: 0});
        e.add({x: -1, y: 5 / 9});
        e.add({x: 0, y: 0});
        e.add({x: -1, y: -5 / 9});
        return e
    }, createDeltaArrow: function () {
        var e = new C;
        e.add({x: -1, y: -5 / 9});
        e.add({x: -1, y: 5 / 9});
        e.add({x: 0, y: 0});
        e.add({x: -1, y: -5 / 9});
        return e
    }, createDiamondArrow: function () {
        var e = new C;
        e.add({x: -7 / 12, y: 5 / 9});
        e.add({x: -14 / 12, y: 0});
        e.add({x: -7 / 12, y: -5 / 9});
        e.add({x: 0, y: 0});
        e.add({x: -7 / 12, y: 5 / 9});
        return e
    }, createShortArrow: function () {
        var e = new C;
        e.add({x: -8 / 12, y: 6 / 9});
        e.add({x: -5 / 12, y: 0});
        e.add({x: -8 / 12, y: -6 / 9});
        e.add({x: 0, y: 0});
        e.add({x: -8 / 12, y: 6 / 9});
        return e
    }, createSlantArrow: function () {
        var e = new C;
        e.add({x: -1, y: -5 / 9});
        e.add({x: -6.5 / 12, y: 0});
        e.add({x: -9 / 12, y: 4 / 9});
        e.add({x: 0, y: 0});
        e.add({x: -1, y: -5 / 9});
        return e
    }, register: function (e, t) {
        L.shapeMap[e] = t
    }, getShape: function (e) {
        if (e) {
            return L.shapeMap[e]
        }
        throw"shape type can't be null"
    }, getArrowRect: function (e, t, i, n, r, a, o) {
        var s = L.getShape(i);
        if (!s || s.size() <= 0) {
            return null
        }
        var h = l.calculatePointInfoAlongLine(e, t, a, o);
        var u = h.point;
        var f = h.angle;
        var c = s._as;
        var d, g = c.length, _ = new C, m, v;
        v = new A(n, 0, 0, r, u.x, u.y);
        for (d = 0; d < g; d++) {
            _.add(v.transform(c[d]))
        }
        v = l.createMatrix(f + Math.PI, u.x, u.y);
        for (d = 0; d < g; d++) {
            m = _.get(d);
            if (m instanceof C) {
                m = m._as
            }
            if (m instanceof Array) {
                m[0] = v.transform(m[0]);
                m[1] = v.transform(m[1])
            } else {
                _.set(d, v.transform(m))
            }
        }
        return l.getLineRect(_)
    }, drawArrow: function (e, t, i, n, r, a, o, s, A, h, u, f) {
        A = A || 0;
        h = h || 0;
        u = u || 0;
        var c = u >= 0 && f;
        if (!o && !c) {
            return
        }
        var d = L.getShape(a);
        if (!d || d.size() <= 0) {
            return
        }
        var g = l.calculatePointInfoAlongLine(n, r, A, h);
        var _ = g.point;
        var m = g.angle;
        if (o) {
            e.fillStyle = s
        }
        e.beginPath();
        if (c) {
            e.lineWidth = u;
            e.strokeStyle = f
        }
        L._drawArrow(e, d, m, _, t, i);
        if (o) {
            e.fill()
        }
        if (c) {
            e.stroke()
        }
    }, _drawArrow: function (e, t, i, n, r, a) {
        t = t._as;
        var o, s = t.length, h = new C, u, f;
        f = new A(r, 0, 0, a, n.x, n.y);
        for (o = 0; o < s; o++) {
            h.add(f.transform(t[o]))
        }
        h = h._as;
        f = l.createMatrix(i + Math.PI, n.x, n.y);
        var c = h[0];
        c = f.transform(c);
        e.moveTo(c.x, c.y);
        for (o = 1; o < s; o++) {
            u = h[o];
            if (u instanceof C) {
                u = u._as
            }
            if (u instanceof Array) {
                u[0] = f.transform(u[0]);
                u[1] = f.transform(u[1]);
                e.quadraticCurveTo(u[0].x, u[0].y, u[1].x, u[1].y)
            } else {
                u = f.transform(u);
                e.lineTo(u.x, u.y)
            }
        }
    }, drawLinkArrow: function (e, t, i) {
        if (i.size() < 2) {
            return
        }
        if (e._element.getStyle("arrow.from")) {
            L._drawFromArrow(e, t, i)
        }
        if (e._element.getStyle("arrow.to")) {
            L._drawToArrow(e, t, i)
        }
    }, _drawFromArrow: function (e, t, i) {
        var n = e._element;
        var r = n.getStyle("arrow.from.fill");
        var a = n.getStyle("arrow.from.outline.width");
        if (r || a >= 0) {
            var o = n.getStyle("arrow.from.width");
            var s = n.getStyle("arrow.from.height");
            var A = n.getStyle("arrow.from.xoffset");
            if (A > 0 && A < 1) {
                var l;
                if (e.getLineLength) {
                    l = e.getLineLength()
                } else {
                    l = e._element.getLineLength()
                }
                A *= l
            } else if (e.getLineLength) {
                A += L.calculateArrowXOffsetAtEdge(i, e, true)
            }
            var h = n.getStyle("arrow.from.yoffset");
            var u = n.getStyle("arrow.from.shape");
            L.drawArrow(t, o, s, i, true, u, r, n.getStyle("arrow.from.color"), A, h, a, n.getStyle("arrow.from.outline.color"))
        }
    }, _drawToArrow: function (e, t, i) {
        var n = e._element;
        var r = n.getStyle("arrow.to.fill");
        var a = n.getStyle("arrow.to.outline.width");
        if (r || a >= 0) {
            var o = n.getStyle("arrow.to.width");
            var s = n.getStyle("arrow.to.height");
            var A = n.getStyle("arrow.to.xoffset");
            if (A > 0 && A < 1) {
                var l;
                if (e.getLineLength) {
                    l = e.getLineLength()
                } else {
                    l = e._element.getLineLength()
                }
                A *= l
            } else if (e.getLineLength) {
                A += L.calculateArrowXOffsetAtEdge(i, e, false)
            }
            var h = n.getStyle("arrow.to.yoffset");
            var u = n.getStyle("arrow.to.shape");
            L.drawArrow(t, o, s, i, false, u, r, n.getStyle("arrow.to.color"), A, h, a, n.getStyle("arrow.to.outline.color"))
        }
    }, calculateArrowXOffsetAtEdge: function (e, t, i) {
        if (e == null || e.size() < 2) {
            return 0
        }
        var n = t._element;
        var r = i ? n.getStyle("arrow.from.at.edge") : n.getStyle("arrow.to.at.edge");
        if (!r) {
            return 0
        }
        var a = i ? t._network.getElementUI(n.getFromAgent()) : t._network.getElementUI(n.getToAgent());
        if (!a) {
            return 0
        }
        var o = a._bodyRect;
        if (o == null) {
            return 0
        }
        var s = l._getPoint(e.get(i ? 0 : e.size() - 1));
        var A = 0, h = t.getLineLength();
        while (L._containsByInt(o, Math.floor(s.x), Math.floor(s.y), false) && A < h) {
            s = l.calculatePointInfoAlongLine(e, i, A++).point
        }
        return A
    }, _containsByInt: function (e, i, n, r) {
        r = r === t ? true : r;
        if (r) {
            return i >= Math.floor(e.x) && i <= Math.floor(e.x + e.width) && n >= Math.floor(e.y) && n <= Math.floor(e.y + e.height)
        }
        return i > Math.floor(e.x) && i < Math.floor(e.x + e.width) && n > Math.floor(e.y) && n < Math.floor(e.y + e.height)
    }};
    L.init();
    r.arrow = L;
    i.EventDispatcher = function () {
    };
    r.ext("twaver.EventDispatcher", null, {contains: function (e, t) {
        if (this._ls) {
            for (var i = 0, n = this._ls.size(), r; i < n; i++) {
                r = this._ls.get(i);
                if (e === r.l && t === r.s) {
                    return true
                }
            }
        }
        return false
    }, add: function (e, t, i) {
        var n = {l: e, s: t, a: i};
        if (!this._ls) {
            this._ls = new C
        }
        if (this._f) {
            if (!this._addPendings) {
                this._addPendings = new C
            }
            this._addPendings.add(n)
        } else {
            if (n.a) {
                this._ls.add(n, 0)
            } else {
                this._ls.add(n)
            }
        }
    }, remove: function (e, t) {
        if (this._ls) {
            if (this._f) {
                if (!this._removePendings) {
                    this._removePendings = new C
                }
                this._removePendings.add({l: e, s: t})
            } else {
                this._remove(e, t)
            }
        }
    }, _remove: function (e, t) {
        for (var i = 0, n = this._ls.size(), r; i < n; i++) {
            r = this._ls.get(i);
            if (r.l === e && r.s === t) {
                this._ls.removeAt(i);
                return
            }
        }
    }, fire: function (e) {
        if (this._ls) {
            var t, i = this._ls.size(), n;
            this._f = true;
            for (t = 0; t < i; t++) {
                n = this._ls.get(t);
                if (n.s) {
                    n.l.call(n.s, e)
                } else {
                    n.l(e)
                }
            }
            this._f = false;
            if (this._removePendings) {
                i = this._removePendings.size();
                for (t = 0; t < i; t++) {
                    n = this._removePendings.get(t);
                    this._remove(n.l, n.s)
                }
                delete this._removePendings
            }
            if (this._addPendings) {
                i = this._addPendings.size();
                for (t = 0; t < i; t++) {
                    n = this._addPendings.get(t);
                    if (n.a) {
                        this._ls.add(n, 0)
                    } else {
                        this._ls.add(n)
                    }
                }
                delete this._addPendings
            }
        }
    }});
    i.ImageAsset = function (e, t, i, n) {
        this._name = e;
        this._width = i;
        this._height = n;
        if (typeof t === "string") {
            this._src = t
        } else if (typeof t === "function") {
            this._func = t
        } else {
            this._image = t
        }
    };
    r.ext("twaver.ImageAsset", Object, {getName: function () {
        return this._name
    }, getSrc: function () {
        return this._src
    }, getImage: function (e) {
        if (!e || !this._image) {
            return this._image
        }
        if (!this._map) {
            this._map = {}
        }
        var t = this._map[e];
        if (t) {
            return t
        }
        var n = i.ImageAsset._getValue(e);
        t = i.ImageAsset._getImage(this._image, n, this.getWidth(), this.getHeight());
        this._map[e] = t;
        return t
    }, getWidth: function () {
        return this._width
    }, getHeight: function () {
        return this._height
    }, getFunction: function () {
        return this._func
    }});
    i.ImageAsset._canvas = document.createElement("canvas");
    i.ImageAsset._colors = {};
    i.ImageAsset._getValue = function (e) {
        var t = i.ImageAsset._colors[e];
        if (t != null) {
            return t
        }
        var n = i.ImageAsset._canvas;
        n.width = 3;
        n.height = 3;
        var r = n.getContext("2d");
        r.clearRect(0, 0, 3, 3);
        r.fillStyle = e;
        r.beginPath();
        r.rect(0, 0, 3, 3);
        r.closePath();
        r.fill();
        var a = r.getImageData(1, 1, 1, 1).data;
        t = (a[0] << 16) + (a[1] << 8) + a[2];
        i.ImageAsset._colors[e] = t;
        return t
    };
    i.ImageAsset._getImage = function (e, t, i, r) {
        var a = document.createElement("canvas");
        a.width = i;
        a.height = r;
        var o = a.getContext("2d");
        o.drawImage(e, 0, 0);
        try {
            var s = o.getImageData(0, 0, i, r);
            var A = s.data;
            for (var l = 0; n = A.length, l < n; l += 4) {
                var h = A[l + 0];
                var u = A[l + 1];
                var f = A[l + 2];
                var c = h * 77 + u * 151 + f * 28 >> 8;
                c = c << 16 | c << 8 | c;
                c = c & t;
                A[l + 0] = c >> 16 & 255;
                A[l + 1] = c >> 8 & 255;
                A[l + 2] = c & 255
            }
            o.putImageData(s, 0, 0)
        } catch (d) {
            return e
        }
        return a
    };
    var x = {COLORS: ["#6495ED", "#FFFF00", "#00FFFF", "#FF0000", "#7FFF00", "#E0A580", "#5FC0CB", "#FA00F0", "#A1BC50", "#FFD700", "#4169E1", "#E5A5F5", "#1E90FF", "#696969", "#FF6347", "#00BFEF", "#FFD700", "#80E090", "#5F9EA0", "#A000FF", "#7FAF00", "#228BA2", "#FF00FF", "#7FFFD4", "#800000", "#0000CD", "#20B2AA", "#D2691E", "#6495BD", "#DC143C", "#F0A8AF", "#008B8B", "#800080", "#B8860B", "#4B0082", "#00FF00", "#FFA500", "#FF4500", "#FFFF00", "#9ACD32", "#00008B", "#FF1493", "#ADFF2F", "#4682B4", "#00C0B1"], CALL_LATER_DELAY: 17, SCROLL_BAR_WIDTH: 17, SELECT_COLOR: "#C2CFF1", FOCUS_ON_CLICK: true, VIEW_POSITION: "absolute", VIEW_FONT_SIZE: "12px", VIEW_FONT_FAMILY: "arial, tahoma, sans-serif, helvetica", TOOLTIP_BACKGROUND: "lightyellow", TOOLTIP_FONT_SIZE: "12px", TOOLTIP_COLOR: "black", TOOLTIP_PADDING: "4px 8px", TOOLTIP_BORDER: "1px solid gray", TOOLTIP_BORDER_RADIUS: "6px", TOOLTIP_XOFFSET: 12, TOOLTIP_YOFFSET: 12, TOOLTIP_BOX_SHADOW: "0px 0px 3px #AAA", ZOOM_MAX: 5, ZOOM_MIN: .1, ZOOM_INCREMENT: 1.3, ZOOM_ANIMATE: true, COLUMN_INNER_TEXT: true, COLUMN_WIDTH: 80, COLUMN_HORIZONTAL_ALIGN: "", COLUMN_PROPERTY_TYPE: "accessor", COLUMN_VALUE_TYPE: "string", COLUMN_EDITABLE: false, COLUMN_SORTABLE: true, COLUMN_VISIBLE: true, COLUMN_RESIZABLE: true, COLUMN_MOVABLE: true, COLUMN_RENDER_CELL: null, COLUMN_RENDER_HEADER: null, PROPERTY_INNER_TEXT: true, PROPERTY_HORIZONTAL_ALIGN: "", PROPERTY_PROPERTY_TYPE: "accessor", PROPERTY_VALUE_TYPE: "string", PROPERTY_EDITABLE: false, PROPERTY_CATEGORY_NAME: null, PROPERTY_RENDER_NAME: null, PROPERTY_RENDER_VALUE: null, TAB_WIDTH: 100, TAB_CLOSABLE: false, TAB_RESIZABLE: true, TAB_MOVABLE: true, TAB_DISABLED: false, TAB_VISIBLE: true, ACCORDION_EXPAND_ICON: "expand_icon", ACCORDION_COLLAPSE_ICON: "collapse_icon", ACCORDION_TITLE_HEIGHT: 20, ACCORDION_TITLE_BACKGROUND: "#EBEBEB", ACCORDION_BORDER_BOTTOM_COLOR: "lightgray", TITLEPANE_TITLE_HEIGHT: 20, TITLEPANE_TITLE_BACKGROUND: "#DDD", TITLEPANE_TITLE_HORIZONTAL_ALIGN: "left", BORDERPANE_HGAP: 0, BORDERPANE_VGAP: 0, CHARTPANE_TITLE_HEIGHT: 20, CHARTPANE_TITLE_HORIZONTAL_ALIGN: "center", CHARTPANE_LEGEND_ORIENTATION: "bottom", CHARTPANE_LEGEND_WIDTH: 80, LEGENDPANE_ICON_WIDTH: 10, LEGENDPANE_ICON_HEIGHT: 10, LEGENDPANE_ICON_RADIUS: 0, LEGENDPANE_ROW_HEIGHT: 20, LEGENDPANE_ORIENTATION: "horizontal", LEGENDPANE_HIDDEN_COLOR: "#BABBBC", LEGENDPANE_SELECT_BACKGROUND_COLOR: "#00007D", LEGENDPANE_SELECT_FOREGROUND_COLOR: "#FFFFFF", CHART_TOOLTIP_ENABLED: true, CHART_SELECT_TOLERANCE: 0, CHART_XGAP: 6, CHART_YGAP: 6, CHART_XZOOM_ENABLED: true, CHART_YZOOM_ENABLED: true, CHART_XTRANSLATE_ENABLED: true, CHART_YTRANSLATE_ENABLED: true, CHART_DOUBLE_CLICK_TO_RESET: true, CHART_VALUE_VISIBLE: true, CHART_VALUE_FONT: null, CHART_BACKGROUND_VISIBLE: false, CHART_BACKGROUND_FILL: true, CHART_BACKGROUND_FILL_COLOR: "rgba(50,50,50,0.11)", CHART_BACKGROUND_OUTLINE_WIDTH: 1, CHART_BACKGROUND_OUTLINE_COLOR: "rgba(50,50,50,0.11)", CHART_BACKGROUND_GRADIENT: "linear.north", CHART_BACKGROUND_GRADIENT_COLOR: "#FFFFFF", PIECHART_TYPE: "oval", PIECHART_START_ANGLE: 0, PIECHART_SELECT_OFFSET: 5, PIECHART_SHADOW_OFFSET: 1, PIECHART_SHADOW_COLOR: "#C2CFF1", PIECHART_LINE_RATE: .5, PIECHART_DONUT_RATE: .5, PIECHART_VALUE_POSITION: .5, BARCHART_TYPE: "default", BARCHART_UPPER_LIMIT: null, BARCHART_LOWER_LIMIT: 0, BARCHART_XAXIS_LINE_COLOR: "#808080", BARCHART_XAXIS_LINE_WIDTH: 1, BARCHART_XAXIS_TEXT_COLOR: "#000000", BARCHART_XAXIS_TEXT_FONT: null, BARCHART_YAXIS_LINE_COLOR: "#808080", BARCHART_YAXIS_LINE_WIDTH: 1, BARCHART_YAXIS_TEXT_COLOR: "#000000", BARCHART_YAXIS_TEXT_FONT: null, BARCHART_XSCALE_TEXT_FONT: null, BARCHART_XSCALE_TEXT_COLOR: "#000000", BARCHART_XSCALE_TEXT_ORIENTATION: "horizontal", BARCHART_YSCALE_TEXT_VISIBLE: true, BARCHART_YSCALE_TEXT_COLOR: "#000000", BARCHART_YSCALE_TEXT_FONT: null, BARCHART_YSCALE_LINE_COLOR: "#808080", BARCHART_YSCALE_LINE_WIDTH: .3, BARCHART_YSCALE_VALUE_GAP: 0, BARCHART_YSCALE_PIXEL_GAP: 20, BARCHART_YSCALE_MIN_TEXT_VISIBLE: false, LINECHART_INTERRUPTABLE: true, LINECHART_UPPER_LIMIT: null, LINECHART_LOWER_LIMIT: null, LINECHART_XAXIS_LINE_COLOR: "#808080", LINECHART_XAXIS_LINE_WIDTH: 1, LINECHART_XAXIS_TEXT_COLOR: "#000000", LINECHART_XAXIS_TEXT_FONT: null, LINECHART_YAXIS_LINE_COLOR: "#808080", LINECHART_YAXIS_LINE_WIDTH: 1, LINECHART_YAXIS_TEXT_COLOR: "#000000", LINECHART_YAXIS_TEXT_FONT: null, LINECHART_XSCALE_TEXT_FONT: null, LINECHART_XSCALE_TEXT_COLOR: "#000000", LINECHART_XSCALE_TEXT_ORIENTATION: "horizontal", LINECHART_XSCALE_LINE_COLOR: "#808080", LINECHART_XSCALE_LINE_WIDTH: .3, LINECHART_YSCALE_TEXT_VISIBLE: true, LINECHART_YSCALE_TEXT_COLOR: "#000000", LINECHART_YSCALE_TEXT_FONT: null, LINECHART_YSCALE_LINE_COLOR: "#808080", LINECHART_YSCALE_LINE_WIDTH: .3, LINECHART_YSCALE_VALUE_GAP: 0, LINECHART_YSCALE_PIXEL_GAP: 20, LINECHART_YSCALE_MIN_TEXT_VISIBLE: false, BUBBLECHART_UPPER_LIMIT: null, BUBBLECHART_LOWER_LIMIT: null, BUBBLECHART_XAXIS_UPPER_LIMIT: null, BUBBLECHART_XAXIS_LOWER_LIMIT: null, BUBBLECHART_XAXIS_LINE_COLOR: "#808080", BUBBLECHART_XAXIS_LINE_WIDTH: 1, BUBBLECHART_XAXIS_TEXT_COLOR: "#000000", BUBBLECHART_XAXIS_TEXT_FONT: null, BUBBLECHART_YAXIS_LINE_COLOR: "#808080", BUBBLECHART_YAXIS_LINE_WIDTH: 1, BUBBLECHART_YAXIS_TEXT_COLOR: "#000000", BUBBLECHART_YAXIS_TEXT_FONT: null, BUBBLECHART_XSCALE_TEXT_FONT: null, BUBBLECHART_XSCALE_TEXT_COLOR: "#000000", BUBBLECHART_XSCALE_TEXT_ORIENTATION: "horizontal", BUBBLECHART_XSCALE_LINE_COLOR: "#808080", BUBBLECHART_XSCALE_LINE_WIDTH: .3, BUBBLECHART_YSCALE_TEXT_VISIBLE: true, BUBBLECHART_YSCALE_TEXT_COLOR: "#000000", BUBBLECHART_YSCALE_TEXT_FONT: null, BUBBLECHART_YSCALE_LINE_COLOR: "#808080", BUBBLECHART_YSCALE_LINE_WIDTH: .3, BUBBLECHART_YSCALE_VALUE_GAP: 0, BUBBLECHART_YSCALE_PIXEL_GAP: 20, BUBBLECHART_YSCALE_MIN_TEXT_VISIBLE: false, BUBBLECHART_SELECT_SHADOW_COLOR: "#000000", BUBBLECHART_SELECT_SHADOW_OFFSET: 3, RADARCHART_AXIS_TEXT_FONT: null, RADARCHART_AXIS_TEXT_COLOR: "#000000", RADARCHART_AXIS_TEXT_VISIBLE: true, RADARCHART_SCALE_TEXT_FONT: null, RADARCHART_SCALE_TEXT_COLOR: "#000000", RADARCHART_SCALE_TEXT_VISIBLE: true, RADARCHART_AXIS_VISIBLE: true, RADARCHART_AXIS_LINE_COLOR: "#808080", RADARCHART_AXIS_LINE_WIDTH: 3, RADARCHART_AXIS_START_ANGLE: 0, RADARCHART_RING_VISIBLE: true, RADARCHART_RING_TYPE: "line", RADARCHART_RING_LINE_COLOR: "#808080", RADARCHART_RING_LINE_WIDTH: 1, RADARCHART_SCALE_COUNT: 5, RADARCHART_SCALE_MAXVALUE: 1, RADARCHART_SCALE_MINVALUE: 0, RADARCHART_ANCHOR_VISIBLE: true, RADARCHART_AREA_FILL: true, RADARCHART_AREA_FILL_ALPHA: .2, RADARCHART_AREA_SELECT_FILL_ALPHA: .5, DIALCHART_UPPER_LIMIT: 100, DIALCHART_LOWER_LIMIT: 0, DIALCHART_START_ANGLE: 0, DIALCHART_END_ANGLE: 360, DIALCHART_INNER_RADIUS: .8, DIALCHART_COLOR_RANGE_FILL_COLOR: "#808080", DIALCHART_OUTLINE_WIDTH: 0, DIALCHART_OUTLINE_COLOR: "#808080", DIALCHART_SCALE_INSIDE: true, DIALCHART_MAJOR_SCALE_COUNT: 11, DIALCHART_MAJOR_SCALE_LINE_WIDTH: 2, DIALCHART_MAJOR_SCALE_LINE_LENGTH: 8, DIALCHART_MAJOR_SCALE_LINE_COLOR: "#000000", DIALCHART_MINOR_SCALE_COUNT: 4, DIALCHART_MINOR_SCALE_LINE_WIDTH: 1, DIALCHART_MINOR_SCALE_LINE_LENGTH: 4, DIALCHART_MINOR_SCALE_LINE_COLOR: "#000000", DIALCHART_SCALE_TEXT_VISIBLE: true, DIALCHART_SCALE_UPPER_LIMIT_TEXT_VISIBLE: true, DIALCHART_SCALE_LOWER_LIMIT_TEXT_VISIBLE: true, DIALCHART_SCALE_TEXT_FONT: null, DIALCHART_SCALE_TEXT_COLOR: "#000000", DIALCHART_PIVOT_RADIUS: 10, DIALCHART_PIVOT_FILL: true, DIALCHART_PIVOT_FILL_COLOR: "#808080", DIALCHART_PIVOT_OUTLINE_WIDTH: 0, DIALCHART_PIVOT_OUTLINE_COLOR: "#808080", DIALCHART_VALUE_POSITION: .5, DIALCHART_INNER_DARKER_RADIUS: 10, DIALCHART_OUTER_BRIGHTER_RADIUS: 10, DIALCHART_SELECT_SHADOW_COLOR: "#000000", DIALCHART_SELECT_SHADOW_OFFSET: 3, TABPANE_TAB_GAP: 1, TABPANE_TAB_RADIUS: 0, TABPANE_TAB_HEIGHT: 24, TABPANE_TAB_ORIENTATION: "top", TABPANE_RESIZE_TOLERANCE: 3, TABPANE_TAB_BACKGROUND: "#EBEBEB", TABPANE_DISABLED_COLOR: "#BABBBC", TABPANE_SELECT_BACKGROUND: "white", TABPANE_MOVE_BACKGROUND: "rgba(184,211,240,0.7)", TABPANE_INSERT_BACKGROUND: "orange", TABPANE_HORIZONTAL_ALIGN: "center", TABPANE_CLOSE_ICON: "close_icon", TABPANE_SELECT_NEXT_ON_CLOSE: true, TABPANE_SELECT_NEXT_ON_INVISIBLE: true, LISTBASE_INNER_TEXT: true, LIST_ROW_HEIGHT: 19, LIST_INDENT: 2, LIST_ROW_LINE_WIDTH: 0, LIST_ROW_LINE_COLOR: "#DDD", LIST_MAKE_VISIBLE_ON_SELECTED: true, LIST_KEYBOARD_REMOVE_ENABLED: true, LIST_KEYBOARD_SELECT_ENABLED: true, TREE_ROW_HEIGHT: 19, TREE_INDENT: 16, TREE_ROW_LINE_WIDTH: 0, TREE_ROW_LINE_COLOR: "#DDD", TREE_MAKE_VISIBLE_ON_SELECTED: true, TREE_KEYBOARD_REMOVE_ENABLED: true, TREE_KEYBOARD_SELECT_ENABLED: true, TREE_EXPAND_ICON: "expand_icon", TREE_COLLAPSE_ICON: "collapse_icon", TABLE_ROW_HEIGHT: 19, TABLE_ROW_LINE_WIDTH: 1, TABLE_ROW_LINE_COLOR: "#DDD", TABLE_COLUMN_LINE_WIDTH: 1, TABLE_COLUMN_LINE_COLOR: "#DDD", TABLE_MAKE_VISIBLE_ON_SELECTED: true, TABLE_KEYBOARD_REMOVE_ENABLED: true, TABLE_KEYBOARD_SELECT_ENABLED: true, TABLE_EDITABLE: false, TABLEHEADER_HEIGHT: 24, TABLEHEADER_RESIZE_TOLERANCE: 3, TABLEHEADER_BACKGROUND: "#EBEBEB", TABLEHEADER_MOVE_BACKGROUND: "rgba(184,211,240,0.7)", TABLEHEADER_INSERT_BACKGROUND: "orange", TABLEHEADER_COLUMN_LINE_COLOR: "#DDD", TABLEHEADER_SORT_DESC_ICON: "sort_desc", TABLEHEADER_SORT_ASC_ICON: "sort_asc", TABLEHEADER_SORT_ICON_POSITION: "98% 50%", TREETABLE_ROW_HEIGHT: 19, TREETABLE_INDENT: 16, TREETABLE_ROW_LINE_WIDTH: 1, TREETABLE_ROW_LINE_COLOR: "#DDD", TREETABLE_COLUMN_LINE_WIDTH: 1, TREETABLE_COLUMN_LINE_COLOR: "#DDD", TREETABLE_MAKE_VISIBLE_ON_SELECTED: true, TREETABLE_KEYBOARD_REMOVE_ENABLED: true, TREETABLE_KEYBOARD_SELECT_ENABLED: true, TREETABLE_EXPAND_ICON: "expand_icon", TREETABLE_COLLAPSE_ICON: "collapse_icon", TREETABLE_EDITABLE: false, PROPERTYSHEET_AUTO_ADJUSTABLE: true, PROPERTYSHEET_INDENT: 16, PROPERTYSHEET_ROW_HEIGHT: 19, PROPERTYSHEET_ROW_LINE_WIDTH: 1, PROPERTYSHEET_COLUMN_LINE_WIDTH: 1, PROPERTYSHEET_BORDER_COLOR: "#EBEBEB", PROPERTYSHEET_EXPAND_ICON: "expand_icon", PROPERTYSHEET_COLLAPSE_ICON: "collapse_icon", PROPERTYSHEET_PROPERTY_NAME_WIDTH: 100, PROPERTYSHEET_PROPERTY_NAME_HORIZONTAL_ALIGN: "", PROPERTYSHEET_SUM_WIDTH: 200, PROPERTYSHEET_RESIZE_TOLERANCE: 3, PROPERTYSHEET_EDITABLE: false, PROPERTYSHEET_CATEGORIZABLE: true, PROPERTYSHEET_EXPAND_CATEGORY: true, SPLITPANE_ORIENTATION: "horizontal", SPLITPANE_POSITION: .5, SPLITPANE_DIVIDER_WIDTH: 6, SPLITPANE_DIVIDER_BACKGROUND: "#CCCCFF", SPLITPANE_DIVIDER_OPACITY: .5, SPLITPANE_MASK_BACKGROUND: "", NODE_WIDTH: 50, NODE_HEIGHT: 50, IMAGE_NODE: "node_image", IMAGE_GROUP: "group_image", IMAGE_SUBNETWORK: "subnetwork_image", ICON_DATABOX: "databox_icon", ICON_DATA: "data_icon", ICON_NODE: "node_icon", ICON_LINK: "link_icon", ICON_GROUP: "group_icon", ICON_SUBNETWORK: "subnetwork_icon", ICON_GRID: "grid_icon", ICON_BUS: "bus_icon", ICON_SHAPENODE: "shapenode_icon", ICON_SHAPELINK: "shapelink_icon", ICON_LINKSUBNETWORK: "linksubnetwork_icon", ICON_SHAPESUBNETWORK: "shapesubnetwork_icon", LAYER_DEFAULT_ID: "default", LAYER_DEFAULT_NAME: "default", ATTACHMENT_POINTER_LENGTH: 10, ATTACHMENT_POINTER_WIDTH: 8, ATTACHMENT_CORNER_RADIUS: 5, ATTACHMENT_CONTENT_WIDTH: 30, ATTACHMENT_CONTENT_HEIGHT: 20, ATTACHMENT_POSITION: "topright.topright", ATTACHMENT_XOFFSET: 0, ATTACHMENT_YOFFSET: 0, ATTACHMENT_PADDING: 0, ATTACHMENT_PADDING_LEFT: 0, ATTACHMENT_PADDING_RIGHT: 0, ATTACHMENT_PADDING_TOP: 0, ATTACHMENT_PADDING_BOTTOM: 0, ATTACHMENT_DIRECTION: "right", ATTACHMENT_FILL: false, ATTACHMENT_FILL_COLOR: "#000000", ATTACHMENT_GRADIENT: null, ATTACHMENT_GRADIENT_COLOR: "#FFFFFF", ATTACHMENT_OUTLINE_WIDTH: -1, ATTACHMENT_OUTLINE_COLOR: "#000000", ATTACHMENT_CAP: "butt", ATTACHMENT_JOIN: "miter", ATTACHMENT_SHADOWABLE: true, NETWORK_TOOLTIP_ENABLED: true, NETWORK_SELECT_MODE: "mix", NETWORK_MAKE_VISIBLE_ON_SELECTED: true, NETWORK_NO_AGENT_LINK_VISIBLE: false, NETWORK_REMOVE_ELEMENTUI_ON_INVISIBLE: false, NETWORK_SUBNETWORK_ANIMATE: true, NETWORK_SENDTOTOP_ON_SELECTED: true, NETWORK_KEYBOARD_REMOVE_ENABLED: true, NETWORK_KEYBOARD_SELECT_ENABLED: true, NETWORK_RECT_SELECT_ENABLED: true, NETWORK_DOUBLECLICK_TO_SUBNETWORK: true, NETWORK_DOUBLECLICK_TO_UPSUBNETWORK: true, NETWORK_DOUBLECLICK_TO_EMPTYSUBNETWORK: true, NETWORK_DOUBLECLICK_TO_LINKBUNDLE: true, NETWORK_DOUBLECLICK_TO_GROUPEXPAND: true, NETWORK_SELECT_OUTLINE_COLOR: "#2877A8", NETWORK_SELECT_OUTLINE_WIDTH: 1, NETWORK_SELECT_FILL_COLOR: "rgba(184,211,240,0.4)", NETWORK_LAZYMOVE_OUTLINE_COLOR: "#2877A8", NETWORK_LAZYMOVE_OUTLINE_WIDTH: 1, NETWORK_LAZYMOVE_FILL_COLOR: "rgba(184,211,240,0.4)", NETWORK_LAZYMOVE_FILL: true, NETWORK_LAZYMOVE_ANIMATE: true, NETWORK_RESIZE_POINT_FILL_COLOR: "#FFFFFF", NETWORK_RESIZE_POINT_OUTLINE_COLOR: "#000000", NETWORK_RESIZE_POINT_OUTLINE_WIDTH: 1, NETWORK_RESIZE_LINE_COLOR: "#000000", NETWORK_RESIZE_LINE_WIDTH: 1, NETWORK_RESIZE_ANIMATE: true, NETWORK_EDIT_POINT_SIZE: 3, NETWORK_EDIT_POINT_FILL_COLOR: "#FFFF00", NETWORK_EDIT_POINT_OUTLINE_COLOR: "#000000", NETWORK_EDIT_POINT_OUTLINE_WIDTH: 1, NETWORK_EDIT_LINE_COLOR: "rgba(184,211,240,0.7)", NETWORK_EDIT_LINE_WIDTH: 2, NETWORK_LIMIT_ELEMENT_INPOSITIVE_LOCATION: true, NETWORK_LINK_FLOW_STEPPING: 3, NETWORK_LINK_FLOW_COLOR: "#FF0000", NETWORK_LINK_FLOW_INTERVAL: 600, NETWORK_SELECTION_TOLERANCE: 2, SHOW_ALARM_IN_ATTACHMENT_DIV: true, OVERVIEW_FILL_COLOR: "rgba(184,211,240,0.4)", OVERVIEW_OUTLINE_COLOR: "#B8D3F0", OVERVIEW_OUTLINE_WIDTH: 1, OVERVIEW_SELECT_COLOR: "#0000FF", OVERVIEW_SELECT_WIDTH: 1, OVERVIEW_PADDING: 1, OVERVIEW_ANIMATE: true, OVERVIEW_MAX_PACKING_WIDTH: -1, OVERVIEW_MAX_PACKING_HEIGHT: -1, LINK_BUNDLE_AGENT_FUNCTION: null, ELEMENTUI_FUNCTION: function (e, t) {
        var i = t.getElementUIClass();
        if (i) {
            return new i(e, t)
        }
        return null
    }, CANVASUI_FUNCTION: function (e, t) {
        var i = t.getCanvasUIClass();
        if (i) {
            return new i(e, t)
        }
        return null
    }, KEEP_DEFAULT_FUNCTION: function (e) {
        if (e.target.keepDefault || e.target.getAttribute("keepDefault")) {
            return true
        }
        if (e.target.parentNode && (e.target.parentNode.keepDefault || e.target.parentNode.getAttribute("keepDefault"))) {
            return true
        }
        if (e.shiftKey) {
            return true
        }
        return false
    }, SORT_FUNCTION: function (e, i) {
        if (e === i) {
            return 0
        }
        if (e == null && i != null) {
            return 1
        }
        if (e != null && i == null) {
            return-1
        }
        if (e == null && i == null) {
            return 0
        }
        var n = typeof e;
        var r = typeof i;
        var a;
        if (n === "string" && r === "string") {
            a = e.localeCompare(i)
        }
        if (n === "number" && r === "number") {
            a = e - i
        }
        if (a === t) {
            a = ("" + e).localeCompare("" + i)
        }
        if (a > 0) {
            return 1
        } else if (a < 0) {
            return-1
        }
        return 0
    }};
    (function () {
        var t = x;
        if (e.OverrideTWaverDefaults) {
            for (var i in OverrideTWaverDefaults) {
                t[i] = OverrideTWaverDefaults[i]
            }
        }
        if (t.VIEW_FONT_SIZE && t.VIEW_FONT_FAMILY) {
            t.FONT = t.VIEW_FONT_SIZE + " " + t.VIEW_FONT_FAMILY
        } else {
            t.FONT = document.createElement("canvas").getContext("2d").font
        }
        if (!t.CHART_VALUE_FONT)t.CHART_VALUE_FONT = "10px " + t.VIEW_FONT_FAMILY;
        if (!t.BARCHART_XSCALE_TEXT_FONT)t.BARCHART_XSCALE_TEXT_FONT = "10px " + t.VIEW_FONT_FAMILY;
        if (!t.BARCHART_YSCALE_TEXT_FONT)t.BARCHART_YSCALE_TEXT_FONT = "10px " + t.VIEW_FONT_FAMILY;
        if (!t.BARCHART_XAXIS_TEXT_FONT)t.BARCHART_XAXIS_TEXT_FONT = "12px " + t.VIEW_FONT_FAMILY;
        if (!t.BARCHART_YAXIS_TEXT_FONT)t.BARCHART_YAXIS_TEXT_FONT = "12px " + t.VIEW_FONT_FAMILY;
        if (!t.LINECHART_XSCALE_TEXT_FONT)t.LINECHART_XSCALE_TEXT_FONT = "10px " + t.VIEW_FONT_FAMILY;
        if (!t.LINECHART_YSCALE_TEXT_FONT)t.LINECHART_YSCALE_TEXT_FONT = "10px " + t.VIEW_FONT_FAMILY;
        if (!t.LINECHART_XAXIS_TEXT_FONT)t.LINECHART_XAXIS_TEXT_FONT = "12px " + t.VIEW_FONT_FAMILY;
        if (!t.LINECHART_YAXIS_TEXT_FONT)t.LINECHART_YAXIS_TEXT_FONT = "12px " + t.VIEW_FONT_FAMILY;
        if (!t.BUBBLECHART_XAXIS_TEXT_FONT)t.BUBBLECHART_XAXIS_TEXT_FONT = "12px " + t.VIEW_FONT_FAMILY;
        if (!t.BUBBLECHART_YAXIS_TEXT_FONT)t.BUBBLECHART_YAXIS_TEXT_FONT = "12px " + t.VIEW_FONT_FAMILY;
        if (!t.BUBBLECHART_XSCALE_TEXT_FONT)t.BUBBLECHART_XSCALE_TEXT_FONT = "10px " + t.VIEW_FONT_FAMILY;
        if (!t.BUBBLECHART_YSCALE_TEXT_FONT)t.BUBBLECHART_YSCALE_TEXT_FONT = "10px " + t.VIEW_FONT_FAMILY;
        if (!t.RADARCHART_AXIS_TEXT_FONT)t.RADARCHART_AXIS_TEXT_FONT = "12px " + t.VIEW_FONT_FAMILY;
        if (!t.RADARCHART_SCALE_TEXT_FONT)t.RADARCHART_SCALE_TEXT_FONT = "10px " + t.VIEW_FONT_FAMILY;
        if (!t.DIALCHART_SCALE_TEXT_FONT)t.DIALCHART_SCALE_TEXT_FONT = "10px " + t.VIEW_FONT_FAMILY
    })();
    i.Defaults = x;
    r.ext("twaver.Defaults", Object, {});
    i.SerializationSettings = function () {
        var e = i.SerializationSettings;
        this.isDataBoxSerializable = e.isDataBoxSerializable;
        this.isLayerBoxSerializable = e.isLayerBoxSerializable;
        this.isStyleSerializable = e.isStyleSerializable;
        this.isClientSerializable = e.isClientSerializable;
        this._pm = r.clone(e._pm);
        this._sm = r.clone(e._sm);
        this._cm = r.clone(e._cm)
    };
    (function () {
        var e = i.SerializationSettings;
        e.isDataBoxSerializable = true;
        e.isLayerBoxSerializable = true;
        e.isStyleSerializable = true;
        e.isClientSerializable = true;
        e._pm = {};
        e._sm = {};
        e._cm = {};
        e.setPropertyType = function (t, i) {
            e._pm[t] = i
        };
        e.getPropertyType = function (t) {
            return e._pm[t]
        };
        e.setStyleType = function (t, i) {
            e._sm[t] = i
        };
        e.getStyleType = function (t) {
            return e._sm[t]
        };
        e.setClientType = function (t, i) {
            e._cm[t] = i
        };
        e.getClientType = function (t) {
            return e._cm[t]
        }
    })();
    r.ext("twaver.SerializationSettings", Object, {setPropertyType: function (e, t) {
        this._pm[e] = t
    }, getPropertyType: function (e) {
        return this._pm[e]
    }, setStyleType: function (e, t) {
        this._sm[e] = t
    }, getStyleType: function (e) {
        return this._sm[e]
    }, setClientType: function (e, t) {
        this._cm[e] = t
    }, getClientType: function (e) {
        return this._cm[e]
    }});
    i.Styles = {_m: {}, setStyle: function (e, t) {
        if (t == null) {
            delete i.Styles._m[e]
        } else {
            i.Styles._m[e] = t
        }
    }, getStyle: function (e) {
        return i.Styles._m[e]
    }, getStyleProperties: function () {
        return r.keys(i.Styles._m)
    }};
    (function () {
        var e = function (e, t) {
            i.SerializationSettings.setPropertyType(e, t)
        };
        e("name", "cdata");
        e("icon", "string");
        e("toolTip", "cdata");
        e("parent", "data");
        e("layerId", "string");
        e("alarmState", "alarmstate");
        e("image", "string");
        e("location", "point");
        e("width", "number");
        e("height", "number");
        e("expanded", "boolean");
        e("host", "data");
        e("fromNode", "data");
        e("toNode", "data");
        e("points", "list.point");
        e("segments", "list.string");
        e("angle", "number");
        e = function (e, t, n) {
            if (n == null) {
                if (t != null) {
                    n = typeof t
                } else {
                    n = "string"
                }
            }
            i.Styles.setStyle(e, t);
            i.SerializationSettings.setStyleType(e, n)
        };
        e("chart.color", null);
        e("chart.value", 0);
        e("chart.values", null, "list.number");
        e("chart.value.color", "#000000");
        e("chart.value.font", null);
        e("chart.line.width", 2);
        e("chart.marker.size", 6);
        e("chart.marker.shape", "circle");
        e("chart.bubble.shape", "circle");
        e("chart.names", null, "list.string");
        e("chart.xaxis.values", null, "list.number");
        e("chart.yaxis.values", null, "list.number");
        e("dialchart.rear.extension", 0);
        e("dialchart.base.width", 5);
        e("dialchart.top.width", 0);
        e("dialchart.radius", .8);
        e("inner.color", null);
        e("outer.shape", "rectangle");
        e("outer.color", null);
        e("outer.width", 2);
        e("outer.padding", 1);
        e("outer.padding.left", 0);
        e("outer.padding.right", 0);
        e("outer.padding.top", 0);
        e("outer.padding.bottom", 0);
        e("outer.cap", "butt");
        e("outer.join", "miter");
        e("shadow.color", null);
        e("shadow.xoffset", 3);
        e("shadow.yoffset", 3);
        e("shadow.blur", 6);
        e("select.style", "shadow");
        e("select.color", "rgba(0, 0, 0, 0.7)");
        e("select.shape", "rectangle");
        e("select.width", 2);
        e("select.padding", 2);
        e("select.padding.left", 0);
        e("select.padding.right", 0);
        e("select.padding.top", 0);
        e("select.padding.bottom", 0);
        e("select.cap", "butt");
        e("select.join", "miter");
        e("whole.alpha", 1);
        e("body.type", "default");
        e("network.label", null, "cdata");
        e("image.padding", 0);
        e("image.padding.left", 0);
        e("image.padding.right", 0);
        e("image.padding.top", 0);
        e("image.padding.bottom", 0);
        e("vector.shape", "rectangle");
        e("vector.fill", true);
        e("vector.fill.color", "#CCCCFF");
        e("vector.outline.width", -1);
        e("vector.outline.pattern", null, "array.number");
        e("vector.outline.color", "#5B5B5B");
        e("vector.gradient", "none");
        e("vector.gradient.color", "#FFFFFF");
        e("vector.padding", 0);
        e("vector.padding.left", 0);
        e("vector.padding.right", 0);
        e("vector.padding.top", 0);
        e("vector.padding.bottom", 0);
        e("vector.cap", "butt");
        e("vector.join", "miter");
        e("vector.deep", 0);
        e("group.shape", "rectangle");
        e("group.fill", true);
        e("group.fill.color", "#CCCCFF");
        e("group.outline.width", -1);
        e("group.outline.color", "#5B5B5B");
        e("group.gradient", "none");
        e("group.gradient.color", "#FFFFFF");
        e("group.padding", 5);
        e("group.padding.left", 0);
        e("group.padding.right", 0);
        e("group.padding.top", 0);
        e("group.padding.bottom", 0);
        e("group.cap", "butt");
        e("group.join", "miter");
        e("group.deep", 1);
        e("label.alpha", 1);
        e("label.color", "#000000");
        e("label.font", null);
        e("label.position", "bottom.bottom");
        e("label.direction", "below");
        e("label.corner.radius", 0);
        e("label.pointer.length", 0);
        e("label.pointer.width", 8);
        e("label.xoffset", 0);
        e("label.yoffset", 2);
        e("label.padding", 0);
        e("label.padding.left", 0);
        e("label.padding.right", 0);
        e("label.padding.top", 0);
        e("label.padding.bottom", 0);
        e("label.fill", false);
        e("label.fill.color", "#C0C0C0");
        e("label.gradient", "none");
        e("label.gradient.color", "#FFFFFF");
        e("label.outline.width", -1);
        e("label.outline.color", "#000000");
        e("label.cap", "butt");
        e("label.join", "miter");
        e("label.shadowable", true);
        e("icons.names", null, "array.string");
        e("icons.colors", null, "array.string");
        e("icons.position", "topleft.bottomright");
        e("icons.orientation", "right");
        e("icons.xoffset", 0);
        e("icons.yoffset", 0);
        e("icons.xgap", 1);
        e("icons.ygap", 1);
        e("alarm.alpha", 1);
        e("alarm.color", "#000000");
        e("alarm.font", null);
        e("alarm.position", "hotspot");
        e("alarm.direction", "aboveright");
        e("alarm.corner.radius", 5);
        e("alarm.pointer.length", 10);
        e("alarm.pointer.width", 8);
        e("alarm.xoffset", 0);
        e("alarm.yoffset", 0);
        e("alarm.padding", 0);
        e("alarm.padding.left", 0);
        e("alarm.padding.right", 0);
        e("alarm.padding.top", 0);
        e("alarm.padding.bottom", 0);
        e("alarm.gradient", "none");
        e("alarm.gradient.color", "#FFFFFF");
        e("alarm.outline.width", -1);
        e("alarm.outline.color", "#000000");
        e("alarm.cap", "butt");
        e("alarm.join", "miter");
        e("alarm.shadowable", true);
        e("link.color", "#658DC1");
        e("link.width", 3);
        e("link.cap", "butt");
        e("link.join", "miter");
        e("link.type", "arc");
        e("link.pattern", null, "array.number");
        e("link.extend", 20);
        e("link.control.point", null, "point");
        e("link.bundle.id", 0);
        e("link.bundle.enable", true);
        e("link.bundle.expanded", true);
        e("link.bundle.independent", false);
        e("link.bundle.offset", 20);
        e("link.bundle.gap", 12);
        e("link.looped.gap", 6);
        e("link.looped.direction", "northwest");
        e("link.looped.type", "arc");
        e("link.from.position", "center");
        e("link.from.xoffset", 0);
        e("link.from.yoffset", 0);
        e("link.from.at.edge", true);
        e("link.to.position", "center");
        e("link.to.xoffset", 0);
        e("link.to.yoffset", 0);
        e("link.to.at.edge", true);
        e("link.split.by.percent", true);
        e("link.split.percent", .5);
        e("link.split.value", 20);
        e("link.corner", "round");
        e("link.xradius", 8);
        e("link.yradius", 8);
        e("link.flow", false);
        e("link.flow.converse", false);
        e("link.handler.alpha", 1);
        e("link.handler.color", "#000000");
        e("link.handler.font", null);
        e("link.handler.position", "topleft.topleft");
        e("link.handler.direction", "below");
        e("link.handler.corner.radius", 0);
        e("link.handler.pointer.length", 0);
        e("link.handler.pointer.width", 8);
        e("link.handler.xoffset", 0);
        e("link.handler.yoffset", 0);
        e("link.handler.padding", 0);
        e("link.handler.padding.left", 0);
        e("link.handler.padding.right", 0);
        e("link.handler.padding.top", 0);
        e("link.handler.padding.bottom", 0);
        e("link.handler.fill", false);
        e("link.handler.fill.color", "#C0C0C0");
        e("link.handler.gradient", "none");
        e("link.handler.gradient.color", "#FFFFFF");
        e("link.handler.outline.width", -1);
        e("link.handler.outline.color", "#000000");
        e("link.handler.cap", "butt");
        e("link.handler.join", "miter");
        e("link.handler.shadowable", true);
        e("follower.row.index", 0);
        e("follower.column.index", 0);
        e("follower.row.span", 1);
        e("follower.column.span", 1);
        e("follower.padding", 0);
        e("follower.padding.left", 0);
        e("follower.padding.right", 0);
        e("follower.padding.top", 0);
        e("follower.padding.bottom", 0);
        e("grid.row.count", 1);
        e("grid.column.count", 1);
        e("grid.row.percents", null, "array.number");
        e("grid.column.percents", null, "array.number");
        e("grid.border", 1);
        e("grid.border.left", 0);
        e("grid.border.right", 0);
        e("grid.border.top", 0);
        e("grid.border.bottom", 0);
        e("grid.padding", 1);
        e("grid.padding.left", 0);
        e("grid.padding.right", 0);
        e("grid.padding.top", 0);
        e("grid.padding.bottom", 0);
        e("grid.fill", true);
        e("grid.fill.color", "#C0C0C0");
        e("grid.deep", 1);
        e("grid.cell.deep", -1);
        e("shapelink.type", "lineto");
        e("shapenode.closed", false);
        e("shapenode.pattern", null, "array.number");
        e("bus.style", "nearby");
        e("arrow.from", false);
        e("arrow.from.fill", true);
        e("arrow.from.shape", "arrow.standard");
        e("arrow.from.color", "#000000");
        e("arrow.from.xoffset", 0);
        e("arrow.from.yoffset", 0);
        e("arrow.from.width", 12);
        e("arrow.from.height", 9);
        e("arrow.from.outline.color", "#000000");
        e("arrow.from.outline.width", -1);
        e("arrow.from.at.edge", true);
        e("arrow.to", false);
        e("arrow.to.fill", true);
        e("arrow.to.shape", "arrow.standard");
        e("arrow.to.color", "#000000");
        e("arrow.to.xoffset", 0);
        e("arrow.to.yoffset", 0);
        e("arrow.to.width", 12);
        e("arrow.to.height", 9);
        e("arrow.to.outline.color", "#000000");
        e("arrow.to.outline.width", -1);
        e("arrow.to.at.edge", true)
    })();
    r.ext("twaver.Styles", Object, {});
    i.PropertyChangeDispatcher = function () {
        this._dispatcher = new i.EventDispatcher
    };
    r.ext("twaver.PropertyChangeDispatcher", Object, {addPropertyChangeListener: function (e, t, i) {
        this._dispatcher.add(e, t, i)
    }, removePropertyChangeListener: function (e, t) {
        this._dispatcher.remove(e, t)
    }, firePropertyChange: function (e, t, i) {
        if (t == i) {
            return false
        }
        var n = {property: e, oldValue: t, newValue: i, source: this};
        this._dispatcher.fire(n);
        this.onPropertyChanged(n);
        return true
    }, onPropertyChanged: function (e) {
    }});
    i.animate.Animate = function () {
    };
    r.ext("twaver.animate.Animate", Object, {current: 0, step: 8, delay: 4, finishFunction: null, shouldBeFinished: false, getCurrentDelay: function () {
        return this.delay * this.current + 1
    }, action: function (e) {
    }});
    i.animate.AnimateProperty = function (e, t, i) {
        this.objects = e;
        this.newValues = t;
        this.finishFunction = i;
        this.oldValues = new C;
        var n = this.objects.size();
        for (var r = 0; r < n; r++) {
            var a = this.objects.get(r);
            this.oldValues.add(this.getPropertyValue(a))
        }
    };
    r.ext("twaver.animate.AnimateProperty", i.animate.Animate, {action: function (e) {
        var t = this.objects.size();
        for (var i = 0; i < t; i++) {
            var n = this.objects.get(i);
            var r = this.oldValues.get(i);
            var a = this.newValues.get(i);
            this.currentAction(n, r, a, e)
        }
    }, getPropertyValue: function (e) {
    }, currentAction: function (e, t, i, n) {
    }});
    i.animate.AnimateBounds = function (e, t, i) {
        this.node = e;
        this.newBounds = t;
        this.oldBounds = e.getRect();
        this.finishFunction = i
    };
    r.ext("twaver.animate.AnimateBounds", i.animate.Animate, {shouldBeFinished: true, action: function (e) {
        var t = this.oldBounds;
        var i = this.newBounds;
        node.setLocation(t.x + (i.x - t.x) * e, t.y + (i.y - t.y) * e);
        node.setSize(t.width + (i.width - t.width) * e, t.height + (i.height - t.height) * e)
    }});
    i.animate.AnimateCenterLocation = function (e, t, n) {
        i.animate.AnimateCenterLocation.superClass.constructor.call(this, e, t, n)
    };
    r.ext("twaver.animate.AnimateCenterLocation", i.animate.AnimateProperty, {getPropertyValue: function (e) {
        return e.getCenterLocation()
    }, currentAction: function (e, t, i, n) {
        var r = t.x + (i.x - t.x) * n;
        var a = t.y + (i.y - t.y) * n;
        e.setCenterLocation(r, a)
    }});
    i.animate.AnimateLocation = function (e, t, n) {
        i.animate.AnimateLocation.superClass.constructor.call(this, e, t, n)
    };
    r.ext("twaver.animate.AnimateLocation", i.animate.AnimateProperty, {getPropertyValue: function (e) {
        return e.getLocation()
    }, currentAction: function (e, t, i, n) {
        var r = t.x + (i.x - t.x) * n;
        var a = t.y + (i.y - t.y) * n;
        e.setLocation(r, a)
    }});
    i.animate.AnimateScrollPosition = function (e, t, i) {
        this.view = e;
        this.oldHorizontalOffset = e.scrollLeft;
        this.oldVerticalOffset = e.scrollTop;
        this.newHorizontalOffset = t;
        this.newVerticalOffset = i
    };
    r.ext("twaver.animate.AnimateScrollPosition", i.animate.Animate, {action: function (e) {
        this.view.scrollLeft = this.oldHorizontalOffset + (this.newHorizontalOffset - this.oldHorizontalOffset) * e;
        this.view.scrollTop = this.oldVerticalOffset + (this.newVerticalOffset - this.oldVerticalOffset) * e
    }});
    i.animate.AnimateZoom = function (e, t, i) {
        this.view = e;
        this.oldZoom = e.getZoom();
        this.newZoom = t;
        this.finishFunction = i
    };
    r.ext("twaver.animate.AnimateZoom", i.animate.Animate, {shouldBeFinished: true, action: function (e) {
        this.view.setZoom(this.oldZoom + (this.newZoom - this.oldZoom) * e, false)
    }});
    i.animate.AnimateXZoom = function (e, t, i) {
        this.view = e;
        this.oldXZoom = e.getXZoom();
        this.newXZoom = t;
        this.finishFunction = i
    };
    r.ext("twaver.animate.AnimateXZoom", i.animate.Animate, {shouldBeFinished: true, action: function (e) {
        this.view.setXZoom(this.oldXZoom + (this.newXZoom - this.oldXZoom) * e, false)
    }});
    i.animate.AnimateYZoom = function (e, t, i) {
        this.view = e;
        this.oldYZoom = e.getYZoom();
        this.newYZoom = t;
        this.finishFunction = i
    };
    r.ext("twaver.animate.AnimateYZoom", i.animate.Animate, {shouldBeFinished: true, action: function (e) {
        this.view.setYZoom(this.oldYZoom + (this.newYZoom - this.oldYZoom) * e, false)
    }});
    i.animate.AnimateXYZoom = function (e, t, i, n) {
        this.view = e;
        this.oldXZoom = e.getXZoom();
        this.newXZoom = t;
        this.oldYZoom = e.getYZoom();
        this.newYZoom = i;
        this.finishFunction = n
    };
    r.ext("twaver.animate.AnimateXYZoom", i.animate.Animate, {shouldBeFinished: true, action: function (e) {
        this.view.setXZoom(this.oldXZoom + (this.newXZoom - this.oldXZoom) * e, false);
        this.view.setYZoom(this.oldYZoom + (this.newYZoom - this.oldYZoom) * e, false)
    }});
    i.animate.AnimateSubNetwork = function (e, t, i) {
        this.network = e;
        this.subNetwork = t;
        this.finishFunction = i
    };
    r.ext("twaver.animate.AnimateSubNetwork", i.animate.Animate, {shouldBeFinished: true, action: function (e) {
        if (e > .5) {
            this.network.getView().style.opacity = e * 2 - 1;
            this.network._setCurrentSubNetwork(this.subNetwork)
        } else {
            this.network.getView().style.opacity = 1 - e * 2
        }
    }});
    i.animate.AnimateManager = {timer: null, animate: null, start: function (e, t) {
        var n = i.animate.AnimateManager;
        if (e.current < 0) {
            e.current = 0
        }
        if (t) {
            r.callLater(n.startImpl, null, [e], t)
        } else {
            n.startImpl(e)
        }
    }, startImpl: function (e) {
        var t = i.animate.AnimateManager;
        if (t.animate) {
            t.endAnimate()
        }
        t.animate = e;
        t.timer = setTimeout(t.tick, e.getCurrentDelay())
    }, tick: function () {
        var e = i.animate.AnimateManager;
        var t = e.animate;
        if (!t) {
            return
        }
        if (t.current < 0) {
            t.current++;
            return
        }
        if (t.current < t.step) {
            t.current++;
            t.action(t.current / t.step);
            e.timer = setTimeout(e.tick, t.getCurrentDelay())
        }
        if (t.current >= t.step) {
            e.endAnimate()
        }
    }, endAnimate: function () {
        var e = i.animate.AnimateManager;
        if (e.animate) {
            if (e.animate.shouldBeFinished && e.animate.current < e.animate.step) {
                e.animate.current = e.animate.step;
                e.animate.action(e.animate.current / e.animate.step)
            }
            var t = e.animate.finishFunction;
            e.animate = null;
            if (e.timer) {
                clearTimeout(e.timer);
                e.timer = null
            }
            if (t) {
                t()
            }
        } else {
            if (e.timer) {
                clearTimeout(e.timer);
                e.timer = null
            }
        }
    }};
    i.DataBox = function (e) {
        i.DataBox.superClass.constructor.apply(this, arguments);
        if (arguments.length === 1) {
            this._name = e
        }
        this._dataList = new C;
        this._dataMap = {};
        this._rootList = new C;
        this._rootMap = {};
        this._clientMap = {};
        this._dataBoxChangeDispatcher = new i.EventDispatcher;
        this._dataPropertyChangeDispatcher = new i.EventDispatcher;
        this._hierarchyChangeDispatcher = new i.EventDispatcher;
        this._selectionModel = new i.SelectionModel(this)
    };
    r.ext("twaver.DataBox", i.PropertyChangeDispatcher, {IClient: true, __client: 1, __new: 1, _limit: -1, _name: "DataBox", _icon: x.ICON_DATABOX, __accessor: ["name", "icon", "toolTip"], getSelectionModel: function () {
        return this._selectionModel
    }, size: function () {
        return this._dataList.size()
    }, isEmpty: function () {
        return this._dataList.isEmpty()
    }, getLimit: function () {
        return this._limit
    }, setLimit: function (e) {
        var t = this._limit;
        this._limit = e;
        this.firePropertyChange("limit", t, e);
        this._checkLimit()
    }, _checkLimit: function () {
        if (this._limit >= 0 && this.size() > this._limit) {
            this.removeFirst(this.size() - this._limit)
        }
    }, removeFirst: function (e) {
        if (arguments.length === 0) {
            e = 1
        }
        while (e > 0 && this._dataList.size() > 0) {
            var t = this._dataList.get(0);
            this.remove(t);
            e--
        }
    }, getSiblings: function (e) {
        if (!this.contains(e)) {
            throw e + " dosen't belong to this dataBox"
        }
        var t = e.getParent();
        if (t) {
            return t.getChildren()
        } else {
            return this._rootList
        }
    }, getRoots: function () {
        return this._rootList
    }, getSiblingIndex: function (e) {
        if (e.getParent()) {
            return e.getParent().getChildren().indexOf(e)
        } else {
            return this._rootList.indexOf(e)
        }
    }, getDatas: function () {
        return this._dataList
    }, getDataAt: function (e) {
        return this._dataList.get(e)
    }, toDatas: function (e, t) {
        return this._dataList.toList(e, t)
    }, forEach: function (e, t) {
        this._dataList.forEach(e, t)
    }, forEachReverse: function (e, t) {
        this._dataList.forEachReverse(e, t)
    }, forEachByDepthFirst: function (e, t, i) {
        if (t) {
            this._depthFirst(e, t, i)
        } else {
            var n = this._rootList.size();
            for (var r = 0; r < n; r++) {
                var a = this._rootList.get(r);
                if (this._depthFirst(e, a, i) === false) {
                    return
                }
            }
        }
    }, _depthFirst: function (e, t, i) {
        var n = t.getChildrenSize();
        for (var r = 0; r < n; r++) {
            var a = t.getChildAt(r);
            if (this._depthFirst(e, a, i) === false) {
                return false
            }
        }
        if (i) {
            if (e.call(i, t) === false) {
                return false
            }
        } else {
            if (e(t) === false) {
                return false
            }
        }
    }, forEachByBreadthFirst: function (e, t, i) {
        var n = new C;
        if (t) {
            n.add(t)
        } else {
            this._rootList.forEach(n.add, n)
        }
        while (n.size() > 0) {
            t = n.removeAt(0);
            t.getChildren().forEach(n.add, n);
            if (i) {
                if (e.call(i, t) === false) {
                    return
                }
            } else {
                if (e(t) === false) {
                    return
                }
            }
        }
    }, add: function (e, t) {
        if (!e) {
            return
        }
        if (arguments.length === 1) {
            t = -1
        }
        var i = e.getId();
        if (this._dataMap.hasOwnProperty(i)) {
            throw"Data with ID '" + i + "' already exists"
        }
        this._dataMap[i] = e;
        this._dataList.add(e);
        if (!e.getParent()) {
            this._rootMap[i] = e;
            if (t >= 0) {
                this._rootList.add(e, t)
            } else {
                this._rootList.add(e)
            }
        }
        e.addPropertyChangeListener(this.handleDataPropertyChange, this, true);
        this._dataBoxChangeDispatcher.fire({kind: "add", data: e});
        this._checkLimit()
    }, remove: function (e) {
        this.removeById(e.getId())
    }, removeSelection: function () {
        this._selectionModel.toSelection().forEach(function (e) {
            this.remove(e)
        }, this)
    }, removeById: function (e) {
        var t = this.getDataById(e);
        if (!t) {
            return
        }
        if (t instanceof i.Link) {
            t.setFromNode(null);
            t.setToNode(null)
        }
        if (t instanceof w && t.getLinks()) {
            t.getLinks().toList().forEach(function (e) {
                this.remove(e)
            }, this)
        }
        if (t instanceof w && t.getFollowers()) {
            t.getFollowers().toList().forEach(function (e) {
                e.setHost(null)
            })
        }
        if (t instanceof i.Follower && t.getHost()) {
            t.setHost(null)
        }
        t.toChildren().forEach(function (e) {
            this.remove(e)
        }, this);
        if (t.getParent()) {
            t.getParent().removeChild(t)
        }
        this._dataList.remove(t);
        delete this._dataMap[e];
        if (this._rootMap[e]) {
            delete this._rootMap[e];
            this._rootList.remove(t)
        }
        this._dataBoxChangeDispatcher.fire({kind: "remove", data: t});
        t.removePropertyChangeListener(this.handleDataPropertyChange, this)
    }, clear: function () {
        if (this._dataList.size() > 0) {
            this._dataList.forEach(function (e) {
                e.removePropertyChangeListener(this.handleDataPropertyChange, this)
            }, this);
            var e = this._dataList.toList();
            this._dataList.clear();
            this._dataMap = {};
            this._rootList.clear();
            this._rootMap = {};
            this._dataBoxChangeDispatcher.fire({kind: "clear", datas: e})
        }
    }, getDataById: function (e) {
        return this._dataMap[e]
    }, containsById: function (e) {
        return this._dataMap.hasOwnProperty(e)
    }, contains: function (e) {
        if (e) {
            return this._dataMap[e.getId()] === e
        }
        return false
    }, moveTo: function (e, t) {
        if (!this.contains(e)) {
            throw e + " dosen't belong to this dataBox"
        }
        var i = this.getSiblings(e);
        var n = i.indexOf(e);
        if (n === t || n < 0) {
            return
        }
        if (t >= 0 && t <= i.size()) {
            i.remove(e);
            if (t > i.size()) {
                t--
            }
            i.add(e, t);
            this._hierarchyChangeDispatcher.fire({data: e, oldIndex: n, newIndex: t})
        }
    }, moveUp: function (e) {
        var t = this.getSiblings(e);
        this.moveTo(e, t.indexOf(e) - 1)
    }, moveDown: function (e) {
        var t = this.getSiblings(e);
        this.moveTo(e, t.indexOf(e) + 1)
    }, moveToTop: function (e) {
        this.moveTo(e, 0)
    }, moveToBottom: function (e) {
        var t = this.getSiblings(e);
        this.moveTo(e, t.size())
    }, moveSelectionUp: function (e) {
        if (!e) {
            e = this._selectionModel
        }
        var t = new C;
        v.findMoveUpDatas(e, t, this._rootList);
        t.forEach(this.moveUp, this)
    }, moveSelectionDown: function (e) {
        if (!e) {
            e = this._selectionModel
        }
        var t = new C;
        v.findMoveDownDatas(e, t, this._rootList);
        t.forEach(this.moveDown, this)
    }, moveSelectionToTop: function (e) {
        if (!e) {
            e = this._selectionModel
        }
        var t = new C;
        v.findMoveToTopDatas(e, t, this._rootList);
        t.forEach(this.moveToTop, this)
    }, moveSelectionToBottom: function (e) {
        if (!e) {
            e = this._selectionModel
        }
        var t = new C;
        v.findMoveToBottomDatas(e, t, this._rootList);
        t.forEach(this.moveToBottom, this)
    }, handleDataPropertyChange: function (e) {
        var t = e.source;
        if (e.property === "parent") {
            var i = t.getId();
            if (t.getParent()) {
                if (this._rootMap[i]) {
                    delete this._rootMap[i];
                    this._rootList.remove(t)
                }
            } else {
                if (!this._rootMap[i]) {
                    this._rootMap[i] = t;
                    this._rootList.add(t)
                }
            }
        }
        this.onDataPropertyChanged(t, e);
        this._dataPropertyChangeDispatcher.fire(e)
    }, onDataPropertyChanged: function (e, t) {
    }, addDataBoxChangeListener: function (e, t, i) {
        this._dataBoxChangeDispatcher.add(e, t, i)
    }, removeDataBoxChangeListener: function (e, t) {
        this._dataBoxChangeDispatcher.remove(e, t)
    }, addDataPropertyChangeListener: function (e, t, i) {
        this._dataPropertyChangeDispatcher.add(e, t, i)
    }, removeDataPropertyChangeListener: function (e, t) {
        this._dataPropertyChangeDispatcher.remove(e, t)
    }, addHierarchyChangeListener: function (e, t, i) {
        this._hierarchyChangeDispatcher.add(e, t, i)
    }, removeHierarchyChangeListener: function (e, t) {
        this._hierarchyChangeDispatcher.remove(e, t)
    }});
    i.ElementBox = function (e) {
        i.ElementBox.superClass.constructor.apply(this, arguments);
        this._styleMap = {};
        this._alarmBox = new i.AlarmBox(this);
        this._layerBox = new i.LayerBox(this);
        this._alarmStatePropagator = new i.AlarmStatePropagator(this);
        this._alarmStatePropagator.setEnable(true);
        this._indexChangeDispatcher = new i.EventDispatcher
    };
    i.ElementBox.IS_INTERESTED_ADJUSTELEMENTINDEX_PROPERTY = {fromAgent: 1, toAgent: 1, expanded: 1, parent: 1, host: 1};
    r.ext("twaver.ElementBox", i.DataBox, {IStyle: true, __style: 1, _name: "ElementBox", add: function (e, t) {
        if (!e) {
            return
        }
        if (!e.IElement) {
            throw"Only IElement can be added into ElementBox"
        }
        i.ElementBox.superClass.add.apply(this, arguments);
        this.adjustElementIndex(e)
    }, onDataPropertyChanged: function (e, t) {
        if (i.ElementBox.IS_INTERESTED_ADJUSTELEMENTINDEX_PROPERTY[t.property]) {
            this.adjustElementIndex(e)
        }
        i.ElementBox.superClass.onDataPropertyChanged.apply(this, arguments)
    }, addIndexChangeListener: function (e, t, i) {
        this._indexChangeDispatcher.add(e, t, i)
    }, removeIndexChangeListener: function (e, t) {
        this._indexChangeDispatcher.remove(e, t)
    }, sendToTop: function (e) {
        if (!this.contains(e)) {
            return
        }
        if (e !== this.getDatas().get(this.size() - 1)) {
            var t = this.getDatas().indexOf(e);
            this.getDatas().removeAt(t);
            this.getDatas().add(e);
            this._indexChangeDispatcher.fire({element: e, oldIndex: t, newIndex: this.size() - 1})
        }
        if (e instanceof i.Link) {
            if (e.getFromAgent() && !e.getFromAgent().isAdjustedToBottom()) {
                this.sendToTop(e.getFromAgent())
            }
            if (e.getToAgent() && !e.getToAgent().isAdjustedToBottom()) {
                this.sendToTop(e.getToAgent())
            }
        }
        if (e instanceof w) {
            if (e.getFollowers()) {
                e.getFollowers().forEach(function (t) {
                    if (t.isRelatedTo(e)) {
                        return
                    }
                    if (e instanceof i.Follower && t.isLoopedHostOn(e)) {
                        return
                    }
                    this.sendToTop(t)
                }, this)
            }
        }
        if (e.ISubNetwork) {
            return
        }
        if (e instanceof I && !e.isExpanded()) {
            return
        }
        e.getChildren().forEach(function (e) {
            if (!(e instanceof i.Link)) {
                this.sendToTop(e)
            }
        }, this)
    }, sendToBottom: function (e, t) {
        if (e === t) {
            return
        }
        if (!this.contains(e)) {
            return
        }
        if (t && !this.contains(t)) {
            return
        }
        var n = this.getDatas().remove(e);
        var r = 0;
        if (t) {
            r = this.getDatas().indexOf(t)
        }
        this.getDatas().add(e, r);
        if (n != r) {
            this._indexChangeDispatcher.fire({element: e, oldIndex: n, newIndex: r});
            if (e.getParent() && !e.getParent().ISubNetwork && !(e.getParent()instanceof i.Link)) {
                this.sendToBottom(e.getParent(), e)
            }
        }
    }, fireIndexChange: function (e, t, i) {
        this._indexChangeDispatcher.fire({element: e, oldIndex: t, newIndex: i})
    }, adjustElementIndex: function (e) {
        if (!this.contains(e)) {
            return
        }
        if (e.isAdjustedToBottom()) {
            this.sendToBottom(e);
            e.getChildren().forEach(this.adjustElementIndex, this)
        } else {
            this.sendToTop(e)
        }
    }, forEachByLayer: function (e, t, i) {
        var n = this.size();
        var r = this.getDatas();
        if (!t) {
            this._layerBox.forEachByDepthFirst(function (t) {
                for (var a = 0; a < n; a++) {
                    var o = r.get(a);
                    if (this._layerBox.getLayerByElement(o) === t) {
                        if (i) {
                            if (e.call(i, o) === false) {
                                return
                            }
                        } else {
                            if (e(o) === false) {
                                return
                            }
                        }
                    }
                }
            }, null, this)
        } else {
            for (var a = 0; a < n; a++) {
                var o = r.get(a);
                if (this._layerBox.getLayerByElement(o) === t) {
                    if (i) {
                        if (e.call(i, o) === false) {
                            return
                        }
                    } else {
                        if (e(o) === false) {
                            return
                        }
                    }
                }
            }
        }
    }, forEachByLayerReverse: function (e, t, i) {
        var n = new C;
        this.forEachByLayer(function (e) {
            n.add(e, 0)
        }, t);
        n.forEach(e, i)
    }, getLayerBox: function () {
        return this._layerBox
    }, getAlarmBox: function () {
        return this._alarmBox
    }, getAlarmStatePropagator: function () {
        return this._alarmStatePropagator
    }});
    i.SelectionModel = function (e) {
        i.SelectionModel.superClass.constructor.apply(this, arguments);
        this._selectionMode = "multipleSelection";
        this._selectionList = new C;
        this._selectionChangeDispatcher = new i.EventDispatcher;
        this._selectionMap = {};
        this._setDataBox(e)
    };
    r.ext("twaver.SelectionModel", i.PropertyChangeDispatcher, {getSelectionMode: function () {
        return this._selectionMode
    }, setSelectionMode: function (e) {
        if (this._selectionMode === e) {
            return
        }
        if (e !== "noneSelection" && e !== "singleSelection" && e !== "multipleSelection") {
            return
        }
        this.clearSelection();
        var t = this._selectionMode;
        this._selectionMode = e;
        this.firePropertyChange("selectionMode", t, this._selectionMode)
    }, getDataBox: function () {
        return this._dataBox
    }, _setDataBox: function (e) {
        if (!e) {
            throw"dataBox can not be null"
        }
        if (this._dataBox === e) {
            return
        }
        if (this._dataBox) {
            this.clearSelection();
            this._dataBox.removeDataBoxChangeListener(this.handleDataBoxChange, this)
        }
        var t = this._dataBox;
        this._dataBox = e;
        this._dataBox.addDataBoxChangeListener(this.handleDataBoxChange, this, true);
        this.firePropertyChange("dataBox", t, this._dataBox)
    }, dispose: function () {
        this.clearSelection();
        this._dataBox.removeDataBoxChangeListener(this.handleDataBoxChange, this)
    }, handleDataBoxChange: function (e) {
        if (e.kind === "remove") {
            var t = e.data;
            if (this.contains(t)) {
                this._selectionList.remove(t);
                delete this._selectionMap[t.getId()];
                this.fireSelectionChange("remove", new C(t))
            }
        } else if (e.kind === "clear") {
            this.clearSelection()
        }
    }, getFilterFunction: function () {
        return this._filterFunction
    }, setFilterFunction: function (e) {
        if (this._filterFunction === e) {
            return
        }
        this.clearSelection();
        var t = this._filterFunction;
        this._filterFunction = e;
        this.firePropertyChange("filterFunction", t, this._filterFunction)
    }, fireSelectionChange: function (e, t, i) {
        if (i) {
            this._selectionList.forEach(function (e) {
                if (i.contains(e)) {
                    i.remove(e)
                } else {
                    i.add(e)
                }
            });
            t = i.toList()
        }
        this._selectionChangeDispatcher.fire({kind: e, datas: new C(t)})
    }, addSelectionChangeListener: function (e, t, i) {
        this._selectionChangeDispatcher.add(e, t, i)
    }, removeSelectionChangeListener: function (e, t) {
        this._selectionChangeDispatcher.remove(e, t)
    }, _filterList: function (e, t) {
        var i = new C(e);
        for (var n = 0; n < i.size(); n++) {
            var r = i.get(n);
            if (this._filterFunction && !this._filterFunction(r) || t && this.contains(r) || !t && !this.contains(r) || !this._dataBox.contains(r)) {
                i.removeAt(n);
                n--
            }
        }
        return i
    }, appendSelection: function (e) {
        if (this._selectionMode === "noneSelection") {
            return
        }
        var t = this._filterList(e, true);
        if (t.isEmpty()) {
            return
        }
        var i = null;
        if (this._selectionMode === "singleSelection") {
            i = new C(this._selectionList);
            this._selectionList.clear();
            this._selectionMap = {};
            t = new C(t.get(t.size() - 1))
        }
        for (var n = 0; n < t.size(); n++) {
            var r = t.get(n);
            this._selectionList.add(r);
            this._selectionMap[r.getId()] = r
        }
        this.fireSelectionChange("append", t, i)
    }, removeSelection: function (e) {
        var t = this._filterList(e);
        if (t.size() === 0) {
            return
        }
        for (var i = 0; i < t.size(); i++) {
            var n = t.get(i);
            this._selectionList.remove(n);
            delete this._selectionMap[n.getId()]
        }
        this.fireSelectionChange("remove", t)
    }, toSelection: function (e, t) {
        return this._selectionList.toList(e, t)
    }, getSelection: function () {
        return this._selectionList
    }, setSelection: function (e) {
        if (this._selectionMode === "noneSelection") {
            return
        }
        if (this._selectionList.size() === 0 && e == null) {
            return
        }
        var t = new C(this._selectionList);
        this._selectionList.clear();
        this._selectionMap = {};
        var i = this._filterList(e, true);
        if (this._selectionMode === "singleSelection" && i.size() > 1) {
            i = new C(i.get(i.size() - 1))
        }
        for (var n = 0; n < i.size(); n++) {
            var r = i.get(n);
            this._selectionList.add(r);
            this._selectionMap[r.getId()] = r
        }
        this.fireSelectionChange("set", null, t)
    }, clearSelection: function () {
        if (this._selectionList.size() > 0) {
            var e = this._selectionList.toList();
            this._selectionList.clear();
            this._selectionMap = {};
            this.fireSelectionChange("clear", e)
        }
    }, selectAll: function () {
        if (this._selectionMode === "noneSelection") {
            return
        }
        var e = this._dataBox.toDatas();
        var t = 0;
        var i = null;
        if (this._filterFunction) {
            for (t = 0; t < e.size(); t++) {
                i = e.get(t);
                if (!this._filterFunction(i)) {
                    e.removeAt(t);
                    t--
                }
            }
        }
        var n = new C(this._selectionList);
        this._selectionList.clear();
        this._selectionMap = {};
        if (this._selectionMode === "singleSelection" && e.size() > 1) {
            e = new C(e.get(e.size() - 1))
        }
        for (t = 0; t < e.size(); t++) {
            i = e.get(t);
            this._selectionList.add(i);
            this._selectionMap[i.getId()] = i
        }
        this.fireSelectionChange("all", null, n)
    }, size: function () {
        return this._selectionList.size()
    }, contains: function (e) {
        if (!e) {
            return false
        }
        return this._selectionMap[e.getId()] != null
    }, getLastData: function () {
        if (this._selectionList.size() > 0) {
            return this._selectionList.get(this._selectionList.size() - 1)
        }
        return null
    }, getFirstData: function () {
        if (this._selectionList.size() > 0) {
            return this._selectionList.get(0)
        }
        return null
    }, isSelectable: function (e) {
        if (!e) {
            return false
        }
        if (this._selectionMode === "noneSelection") {
            return false
        }
        if (this._filterFunction && !this._filterFunction(e)) {
            return false
        }
        return true
    }});
    i.QuickFinder = function (e, t, i, n, a) {
        this._map = {};
        if (!e) {
            throw"dataBox can not be null"
        }
        if (!t) {
            throw"propertyName can not be null"
        }
        this._dataBox = e;
        this._propertyName = t;
        this._propertyType = i || "accessor";
        if (this._propertyType === "accessor") {
            this._getter = r.getter(t)
        }
        this._valueFunction = n || this.getValue;
        this._filterFunction = a || this.isInterested;
        this._dataBox.forEach(this._addData, this);
        this._dataBox.addDataBoxChangeListener(this.handleDataBoxChange, this, true);
        this._dataBox.addDataPropertyChangeListener(this.handleDataPropertyChange, this, true)
    };
    r.ext("twaver.QuickFinder", Object, {_NULL_: "twaver-null-key", getValueFunction: function () {
        return this._valueFunction
    }, getFilterFunction: function () {
        return this._filterFunction
    }, handleDataBoxChange: function (e) {
        if (e.kind === "add") {
            this._addData(e.data)
        } else if (e.kind === "remove") {
            this._removeData(e.data)
        } else if (e.kind === "clear") {
            this._map = {}
        }
    }, handleDataPropertyChange: function (e) {
        if (!this._filterFunction.call(this, e.source)) {
            return
        }
        if (this._propertyType === "accessor" && this._propertyName === e.property) {
        } else if (this._propertyType === "style" && e.source.IStyle && "S:" + this._propertyName === e.property) {
        } else if (this._propertyType === "client" && "C:" + this._propertyName === e.property) {
        } else {
            return
        }
        var t = this._getMap(e.oldValue);
        if (t) {
            t.remove(e.source)
        }
        this._addData(e.source)
    }, _getMap: function (e) {
        e = e == null ? this._NULL_ : e;
        return this._map[e]
    }, find: function (e) {
        var t = this._getMap(e);
        return t ? t.toList() : new C
    }, findFirst: function (e) {
        var t = this._getMap(e);
        return!t || t.isEmpty() ? null : t.get(0)
    }, _addData: function (e) {
        if (!this._filterFunction.call(this, e)) {
            return
        }
        var t = this._valueFunction.call(this, e);
        var i = this._getMap(t);
        if (!i) {
            i = new C;
            t = t == null ? this._NULL_ : t;
            this._map[t] = i
        }
        i.add(e)
    }, _removeData: function (e) {
        if (!this._filterFunction.call(this, e)) {
            return
        }
        var t = this._valueFunction.call(this, e);
        var i = this._getMap(t);
        if (i) {
            i.remove(e);
            if (i.isEmpty()) {
                t = t == null ? this._NULL_ : t;
                delete this._map[t]
            }
        }
    }, dispose: function () {
        this._dataBox.removeDataBoxChangeListener(this.handleDataBoxChange, this);
        this._dataBox.removeDataPropertyChangeListener(this.handleDataPropertyChange, this);
        delete this._dataBox
    }, getDataBox: function () {
        return this._dataBox
    }, getPropertyType: function () {
        return this._propertyType
    }, getPropertyName: function () {
        return this._propertyName
    }, isInterested: function (e) {
        if (this._propertyType === "style" && !e.IStyle) {
            return false
        }
        if (this._propertyType === "accessor" && this._valueFunction === this.getValue && !e[this._getter]) {
            return false
        }
        return true
    }, getValue: function (e) {
        if (this._propertyType === "accessor") {
            return e[this._getter]()
        } else if (this._propertyType === "style" && e.getStyle) {
            return e.getStyle(this._propertyName)
        } else if (this._propertyType === "client" && e.getClient) {
            return e.getClient(this._propertyName)
        }
        return null
    }});
    i.PropertyPropagator = function (e, t, i) {
        if (!e) {
            throw"dataBox can not be null"
        }
        if (!t) {
            throw"propertyName can not be null"
        }
        this._dataBox = e;
        this._propertyName = t;
        this._propertyType = i || "accessor";
        if (this._propertyType === "accessor") {
            this._getter = r.getter(t);
            this._setter = r.setter(t)
        }
        this._enable = false;
        this._isPropagating = false
    };
    r.ext("twaver.PropertyPropagator", Object, {getDataBox: function () {
        return this._dataBox
    }, getPropertyType: function () {
        return this._propertyType
    }, getPropertyName: function () {
        return this._propertyName
    }, isEnable: function () {
        return this._enable
    }, setEnable: function (e) {
        if (this._enable === e) {
            return
        }
        this._enable = e;
        if (this._enable) {
            this._dataBox.addDataBoxChangeListener(this.handleDataBoxChange, this);
            this._dataBox.addDataPropertyChangeListener(this.handleDataPropertyChange, this);
            this._dataBox.forEach(function (e) {
                this.propagate(e)
            }, this)
        } else {
            this._dataBox.removeDataBoxChangeListener(this.handleDataBoxChange, this);
            this._dataBox.removeDataPropertyChangeListener(this.handleDataPropertyChange, this)
        }
    }, handleDataBoxChange: function (e) {
        if (e.data) {
            this.propagate(e.data)
        }
    }, handleDataPropertyChange: function (e) {
        if (this.isInterestedProperty(e)) {
            this.propagate(e.source)
        } else if (e.property === "parent") {
            var t = e.oldValue;
            if (t) {
                this.propagate(t)
            }
            this.propagate(e.source)
        }
    }, isInterestedProperty: function (e) {
        if (this._propertyType === "accessor" && this._propertyName === e.property) {
            return true
        } else if (this._propertyType === "style" && e.IElement && "S:" + this._propertyName === e.property) {
            return true
        } else if (this._propertyType === "client" && "C:" + this._propertyName === e.property) {
            return true
        }
        return false
    }, propagate: function (e) {
        if (!e || this._isPropagating) {
            return
        }
        this._isPropagating = true;
        this.propagateToTop(e);
        this._isPropagating = false
    }, propagateToTop: function (e) {
        this.propagateToParent(null, e);
        while (e && e.getParent()) {
            this.propagateToParent(e, e.getParent());
            e = e.getParent()
        }
    }, propagateToParent: function (e, t) {
    }});
    i.AlarmStatePropagator = function (e) {
        i.AlarmStatePropagator.superClass.constructor.call(this, e, "alarmState")
    };
    r.ext("twaver.AlarmStatePropagator", i.PropertyPropagator, {handleDataPropertyChange: function (e) {
        if (e.property === "enablePropagation") {
            this.propagate(e.source)
        } else {
            i.AlarmStatePropagator.superClass.handleDataPropertyChange.call(this, e)
        }
    }, propagateToParent: function (e, t) {
        var n = null;
        t.getChildren().forEach(function (e) {
            var t = e.getAlarmState().getHighestOverallAlarmSeverity();
            if (i.AlarmSeverity.compare(t, n) > 0) {
                n = t
            }
        });
        t.getAlarmState().setPropagateSeverity(n)
    }});
    i.AlarmSeverity = function (e, t, i, n, r) {
        this.value = e;
        this.name = t;
        this.nickName = i;
        this.color = n;
        this.displayName = r
    };
    r.ext("twaver.AlarmSeverity", Object, {toString: function () {
        if (this.displayName) {
            return this.displayName
        }
        return this.name
    }});
    (function () {
        var e = i.AlarmSeverity;
        e.severities = new C;
        e._vm = {};
        e._nm = {};
        e._cp = function (e, t) {
            if (e && t) {
                var i = e.value - t.value;
                if (i > 0)return 1;
                if (i < 0)return-1;
                return 0
            }
            if (e && !t)return 1;
            if (!e && t)return-1;
            return 0
        };
        e.forEach = function (t, i) {
            e.severities.forEach(t, i)
        };
        e.getSortFunction = function () {
            return e._cp
        };
        e.setSortFunction = function (t) {
            e._cp = t;
            e.severities.sort(t)
        };
        e.add = function (t, i, n, r, a) {
            var o = new e(t, i, n, r, a);
            e._vm[t] = o;
            e._nm[i] = o;
            e.severities.add(o);
            e.severities.sort(e._cp);
            return o
        };
        e.remove = function (t) {
            var i = e._nm[t];
            if (i) {
                delete e._nm[t];
                delete e._vm[i.value];
                e.severities.remove(i)
            }
            return i
        };
        e.CRITICAL = e.add(500, "Critical", "C", "#FF0000");
        e.MAJOR = e.add(400, "Major", "M", "#FFA000");
        e.MINOR = e.add(300, "Minor", "m", "#FFFF00");
        e.WARNING = e.add(200, "Warning", "W", "#00FFFF");
        e.INDETERMINATE = e.add(100, "Indeterminate", "N", "#C800FF");
        e.CLEARED = e.add(0, "Cleared", "R", "#00FF00");
        e.isClearedAlarmSeverity = function (e) {
            return e ? e.value === 0 : false
        };
        e.getByName = function (t) {
            return e._nm[t]
        };
        e.getByValue = function (t) {
            return e._vm[t]
        };
        e.clear = function () {
            e.severities.clear();
            e._vm = {};
            e._nm = {}
        };
        e.compare = function (t, i) {
            return e._cp(t, i)
        }
    })();
    i.AlarmState = function (e) {
        this._e = e;
        this._nm = {};
        this._am = {};
        this._ps = null;
        this._haa = null;
        this._hna = null;
        this._hoa = null;
        this._hta = null;
        this._hls = false;
        this._aac = 0;
        this._nac = 0
    };
    r.ext("twaver.AlarmState", Object, {_ep: true, _f: function () {
        this._c1();
        this._c2();
        this._c3();
        this._c4();
        this._c5();
        this._c6();
        this._c7();
        this._e.firePropertyChange("alarmState", null, this)
    }, getHighestAcknowledgedAlarmSeverity: function () {
        return this._haa
    }, getHighestNewAlarmSeverity: function () {
        return this._hna
    }, getHighestOverallAlarmSeverity: function () {
        return this._hoa
    }, getHighestNativeAlarmSeverity: function () {
        return this._hta
    }, hasLessSevereNewAlarms: function () {
        return this._hls
    }, _c1: function () {
        var e = null;
        for (var t in this._am) {
            t = i.AlarmSeverity.getByName(t);
            if (i.AlarmSeverity.isClearedAlarmSeverity(t)) {
                continue
            }
            if (this.getAcknowledgedAlarmCount(t) === 0) {
                continue
            }
            if (e) {
                e = i.AlarmSeverity.compare(e, t) > 0 ? e : t
            } else {
                e = t
            }
        }
        this._haa = e
    }, _c2: function () {
        var e = null;
        for (var t in this._nm) {
            t = i.AlarmSeverity.getByName(t);
            if (i.AlarmSeverity.isClearedAlarmSeverity(t)) {
                continue
            }
            if (this.getNewAlarmCount(t) === 0) {
                continue
            }
            if (e) {
                e = i.AlarmSeverity.compare(e, t) > 0 ? e : t
            } else {
                e = t
            }
        }
        this._hna = e
    }, _c3: function () {
        if (!this._hna) {
            this._hls = false;
            return
        }
        for (var e in this._nm) {
            e = i.AlarmSeverity.getByName(e);
            if (i.AlarmSeverity.isClearedAlarmSeverity(e)) {
                continue
            }
            if (this.getNewAlarmCount(e) === 0) {
                continue
            }
            if (i.AlarmSeverity.compare(this._hna, e) > 0) {
                this._hls = true;
                return
            }
        }
        this._hls = false
    }, _c4: function () {
        var e = this._haa;
        var t = this._hna;
        var n = this._ps;
        this._hoa = e;
        if (i.AlarmSeverity.compare(t, this._hoa) > 0) {
            this._hoa = t
        }
        if (i.AlarmSeverity.compare(n, this._hoa) > 0) {
            this._hoa = n
        }
    }, _c5: function () {
        var e = this._haa;
        var t = this._hna;
        this._hta = e;
        if (i.AlarmSeverity.compare(t, this._hta) > 0) {
            this._hta = t
        }
    }, increaseAcknowledgedAlarm: function (e, t) {
        if (t == null) {
            t = 1
        }
        if (t === 0) {
            return
        }
        var i = this._am[e.name];
        if (i == null) {
            i = 0
        }
        i += t;
        this._am[e.name] = i;
        this._f()
    }, increaseNewAlarm: function (e, t) {
        if (t == null) {
            t = 1
        }
        if (t === 0) {
            return
        }
        var i = this._nm[e.name];
        if (i == null) {
            i = 0
        }
        i += t;
        this._nm[e.name] = i;
        this._f()
    }, decreaseAcknowledgedAlarm: function (e, t) {
        if (t == null) {
            t = 1
        }
        if (t === 0) {
            return
        }
        var i = this._am[e.name];
        if (i == null) {
            i = 0
        }
        i -= t;
        if (i < 0) {
            throw"Alarm count can not be negative"
        }
        this._am[e.name] = i;
        this._f()
    }, decreaseNewAlarm: function (e, t) {
        if (t == null) {
            t = 1
        }
        if (t === 0) {
            return
        }
        var i = this._nm[e.name];
        if (i == null) {
            i = 0
        }
        i -= t;
        if (i < 0) {
            throw"Alarm count can not be negative"
        }
        this._nm[e.name] = i;
        this._f()
    }, acknowledgeAlarm: function (e) {
        this.decreaseNewAlarm(e, 1);
        this.increaseAcknowledgedAlarm(e, 1)
    }, acknowledgeAllAlarms: function (e) {
        if (e) {
            var t = this.getNewAlarmCount(e);
            this.decreaseNewAlarm(e, t);
            this.increaseAcknowledgedAlarm(e, t)
        } else {
            for (var n in this._nm) {
                this.acknowledgeAllAlarms(i.AlarmSeverity.getByName(n))
            }
        }
    }, _c6: function () {
        this._aac = 0;
        for (var e in this._am) {
            e = i.AlarmSeverity.getByName(e);
            this._aac += this.getAcknowledgedAlarmCount(e)
        }
    }, getAcknowledgedAlarmCount: function (e) {
        if (e) {
            var t = this._am[e.name];
            return t == null ? 0 : t
        } else {
            return this._aac
        }
    }, getAlarmCount: function (e) {
        return this.getAcknowledgedAlarmCount(e) + this.getNewAlarmCount(e)
    }, _c7: function () {
        this._nac = 0;
        for (var e in this._nm) {
            e = i.AlarmSeverity.getByName(e);
            this._nac += this.getNewAlarmCount(e)
        }
    }, getNewAlarmCount: function (e) {
        if (e) {
            var t = this._nm[e.name];
            return t == null ? 0 : t
        } else {
            return this._nac
        }
    }, setNewAlarmCount: function (e, t) {
        this._nm[e.name] = t;
        this._f()
    }, removeAllNewAlarms: function (e) {
        if (e) {
            delete this._nm[e]
        } else {
            this._nm = {}
        }
        this._f()
    }, setAcknowledgedAlarmCount: function (e, t) {
        this._am[e.name] = t;
        this._f()
    }, removeAllAcknowledgedAlarms: function (e) {
        if (e) {
            delete this._am[e.name]
        } else {
            this._am = {}
        }
        this._f()
    }, isEmpty: function () {
        return this._hoa == null
    }, clear: function () {
        this._am = {};
        this._nm = {};
        this._f()
    }, getPropagateSeverity: function () {
        return this._ps
    }, setPropagateSeverity: function (e) {
        if (!this._ep) {
            e = null
        }
        if (this._ps === e) {
            return
        }
        var t = this._ps;
        this._ps = e;
        this._f();
        this._e.firePropertyChange("propagateSeverity", t, e)
    }, isEnablePropagation: function () {
        return this._ep
    }, setEnablePropagation: function (e) {
        var t = this._ep;
        this._ep = e;
        if (this._e.firePropertyChange("enablePropagation", t, e)) {
            if (!e) {
                this.setPropagateSeverity(null)
            }
        }
    }});
    i.AlarmBox = function (e) {
        if (!e) {
            throw"elementBox can not be null."
        }
        i.AlarmBox.superClass.constructor.call(this);
        this._elementBox = e;
        this._alarmElementMapping = new i.AlarmElementMapping(this, e);
        this._elementBox.addDataBoxChangeListener(this.handleElementBoxChange, this, true);
        this.addDataBoxChangeListener(this.handleAlarmBoxChange, this, true);
        this.addDataPropertyChangeListener(this.handleAlarmPropertyChange, this, true)
    };
    r.ext("twaver.AlarmBox", i.DataBox, {__accessor: ["removeAlarmWhenElementIsRemoved"], _name: "AlarmBox", _removeAlarmWhenAlarmIsCleared: false, _removeAlarmWhenElementIsRemoved: true, getElementBox: function () {
        return this._elementBox
    }, isRemoveAlarmWhenAlarmIsCleared: function () {
        return this._removeAlarmWhenAlarmIsCleared
    }, setRemoveAlarmWhenAlarmIsCleared: function (e) {
        var t = this._removeAlarmWhenAlarmIsCleared;
        this._removeAlarmWhenAlarmIsCleared = e;
        this.firePropertyChange("removeAlarmWhenAlarmIsCleared", t, e);
        if (e) {
            this.toDatas(function (e) {
                return e.isCleared()
            }).forEach(this.remove, this)
        }
    }, getAlarmElementMapping: function () {
        return this._alarmElementMapping
    }, setAlarmElementMapping: function (e) {
        if (!e) {
            throw"alarmElementMapping can not be null"
        }
        if (this._alarmElementMapping === e) {
            return
        }
        var t = this._alarmElementMapping;
        this.getDatas().forEach(this._decreaseAlarmState, this);
        this._alarmElementMapping = e;
        this.getDatas().forEach(this._increaseAlarmState, this);
        this.firePropertyChange("alarmElementMapping", t, e)
    }, handleElementBoxChange: function (e) {
        if (e.kind === "add") {
            this.handleElementAdded(e.data)
        } else if (e.kind === "remove") {
            this.handleElementRemoved(e.data);
            if (this._removeAlarmWhenElementIsRemoved) {
                this.removeAlarmsByElement(e.data)
            }
        } else if (e.kind === "clear") {
            e.datas.forEach(this.handleElementRemoved, this);
            if (this._removeAlarmWhenElementIsRemoved) {
                this.clear()
            }
        }
    }, handleAlarmBoxChange: function (e) {
        if (e.kind === "add") {
            this._increaseAlarmState(e.data)
        } else if (e.kind === "remove") {
            this._decreaseAlarmState(e.data)
        } else if (e.kind === "clear") {
            e.datas.forEach(this._decreaseAlarmState, this)
        }
    }, handleAlarmPropertyChange: function (e) {
        var t = e.source;
        if (!t.isCleared()) {
            if (e.property === "alarmSeverity") {
                this.handleAlarmSeverityChange(t, e)
            } else if (e.property === "acked") {
                this.handleAckedChange(t, e)
            }
        }
        if (e.property === "cleared") {
            if (t.isCleared()) {
                this._decreaseAlarmState(t, true);
                if (this._removeAlarmWhenAlarmIsCleared) {
                    this.remove(t)
                }
            } else {
                this._increaseAlarmState(t, true)
            }
        }
    }, handleAckedChange: function (e, t) {
        if (!e.getAlarmSeverity()) {
            return
        }
        var i = this.getCorrespondingElements(e);
        if (i) {
            for (var n = 0; n < i.size(); n++) {
                var r = i.get(n);
                if (t.oldValue) {
                    r.getAlarmState().decreaseAcknowledgedAlarm(e.getAlarmSeverity())
                } else {
                    r.getAlarmState().decreaseNewAlarm(e.getAlarmSeverity())
                }
                if (t.newValue) {
                    r.getAlarmState().increaseAcknowledgedAlarm(e.getAlarmSeverity())
                } else {
                    r.getAlarmState().increaseNewAlarm(e.getAlarmSeverity())
                }
            }
        }
    }, handleAlarmSeverityChange: function (e, t) {
        var i = t.oldValue;
        var n = t.newValue;
        var r = this.getCorrespondingElements(e);
        if (r) {
            for (var a = 0; a < r.size(); a++) {
                var o = r.get(a);
                if (i) {
                    if (e.isAcked()) {
                        o.getAlarmState().decreaseAcknowledgedAlarm(i)
                    } else {
                        o.getAlarmState().decreaseNewAlarm(i)
                    }
                }
                if (n) {
                    if (e.isAcked()) {
                        o.getAlarmState().increaseAcknowledgedAlarm(n)
                    } else {
                        o.getAlarmState().increaseNewAlarm(n)
                    }
                }
            }
        }
    }, getCorrespondingAlarms: function (e) {
        return this._alarmElementMapping.getCorrespondingAlarms(e)
    }, getCorrespondingElements: function (e) {
        return this._alarmElementMapping.getCorrespondingElements(e)
    }, handleElementAdded: function (e) {
        var t = this.getCorrespondingAlarms(e);
        if (t) {
            for (var i = 0; i < t.size(); i++) {
                var n = t.get(i);
                if (n.isCleared()) {
                    continue
                }
                var r = n.getAlarmSeverity();
                if (r) {
                    if (n.isAcked()) {
                        e.getAlarmState().increaseAcknowledgedAlarm(r)
                    } else {
                        e.getAlarmState().increaseNewAlarm(r)
                    }
                }
            }
        }
    }, _increaseAlarmState: function (e, t) {
        if (e.isCleared() && !t) {
            return
        }
        var i = e.getAlarmSeverity();
        if (i) {
            var n = this.getCorrespondingElements(e);
            if (n) {
                for (var r = 0; r < n.size(); r++) {
                    var a = n.get(r);
                    if (e.isAcked()) {
                        a.getAlarmState().increaseAcknowledgedAlarm(i)
                    } else {
                        a.getAlarmState().increaseNewAlarm(i)
                    }
                }
            }
        }
    }, _decreaseAlarmState: function (e, t) {
        if (e.isCleared() && !t) {
            return
        }
        var i = e.getAlarmSeverity();
        if (!i) {
            return
        }
        var n = this.getCorrespondingElements(e);
        if (n) {
            for (var r = 0; r < n.size(); r++) {
                var a = n.get(r);
                if (e.isAcked()) {
                    a.getAlarmState().decreaseAcknowledgedAlarm(i)
                } else {
                    a.getAlarmState().decreaseNewAlarm(i)
                }
            }
        }
    }, handleElementRemoved: function (e) {
        var t = this.getCorrespondingAlarms(e);
        if (t) {
            t.forEach(function (t) {
                if (!t.isCleared() && t.getAlarmSeverity()) {
                    if (t.isAcked()) {
                        e.getAlarmState().decreaseAcknowledgedAlarm(t.getAlarmSeverity())
                    } else {
                        e.getAlarmState().decreaseNewAlarm(t.getAlarmSeverity())
                    }
                }
            })
        }
    }, removeAlarmsByElement: function (e) {
        var t = this.getCorrespondingAlarms(e);
        if (t) {
            t.forEach(this.remove, this)
        }
    }, add: function (e, t) {
        if (!e.IAlarm) {
            throw"Only IAlarm can be added into AlarmBox"
        }
        if (this._removeAlarmWhenAlarmIsCleared && e.isCleared()) {
            return
        }
        i.AlarmBox.superClass.add.apply(this, arguments)
    }});
    i.AlarmElementMapping = function (e, t) {
        if (!t) {
            throw"ElementBox can not be null"
        }
        if (!e) {
            throw"AlarmBox can not be null"
        }
        this._elementBox = t;
        this._alarmBox = e;
        this._alarmsFinder = new i.QuickFinder(e, "elementId")
    };
    r.ext("twaver.AlarmElementMapping", Object, {getCorrespondingAlarms: function (e) {
        return this._alarmsFinder.find(e.getId())
    }, getCorrespondingElements: function (e) {
        var t = this._elementBox.getDataById(e.getElementId());
        return new C(t)
    }, dispose: function () {
        this._alarmsFinder.dispose();
        delete this._elementBox;
        delete this._alarmBox;
        delete this._alarmsFinder
    }});
    i.AlarmStateStatistics = function (e) {
        i.AlarmStateStatistics.superClass.constructor.apply(this, arguments);
        this.sumNew = 0;
        this.sumAcked = 0;
        this.sumTotal = 0;
        this.severtiyMap = {};
        this.elementMap = {};
        this.setElementBox(e)
    };
    r.ext("twaver.AlarmStateStatistics", i.PropertyChangeDispatcher, {getElementBox: function () {
        return this._elementBox
    }, setElementBox: function (e) {
        if (!e) {
            throw"ElementBox can not be null"
        }
        if (this._elementBox === e) {
            return
        }
        var t = this._elementBox;
        if (t) {
            t.removeDataPropertyChangeListener(this.handleElementPropertyChange, this);
            t.removeDataBoxChangeListener(this.handleElementBoxChange, this);
            this.severtiyMap = {};
            this.elementMap = {}
        }
        this._elementBox = e;
        this.reset();
        e.addDataPropertyChangeListener(this.handleElementPropertyChange, this);
        e.addDataBoxChangeListener(this.handleElementBoxChange, this);
        this.firePropertyChange("elementBox", t, e)
    }, dispose: function () {
        this._elementBox.removeDataPropertyChangeListener(this.handleElementPropertyChange, this);
        this._elementBox.removeDataBoxChangeListener(this.handleElementBoxChange, this);
        delete this._elementBox
    }, handleElementPropertyChange: function (e) {
        if (e.property === "alarmState") {
            this.increase(e.source);
            this.fireAlarmStateChange()
        }
    }, handleElementBoxChange: function (e) {
        if (e.kind === "add") {
            this.increase(e.data);
            this.fireAlarmStateChange()
        } else if (e.kind === "remove") {
            this.decrease(e.data);
            this.fireAlarmStateChange()
        } else if (e.kind === "clear") {
            this.severtiyMap = {};
            this.elementMap = {};
            this.fireAlarmStateChange()
        }
    }, fireAlarmStateChange: function () {
        this.sumAcked = 0;
        this.sumNew = 0;
        this.sumTotal = 0;
        i.AlarmSeverity.forEach(function (e) {
            var t = this.getSumInfo(e);
            this.sumAcked += t["ackedCount"];
            this.sumNew += t["newCount"];
            this.sumTotal += t["totalCount"]
        }, this);
        this.firePropertyChange("alarmState", false, true)
    }, getNewAlarmCount: function (e) {
        if (!e) {
            return this.sumNew
        }
        var t = this.getSumInfo(e);
        return t["newCount"]
    }, getAcknowledgedAlarmCount: function (e) {
        if (!e) {
            return this.sumAcked
        }
        var t = this.getSumInfo(e);
        return t["ackedCount"]
    }, getTotalAlarmCount: function (e) {
        if (!e) {
            return this.sumTotal
        }
        var t = this.getSumInfo(e);
        return t["totalCount"]
    }, getSumInfo: function (e) {
        var t = this.severtiyMap[e.name];
        if (!t) {
            t = {};
            t["newCount"] = 0;
            t["ackedCount"] = 0;
            t["totalCount"] = 0;
            this.severtiyMap[e.name] = t
        }
        return t
    }, decrease: function (e) {
        var t = this.elementMap[e.getId()];
        if (t) {
            delete this.elementMap[e.getId()];
            i.AlarmSeverity.forEach(function (e) {
                var i = t[e.name];
                var n = this.getSumInfo(e);
                n["newCount"] = n["newCount"] - i["newCount"];
                n["ackedCount"] = n["ackedCount"] - i["ackedCount"];
                n["totalCount"] = n["totalCount"] - i["totalCount"]
            }, this)
        }
    }, increase: function (e) {
        this.decrease(e);
        if (this._filterFunction && !this._filterFunction(e)) {
            return
        }
        var t = {};
        this.elementMap[e.getId()] = t;
        i.AlarmSeverity.forEach(function (i) {
            var n = {};
            n["newCount"] = e.getAlarmState().getNewAlarmCount(i);
            n["ackedCount"] = e.getAlarmState().getAcknowledgedAlarmCount(i);
            n["totalCount"] = e.getAlarmState().getAlarmCount(i);
            t[i.name] = n;
            var r = this.getSumInfo(i);
            r["newCount"] = r["newCount"] + n["newCount"];
            r["ackedCount"] = r["ackedCount"] + n["ackedCount"];
            r["totalCount"] = r["totalCount"] + n["totalCount"]
        }, this)
    }, reset: function () {
        this.severtiyMap = {};
        this.elementMap = {};
        this._elementBox.forEach(this.increase, this);
        this.fireAlarmStateChange()
    }, setFilterFunction: function (e) {
        var t = this._filterFunction;
        this._filterFunction = e;
        this.reset();
        this.firePropertyChange("filterFunction", t, e)
    }, getFilterFunction: function () {
        return _filterFunction
    }});
    i.LayerBox = function (e) {
        i.LayerBox.superClass.constructor.call(this);
        this._elementBox = e;
        this._defaultLayer = new i.Layer(x.LAYER_DEFAULT_ID, x.LAYER_DEFAULT_NAME);
        this.add(this._defaultLayer)
    };
    r.ext("twaver.LayerBox", i.DataBox, {_name: "LayerBox", getElementBox: function () {
        return this._elementBox
    }, getDefaultLayer: function () {
        return this._defaultLayer
    }, add: function (e, t) {
        if (!e.ILayer) {
            throw"Only ILayer can be added into LayerBox"
        }
        i.LayerBox.superClass.add.apply(this, arguments)
    }, removeById: function (e) {
        if (e === this._defaultLayer.getId()) {
            throw"Cannot remove default layer"
        }
        i.LayerBox.superClass.removeById.call(this, e)
    }, getLayerByElement: function (e) {
        if (!e) {
            return null
        }
        var t = this.getDataById(e.getLayerId());
        return t ? t : this._defaultLayer
    }, clear: function () {
        this.toDatas().forEach(function (e) {
            if (e != this._defaultLayer) {
                this.removeById(e.getId())
            }
        }, this)
    }});
    i.BundleLinks = function (e, t) {
        this._links = e;
        this._siblings = t;
        var n;
        var r;
        var a = i.Styles.getStyle("link.bundle.expanded");
        for (n = 0; n < e.size(); n++) {
            r = e.get(n);
            var o = r.getStyle("link.bundle.expanded", false);
            if (o != null) {
                a = o;
                break
            }
        }
        if (a == null) {
            a = true
        }
        if (x.LINK_BUNDLE_AGENT_FUNCTION) {
            var s = x.LINK_BUNDLE_AGENT_FUNCTION(e);
            if (s == null) {
                s = e.get(0)
            } else {
                if (s != e.get(0)) {
                    e.remove(s);
                    e.add(s, 0)
                }
            }
        }
        for (n = 0; n < e.size(); n++) {
            e.get(n).setStyle("link.bundle.expanded", a)
        }
    };
    r.ext("twaver.BundleLinks", Object, {getLinks: function () {
        return this._links
    }, getSiblings: function () {
        return this._siblings
    }, forEachSiblingLink: function (e, t) {
        this._siblings.forEach(function (i) {
            i.getLinks().forEach(e, t)
        })
    }});
    i.Data = function (e) {
        i.Data.superClass.constructor.apply(this, arguments);
        this._childList = new C;
        this._childMap = {};
        this._clientMap = {};
        if (e === t || e === null) {
            this._id = r.id()
        } else if (typeof e === "string" || typeof e === "number" || typeof e === "boolean") {
            this._id = e
        } else {
            for (var n in e) {
                if (n === "clients") {
                    for (var a in e.clients) {
                        this._clientMap[a] = e.clients[a]
                    }
                } else if (n === "styles") {
                    for (var o in e.styles) {
                        this._styleMap[o] = e.styles[o]
                    }
                } else {
                    if (e[n] != null)this["_" + n] = e[n]
                }
            }
            if (this._id == null)this._id = r.id()
        }
    };
    r.ext("twaver.Data", i.PropertyChangeDispatcher, {IData: true, IClient: true, __client: 1, __new: 1, _parent: null, __accessor: ["name", "icon", "toolTip"], _icon: x.ICON_DATA, getId: function () {
        return this._id
    }, getChildren: function () {
        return this._childList
    }, getChildrenSize: function () {
        return this._childList.size()
    }, toChildren: function (e, t) {
        return this._childList.toList(e, t)
    }, addChild: function (e, i) {
        if (i === t) {
            i = this._childList.size()
        }
        if (!e || e === this) {
            return false
        }
        if (this._childMap[e.getId()]) {
            return false
        }
        if (this.isDescendantOf(e)) {
            return false
        }
        if (e.getParent()) {
            e.getParent().removeChild(e)
        }
        if (i < 0 || i > this._childList.size()) {
            i = this._childList.size()
        }
        this._childList.add(e, i);
        this._childMap[e._id] = e;
        e.setParent(this);
        this.firePropertyChange("children", null, e);
        this.onChildAdded(e, i);
        return true
    }, onChildAdded: function (e, t) {
    }, removeChild: function (e) {
        if (!e) {
            return false
        }
        if (!this._childMap[e._id]) {
            return false
        }
        var t = this._childList.remove(e);
        delete this._childMap[e._id];
        this.firePropertyChange("children", e, null);
        e.setParent(null);
        this.onChildRemoved(e, t);
        return true
    }, onChildRemoved: function (e, t) {
    }, getChildAt: function (e) {
        return this._childList.get(e)
    }, clearChildren: function () {
        if (this._childList.size() === 0) {
            return false
        }
        var e = this._childList.toArray();
        var t = e.length;
        for (var i = 0; i < t; i++) {
            this.removeChild(e[i])
        }
        this.onChildrenCleared(e);
        return true
    }, onChildrenCleared: function (e) {
    }, getParent: function () {
        return this._parent
    }, setParent: function (e) {
        if (this._isUpdatingParent || this._parent === e || this === e) {
            return
        }
        if (e && e.isDescendantOf(this)) {
            return
        }
        var t = this._parent;
        this._parent = e;
        this._isUpdatingParent = true;
        if (t) {
            t.removeChild(this)
        }
        if (e) {
            e.addChild(this)
        }
        delete this._isUpdatingParent;
        this.firePropertyChange("parent", t, e);
        this.onParentChanged(t, e)
    }, onParentChanged: function (e, t) {
    }, hasChildren: function () {
        return this._childList.size() > 0
    }, isRelatedTo: function (e) {
        if (!e) {
            return false
        }
        return this.isDescendantOf(e) || e.isDescendantOf(this)
    }, isParentOf: function (e) {
        if (!e) {
            return false
        }
        return this._childMap[e._id] != null
    }, isDescendantOf: function (e) {
        if (!e) {
            return false
        }
        if (!e.hasChildren()) {
            return false
        }
        var t = this._parent;
        while (t) {
            if (e === t) {
                return true
            } else {
                t = t.getParent()
            }
        }
        return false
    }, toString: function () {
        if (this.getName()) {
            return this.getName()
        }
        return this._id
    }});
    i.Alarm = function (e, t, n, r, a) {
        i.Alarm.superClass.constructor.call(this, e);
        this._elementId = t;
        this._alarmSeverity = n;
        this._acked = r || false;
        this._cleared = a || false
    };
    r.ext("twaver.Alarm", i.Data, {IAlarm: true, getElementId: function () {
        return this._elementId
    }, __accessor: ["acked", "cleared", "alarmSeverity"]});
    i.Layer = function (e) {
        i.Layer.superClass.constructor.call(this, e)
    };
    r.ext("twaver.Layer", i.Data, {ILayer: true, __accessor: ["visible", "movable", "editable"], _visible: true, _movable: true, _editable: true});
    i.Element = function (e) {
        this._styleMap = this._styleMap || {};
        this._alarmState = new i.AlarmState(this);
        i.Element.superClass.constructor.call(this, e)
    };
    r.ext("twaver.Element", i.Data, {IElement: true, IStyle: true, __accessor: ["layerId"], __style: 1, getAlarmState: function () {
        return this._alarmState
    }, isAdjustedToBottom: function () {
        return false
    }, getElementUIClass: function () {
        return null
    }, getCanvasUIClass: function () {
        return null
    }});
    i.Dummy = function (e) {
        i.Dummy.superClass.constructor.call(this, e)
    };
    r.ext("twaver.Dummy", i.Element, {IDummy: true});
    var w = function (e) {
        this._location = {x: 0, y: 0};
        w.superClass.constructor.call(this, e)
    };
    i.Node = w;
    w.IS_INTERESTED_NODE_PROPERTY = {location: 1, width: 1, height: 1, expanded: 1};
    r.ext("twaver.Node", i.Element, {_icon: x.ICON_NODE, _image: x.IMAGE_NODE, getLoopedLinks: function () {
        return this._loopedLinks
    }, getLinks: function () {
        return this._links
    }, getAgentLinks: function () {
        return this._agentLinks
    }, getFollowers: function () {
        return this._followers
    }, _addFollower: function (e) {
        if (!this._followers) {
            this._followers = new C
        }
        this._followers.add(e)
    }, _removeFollower: function (e) {
        this._followers.remove(e);
        if (this._followers.isEmpty()) {
            delete this._followers
        }
    }, getFromLinks: function () {
        return this._fromLinks
    }, getToLinks: function () {
        return this._toLinks
    }, _addFromLink: function (e) {
        if (!this._allLinks) {
            this._allLinks = new C
        }
        if (!this._fromLinks) {
            this._fromLinks = new C
        }
        this._allLinks.add(e);
        this._fromLinks.add(e);
        this._resetLinkSet()
    }, _addToLink: function (e) {
        if (!this._allLinks) {
            this._allLinks = new C
        }
        if (!this._toLinks) {
            this._toLinks = new C
        }
        this._allLinks.add(e);
        this._toLinks.add(e);
        this._resetLinkSet()
    }, _removeFromLink: function (e) {
        this._allLinks.remove(e);
        this._fromLinks.remove(e);
        if (this._allLinks.size() === 0) {
            delete this._allLinks
        }
        if (this._fromLinks.size() === 0) {
            delete this._fromLinks
        }
        this._resetLinkSet()
    }, _removeToLink: function (e) {
        this._allLinks.remove(e);
        this._toLinks.remove(e);
        if (this._allLinks.size() === 0) {
            delete this._allLinks
        }
        if (this._toLinks.size() === 0) {
            delete this._toLinks
        }
        this._resetLinkSet()
    }, _resetLinkSet: function () {
        delete this._loopedLinks;
        if (!this._allLinks || this._allLinks.size() === 0) {
            delete this._links;
            return
        }
        var e;
        this._allLinks.forEach(function (t) {
            if (t.isLooped()) {
                if (!e) {
                    e = {}
                }
                if (!e[t._id]) {
                    if (!this._loopedLinks) {
                        this._loopedLinks = new C
                    }
                    this._loopedLinks.add(t);
                    e[t._id] = t
                }
            }
        }, this);
        if (e) {
            this._links = new C;
            this._allLinks.forEach(function (t) {
                if (!e[t._id]) {
                    this._links.add(t)
                } else if (e[t._id] !== false) {
                    e[t._id] = false;
                    this._links.add(t)
                }
            }, this)
        } else {
            this._links = this._allLinks
        }
    }, hasAgentLinks: function () {
        return this._agentLinks != null && !this._agentLinks.isEmpty()
    }, getFromAgentLinks: function () {
        return this._fromAgentLinks
    }, getToAgentLinks: function () {
        return this._toAgentLinks
    }, _addFromAgentLink: function (e) {
        if (!this._fromAgentLinks) {
            this._fromAgentLinks = new C
        }
        if (!this._allAgentLinks) {
            this._allAgentLinks = new C
        }
        this._fromAgentLinks.add(e);
        this._allAgentLinks.add(e);
        this._resetAgentLinkSet()
    }, _addToAgentLink: function (e) {
        if (!this._toAgentLinks) {
            this._toAgentLinks = new C
        }
        if (!this._allAgentLinks) {
            this._allAgentLinks = new C
        }
        this._toAgentLinks.add(e);
        this._allAgentLinks.add(e);
        this._resetAgentLinkSet()
    }, _removeFromAgentLink: function (e) {
        this._fromAgentLinks.remove(e);
        this._allAgentLinks.remove(e);
        if (this._fromAgentLinks.size() === 0) {
            delete this._fromAgentLinks
        }
        if (this._allAgentLinks.size() === 0) {
            delete this._allAgentLinks
        }
        this._resetAgentLinkSet()
    }, _removeToAgentLink: function (e) {
        this._toAgentLinks.remove(e);
        this._allAgentLinks.remove(e);
        if (this._toAgentLinks.size() === 0) {
            delete this._toAgentLinks
        }
        if (this._allAgentLinks.size() === 0) {
            delete this._allAgentLinks
        }
        this._resetAgentLinkSet()
    }, _resetAgentLinkSet: function () {
        delete this._agentLinks;
        if (!this._allAgentLinks || this._allAgentLinks.size() === 0) {
            return
        }
        var e = {};
        this._allAgentLinks.forEach(function (t) {
            if (!e[t._id]) {
                e[t._id] = t
            } else if (!this._agentLinks) {
                this._agentLinks = new C
            }
        }, this);
        if (this._agentLinks) {
            this._allAgentLinks.forEach(function (t) {
                if (e[t._id]) {
                    this._agentLinks.add(t);
                    delete e[t._id]
                }
            }, this)
        } else {
            this._agentLinks = this._allAgentLinks
        }
    }, getImage: function () {
        return this._image
    }, setImage: function (e) {
        var t = this._image;
        var i = this.getWidth();
        var n = this.getHeight();
        this._image = e;
        this.firePropertyChange("image", t, e);
        this.firePropertyChange("width", i, this.getWidth());
        this.firePropertyChange("height", n, this.getHeight())
    }, getX: function () {
        return this._location.x
    }, getY: function () {
        return this._location.y
    }, setX: function (e) {
        this.setLocation(e, this._location.y)
    }, setY: function (e) {
        this.setLocation(this._location.x, e)
    }, getLocation: function () {
        return this._location
    }, setLocation: function (e, t) {
        var i;
        if (arguments.length === 2) {
            i = {x: arguments[0], y: arguments[1]}
        } else {
            i = arguments[0]
        }
        if (!r.num(i.x) || !r.num(i.y)) {
            return
        }
        if (i.x === this._location.x && i.y === this._location.y) {
            return
        }
        var n = this._location;
        this._location = i;
        this.firePropertyChange("location", n, i)
    }, getCenterLocation: function () {
        return{x: this.getX() + this.getWidth() / 2, y: this.getY() + this.getHeight() / 2}
    }, setCenterLocation: function (e, t) {
        var i;
        if (arguments.length === 2) {
            i = {x: arguments[0], y: arguments[1]}
        } else {
            i = r.clone(arguments[0])
        }
        if (!r.num(i.x) || !r.num(i.y)) {
            return
        }
        i.x -= this.getWidth() / 2;
        i.y -= this.getHeight() / 2;
        this.setLocation(i)
    }, translate: function (e, t) {
        this.setLocation(this.getX() + e, this.getY() + t)
    }, getWidth: function () {
        if (r.num(this._width) && this._width >= 0) {
            return this._width
        }
        var e = r.getImageAsset(this._image);
        if (e) {
            var t = e.getWidth();
            if (r.num(t) && t >= 0) {
                return t
            }
        }
        return x.NODE_WIDTH
    }, setWidth: function (e) {
        var t = this._width;
        this._width = e;
        this.firePropertyChange("width", t, e)
    }, getHeight: function () {
        if (r.num(this._height) && this._height >= 0) {
            return this._height
        }
        var e = r.getImageAsset(this._image);
        if (e) {
            var t = e.getHeight();
            if (r.num(t) && t >= 0) {
                return t
            }
        }
        return x.NODE_HEIGHT
    }, setHeight: function (e) {
        var t = this._height;
        this._height = e;
        this.firePropertyChange("height", t, e)
    }, setSize: function () {
        if (arguments.length === 2) {
            this.setWidth(arguments[0]);
            this.setHeight(arguments[1])
        } else {
            this.setWidth(arguments[0].width);
            this.setHeight(arguments[0].height)
        }
    }, getSize: function () {
        return{width: this.getWidth(), height: this.getHeight()}
    }, getRect: function () {
        return{x: this.getX(), y: this.getY(), width: this.getWidth(), height: this.getHeight()}
    }, onParentChanged: function (e, t) {
        w.superClass.onParentChanged.call(this, e, t);
        this._checkLinkAgent()
    }, _checkLinkAgent: function () {
        if (this._links) {
            var e = this._links.size();
            for (var t = 0; t < e; t++) {
                this._links.get(t)._checkAgentNode()
            }
        }
    }, onPropertyChanged: function (e) {
        w.superClass.onPropertyChanged.call(this, e);
        if (this._followers) {
            var t = this._followers.size();
            for (var i = 0; i < t; i++) {
                this._followers.get(i).handleHostPropertyChange(e)
            }
        }
        if (this.getParent()instanceof I) {
            if (w.IS_INTERESTED_NODE_PROPERTY[e.property]) {
                this.getParent().updateLocationFromChildren()
            }
        }
    }, getElementUIClass: function () {
        return i.network.NodeUI
    }, getCanvasUIClass: function () {
        return i.canvas.NodeUI
    }});
    i.Link = function (e, t, n) {
        i.Link.superClass.constructor.call(this, e instanceof w ? null : e);
        if (e instanceof w) {
            n = t;
            t = e
        }
        this.setFromNode(t);
        this.setToNode(n)
    };
    i.Link.IS_INTERESTED_BUNDLE_STYLE = {"link.bundle.enable": 1, "link.bundle.id": 1, "link.bundle.independent": 1};
    r.ext("twaver.Link", i.Element, {_fromNode: null, _toNode: null, _fromAgent: null, _toAgent: null, _icon: x.ICON_LINK, getFromNode: function () {
        return this._fromNode
    }, getToNode: function () {
        return this._toNode
    }, getFromAgent: function () {
        return this._fromAgent
    }, getToAgent: function () {
        return this._toAgent
    }, setFromNode: function (e) {
        if (this._fromNode === e) {
            return
        }
        var t = this._fromNode;
        this._fromNode = e;
        if (t) {
            t._removeFromLink(this)
        }
        if (this._fromNode) {
            this._fromNode._addFromLink(this)
        }
        this._checkAgentNode();
        this.firePropertyChange("fromNode", t, e)
    }, setToNode: function (e) {
        if (this._toNode === e) {
            return
        }
        var t = this._toNode;
        this._toNode = e;
        if (t) {
            t._removeToLink(this)
        }
        if (this._toNode) {
            this._toNode._addToLink(this)
        }
        this._checkAgentNode();
        this.firePropertyChange("toNode", t, e)
    }, isLooped: function () {
        return this._fromNode === this._toNode && this._fromNode != null && this._toNode != null
    }, _checkAgentNode: function () {
        var e = g.figureFromAgent(this);
        var t;
        if (this._fromAgent != e) {
            t = this._fromAgent;
            if (this._fromAgent) {
                this._fromAgent._removeFromAgentLink(this)
            }
            this._fromAgent = e;
            if (this._fromAgent) {
                this._fromAgent._addFromAgentLink(this)
            }
            this.firePropertyChange("fromAgent", t, this._fromAgent);
            g.resetBundleLinks(t, this._toAgent);
            g.resetBundleLinks(this._fromAgent, this._toAgent)
        }
        var i = g.figureToAgent(this);
        if (this._toAgent != i) {
            t = this._toAgent;
            if (this._toAgent) {
                this._toAgent._removeToAgentLink(this)
            }
            this._toAgent = i;
            if (this._toAgent) {
                this._toAgent._addToAgentLink(this)
            }
            this.firePropertyChange("toAgent", t, this._toAgent);
            g.resetBundleLinks(t, this._fromAgent);
            g.resetBundleLinks(this._toAgent, this._fromAgent)
        }
    }, _setBundleLinks: function (e) {
        this._bundleLinks = e;
        this.firePropertyChange("bundleLinks", true, false)
    }, getBundleLinks: function () {
        return this._bundleLinks
    }, getBundleCount: function () {
        if (this._bundleLinks) {
            return this._bundleLinks.getLinks().size()
        } else {
            return 1
        }
    }, getBundleIndex: function () {
        if (this._bundleLinks) {
            return this._bundleLinks.getLinks().indexOf(this)
        } else {
            return 0
        }
    }, reverseBundleExpanded: function () {
        if (this._bundleLinks && this._bundleLinks.getLinks().size() > 0) {
            var e;
            var t;
            var i = this._bundleLinks.getLinks();
            var n = !this.getStyle("link.bundle.expanded");
            for (e = 0; e < i.size(); e++) {
                t = i.get(e);
                t.setStyle("link.bundle.expanded", n)
            }
            var r = this._bundleLinks.getSiblings();
            for (e = 0; e < r.size(); e++) {
                var a = r.get(e);
                if (a != this._bundleLinks) {
                    i = a.getLinks();
                    for (var o = 0; o < i.size(); o++) {
                        t = i.get(o);
                        t.firePropertyChange("bundleLinks", null, a)
                    }
                }
            }
            return true
        }
        return false
    }, isBundleAgent: function () {
        return this._bundleLinks != null && this._bundleLinks.getLinks().size() > 1 && this === this._bundleLinks.getLinks().get(0) && !this.getStyle("link.bundle.expanded")
    }, onStyleChanged: function (e, t, n) {
        i.Link.superClass.onStyleChanged.call(this, e, t, n);
        if (i.Link.IS_INTERESTED_BUNDLE_STYLE[e]) {
            g.resetBundleLinks(this._toAgent, this._fromAgent)
        }
    }, getElementUIClass: function () {
        return i.network.LinkUI
    }, getCanvasUIClass: function () {
        return i.canvas.LinkUI
    }});
    i.Follower = function (e) {
        this._isUpdatingFollower = false;
        this._isUpdatingLocation = false;
        i.Follower.superClass.constructor.call(this, e)
    };
    i.Follower.IS_INTERESTED_HOST_GRID_PROPERTY = {location: 1, width: 1, height: 1, "S:grid.row.count": 1, "S:grid.column.count": 1, "S:grid.row.percents": 1, "S:grid.column.percents": 1, "S:grid.border": 1, "S:grid.border.left": 1, "S:grid.border.right": 1, "S:grid.border.top": 1, "S:grid.border.bottom": 1, "S:grid.padding": 1, "S:grid.padding.left": 1, "S:grid.padding.right": 1, "S:grid.padding.top": 1, "S:grid.padding.bottom": 1};
    i.Follower.IS_INTERESTED_FOLLOWER_STYLE = {"follower.row.index": 1, "follower.column.index": 1, "follower.row.span": 1, "follower.column.span": 1, "follower.padding": 1, "follower.padding.left": 1, "follower.padding.right": 1, "follower.padding.top": 1, "follower.padding.bottom": 1};
    r.ext("twaver.Follower", w, {_host: null, getHost: function () {
        return this._host
    }, setHost: function (e) {
        if (this === e || this._host === e) {
            return
        }
        var t = this._host;
        if (t) {
            t._removeFollower(this)
        }
        this._host = e;
        if (this._host) {
            this._host._addFollower(this)
        }
        this.firePropertyChange("host", t, e);
        this.onHostChanged(t, e)
    }, onStyleChanged: function (e, t, n) {
        i.Follower.superClass.onStyleChanged.call(this, e, t, n);
        if (i.Follower.IS_INTERESTED_FOLLOWER_STYLE[e]) {
            this.updateFollower(null)
        }
    }, setLocation: function () {
        if (this._isUpdatingLocation) {
            return
        }
        this._isUpdatingLocation = true;
        i.Follower.superClass.setLocation.apply(this, arguments);
        this._isUpdatingLocation = false
    }, onHostChanged: function (e, t) {
        this.updateFollower(null)
    }, handleHostPropertyChange: function (e) {
        this.updateFollower(e)
    }, updateFollower: function (e) {
        if (this._isUpdatingFollower || r.isDeserializing) {
            return
        }
        this._isUpdatingFollower = true;
        this.updateFollowerImpl(e);
        this._isUpdatingFollower = false
    }, updateFollowerImpl: function (e) {
        var t = this.getHost();
        if (t instanceof i.Grid) {
            if (!e || i.Follower.IS_INTERESTED_HOST_GRID_PROPERTY[e.property]) {
                var n = this.getStyle("follower.row.index");
                var r = this.getStyle("follower.column.index");
                var a = t.getCellRect(n, r);
                if (!a) {
                    return
                }
                var o = this.getStyle("follower.row.span");
                var s = this.getStyle("follower.column.span");
                if (o != 1 || s != 1) {
                    var A = t.getCellRect(n + o - 1, r + s - 1);
                    if (A) {
                        a = l.unionRect(a, A)
                    }
                }
                l.addPadding(a, this, "follower.padding");
                this.setLocation(a.x, a.y);
                this.setWidth(a.width);
                this.setHeight(a.height)
            }
        } else {
            if (e != null && e.property === "location") {
                var h = e.oldValue;
                var u = e.newValue;
                var f = this.getLocation();
                this.setLocation(f.x + (u.x - h.x), f.y + (u.y - h.y))
            }
        }
    }, isHostOn: function (e) {
        if (!e) {
            return false
        }
        var t = {};
        var n = this._host;
        while (n && n != this && !t[n.getId()]) {
            if (n === e) {
                return true
            } else {
                t[n.getId()] = n;
                if (n instanceof i.Follower) {
                    n = n.getHost()
                } else {
                    n = null
                }
            }
        }
        return false
    }, isLoopedHostOn: function (e) {
        return this.isHostOn(e) && e.isHostOn(this)
    }});
    var I = function (e) {
        this._isUpdatingLocationFromChildren = false;
        this._isAdjusting = false;
        this._expanded = false;
        I.superClass.constructor.call(this, e)
    };
    i.Group = I;
    r.ext("twaver.Group", i.Follower, {_image: x.IMAGE_GROUP, _icon: x.ICON_GROUP, isAdjustedToBottom: function () {
        return this.isExpanded() && g.hasAgentLinks(this)
    }, onChildAdded: function (e, t) {
        I.superClass.onChildAdded.apply(this, arguments);
        this.updateLocationFromChildren()
    }, onChildRemoved: function (e, t) {
        I.superClass.onChildRemoved.apply(this, arguments);
        this.updateLocationFromChildren()
    }, updateLocationFromChildren: function () {
        if (this._isAdjusting || r.isDeserializing) {
            return
        }
        var e, t = 0, i = this.getChildrenSize(), n;
        for (; t < i; t++) {
            n = this.getChildAt(t);
            if (n instanceof w) {
                e = l.unionRect(e, this.getChildRect(n))
            }
        }
        if (e) {
            this._isUpdatingLocationFromChildren = true;
            this.setLocation(e.x + e.width / 2 - this.getWidth() / 2, e.y + e.height / 2 - this.getHeight() / 2);
            this._isUpdatingLocationFromChildren = false
        }
    }, getChildRect: function (e) {
        var t;
        if (e instanceof w) {
            if (e instanceof I) {
                if (e.isExpanded()) {
                    e.getChildren().forEach(function (i) {
                        t = l.unionRect(t, e.getChildRect(i))
                    })
                }
                if (!t) {
                    t = e.getRect()
                }
            } else {
                t = e.getRect()
            }
        }
        return t
    }, setLocation: function () {
        if (this._isAdjusting) {
            return
        }
        var e;
        if (arguments.length === 2) {
            e = {x: arguments[0], y: arguments[1]}
        } else {
            e = arguments[0]
        }
        if (!r.isDeserializing && !this._isUpdatingLocationFromChildren) {
            this._isAdjusting = true;
            var t = e.x - this.getX();
            var i = e.y - this.getY();
            g.moveElements(this.getChildren(), t, i);
            this._isAdjusting = false
        }
        I.superClass.setLocation.call(this, e)
    }, reverseExpanded: function () {
        this.setExpanded(!this.isExpanded())
    }, isExpanded: function () {
        return this._expanded
    }, setExpanded: function (e) {
        if (this._expanded === e) {
            return
        }
        var t = this._expanded;
        this._expanded = e;
        this.firePropertyChange("expanded", t, this._expanded);
        this._checkLinkAgent()
    }, _checkLinkAgent: function () {
        I.superClass._checkLinkAgent.call(this);
        var e = this.getChildrenSize();
        for (var t = 0; t < e; t++) {
            var i = this.getChildAt(t);
            if (i instanceof w) {
                i._checkLinkAgent()
            }
        }
    }, getElementUIClass: function () {
        return i.network.GroupUI
    }, getCanvasUIClass: function () {
        return i.canvas.GroupUI
    }});
    i.SubNetwork = function (e) {
        i.SubNetwork.superClass.constructor.call(this, e)
    };
    r.ext("twaver.SubNetwork", i.Follower, {ISubNetwork: true, _image: x.IMAGE_SUBNETWORK, _icon: x.ICON_SUBNETWORK, _checkLinkAgent: function () {
        i.SubNetwork.superClass._checkLinkAgent.call(this);
        var e = this.getChildrenSize();
        for (var t = 0; t < e; t++) {
            var n = this.getChildAt(t);
            if (n instanceof w) {
                n._checkLinkAgent()
            }
        }
    }});
    i.Grid = function (e) {
        i.Grid.superClass.constructor.call(this, e)
    };
    r.ext("twaver.Grid", i.Follower, {_icon: x.ICON_GRID, _image: null, getCellObject: function (e, t) {
        if (arguments.length === 1) {
            t = e.y;
            e = e.x
        }
        var i = this.getStyle("grid.row.count");
        var n = this.getStyle("grid.column.count");
        for (var r = 0; r < i; r++) {
            for (var a = 0; a < n; a++) {
                var o = this.getCellRect(r, a);
                if (l.containsPoint(o, e, t)) {
                    return{rowIndex: r, columnIndex: a, rect: o}
                }
            }
        }
        return null
    }, getCellRect: function (e, t) {
        var i = this.getStyle("grid.row.count");
        var n = this.getStyle("grid.column.count");
        if (i <= 0 || n <= 0) {
            return null
        }
        if (e < 0 || e >= i) {
            return null
        }
        if (t < 0 || t >= n) {
            return null
        }
        var r = this.getRect();
        l.addPadding(r, this, "grid.border");
        var a = 0;
        var o = this.getStyle("grid.row.percents");
        var s = this.getStyle("grid.column.percents");
        if (o && o.length === i) {
            var A = 0;
            for (a = 0; a < e; a++) {
                A += r.height * o[a]
            }
            r.y += A;
            r.height = r.height * o[e]
        } else {
            r.height = r.height / i;
            r.y += r.height * e
        }
        if (s && s.length === n) {
            var h = 0;
            for (a = 0; a < t; a++) {
                h += r.width * s[a]
            }
            r.x += h;
            r.width = r.width * s[t]
        } else {
            r.width = r.width / n;
            r.x += r.width * t
        }
        l.addPadding(r, this, "grid.padding");
        return r
    }, getElementUIClass: function () {
        return i.network.GridUI
    }, getCanvasUIClass: function () {
        return i.canvas.GridUI
    }});
    i.ShapeNode = function (e) {
        this._isUpdatingShapeNode = false;
        this._points = new C;
        i.ShapeNode.superClass.constructor.call(this, e)
    };
    r.ext("twaver.ShapeNode", i.Follower, {_icon: x.ICON_SHAPENODE, __accessor: ["segments"], getElementUIClass: function () {
        return i.network.ShapeNodeUI
    }, getCanvasUIClass: function () {
        return i.canvas.ShapeNodeUI
    }, getPoints: function () {
        return this._points
    }, setPoints: function (e) {
        if (!e) {
            e = new C
        }
        this._points = e;
        this.firePointsChange()
    }, getSegments: function () {
        return this._segments
    }, setSegments: function (e) {
        if (!e) {
            e = new C
        }
        this._segments = e;
        this._reCalculateLineLength();
        this.firePointsChange()
    }, addPoint: function (e, t) {
        this._points.add(e, t);
        this.firePointsChange()
    }, setPoint: function (e, t) {
        this._points.set(e, t);
        this.firePointsChange()
    }, removePoint: function (e) {
        this._points.remove(e);
        this.firePointsChange()
    }, removeAt: function (e) {
        this._points.removeAt(e);
        this.firePointsChange()
    }, setWidth: function (e) {
        if (e < 1) {
            e = 1
        }
        if (!this._isUpdatingShapeNode && !r.isDeserializing) {
            this._isUpdatingShapeNode = true;
            for (var t = 0; t < this._points.size(); t++) {
                var n = this._points.get(t);
                n.x = (n.x - this.getX()) * e / this.getWidth() + this.getX()
            }
            this.firePointsChange();
            this._isUpdatingShapeNode = false
        }
        i.ShapeNode.superClass.setWidth.apply(this, arguments)
    }, setHeight: function (e) {
        if (e < 1) {
            e = 1
        }
        if (!this._isUpdatingShapeNode && !r.isDeserializing) {
            this._isUpdatingShapeNode = true;
            for (var t = 0; t < this._points.size(); t++) {
                var n = this._points.get(t);
                n.y = (n.y - this.getY()) * e / this.getHeight() + this.getY()
            }
            this.firePointsChange();
            this._isUpdatingShapeNode = false
        }
        i.ShapeNode.superClass.setHeight.apply(this, arguments)
    }, setLocation: function () {
        if (!this._isUpdatingShapeNode && !r.isDeserializing) {
            var e;
            if (arguments.length === 2) {
                e = {x: arguments[0], y: arguments[1]}
            } else {
                e = arguments[0]
            }
            if (!r.num(e.x) || !r.num(e.y)) {
                return
            }
            var t = e.x - this.getX();
            var n = e.y - this.getY();
            if (t === 0 && n === 0) {
                return
            }
            this._isUpdatingShapeNode = true;
            for (var a = 0; a < this._points.size(); a++) {
                var o = this._points.get(a);
                o.x += t;
                o.y += n
            }
            this.firePointsChange();
            this._isUpdatingShapeNode = false
        }
        i.ShapeNode.superClass.setLocation.apply(this, arguments)
    }, firePointsChange: function () {
        if (!this._isUpdatingShapeNode && !r.isDeserializing) {
            var e = l.getRect(this._points);
            if (e) {
                this._isUpdatingShapeNode = true;
                this.setLocation(e.x, e.y);
                this.setWidth(e.width);
                this.setHeight(e.height);
                this._isUpdatingShapeNode = false
            }
        }
        this._reCalculateLineLength();
        this.firePropertyChange("points", null, this._points)
    }, _reCalculateLineLength: function () {
        if (this._points != null && this._points.size() > 0) {
            this._lineLength = l.calculateLineLength(this._points, this._segments)
        } else {
            this._lineLength = 0
        }
    }, getLineLength: function () {
        return this._lineLength
    }});
    i.Bus = function (e) {
        this._styleMap = {};
        this._styleMap["vector.fill"] = false;
        this._styleMap["shapenode.closed"] = false;
        i.Bus.superClass.constructor.call(this, e)
    };
    r.ext("twaver.Bus", i.ShapeNode, {_icon: x.ICON_BUS, firePointsChange: function () {
        var e = this._points.size();
        if (!r.isDeserializing && e >= 2) {
            var t = this._points.get(0);
            for (var n = 1; n < e; n++) {
                var a = this._points.get(n);
                if (Math.abs(a.x - t.x) > Math.abs(a.y - t.y)) {
                    a.y = t.y
                } else {
                    a.x = t.x
                }
                t = a
            }
        }
        i.Bus.superClass.firePointsChange.apply(this, arguments)
    }});
    i.ShapeLink = function (e, t, n) {
        this._points = new C;
        this._styleMap = {};
        this._styleMap["link.bundle.enable"] = false;
        i.ShapeLink.superClass.constructor.call(this, e, t, n)
    };
    r.ext("twaver.ShapeLink", i.Link, {_icon: x.ICON_SHAPELINK, getElementUIClass: function () {
        return i.network.ShapeLinkUI
    }, getCanvasUIClass: function () {
        return i.canvas.ShapeLinkUI
    }, getPoints: function () {
        return this._points
    }, setPoints: function (e) {
        if (!e) {
            e = new C
        }
        this._points = e;
        this.firePointsChange()
    }, addPoint: function (e, t) {
        this._points.add(e, t);
        this.firePointsChange()
    }, setPoint: function (e, t) {
        this._points.set(e, t);
        this.firePointsChange()
    }, removePoint: function (e) {
        this._points.remove(e);
        this.firePointsChange()
    }, removeAt: function (e) {
        this._points.removeAt(e);
        this.firePointsChange()
    }, firePointsChange: function () {
        this.firePropertyChange("points", null, this._points)
    }});
    i.ShapeSubNetwork = function (e) {
        i.ShapeSubNetwork.superClass.constructor.call(this, e)
    };
    r.ext("twaver.ShapeSubNetwork", i.ShapeNode, {ISubNetwork: true, _icon: x.ICON_SHAPESUBNETWORK, _checkLinkAgent: function () {
        i.ShapeSubNetwork.superClass._checkLinkAgent.call(this);
        var e = this.getChildrenSize();
        for (var t = 0; t < e; t++) {
            var n = this.getChildAt(t);
            if (n instanceof w) {
                n._checkLinkAgent()
            }
        }
    }});
    i.LinkSubNetwork = function (e) {
        i.LinkSubNetwork.superClass.constructor.call(this, e)
    };
    r.ext("twaver.LinkSubNetwork", i.Link, {ISubNetwork: true, _icon: x.ICON_LINKSUBNETWORK});
    i.RotatableNode = function (e) {
        i.RotatableNode.superClass.constructor.call(this, e)
    };
    r.ext("twaver.RotatableNode", i.Follower, {_angle: 0, getAngle: function () {
        return this._angle
    }, setAngle: function (e) {
        var t = this._angle;
        this._angle = e;
        this.firePropertyChange("angle", t, e)
    }, getWidth: function () {
        if (this._angle == 0) {
            return this._getOrignalWidth()
        } else {
            return this._getRotateRect().width
        }
    }, setWidth: function (e) {
    }, getHeight: function () {
        if (this._angle == 0) {
            return this._getOrignalHeight()
        } else {
            return this._getRotateRect().height
        }
    }, setHeight: function (e) {
    }, getElementUIClass: function () {
        return i.network.RotatableNodeUI
    }, getCanvasUIClass: function () {
        return i.canvas.RotatableNodeUI
    }, _getRotateRect: function () {
        var e = this._getOrignalWidth();
        var t = this._getOrignalHeight();
        var i = l.createMatrix(this._angle * Math.PI / 180, e / 2, t / 2);
        var n = [
            {x: 0, y: 0},
            {x: e, y: 0},
            {x: e, y: t},
            {x: 0, y: t}
        ];
        for (var r = 0, a = n.length; r < a; r++) {
            n[r] = i.transform(n[r])
        }
        return l.getRect(n)
    }, _getOrignalWidth: function () {
        return i.RotatableNode.superClass.getWidth.call(this)
    }, _getOrignalHeight: function () {
        return i.RotatableNode.superClass.getHeight.call(this)
    }});
    i.controls.ControlBase = function () {
        i.controls.ControlBase.superClass.constructor.apply(this, arguments);
        this._pools = new C
    };
    r.ext("twaver.controls.ControlBase", i.PropertyChangeDispatcher, {addPool: function (e) {
        if (!this._pools.contains(e)) {
            this._pools.add(e)
        }
    }, removePool: function (e) {
        this._pools.remove(e)
    }, adjustBounds: function (e) {
        var t = this._view.style;
        t.position = "absolute";
        t.left = e.x + "px";
        t.top = e.y + "px";
        t.width = e.width + "px";
        t.height = e.height + "px";
        if (this.invalidate) {
            this.invalidate()
        }
    }, getView: function () {
        return this._view
    }, invalidate: function (e) {
        if (!this._invalidate) {
            this._invalidate = true;
            r.callLater(this.validate, this, null, e)
        }
    }, validate: function () {
        if (!this._invalidate) {
            return
        }
        this._invalidate = false;
        if (this._view.offsetWidth === 0 && this._view.offsetHeight === 0 && this._reinvalidateCount !== null) {
            if (this._reinvalidateCount === t) {
                this._reinvalidateCount = 100
            }
            if (this._reinvalidateCount > 0) {
                this._reinvalidateCount--
            } else {
                this._reinvalidateCount = null
            }
            this.invalidate()
        } else {
            this.validateImpl()
        }
    }, validateImpl: function () {
    }});
    i.controls.ViewBase = function () {
        i.controls.ViewBase.superClass.constructor.apply(this, arguments);
        this._interactionDispatcher = new i.EventDispatcher;
        this._viewDispatcher = new i.EventDispatcher
    };
    r.ext("twaver.controls.ViewBase", i.controls.ControlBase, {__bool: ["focusOnClick"], _focusOnClick: x.FOCUS_ON_CLICK, getSelectionModel: function () {
        return this._selectionModel ? this._selectionModel : this._box.getSelectionModel()
    }, isShareSelectionModel: function () {
        return this._selectionModel == null
    }, setShareSelectionModel: function (e) {
        var t = this._selectionModel == null;
        if (t === e) {
            return
        }
        if (e) {
            this._box.getSelectionModel().addSelectionChangeListener(this.handleSelectionChange, this);
            this._selectionModel.removeSelectionChangeListener(this.handleSelectionChange, this);
            this._selectionModel.dispose();
            this._selectionModel = null
        } else {
            this._box.getSelectionModel().removeSelectionChangeListener(this.handleSelectionChange, this);
            this._selectionModel = new i.SelectionModel(this._box);
            this._selectionModel.addSelectionChangeListener(this.handleSelectionChange, this)
        }
        this.onShareSelectionModelChanged();
        this.firePropertyChange("shareSelectionModel", t, e)
    }, removeSelection: function () {
        if (this.getSelectionModel().size() === 0) {
            return null
        }
        var e = this.getSelectionModel().toSelection();
        e.forEach(function (e) {
            this._box.remove(e)
        }, this);
        return e
    }, selectAll: function () {
        var e = new C;
        this._box.forEach(function (t) {
            if (this.isVisible(t)) {
                e.add(t)
            }
        }, this);
        this.getSelectionModel().setSelection(e);
        return e
    }, isSelected: function (e) {
        return this.getSelectionModel().contains(e)
    }, isSelectable: function (e) {
        return this.getSelectionModel().isSelectable(e)
    }, getLabel: function (e) {
        return e.getName()
    }, getToolTip: function (e) {
        return e.getToolTip()
    }, getIcon: function (e) {
        return e.getIcon()
    }, getSelectColor: function (e) {
        return x.SELECT_COLOR
    }, addViewListener: function (e, t, i) {
        this._viewDispatcher.add(e, t, i)
    }, removeViewListener: function (e, t) {
        this._viewDispatcher.remove(e, t)
    }, fireViewEvent: function (e) {
        this._viewDispatcher.fire(e)
    }, addInteractionListener: function (e, t, i) {
        this._interactionDispatcher.add(e, t, i)
    }, removeInteractionListener: function (e, t) {
        this._interactionDispatcher.remove(e, t)
    }, fireInteractionEvent: function (e) {
        this._interactionDispatcher.fire(e)
    }, invalidate: function (e) {
        if (!this._invalidate) {
            this._invalidate = true;
            this.fireViewEvent({kind: "invalidate"});
            r.callLater(this.validate, this, null, e)
        }
    }, validate: function () {
        if (!this._invalidate) {
            return
        }
        this._invalidate = false;
        if (this._view.offsetWidth === 0 && this._view.offsetHeight === 0 && this._reinvalidateCount !== null) {
            if (this._reinvalidateCount === t) {
                this._reinvalidateCount = 100
            }
            if (this._reinvalidateCount > 0) {
                this._reinvalidateCount--
            } else {
                this._reinvalidateCount = null
            }
            this.invalidate()
        } else {
            this._isValidating = true;
            this.fireViewEvent({kind: "validateStart"});
            this.validateImpl();
            this.fireViewEvent({kind: "validateEnd"});
            delete this._isValidating
        }
    }});
    i.controls.View = function () {
        i.controls.View.superClass.constructor.apply(this, arguments)
    };
    r.ext("twaver.controls.View", i.controls.ViewBase, {_zoom: 1, _maxZoom: x.ZOOM_MAX, _minZoom: x.ZOOM_MIN, getRootDiv: function () {
        return this._rootDiv
    }, isValidEvent: function (e) {
        return f.isValidEvent(this._view, e)
    }, getAlarmFillColor: function (e) {
        if (e.IElement) {
            var t = e.getAlarmState().getHighestNewAlarmSeverity();
            if (t) {
                return t.color
            }
        }
        return null
    }, getInnerColor: function (e) {
        if (e.IElement) {
            var t = e.getAlarmState().getHighestNativeAlarmSeverity();
            if (t) {
                return t.color
            }
            return e.getStyle("inner.color")
        }
        return null
    }, getOuterColor: function (e) {
        if (e.IElement) {
            var t = e.getAlarmState().getPropagateSeverity();
            if (t) {
                return t.color
            }
            return e.getStyle("outer.color")
        }
        return null
    }, zoomOverview: function (e) {
        var t = Math.min(this._view.clientWidth / this._viewRect.width, this._view.clientHeight / this._viewRect.height);
        this.setZoom(t, e)
    }, getLogicalPoint: function (e) {
        return f.getLogicalPoint(this._view, e, this.getZoom(), this._rootDiv)
    }, centerByLogicalPoint: function (e, t, n) {
        if (n) {
            i.animate.AnimateManager.endAnimate()
        }
        var r = this._view.scrollWidth - this._view.clientWidth;
        var a = this._view.scrollHeight - this._view.clientHeight;
        var o = (e - this._view.clientWidth / this._zoom / 2) * this._zoom;
        var s = (t - this._view.clientHeight / this._zoom / 2) * this._zoom;
        if (o < 0) {
            o = 0
        }
        if (s < 0) {
            s = 0
        }
        if (o > r) {
            o = r
        }
        if (s > a) {
            s = a
        }
        if (n) {
            i.animate.AnimateManager.start(new i.animate.AnimateScrollPosition(this._view, o, s))
        } else {
            this._view.scrollLeft = o;
            this._view.scrollTop = s
        }
    }, panByOffset: function (e, t) {
        e *= this.getZoom();
        t *= this.getZoom();
        var i = this._view.scrollLeft + e;
        var n = this._view.scrollTop + t;
        var r = this._view.scrollWidth - this._view.clientWidth;
        var a = this._view.scrollHeight - this._view.clientHeight;
        if (i < 0) {
            i = 0
        }
        if (i > r) {
            i = r
        }
        if (n < 0) {
            n = 0
        }
        if (n > a) {
            n = a
        }
        var o = {x: (i - this._view.scrollLeft) / this.getZoom(), y: (n - this._view.scrollTop) / this.getZoom()};
        this._view.scrollLeft = i;
        this._view.scrollTop = n;
        return o
    }, getMaxZoom: function () {
        return this._maxZoom
    }, setMaxZoom: function (e) {
        if (e < 0) {
            return
        }
        var t = this._maxZoom;
        this._maxZoom = e;
        this.firePropertyChange("maxZoom", t, e);
        if (this.getZoom() > e) {
            this.setZoom(e)
        }
    }, getMinZoom: function () {
        return this._minZoom
    }, setMinZoom: function (e) {
        if (e < 0) {
            return
        }
        var t = this._minZoom;
        this._minZoom = e;
        this.firePropertyChange("minZoom", t, e);
        if (this.getZoom() < e) {
            this.setZoom(e, false)
        }
    }, getZoom: function () {
        return this._zoom
    }, onZoomChanged: function (e, t) {
    }, zoomIn: function (e) {
        this.setZoom(this._zoom * x.ZOOM_INCREMENT, e)
    }, zoomOut: function (e) {
        this.setZoom(this._zoom / x.ZOOM_INCREMENT, e)
    }, zoomReset: function (e) {
        this.setZoom(1, e)
    }, setZoom: function (e, t) {
        if (!r.num(e) || e <= 0) {
            return
        }
        if (e < this._minZoom) {
            e = this._minZoom
        }
        if (e > this._maxZoom) {
            e = this._maxZoom
        }
        if (e === this._zoom) {
            return
        }
        if (t == null) {
            t = x.ZOOM_ANIMATE
        }
        if (t) {
            i.animate.AnimateManager.start(new i.animate.AnimateZoom(this, e))
        } else {
            var n = (this._view.scrollLeft + this._view.clientWidth / 2) / this._zoom;
            var a = (this._view.scrollTop + this._view.clientHeight / 2) / this._zoom;
            var o = this._zoom;
            this._zoom = e;
            f.setZoom(this._rootDiv, e);
            this.firePropertyChange("zoom", o, e);
            this.onZoomChanged(o, e);
            this.centerByLogicalPoint(n, a, false)
        }
    }});
    (function () {
        var e = function (e, t, n, r) {
            var a = document.createElement("img");
            a.src = r;
            i.Util.registerImage(e, a, t, n)
        };
        e("subnetwork_image", 64, 46, "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAAAuCAYAAACYlx/0AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAB1JJREFUeNrkWmtQk1cafr4vUQhEiNeBpkWwXitCqK1WaiU4tCMjlmCnrU4rmE4v2v1Rmf7q7M6is/uj7e4OurMz7fSyiXXVddsasBa0xQawoqiFFPBWJATkVpQSLPdLTt/zkTCgSHVNuISXeZLvnC8JeZ7zvu8578kBRs/UhB0EE6GZwIaBmbCToIEXWSjBcAfCI4GLoZ3QzIX+0RwgpYnUsPT0dGY2m5nDwYagqKiYGQwGlpiYeKsQJvoc1UQjriKYCYwjJiaG5eScYN09fXeF8qsVLDk5hbneT2gWJkpYyARBJQpCMYFNV6nYRx9/wtq7uv8vnD57jkVGRjL+WYRmgsYDg+U+U0ydoiJvNpPjagICA2E6moVlERH39Zkt9hboEuJxobSUN+2iKMR2dPdYxkSAQD+FhoJSxxiLAY9LNsgtBeS6+qYFBuC/piNYGr7MLV/yZksLXkx6FpfKynjTRiJEtbR32EdFgNmB01REeAdjSHFm9N8146Ev8fgTq9zqqr/evImN8XGoq6nhzd1Nv7amelwA9awZOsrQBjizsHLaNCxf8YSEhUseue0L/nT5IgICArAp5RWP5Jeis2fwxpbN0jX3gtobv1g8IkCYOkjFiDiNvI63gx5QQ7/tD1i9Ng5KZcCYJtl3095BdqaJf3NjVX2j3u0CLA4LUTkcDjNzxvfLr24jbIdDmpLH3q7X1yMlKb5/xpGJSTwxOm9ZLldW2+9LgIhF8/vJ05zr76/EO399H0siHh1vawykvf0mSi1Fw9220/1cQRDyCBklV67a7kmA5eFLTNzt/ZVK/Ond3VCHPjwu1xqWwlM4lvnFQLvKehVtra23kyMRKFfsOVdyMfd3BYheHrmV3J4nPPz57/9CcEgoxqsRMdBADbRFQaQ+4HJZCWqrrDhtzkG1zTr49UZC6qnzxfZhBVj75EqVo89RybN9/MZNWLvhuYldg5AaDTVVOPnNURTmmwfCQxTF2O8KCi23CbBO+xQVLSxt+szZSP3LP9DrcHhFGSrQX431CrI/34+6a1VOcUR9tjnfOESAxHVxvD5XPbtZjwWRj8HbzNHTjexDeylELM41hBhlyvpGagibdBv40tYUOGMmknf8ET19ffBGk4si8r76H0rPF0rhIJPJww4czrDLfXx9+bqeprsodHR1w1utF31YGZeAlqYbaGyo4yvbdIJe2KZPLuZbUNoNz2O6ei683dqbfsbxz/e5QiFMrlD4SSs+1aw5cHhJ8hvJlLOCMG/hYtRfq+YZ8C25r59CujHVz9+rQ8Bl3TTIcxeHo7npOp8BtHI/Ig7XBhzDpDDV7GA4eWvkhn37pc650esmRQg4Yx8u3nJrZaV00dbZjclkLt5yV0e1tRwPjtPix6PrA14+0rO2zlaBkHkLJgXpcloROqtAO/eAPC5AydkCPBkXPykE4FydlivnNTOpkVZCNXZXZwf8/JXevRBqa8UZ83EqoQU+8+2V0UODzxS5TibKgnx8fLAoQiOVk96KzH2foOJCKWSiYOvpc2yXkuAUuXwP3TaczMrA07oXoPBSL+Be/n1WJqbK5TT6LLWzpxcyaXXU22tRKnx1zNEbdL2uBo89tVZyEW9CXVUFDO/vAnHkW+pGe1vHe0O2xIJUARpBFHlhhKSt27AmYaPXjHz+14dhMnzY32Ast765JdZ1T+a6aO3sapih9K+Sy2S68pIizJwTBHXo/Akd7/XVVhz453sozMmmmBe5Jxhrm5qTht0Uddl8dbCB3ruVX6+O1yFhy2sTbsQvnj+D77MzYb1UMtDHHCz1al3D7mE3RW+1R8JC0klBfpwFwSFhWP/yqwijCmpckCsqRENVJYLnhsGXCprO9jbUU7ujvRUN1ZVEumzI6xljRsKuS7ZrtuH3De9gkQvn6URBHPhdMJQEWPVMAhZHrRgz8vYbjfgg7W2J9EhGGd5GDxlEfM+P5VbbyBunI9jjSxepyBO4N2wd3B+6aCkio7USRss6O9rw2d92oqF/IG1E7lZiedTH9/1zz124ctc/mt7V+YBoTXgoifAWQUcIdfVvSNmOiFVrRkWAr/Z+iJLTeZIjUNkedaq41OaOz73nEyKxK5drnGJIXrF+y+tYtnK1B0e+HSe+3I/SMyelNidvLvxhbE6IDLb4mGiDS4SlK1YjVrcZvgo/t5JvrK3GsYOfSs/95Jn+WH6B0Z3/477OCCU+rd1JIqTx68AZs6DVbcKCcI0bRr0DRfnfouD4kYH8RyMfeyQnz+JuD7vvQ1LPr39GSyIYXLlhzgMP4dE1cZIQ9+oRLb/cQNm5Avxw8gS6yPWd01gukdd/kfWtzRMh5pZTYi/p1vPZYoczNwwcapxPIoQ8vFASZY76IRJEMeR9P9fWSESvVfyE8rJiNNbVDJ6/eabf9R/TUSM8aG49Jqd/IUkliiIXImXwbHEvRqQtNOJ7/n3osEeJe0SAwbY9ebOGxOBnjGKcYtxJEAsnTfiRkPHBZwdtGEX7TYABAPgBTYK366ChAAAAAElFTkSuQmCC");
        e("bus_icon", 16, 16, "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAINJREFUeNqkU0EOgCAMo2Y/1P8Y/6NvnBADwTnGzHYiGetKW8DMKVJLChbVAwCNCrrzp5/Zg/4MaH0JMBOEh08o6OtxtgvXvkFuV/vFBeGEm0WZo8GgF+QlIkI2OrZq5WLAFjuy4DvVWXHl2VodyElMjkxAJNFm4EjmFGAqLKLf+RZgAKkFNRwzv7gHAAAAAElFTkSuQmCC");
        e("data_icon", 16, 16, "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAMZJREFUeNqkU8ENwjAM9KEwWwaAKVA3iMQDtRtUTAEDdLZWMkkhIUljU4n7RInP9p3dgoiYBAzDgHAyfykA1rtzbr2bmpDDk5uBvu+ROO98pvs4FqRL10nCogokBS3UBaXCZg9JQ7JQY5qmZoK1trCQCuQJnoS9CsQZHKsNcOyWvS1ehdGqz8xyZ0BXEHG+PTdvj+uJkFsASsusdN5sQSKHGWgWfDxY1GcQfEIYIn4p+HuN+SqXRtL8+ZAOinwm5V+P8ZcAAwC0T1T5kpEqewAAAABJRU5ErkJggg==");
        e("databox_icon", 16, 16, "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAJpJREFUeNpi/P//PwMjI+N/BiIBUD0jMp8FpDm4cQ2DvYEiw8EL9/FqBqkBqUc3BGT7/0kbz/6HsXHhS/eewtWBXA7CYAMOX75PlCEgA9ANYYQaADbJVleRAShJ0Csw7+T5G2MaQCpgQReAuQAWqPhokAuYGCgEowZQwwBQuiYn/mGAEZaeYTkSlA6IBeCUCDMA2RBSsjZAgAEAOyp6/CYHWkwAAAAASUVORK5CYII=");
        e("grid_icon", 16, 16, "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAFdJREFUeNpi/P//PwMlgImBQsACIhgZGUl2BtDljCguAHkFhIMb1xBkU9ULjCATQV4A2UAsWFsfAvcCzEn/YQBoEEE2VD1Y76gXhpcXyM0LjJRmZ4AAAwCoyOJjz29PsAAAAABJRU5ErkJggg==");
        e("group_icon", 16, 16, "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAOFJREFUeNqUUwsOwjAILa67i2fwEMbEnUej55mJO4Rn8DBtglAh6YfOSdJkBfregwEgottiHiAlQuZjh68TQRJzI5L07nSbC//zOrUAmkxAJXBP2VgxRjpDK818z06gZIwrfSACF0iVVZrLiab7ownOl7PTV0QESsRgWqoHt80oD0fpy/BVhuZfsOpkC8LYxAkBw4YedOdDhuRny1UyZEPE334NvbZ6kBYeJGFPKFgp4HsUAqtI9u1AYipJgfQ+GjtQlPvPMkGlBHrLdFjeBeHruE+hYAxSo6C3jb4zyh8BBgBVL19PZ27iaAAAAABJRU5ErkJggg==");
        e("group_image", 32, 29, "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAdCAYAAADLnm6HAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAABHNJREFUeNqsV1ts21QY/uy4zc1ZnZY2bdbSLMlKxUWkaBJMgJY9gARIax/2NokVofLARWjiBYRY2QMdCGlI440H1ok3btsQ0wAxNdvKpnYdyyYK7UZHVK1L2rRZLo3j2InDOaZD60psp+WXrDjO93/nO7/PfwkDAwu0Nh8jH30wZwc6/f43X9jVJ5gBn/zueJozgaNkUXLtMwLyLt4XDG4Vtj+/B8lMQRf7QLsb079PCpzJnaVnEsmIEeiZgD/Mu5yYT4uYiWd1sW1NTlCsWQGmzC00gOd5lFQVkqLoYiuViobVBNzf3BRaCfUaUyuV2AomXI1sNrmkRUeUZBRlBXJJRVFRdQUoZVXDclvbvUeImn6j3VmAqpjg5ra0xcL2nDwdwW1JQeP2HJLLki7frVQOo+OXwNnttv5fp65vKPSvvLhHmBgf77fV10XqWBaLZPGEgYC0KIFiOYfdBoY8OH72D8QS6ZoX3x1+CFarFZSnxS1gk9OBeUJ+00BAimAolnM6nQDDEDVAHVOpWQBD/Ow2GyhPoyDHWKjYkr+GVrv+GWBmE6BYIsChRYCz0Kt2AWR92GxWUJ7TFy7GWltb9l368ZteM77lcukE53A4tC91VAC7jggwVIANd3h+OHM+Qlj2ktvQv9U0EIAkSZibm7vbNUpcIxxPQsfQV2BhwDHrE2C320F5qPnaPCMkdVel9EdDQ8iLeex/5+27H4dYljnGnRo5B1EUMT1fwI2lUs0CHs9JOD9xGeNjY9i7u9dXkKTovZgvv/j8H+y2njX+3FxiHmKhgHiGhCir1CwgKxawsLgEynP06xO0aO2sxV+rhAopm9migrRUuwCJVDMS8nXXEE2ALMtIF2UskVJaqxWIgIqqrl8ATUGFkNDaLKu174RGjzYWykO9A17P+6pa2WEqhVnmDOfmnUgmk+gN2vBsZ33NAng1DxspIpTH1+H1Pdrz2OCHn34GpaQfFYe1Dm+9+nKY62jzpIcG3xU20gukXAZtzU0Rkoo+mo6/TMZxI6E/Dzz9sFdLXc7jad6pSIW+jQho2OSKjl2djOyiAwmdB8jrLMj6Ka3emQd+Gh2jeUvTp7/aTGBgwyv+cJNm5HLx2plQSmX9AkYuiuXqOUuorKoj1RZ/7fU34PcHMLj/PSwv5/4LMsgy7EtKuTz887kLyMoq7CERi/miroD5TB4Xr/wGrsPT8omqqlV3PjAwgIYGAd9/+xVmrledG46QjhiZjs0iSYtSehk3M6KugAUigGK5rqA/rAc89MEBOJy81qq7u4LVJyYL27eYSkV50hkXxCLmDCKQIhiK5do3e3VL59TUNdrZ0N3dddTgLMQ89zX5XKQtP+m14kGB1QVv4VVMrIwCRn9M6PkAGctN1fjnwk9ddjc2hcxgb6eWov/rWE7tVGS0ZyWjfEYRoxlkVoBAIhE2gYst5vKDpVJ51QR96PBhxONxfHzw4Oo+wFl2mBFAJ1W6+IgR0OGwD2/zda4Z32/99ScpTiU80fPIvT/1/y3AAMOmtJl1Hv9IAAAAAElFTkSuQmCC");
        e("link_icon", 16, 16, "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAHVJREFUeNqkkwEOgCAIRaEr6nlqdR49I4XTzcqUn39jE5xP1C+LCPkjCl0Kq2NC5fYgRXlMSCw0K6Xozhqaol3ckj+QVwGFNIsI5HPCCunSLZDhGUcQ0033IOb3riE1CLJty/bTVubUBqDyc+Pm01oY8NQpwAAbUwhLBQIWcAAAAABJRU5ErkJggg==");
        e("linksubnetwork_icon", 16, 16, "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAU5JREFUeNqUUi1Tw0AQ3cukEY0AwdlDM8XRD41ARAAi/RHoCmQ7/QNofkTQFQh8W9kOOtgiQIBImTnuXbs3udAvduZms5t9b/fdrUiHGW2z0cOdLsdJ71GU46yfUrgL/PWx8HLxsUTOI3EE98mp9ZdXie0K8HgydYXtVtN6znHsTQAwdy2DOcY/TMFytkqogqskLIf6qQhYL7q/PI8cOIoiiuO69bvIRf3o5M/YANVqIZ03GjSbz2m5/KGiKDxgp90irbUINzEz2BSQEMKSwJiEwfgONmlFR4AAhg2yV0talWNfAbfJN4s7KHcCCcBPgy7WhobdM7q9uXbd3TPyhvEOwL4/30kpRVJKwrYySZ7nWABlzpsthM49R5lzYUhAruERr/P7CdZNPJJVakUiuOgAw9jSXOyUX8f4ZkCHGzQvAGIw4v9M4E0CMEh/BRgAwM37IYxGnbkAAAAASUVORK5CYII=");
        e("node_icon", 16, 16, "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAGBJREFUeNpiZGBg+M9AJvj//z8jC5RBsmZGRkYwzQITCGlaS7TmNXXBcDYTA4Vg1IDBYAAjJB2Rl5DgKRGWqshyATm2o3uBgcwMBbacBZdmZJfh8CJIASMLodxGCAAEGACTAB0gDBYjygAAAABJRU5ErkJggg==");
        e("node_image", 30, 32, "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAgCAYAAAAFQMh/AAAACXBIWXMAAAsTAAALEwEAmpwYAAAKTWlDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVN3WJP3Fj7f92UPVkLY8LGXbIEAIiOsCMgQWaIQkgBhhBASQMWFiApWFBURnEhVxILVCkidiOKgKLhnQYqIWotVXDjuH9yntX167+3t+9f7vOec5/zOec8PgBESJpHmomoAOVKFPDrYH49PSMTJvYACFUjgBCAQ5svCZwXFAADwA3l4fnSwP/wBr28AAgBw1S4kEsfh/4O6UCZXACCRAOAiEucLAZBSAMguVMgUAMgYALBTs2QKAJQAAGx5fEIiAKoNAOz0ST4FANipk9wXANiiHKkIAI0BAJkoRyQCQLsAYFWBUiwCwMIAoKxAIi4EwK4BgFm2MkcCgL0FAHaOWJAPQGAAgJlCLMwAIDgCAEMeE80DIEwDoDDSv+CpX3CFuEgBAMDLlc2XS9IzFLiV0Bp38vDg4iHiwmyxQmEXKRBmCeQinJebIxNI5wNMzgwAABr50cH+OD+Q5+bk4eZm52zv9MWi/mvwbyI+IfHf/ryMAgQAEE7P79pf5eXWA3DHAbB1v2upWwDaVgBo3/ldM9sJoFoK0Hr5i3k4/EAenqFQyDwdHAoLC+0lYqG9MOOLPv8z4W/gi372/EAe/tt68ABxmkCZrcCjg/1xYW52rlKO58sEQjFu9+cj/seFf/2OKdHiNLFcLBWK8ViJuFAiTcd5uVKRRCHJleIS6X8y8R+W/QmTdw0ArIZPwE62B7XLbMB+7gECiw5Y0nYAQH7zLYwaC5EAEGc0Mnn3AACTv/mPQCsBAM2XpOMAALzoGFyolBdMxggAAESggSqwQQcMwRSswA6cwR28wBcCYQZEQAwkwDwQQgbkgBwKoRiWQRlUwDrYBLWwAxqgEZrhELTBMTgN5+ASXIHrcBcGYBiewhi8hgkEQcgIE2EhOogRYo7YIs4IF5mOBCJhSDSSgKQg6YgUUSLFyHKkAqlCapFdSCPyLXIUOY1cQPqQ28ggMor8irxHMZSBslED1AJ1QLmoHxqKxqBz0XQ0D12AlqJr0Rq0Hj2AtqKn0UvodXQAfYqOY4DRMQ5mjNlhXIyHRWCJWBomxxZj5Vg1Vo81Yx1YN3YVG8CeYe8IJAKLgBPsCF6EEMJsgpCQR1hMWEOoJewjtBK6CFcJg4Qxwicik6hPtCV6EvnEeGI6sZBYRqwm7iEeIZ4lXicOE1+TSCQOyZLkTgohJZAySQtJa0jbSC2kU6Q+0hBpnEwm65Btyd7kCLKArCCXkbeQD5BPkvvJw+S3FDrFiOJMCaIkUqSUEko1ZT/lBKWfMkKZoKpRzame1AiqiDqfWkltoHZQL1OHqRM0dZolzZsWQ8ukLaPV0JppZ2n3aC/pdLoJ3YMeRZfQl9Jr6Afp5+mD9HcMDYYNg8dIYigZaxl7GacYtxkvmUymBdOXmchUMNcyG5lnmA+Yb1VYKvYqfBWRyhKVOpVWlX6V56pUVXNVP9V5qgtUq1UPq15WfaZGVbNQ46kJ1Bar1akdVbupNq7OUndSj1DPUV+jvl/9gvpjDbKGhUaghkijVGO3xhmNIRbGMmXxWELWclYD6yxrmE1iW7L57Ex2Bfsbdi97TFNDc6pmrGaRZp3mcc0BDsax4PA52ZxKziHODc57LQMtPy2x1mqtZq1+rTfaetq+2mLtcu0W7eva73VwnUCdLJ31Om0693UJuja6UbqFutt1z+o+02PreekJ9cr1Dund0Uf1bfSj9Rfq79bv0R83MDQINpAZbDE4Y/DMkGPoa5hpuNHwhOGoEctoupHEaKPRSaMnuCbuh2fjNXgXPmasbxxirDTeZdxrPGFiaTLbpMSkxeS+Kc2Ua5pmutG003TMzMgs3KzYrMnsjjnVnGueYb7ZvNv8jYWlRZzFSos2i8eW2pZ8ywWWTZb3rJhWPlZ5VvVW16xJ1lzrLOtt1ldsUBtXmwybOpvLtqitm63Edptt3xTiFI8p0in1U27aMez87ArsmuwG7Tn2YfYl9m32zx3MHBId1jt0O3xydHXMdmxwvOuk4TTDqcSpw+lXZxtnoXOd8zUXpkuQyxKXdpcXU22niqdun3rLleUa7rrStdP1o5u7m9yt2W3U3cw9xX2r+00umxvJXcM970H08PdY4nHM452nm6fC85DnL152Xlle+70eT7OcJp7WMG3I28Rb4L3Le2A6Pj1l+s7pAz7GPgKfep+Hvqa+It89viN+1n6Zfgf8nvs7+sv9j/i/4XnyFvFOBWABwQHlAb2BGoGzA2sDHwSZBKUHNQWNBbsGLww+FUIMCQ1ZH3KTb8AX8hv5YzPcZyya0RXKCJ0VWhv6MMwmTB7WEY6GzwjfEH5vpvlM6cy2CIjgR2yIuB9pGZkX+X0UKSoyqi7qUbRTdHF09yzWrORZ+2e9jvGPqYy5O9tqtnJ2Z6xqbFJsY+ybuIC4qriBeIf4RfGXEnQTJAntieTE2MQ9ieNzAudsmjOc5JpUlnRjruXcorkX5unOy553PFk1WZB8OIWYEpeyP+WDIEJQLxhP5aduTR0T8oSbhU9FvqKNolGxt7hKPJLmnVaV9jjdO31D+miGT0Z1xjMJT1IreZEZkrkj801WRNberM/ZcdktOZSclJyjUg1plrQr1zC3KLdPZisrkw3keeZtyhuTh8r35CP5c/PbFWyFTNGjtFKuUA4WTC+oK3hbGFt4uEi9SFrUM99m/ur5IwuCFny9kLBQuLCz2Lh4WfHgIr9FuxYji1MXdy4xXVK6ZHhp8NJ9y2jLspb9UOJYUlXyannc8o5Sg9KlpUMrglc0lamUycturvRauWMVYZVkVe9ql9VbVn8qF5VfrHCsqK74sEa45uJXTl/VfPV5bdra3kq3yu3rSOuk626s91m/r0q9akHV0IbwDa0b8Y3lG19tSt50oXpq9Y7NtM3KzQM1YTXtW8y2rNvyoTaj9nqdf13LVv2tq7e+2Sba1r/dd3vzDoMdFTve75TsvLUreFdrvUV99W7S7oLdjxpiG7q/5n7duEd3T8Wej3ulewf2Re/ranRvbNyvv7+yCW1SNo0eSDpw5ZuAb9qb7Zp3tXBaKg7CQeXBJ9+mfHvjUOihzsPcw83fmX+39QjrSHkr0jq/dawto22gPaG97+iMo50dXh1Hvrf/fu8x42N1xzWPV56gnSg98fnkgpPjp2Snnp1OPz3Umdx590z8mWtdUV29Z0PPnj8XdO5Mt1/3yfPe549d8Lxw9CL3Ytslt0utPa49R35w/eFIr1tv62X3y+1XPK509E3rO9Hv03/6asDVc9f41y5dn3m978bsG7duJt0cuCW69fh29u0XdwruTNxdeo94r/y+2v3qB/oP6n+0/rFlwG3g+GDAYM/DWQ/vDgmHnv6U/9OH4dJHzEfVI0YjjY+dHx8bDRq98mTOk+GnsqcTz8p+Vv9563Or59/94vtLz1j82PAL+YvPv655qfNy76uprzrHI8cfvM55PfGm/K3O233vuO+638e9H5ko/ED+UPPR+mPHp9BP9z7nfP78L/eE8/sl0p8zAAAAIGNIUk0AAHolAACAgwAA+f8AAIDpAAB1MAAA6mAAADqYAAAXb5JfxUYAAAO0SURBVHjavJZJaF1lGIaffzzn3pvbxAyYJulgNKJIF7WkuhEHFCy40LpRBLdFcFi4ciOCC9dmU910WbduBEEoRhFEarJw2UaLJXFImya5ubln+AcX5+YG3ZjCaT44cDb/+5zv/Ybzi7npo7Mhhi+886c5hFBaLUshX9dKq8tW2bPjExOHweXW+vpZ7/1lrZWanz52jK+//f5QwC8+8xSrN2/Oa2OM10pJgKwoWd/cRQpRKyzEyMRIk9QatFIYY7xOEou1BoD1zS6ff/kTqbW1grtZyVsvz3N8cgRrDUli0dZabB+kpGSkYdHWUGfOSkT6prLH04m1GFOBBaAkKBkQsU5wACpBYyyJtfSt1hVYVGDZf68rpNjXs1b3rU72rZaAlhFJRMj6wJUm+1bv1diYqrmEFCgJQtaf8Z6gMaaqcbPRpJGmgxprCYhYK1iL/YwbaUqz0UTneUFeusG8uRARNYPLEAn95spLR54X6K+uLDI1NQ3A7e0ey3+UtBJDnfO004vc6WRMjg3zzeIPrK2toje3O6StLWII7GYFt7qOPNS7uTo9x25WEENgY2uLze0Oem9xhOBwwZM5j3WyVnDmPC54QnAoWWlrgBgj3nuc9+yWHq3rBe+Wlbb3nhjjPhiowM7TdQ7t6rW66xzOVeBBpw/AzlM4z3bpkTVnvF1W2t79B1xZXVI4x3bpUfcE7PC+/LfVUgic80giY6lhJDG1gmUESawY/QWhG0aLxBh2dnoMqcBrpyawNWdcuMCQCuzs9EiMoWG00GPDR2QrMVxdWqIsch5L1cCOukJowerKn/x9M6GVGMaGj0hx+uEHrypjzzwwN0cI4Z7et6SU/HbtGr4sftbNVvN9a5NP1m78elpK6a0x9wRalCUhBNUeai0Xhf5ASykXh4fbbxo9+nin2y2v3/i9B3jq29YRUA+dPN5ot1qmdOXS7dvldfHIiRky5wBJt9djfePONHA/4Or6KwJ/TYzet9pqNIBAqjVianSEtY1NgCeBd4FTQBuoq+AS6AC/AAvAj1OjIzAzPoqS8pyAFQHx/x4gzs7OxosXP4ufLizEkydORA5wrv+sKCnPzYyPooFHh5vppQiTB/n8PMt47523Of/qebIsY7fT4eOPPiRJkoMcnxVwCXhOH2kPXWi3WpMH7s48J5Ql1tpq3p3j6Pj44MJ4gJgUUlwQzz5xpgMMHbhFYyRNU55+/gWC93x35Qp5niHu7q60I9545aUeoO5qPkJAqupICOFuoQD+nwEAIKWd899qAZAAAAAASUVORK5CYII=");
        e("shapelink_icon", 16, 16, "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAIJJREFUeNqkUwsOgCAIxeYN5Ty1Og+ekUarzRwQ5tsYDpTPExIzgwY86uWgtSTwIAF6KTvxg/sMliwwCy27mEVr2Xu7+TjaWm4JqxvKpW/iWowQprX2i8RXhS0xXv+WL0xiKIAVxKssa/0hEMuPiB4epNFxnh7lZG1jdCPdABGcAgwAc06H0rgwLSIAAAAASUVORK5CYII=");
        e("shapenode_icon", 16, 16, "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAI9JREFUeNq0UtsNgDAILI0jdZN2Ho3O027SnRA+MNb0QTWS8EPuLncAIKL5UvY5CEdC7h7pjrEtEABgqwucRCBFk7aAfo9uZJtwmXhQCLDyLJlrkSxaMuGgu8QZ8hVhYD8LVgZx9fMO1H9QKXbm+EJvBYwsuSYyFaEmUvyBUkQWCYUDfg5NV8/49xW6dQowAIJydCoPajIHAAAAAElFTkSuQmCC");
        e("shapesubnetwork_icon", 16, 16, "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAATBJREFUeNpiDG5cw4ALbO/L+I/M9yyawYjMX1MXzMCCT/PXD69RxLgFREFiKIbADSjzlAfTjq6eYFtBmk+dPgNXaGZqAqZhYjA+igtAmmG2ImuG8UFyIFfAvIPTC+ia0Q2BeYehLpiRCeZfkO37d2/HqRmX4Yxc/CJwZ9+6fYeBEPjw4QOYNjczZfj//z8j3AuMjIjAvXnrNoomdTVVFDkonxEjEIEmgg1C1oAuhw5YQKEZGhHzH9kVbcuPoiiqirSGy5UUF8FtBwFwIK5esYQRaIMfyE/Y/A0yEGbopk2b/FACEeQ0mO1Ati+UvQndFciuAVkG5W5GMQDqV1+QAci2oxuAFC5+4MCBGQIzAEKBBbFimBxILc7MhOQiPzTxTcixwYhsOxLwRWJvxicHEGAAkPKxzyGuYWgAAAAASUVORK5CYII=");
        e("subnetwork_icon", 16, 16, "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAOJJREFUeNqkUjsOwjAMzavSBQYY4FDM7SGYOUARHICZQ5SBiUPBAAMLIJk8aFASkoDgSVFlu/68Z6NatCqF3Woqrj2ZreHabVMpnUs+H/eerz8c0+cV0amuTK6XG69bDEWsa5hM0KafU/DZeJRCmBwWsXRUUwEU0Y5tRFLfgHRMARYDeoPRSyy383Zee0nsgO5rcROBzo19FUlOoYG0Bp/0IAW7y4LHQT5GB/UL4F6ie3mX0yFLoTQUTByQxE8lQ51wMRHx1Chd4FtkReQUj3VFktj97ZSDNYkK9h6L/03hLsAAjRx4oMVjqkMAAAAASUVORK5CYII=");
        e = function (e, t, n, r) {
            i.Util.registerImage(e, r, t, n)
        };
        e("expand_icon", 16, 18, "data:image/gif;base64,R0lGODlhEAASAIcAADFKY0L/QpSlvZylvZytxqW11qm92r3GxrnK5MbGxsbW69jh8efv9+vz/////wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH5BAMAAAEALAAAAAAQABIAAAhfAAMIHEiwoMGDCBMqXMjQ4AICEAcMECDgwEECDjJmbMAAwEWNDjgi8GgQ40YGCwyQLDjAAYCXL1UeFBAS5QIFBVYSFMBxwU0EOWcyUIDAQIGjOgcegMnUYsOnUKMiDAgAOw==");
        e("collapse_icon", 16, 18, "data:image/gif;base64,R0lGODlhEAASAIcAADFKY0L/QpSlvZylvZytxqW11qm92r3GxrXI48bGxsbS59Te8efv9+vz/////wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH5BAMAAAEALAAAAAAQABIAAAhhAAMIHEiwoMGDCBMqXMjQ4AICEAcMECDgwEECDjJmbMAAwEWNADgq8GgQY0YADBYYIFlwgAMAMGGuPCjAAUcACxQUYElQAMcFABQg2EmTgVADBZLyHHggplOLDaNKnYowIAA7");
        e("close_icon", 11, 11, "data:image/gif;base64,R0lGODlhCwALAIcAAHd3d319fUD/QIODg4iIiI6Ojq6urri4uNnZ2eHh4eTk5Ofn5/Dw8PT09Pj4+Pn5+fz8/P39/f///wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH5BAMAAAIALAAAAAALAAsAAAhdAAUIOECw4AGBAyUoXCjh4AEJDBA4mIiAQcMDERAUKOBgI4IIBCE0IECSZAMIBB8wYDCg5coHBBkkCECTZgIGMQ0AAKBgpwGcBxgsMLCgKFGcA1cqXXlQoMGCAgMCADs=");
        e("sort_desc", 9, 5, "data:image/gif;base64,R0lGODlhCQAFAJECAImJiezs7P///wAAACH5BAEAAAIALAAAAAAJAAUAAAIMDI4QYrnC0INxUnYLADs=");
        e("sort_asc", 9, 5, "data:image/gif;base64,R0lGODlhCQAFAJECAImJiezs7P///wAAACH5BAEAAAIALAAAAAAJAAUAAAIMlAWnwIrcDJwi2HsLADs=")
    })()
})(window);
(function (t, e) {
    var i = _twaver.arrow;
    var n = _twaver.box;
    var s = _twaver.bus;
    var r = _twaver.Dashline;
    var a = _twaver.element;
    var o = _twaver.g;
    var h = _twaver.group;
    var l = _twaver.html;
    var c = _twaver.link;
    var u = _twaver.math;
    var v = _twaver.Matrix;
    var d = _twaver.interaction;
    var f = _twaver.popup;
    var g = _twaver.position;
    var w = _twaver.render;
    var _ = _twaver.touch;
    var m = _twaver.ua;
    var y = twaver.Defaults;
    var p = twaver.List;
    var k = twaver.Node;
    var S = twaver.Group;
    var E = {_hitCanvas: null, getHitCanvas: function (t, e) {
        if (this._hitCanvas == null) {
            this._hitCanvas = l.createCanvas()
        }
        if (arguments.length == 0) {
            t = 2;
            e = 2
        }
        this._hitCanvas.setAttribute("width", "" + t - 1);
        this._hitCanvas.setAttribute("height", "" + e - 1);
        this._hitCanvas.setAttribute("width", "" + t);
        this._hitCanvas.setAttribute("height", "" + e);
        var i = this.getCtx(this._hitCanvas);
        i.clearRect(0, 0, t, e);
        return this._hitCanvas
    }, disposeHitCanvas: function () {
        this._hitCanvas = null
    }, getCtx: function (t) {
        return t.getContext("2d")
    }, render: function (t, i, n) {
        if (i != e) {
            t.fillStyle = i;
            t.fill()
        }
        if (n != e) {
            t.strokeStyle = n;
            t.stroke()
        }
    }, text: function (t, e, i, n, s, r) {
        t.textAlign = "center";
        t.textBaseline = "middle";
        if (s != null) {
            t.fillStyle = s;
            t.fillText(e, i, n)
        }
        if (r) {
            t.strokeStyle = r;
            t.strokeText(e, i, n)
        }
    }, circle: function (t, e, i, n, s, r) {
        t.arc(e, i, n, 0, 2 * Math.PI, true);
        t.closePath();
        this.render(t, s, r)
    }, rect: function (t, e, i, n, s, r, a) {
        t.rect(e, i, n, s);
        t.closePath();
        this.render(t, r, a)
    }, OUT_LEFT: 1, OUT_TOP: 2, OUT_RIGHT: 4, OUT_BOTTOM: 8, outcode: function (t, e, i, n, s, r) {
        var a = 0;
        if (s <= 0) {
            a |= this.OUT_LEFT | this.OUT_RIGHT
        } else if (t < i) {
            a |= this.OUT_LEFT
        } else if (t > i + s) {
            a |= this.OUT_RIGHT
        }
        if (r <= 0) {
            a |= this.OUT_TOP | this.OUT_BOTTOM
        } else if (e < n) {
            a |= this.OUT_TOP
        } else if (e > n + r) {
            a |= this.OUT_BOTTOM
        }
        return a
    }, intersectsLine: function (t, e, i, n, s, r, a, o) {
        var h, l;
        if ((l = this.outcode(i, n, s, r, a, o)) == 0) {
            return true
        }
        while ((h = this.outcode(t, e, s, r, a, o)) != 0) {
            if ((h & l) != 0) {
                return false
            }
            if ((h & (this.OUT_LEFT | this.OUT_RIGHT)) != 0) {
                var c = s;
                if ((h & this.OUT_RIGHT) != 0) {
                    c += a
                }
                e = e + (c - t) * (n - e) / (i - t);
                t = c
            } else {
                var u = r;
                if ((h & this.OUT_BOTTOM) != 0) {
                    u += o
                }
                t = t + (u - e) * (i - t) / (n - e);
                e = u
            }
        }
        return true
    }};
    twaver.canvas = {};
    twaver.canvas.interaction = {};
    twaver.canvas.Network = function (t) {
        twaver.canvas.Network.superClass.constructor.apply(this, arguments);
        this._view = l.createView("auto");
        this._rootCanvas = l.createCanvas();
        this._topCanvas = l.createCanvas();
        this._view.appendChild(this._rootCanvas);
        this._view.appendChild(this._topCanvas);
        this.realWidth = 0;
        this.realHeight = 0;
        this._zoom = 1;
        this._elementUIMap = {};
        this.viewRect = {x: 0, y: 0, width: 0, height: 0};
        this.hScrollBarVisible = false;
        this.vScrollBarVisible = false;
        this.markerList = new twaver.List;
        this._topAttachmentList = new twaver.List;
        this.setElementBox(t ? t : new twaver.ElementBox);
        if (m.isMSToucheable) {
            this.setMSTouchInteractions()
        } else if (m.isTouchable) {
            this.setTouchInteractions()
        } else {
            this.setDefaultInteractions(false)
        }
        this.setToolTipEnabled(twaver.Defaults.NETWORK_TOOLTIP_ENABLED)
    };
    _twaver.ext("twaver.canvas.Network", twaver.controls.View, {__accessor: ["selectMode", "makeVisibleOnSelected", "movableFunction", "editPointSize", "editPointFillColor", "scrollBarWidth", "editPointOutlineWidth", "editPointOutlineColor", "editLineColor", "editLineWidth", "resizePointFillColor", "resizePointOutlineWidth", "resizePointOutlineColor", "resizeLineColor", "resizeLineWidth", "selectOutlineColor", "selectOutlineWidth", "selectFillColor", "lazyMoveOutlineColor", "lazyMoveOutlineWidth", "lazyMoveFillColor", "rectSelectFilter"], __bool: ["doubleClickToUpSubNetwork", "doubleClickToSubNetwork", "doubleClickToEmptySubNetwork", "doubleClickToLinkBundle", "doubleClickToGroupExpand", "scrollBarVisible", "limitViewInCanvas", "autoValidateCanvasSize", "subNetworkAnimate", "lazyMoveAnimate", "resizeAnimate", "noAgentLinkVisible", "keyboardRemoveEnabled", "keyboardSelectEnabled", "sendToTopOnSelected", "lazyMoveFill", "editingElement", "movingElement", "selectingElement", "rectSelectEnabled", "limitElementInPositiveLocation"], _currentSubNetwork: null, _subNetworkAnimate: twaver.Defaults.NETWORK_SUBNETWORK_ANIMATE, _scrollBarWidth: 10, _scrollBarVisible: true, _limitViewInCanvas: true, _autoValidateCanvasSize: true, _makeVisibleOnSelected: twaver.Defaults.NETWORK_MAKE_VISIBLE_ON_SELECTED, _keyboardRemoveEnabled: twaver.Defaults.NETWORK_KEYBOARD_REMOVE_ENABLED, _keyboardSelectEnabled: twaver.Defaults.NETWORK_KEYBOARD_SELECT_ENABLED, _rectSelectEnabled: y.NETWORK_RECT_SELECT_ENABLED, _rectSelectFilter: null, _elementUIFunction: twaver.Defaults.CANVASUI_FUNCTION, _doubleClickToUpSubNetwork: twaver.Defaults.NETWORK_DOUBLECLICK_TO_UPSUBNETWORK, _doubleClickToSubNetwork: twaver.Defaults.NETWORK_DOUBLECLICK_TO_SUBNETWORK, _doubleClickToEmptySubNetwork: twaver.Defaults.NETWORK_DOUBLECLICK_TO_EMPTYSUBNETWORK, _doubleClickToLinkBundle: twaver.Defaults.NETWORK_DOUBLECLICK_TO_LINKBUNDLE, _doubleClickToGroupExpand: twaver.Defaults.NETWORK_DOUBLECLICK_TO_GROUPEXPAND, _selectOutlineColor: twaver.Defaults.NETWORK_SELECT_OUTLINE_COLOR, _selectOutlineWidth: twaver.Defaults.NETWORK_SELECT_OUTLINE_WIDTH, _selectFillColor: twaver.Defaults.NETWORK_SELECT_FILL_COLOR, _sendToTopOnSelected: twaver.Defaults.NETWORK_SENDTOTOP_ON_SELECTED, _lazyMoveOutlineColor: twaver.Defaults.NETWORK_LAZYMOVE_OUTLINE_COLOR, _lazyMoveOutlineWidth: twaver.Defaults.NETWORK_LAZYMOVE_OUTLINE_WIDTH, _lazyMoveFillColor: twaver.Defaults.NETWORK_LAZYMOVE_FILL_COLOR, _lazyMoveFill: twaver.Defaults.NETWORK_LAZYMOVE_FILL, _lazyMoveAnimate: twaver.Defaults.NETWORK_LAZYMOVE_ANIMATE, _resizePointFillColor: twaver.Defaults.NETWORK_RESIZE_POINT_FILL_COLOR, _resizePointOutlineColor: twaver.Defaults.NETWORK_RESIZE_POINT_OUTLINE_COLOR, _resizePointOutlineWidth: twaver.Defaults.NETWORK_RESIZE_POINT_OUTLINE_WIDTH, _resizeLineColor: twaver.Defaults.NETWORK_RESIZE_LINE_COLOR, _resizeLineWidth: twaver.Defaults.NETWORK_RESIZE_LINE_WIDTH, _resizeAnimate: twaver.Defaults.NETWORK_RESIZE_ANIMATE, _editPointSize: twaver.Defaults.NETWORK_EDIT_POINT_SIZE, _editPointFillColor: twaver.Defaults.NETWORK_EDIT_POINT_FILL_COLOR, _editPointOutlineColor: twaver.Defaults.NETWORK_EDIT_POINT_OUTLINE_COLOR, _editPointOutlineWidth: twaver.Defaults.NETWORK_EDIT_POINT_OUTLINE_WIDTH, _editLineColor: twaver.Defaults.NETWORK_EDIT_LINE_COLOR, _editLineWidth: twaver.Defaults.NETWORK_EDIT_LINE_WIDTH, _limitElementInPositiveLocation: y.NETWORK_LIMIT_ELEMENT_INPOSITIVE_LOCATION, _invalidateElementVisibility: false, _invalidateViewRectFlag: false, _repaintTopFlag: false, _invalidateCanvasSizeFlag: false, _isEditingElement: false, _isMovingElement: false, _isSelectingElement: false, _hasEditInteraction: false, adjustBounds: function (t) {
        var e = false;
        var i = this._view.style;
        if (i.left == t.x + "px" && i.top == t.y + "px" && i.width == t.width + "px" && i.height == t.height + "px") {
            e = true
        }
        twaver.canvas.Network.superClass.adjustBounds.apply(this, arguments);
        if (e == true) {
            return
        }
        var n = this._view.offsetWidth;
        var s = this._view.offsetHeight;
        this._rootCanvas.setAttribute("width", n);
        this._rootCanvas.setAttribute("height", s);
        this._topCanvas.setAttribute("width", n);
        this._topCanvas.setAttribute("height", s);
        this.setViewRect(this.viewRect.x, this.viewRect.y, n, s);
        this.invalidateElementVisibility()
    }, getLabel: function (t) {
        return t.getStyle("network.label") || t.getName()
    }, getRootCanvas: function () {
        return this._rootCanvas
    }, getTopCanvas: function () {
        return this._topCanvas
    }, validateImpl: function () {
        if (this._invalidateElementVisibility == true) {
            this._invalidateElementVisibility = false;
            var t = this.getElementBox().getDatas();
            var e = t.size();
            var i = {};
            var n, s, r;
            for (n = 0; n < e; n++) {
                s = t.get(n);
                i[s.getId()] = this.isVisible(s)
            }
            if (this._visibleMap) {
                for (n = 0; n < e; n++) {
                    s = t.get(n);
                    if (i[s.getId()] !== this._visibleMap[s.getId()]) {
                        r = this.getElementUI(s);
                        if (r) {
                            r.invalidate()
                        }
                    }
                }
            }
            for (n = 0; n < e; n++) {
                s = t.get(n);
                r = this.getElementUI(s);
                if (r) {
                    r.validate()
                }
            }
            this._visibleMap = i;
            this.paintRoot()
        }
        this.validateCanvasSize();
        if (this._repaintTopFlag == true) {
            this._repaintTopFlag = false;
            this.paintTopCanvas()
        }
    }, getElementBox: function () {
        return this._box
    }, setElementBox: function (t) {
        if (!t) {
            throw"ElementBox can not be null"
        }
        if (this._box === t) {
            return
        }
        var e = this._box;
        if (e) {
            e.removeDataBoxChangeListener(this.handleElementBoxChange, this);
            e.removeDataPropertyChangeListener(this.handleElementPropertyChange, this);
            e.removePropertyChangeListener(this.handleElementBoxPropertyChange, this);
            e.removeIndexChangeListener(this.handleIndexChange, this);
            e.getLayerBox().removeDataBoxChangeListener(this.handleLayerBoxChange, this);
            e.getLayerBox().removeDataPropertyChangeListener(this.handleLayerPropertyChange, this);
            e.getLayerBox().removeHierarchyChangeListener(this.handleLayerHierarchyChange, this);
            if (!this._selectionModel) {
                e.getSelectionModel().removeSelectionChangeListener(this.handleSelectionChange, this)
            }
        }
        this._box = t;
        this._box.addDataBoxChangeListener(this.handleElementBoxChange, this);
        this._box.addDataPropertyChangeListener(this.handleElementPropertyChange, this);
        this._box.addPropertyChangeListener(this.handleElementBoxPropertyChange, this);
        this._box.addIndexChangeListener(this.handleIndexChange, this);
        this._box.getLayerBox().addDataBoxChangeListener(this.handleLayerBoxChange, this);
        this._box.getLayerBox().addDataPropertyChangeListener(this.handleLayerPropertyChange, this);
        this._box.getLayerBox().addHierarchyChangeListener(this.handleLayerHierarchyChange, this);
        if (this._selectionModel) {
            this._selectionModel._setDataBox(t)
        } else {
            this._box.getSelectionModel().addSelectionChangeListener(this.handleSelectionChange, this)
        }
        this._elementUIMap = {};
        this._box.forEach(this.createElementUI, this);
        this.invalidateElementVisibility();
        this.invalidateCanvasSize();
        this.firePropertyChange("elementBox", e, this._box)
    }, handleElementBoxChange: function (t) {
        var e = t.data;
        if (t.kind === "add") {
            this.createElementUI(e);
            this.invalidateBundleLink(e)
        } else if (t.kind === "remove") {
            var i = this.getElementUI(e);
            if (i) {
                delete this._elementUIMap[e.getId()]
            }
            if (e === this._currentSubNetwork && this._currentSubNetwork != null) {
                this._setCurrentSubNetwork(null)
            }
        } else if (t.kind === "clear") {
            this._elementUIMap = {};
            if (this._currentSubNetwork != null) {
                this._setCurrentSubNetwork(null)
            }
        }
        this.invalidateElementVisibility();
        this.invalidateCanvasSize()
    }, handleElementPropertyChange: function (t) {
        var e = t.source;
        var i = this.getElementUI(e);
        if (i) {
            i.handlePropertyChange(t)
        }
        this.invalidateBundleLink(e);
        this.invalidateElementVisibility();
        this.invalidateCanvasSize()
    }, handleElementBoxPropertyChange: function () {
        this.invalidateElementVisibility()
    }, handleIndexChange: function (t) {
        this.invalidateElementVisibility()
    }, handleLayerBoxChange: function () {
        this.invalidateElementVisibility()
    }, handleLayerPropertyChange: function (t) {
        if (t.property === "editable") {
            this.invalidateSelectedElementUIs(true)
        }
        this.invalidateElementVisibility()
    }, handleLayerHierarchyChange: function () {
        this.invalidateElementVisibility()
    }, handleSelectionChange: function (t) {
        t.datas.forEach(function (e) {
            var i = this.getElementUI(e);
            if (i) {
                i.handleSelectionChange(t)
            }
        }, this);
        var e = this.getSelectionModel().getLastData();
        if (e) {
            if (t.kind === "append" || t.kind === "set") {
                if (this.isMakeVisibleOnSelected()) {
                    this.makeVisible(e)
                }
                if (this.isSendToTopOnSelected()) {
                    this.sendToTop(e)
                }
            }
        }
        this.invalidateElementVisibility()
    }, sendToTop: function (t) {
        if (!this._box.contains(t)) {
            return
        }
        var e = t;
        while (this.isVisible(e.getParent())) {
            e = e.getParent();
            if (!e) {
                break
            }
        }
        if (e !== t) {
            this._box.adjustElementIndex(e)
        }
        this._box.adjustElementIndex(t)
    }, getViewRect: function () {
        if (this.viewRect) {
            return _twaver.clone(this.viewRect)
        }
        return{x: 0, y: 0, width: 0, height: 0}
    }, getCanvasSize: function () {
        return{width: this.realWidth, height: this.realHeight}
    }, setViewOffSet: function (t, e) {
        var i = this.viewRect.x;
        var n = this.viewRect.y;
        var s = this.viewRect.width;
        var r = this.viewRect.height;
        this.setViewRect(i + t, n + e, s, r)
    }, setViewRect: function (t, e, i, n) {
        if (this.isLimitViewInCanvas() == true) {
            if (t < 0) {
                t = 0
            }
            if (i > this.realWidth) {
                t = 0
            } else {
                if (t + i > this.realWidth) {
                    t = this.realWidth - i
                }
            }
            if (e < 0) {
                e = 0
            }
            if (n > this.realHeight) {
                e = 0
            } else {
                if (e + n > this.realHeight) {
                    e = this.realHeight - n
                }
            }
        }
        var s = this.viewRect;
        if (this.viewRect != null) {
            if (t == this.viewRect.x && e == this.viewRect.y && i == this.viewRect.width && n == this.viewRect.height) {
                return
            }
        }
        this.viewRect = {x: t, y: e, width: i, height: n};
        this.firePropertyChange("viewRect", s, this.viewRect);
        this.invalidateElementVisibility()
    }, isHScrollBarVisible: function () {
        return this.hScrollBarVisible
    }, setHScrollBarVisible: function (t) {
        this.hScrollBarVisible = t
    }, isVScrollBarVisible: function () {
        return this.vScrollBarVisible
    }, setVScrollBarVisible: function (t) {
        this.vScrollBarVisible = t
    }, invalidateElementVisibility: function () {
        if (!this._invalidateElementVisibility) {
            this._invalidateElementVisibility = true;
            this.invalidate()
        }
    }, repaintTopCanvas: function () {
        if (!this._repaintTopFlag) {
            this._repaintTopFlag = true;
            this.invalidate()
        }
    }, invalidateCanvasSize: function (t) {
        if (!this._invalidateCanvasSizeFlag) {
            this._invalidateCanvasSizeFlag = true;
            this.invalidate()
        }
    }, validateCanvasSize: function () {
        if (this._invalidateCanvasSizeFlag == false) {
            return
        }
        this._invalidateCanvasSizeFlag = false;
        this._validateCanvasSize()
    }, _validateCanvasSize: function () {
        if (this.isMovingElement()) {
            return
        }
        if (this.isAutoValidateCanvasSize() == false) {
            this.realWidth = 0;
            this.realHeight = 0;
            return
        }
        var t = this.getElementBox().getDatas();
        var e = t.size();
        if (e > 0) {
            var i = {x: 0, y: 0, width: 0, height: 0};
            for (var n = 0; n < e; n++) {
                var s = t.get(n);
                if (this.isVisible(s)) {
                    var r = this.getElementUI(s);
                    if (r) {
                        i = u.unionRect(i, r.getViewRect())
                    }
                }
            }
            if (i.x < 0) {
                i.width += i.x;
                i.x = 0
            }
            if (i.y < 0) {
                i.height += i.y;
                i.y = 0
            }
            if (this.realWidth == (i.x + i.width) * this.getZoom() && this.realHeight == (i.y + i.height) * this.getZoom()) {
                return
            }
            this.realWidth = (i.x + i.width) * this.getZoom();
            this.realHeight = (i.y + i.height) * this.getZoom()
        } else {
            this.realWidth = 0;
            this.realHeight = 0
        }
        this.setViewRect(this.viewRect.x, this.viewRect.y, this.viewRect.width, this.viewRect.height);
        this.firePropertyChange("canvasSizeChange", null, this.viewRect)
    }, getElementUI: function (t) {
        if (t == null) {
            return null
        }
        return this._elementUIMap[t.getId()]
    }, createElementUI: function (t) {
        var e = this._elementUIMap[t.getId()];
        if (!e) {
            e = this._elementUIFunction(this, t);
            if (e) {
                this._elementUIMap[t.getId()] = e
            }
        }
    }, getElementUIFunction: function () {
        return this._elementUIFunction
    }, setElementUIFunction: function (t) {
        if (!t) {
            throw"ElementUIFunction can not be null"
        }
        if (this._elementUIFunction === t) {
            return
        }
        var e = this._elementUIFunction;
        this._elementUIFunction = t;
        this.firePropertyChange("elementUIFunction", e, t);
        if (!this._box.isEmpty()) {
            this._elementUIMap = {};
            this._box.forEach(this.createElementUI, this);
            this.invalidateElementVisibility();
            this.invalidateCanvasSize()
        }
    }, invalidateElementUI: function (t, e) {
        var i = this.getElementUI(t);
        if (i) {
            i.invalidate(e)
        }
    }, invalidateElementUIs: function (t) {
        for (var e in this._elementUIMap) {
            var i = this._elementUIMap[e];
            i.invalidate(t)
        }
    }, invalidateSelectedElementUIs: function (t) {
        this.getSelectionModel().getSelection().forEach(function (e) {
            this.invalidateElementUI(e, t)
        }, this)
    }, invalidateBundleLink: function (t) {
        if (t instanceof twaver.Link && t.getBundleLinks()) {
            t.getBundleLinks().forEachSiblingLink(function (e) {
                if (e !== t) {
                    var i = this.getElementUI(e);
                    if (i) {
                        i.invalidate(false)
                    }
                }
            }, this)
        }
    }, paintRoot: function () {
        var t = this._rootCanvas.getContext("2d");
        t.clearRect(0, 0, this._rootCanvas.width, this._rootCanvas.height);
        this.visibleList = new twaver.List;
        this._topAttachmentList = new twaver.List;
        if (this.getElementBox() == null) {
            return
        }
        var e = this.getElementBox().getDatas();
        var i = e.size();
        if (i == 0) {
            return
        }
        t.save();
        t.scale(this.getZoom(), this.getZoom());
        t.translate(-this.viewRect.x / this.getZoom(), -this.viewRect.y / this.getZoom());
        var n = {x: this.viewRect.x / this.getZoom(), y: this.viewRect.y / this.getZoom(), width: this.viewRect.width / this.getZoom(), height: this.viewRect.height / this.getZoom()};
        var s = this.getElementBox().getLayerBox(), r, a, o, h;
        this.getElementBox().getLayerBox().forEachByDepthFirst(function (h) {
            for (r = 0; r < i; r++) {
                a = e.get(r);
                if (s.getLayerByElement(a) === h && this.isVisible(a)) {
                    o = this.getElementUI(a);
                    if (o != null && this._isInView(o, n)) {
                        o.paint(t);
                        this.visibleList.add(a)
                    }
                }
            }
        }, null, this);
        i = this._topAttachmentList.size();
        for (r = 0; r < i; r++) {
            h = this._topAttachmentList.get(r);
            h.getElementUI().paintAttachment(t, h)
        }
        t.restore()
    }, _isInView: function (t, e) {
        return u.intersects(e, t.getViewRect())
    }, paintTopCanvas: function () {
        var t = this._topCanvas.getContext("2d");
        t.clearRect(0, 0, this._topCanvas.width, this._topCanvas.height);
        this.paintMarker(t)
    }, paintMarker: function (t) {
        var e = this.markerList.size();
        for (var i = 0; i < e; i++) {
            var n = this.markerList.get(i);
            n.paint(t)
        }
    }, getLayerByElement: function (t) {
        return this._box.getLayerBox().getLayerByElement(t)
    }, getLogicalPoint: function (t) {
        var e;
        if (m.isTouchable && t.changedTouches && t.changedTouches.length > 0) {
            var i = this._view.getBoundingClientRect();
            var n = t.changedTouches[0];
            var s = m.isAndroid ? 0 : _.scrollLeft();
            var r = m.isAndroid ? 0 : _.scrollTop();
            e = {x: (n.clientX + this.viewRect.x - i.left - s) / this._zoom, y: (n.clientY + this.viewRect.y - i.top - r) / this._zoom};
            return e
        }
        if (m.isFirefox) {
            e = {x: (t.layerX + this.viewRect.x) / this.getZoom(), y: (t.layerY + this.viewRect.y) / this.getZoom()}
        } else {
            e = {x: (t.offsetX + this.viewRect.x) / this.getZoom(), y: (t.offsetY + this.viewRect.y) / this.getZoom()}
        }
        return e
    }, getElementAt: function (t) {
        if (this.visibleList == null) {
            return null
        }
        var e;
        if (t.target) {
            e = this.getLogicalPoint(t)
        } else {
            e = t
        }
        if (this._topAttachmentList != null) {
            var i = this._topAttachmentList.size();
            for (var n = i - 1; n >= 0; n--) {
                var s = this._topAttachmentList.get(n);
                if (s.hit(e.x, e.y)) {
                    return s.getElement()
                }
            }
        }
        if (this.visibleList != null) {
            var r = this.visibleList.size();
            for (var a = r - 1; a >= 0; a--) {
                var o = this.visibleList.get(a);
                var h = this.getElementUI(o);
                if (h && h.hit(e.x, e.y)) {
                    return o
                }
            }
        }
        return null
    }, hitTest: function (t) {
        var e = this.getElementAt(t);
        if (!e) {
            return null
        }
        var i = this.getElementUI(e);
        if (!i) {
            return null
        }
        var n;
        if (t.target) {
            n = this.getLogicalPoint(t)
        } else {
            n = t
        }
        return i.hitTest(n.x, n.y)
    }, getElementsAtRect: function (t, e, i) {
        var n = new twaver.List;
        if (this.visibleList == null) {
            return n
        }
        var s = this.visibleList.size();
        for (var r = s - 1; r >= 0; r--) {
            var a = this.visibleList.get(r);
            var o = this.getElementUI(a);
            if (o && (!i || i(o._element))) {
                if (e) {
                    if (o.intersects(t)) {
                        n.add(a)
                    }
                } else {
                    if (u.contains(t, o.getViewRect())) {
                        n.add(a)
                    }
                }
            }
        }
        return n
    }, getPosition: function (t, e, i, n, s) {
        var r;
        var a = e instanceof twaver.canvas.ElementUI ? e : this.getElementUI(e);
        if (a) {
            if (t === "from" || t === "to") {
                if (a.getFromPosition) {
                    r = t === "from" ? a.getFromPosition(n, s) : a.getToPosition(n, s);
                    if (r) {
                        return{x: r.x - i.width / 2, y: r.y - i.height / 2}
                    }
                }
            } else if (t === "hotspot") {
                r = a.getHotSpot()
            } else {
                r = g.get(t, a.getBodyRect(), i)
            }
        }
        if (!r && e.getRect) {
            r = g.get(t, e.getRect(), i)
        }
        if (r) {
            return{x: r.x + n, y: r.y + s}
        }
        throw"position '" + t + "' object '" + e + "'"
    }, isValidEvent: function (t) {
        if (!t) {
            return false
        }
        var e;
        var i;
        if (t.currentTarget === this._view) {
            if (m.isFirefox) {
                e = t.layerX;
                i = t.layerY
            } else {
                e = t.offsetX;
                i = t.offsetY
            }
            if (this.isHScrollBarVisible() == true) {
                if (i >= this.viewRect.height - this.getScrollBarWidth()) {
                    return false
                }
            }
            if (this.isVScrollBarVisible() == true) {
                if (e >= this.viewRect.width - this.getScrollBarWidth()) {
                    return false
                }
            }
        }
        return true
    }, addMarker: function (t) {
        this.markerList.add(t);
        this.repaintTopCanvas()
    }, removeMarker: function (t) {
        this.markerList.remove(t);
        this.repaintTopCanvas()
    }, clearMarker: function () {
        this.markerList.clear();
        this.repaintTopCanvas()
    }, isMovable: function (t) {
        if (!this._box.contains(t)) {
            return false
        }
        if (t instanceof twaver.Link) {
            return false
        }
        if (this._movableFunction && !this._movableFunction(t)) {
            return false
        }
        return this.getLayerByElement(t).isMovable()
    }, hasMovableSelectedElements: function () {
        var t = this.getSelectionModel().getSelection();
        for (var e = 0; e < t.size(); e++) {
            var i = t.get(e);
            if (this.isMovable(i)) {
                return true
            }
        }
        return false
    }, getMovableSelectedElements: function () {
        return this.getSelectionModel().toSelection(function (t) {
            return this.isMovable(t)
        }, this)
    }, moveSelectedElements: function (t, e, i, n) {
        if (t === 0 && e === 0) {
            return
        }
        var s = this.getMovableSelectedElementsRect();
        if (s == null) {
            return
        }
        if (this._limitElementInPositiveLocation) {
            if (s.x + t < 0) {
                t = -s.x
            }
            if (s.y + e < 0) {
                e = -s.y
            }
        }
        twaver.Util.moveElements(this.getMovableSelectedElements(), t, e, i, n, this)
    }, getMovableSelectedElementsRect: function () {
        var t = this.getMovableSelectedElements();
        if (t.size() === 0) {
            return null
        }
        var e = null;
        for (var i = 0, n = t.size(); i < n; i++) {
            var s = t.get(i);
            if (s instanceof k) {
                var r = this.getElementUI(s);
                if (r) {
                    e = u.unionRect(e, r.getViewRect())
                }
            }
        }
        return e
    }, isVisible: function (t) {
        if (!this._box.contains(t)) {
            return false
        }
        if (this._visibleFunction && !this._visibleFunction(t)) {
            return false
        }
        if (!this.getLayerByElement(t).isVisible()) {
            return false
        }
        if (a.getSubNetwork(t) !== this._currentSubNetwork) {
            return false
        }
        if (t instanceof twaver.Link) {
            if (!this.isNoAgentLinkVisible()) {
                if (!t.getFromAgent() || !t.getToAgent()) {
                    return false
                }
                if (!this.isVisible(t.getFromAgent()) || !this.isVisible(t.getToAgent())) {
                    return false
                }
            }
            if (t.getBundleIndex() > 0 && t.getBundleCount() > 1 && !t.getStyle("link.bundle.expanded")) {
                return false
            }
        } else {
            var e = t.getParent();
            while (e && !e.ISubNetwork) {
                if (e instanceof twaver.Group) {
                    if (!e.isExpanded() || !this.isVisible(e)) {
                        return false
                    }
                }
                e = e.getParent()
            }
        }
        if (t.IDummy) {
            return false
        }
        return true
    }, getVisibleFunction: function () {
        return this._visibleFunction
    }, setVisibleFunction: function (t) {
        var e = this._visibleFunction;
        this._visibleFunction = t;
        this.firePropertyChange("visibleFunction", e, t);
        this.invalidateElementVisibility()
    }, isEditable: function (t) {
        if (!this._box.contains(t)) {
            return false
        }
        if (this._editableFunction && !this._editableFunction(t)) {
            return false
        }
        return this.getLayerByElement(t).isEditable()
    }, getEditableFunction: function () {
        return this._editableFunction
    }, setEditableFunction: function (t) {
        var e = this._editableFunction;
        this._editableFunction = t;
        this.firePropertyChange("editableFunction", e, t);
        this.invalidateSelectedElementUIs(true)
    }, onShareSelectionModelChanged: function () {
        this.invalidateElementUIs()
    }, getShadowColor: function (t) {
        var e = t.getStyle("shadow.color");
        if (!e && this.isSelected(t) && t.getStyle("select.style") === "shadow") {
            return t.getStyle("select.color")
        }
        return e
    }, getSelectColor: function (t) {
        return t.getStyle("select.color")
    }, getAlarmLabel: function (t) {
        var e = t.getAlarmState().getHighestNewAlarmSeverity();
        if (e) {
            var i = t.getAlarmState().getNewAlarmCount(e) + e.nickName;
            if (t.getAlarmState().hasLessSevereNewAlarms()) {
                i += "+"
            }
            return i
        }
        return null
    }, getLinkHandlerLabel: function (t) {
        if (t.isBundleAgent()) {
            return"+(" + t.getBundleCount() + ")"
        }
        return null
    }, setInteractions: function (t) {
        var e = this._interactions;
        if (e) {
            e.forEach(function (t) {
                t.tearDown()
            })
        }
        this._interactions = t;
        if (t) {
            t.forEach(function (t) {
                t.setUp()
            })
        }
        this.invalidateSelectedElementUIs(true);
        this.firePropertyChange("interactions", e, t)
    }, getInteractions: function () {
        return this._interactions
    }, setDefaultInteractions: function (t) {
        this.setInteractions([new twaver.canvas.interaction.SelectInteraction(this), new twaver.canvas.interaction.MoveInteraction(this, t), new twaver.canvas.interaction.ScrollInteraction(this), new twaver.canvas.interaction.DefaultInteraction(this)])
    }, setTouchInteractions: function () {
        this.setInteractions([new twaver.canvas.interaction.TouchInteraction(this)])
    }, setMSTouchInteractions: function () {
        this.setInteractions([new twaver.canvas.interaction.ScrollInteraction(this), new twaver.canvas.interaction.MSTouchInteraction(this)])
    }, setEditInteractions: function (t) {
        this.setInteractions([new twaver.canvas.interaction.SelectInteraction(this), new twaver.canvas.interaction.EditInteraction(this, t), new twaver.canvas.interaction.MoveInteraction(this, t), new twaver.canvas.interaction.ScrollInteraction(this), new twaver.canvas.interaction.DefaultInteraction(this)])
    }, setCreateElementInteractions: function (t) {
        this.setInteractions([new twaver.canvas.interaction.CreateElementInteraction(this, t), new twaver.canvas.interaction.DefaultInteraction(this)])
    }, setCreateLinkInteractions: function (t) {
        this.setInteractions([new twaver.canvas.interaction.CreateLinkInteraction(this, t), new twaver.canvas.interaction.ScrollInteraction(this), new twaver.canvas.interaction.DefaultInteraction(this)])
    }, setCreateShapeLinkInteractions: function (t) {
        this.setInteractions([new twaver.canvas.interaction.CreateShapeLinkInteraction(this, t), new twaver.canvas.interaction.ScrollInteraction(this), new twaver.canvas.interaction.DefaultInteraction(this)])
    }, setCreateShapeNodeInteractions: function (t) {
        this.setInteractions([new twaver.canvas.interaction.CreateShapeNodeInteraction(this, t), new twaver.canvas.interaction.ScrollInteraction(this), new twaver.canvas.interaction.DefaultInteraction(this)])
    }, setPanInteractions: function () {
        this.setInteractions([new twaver.canvas.interaction.PanInteraction(this), new twaver.canvas.interaction.ScrollInteraction(this), new twaver.canvas.interaction.DefaultInteraction(this)])
    }, hasEditInteraction: function () {
        return this._hasEditInteraction
    }, setHasEditInteraction: function (t) {
        var e = this._hasEditInteraction;
        this._hasEditInteraction = t;
        this.firePropertyChange("hasEditInteraction", e, t)
    }, addElementByInteraction: function (t) {
        if (!t.getParent()) {
            t.setParent(this._currentSubNetwork)
        }
        this._box.add(t);
        this.getSelectionModel().setSelection(t);
        this.fireInteractionEvent({kind: "createElement", element: t})
    }, getToolTip: function (t) {
        if (t) {
            var e = t.getToolTip();
            if (e) {
                return e
            }
            return t.getName()
        }
        return null
    }, isToolTipEnabled: function () {
        return this._toolTipEnabled ? true : false
    }, setToolTipEnabled: function (t) {
        this._toolTipEnabled = t;
        if (t) {
            if (!this._toolTipListener) {
                var e = this;
                this._toolTipListener = function (t) {
                    var i = e.getElementAt(t);
                    if (i) {
                        var n = e.getToolTip(i);
                        f.showToolTip({x: t.pageX, y: t.pageY}, n);
                        var s = f.getToolTipDiv();
                        var s = f.getToolTipDiv();
                        if (s.children.length > 0) {
                            var r = e._view.getBoundingClientRect();
                            var a = s.getBoundingClientRect();
                            if (a.width + a.left > r.width + r.left) {
                                s.style.left = r.width + r.left - a.width + (document.documentElement.scrollLeft || document.body.scrollLeft) + "px"
                            }
                            if (a.height + a.top > r.height + r.top) {
                                s.style.top = r.height + r.top - a.height + (document.documentElement.scrollTop || document.body.scrollTop) + "px"
                            }
                        }
                        return
                    }
                    f.hideToolTip()
                };
                this._view.addEventListener("mousemove", this._toolTipListener, true);
                this.firePropertyChange("toolTipEnabled", false, true)
            }
        } else {
            if (this._toolTipListener) {
                f.hideToolTip();
                this._view.removeEventListener("mousemove", this._toolTipListener, true);
                delete this._toolTipListener;
                this.firePropertyChange("toolTipEnabled", true, false)
            }
        }
    }, setZoom: function (t) {
        var e = this._zoom;
        if (this._zoom == t) {
            return
        }
        var i = {x: (this.viewRect.x + this.viewRect.width / 2) / this.getZoom() * t, y: (this.viewRect.y + this.viewRect.height / 2) / this.getZoom() * t};
        this._zoom = t;
        this.invalidateElementVisibility();
        this.invalidateCanvasSize();
        this.validateCanvasSize();
        this.setViewRect(i.x - this.viewRect.width / 2, i.y - this.viewRect.height / 2, this.viewRect.width, this.viewRect.height);
        this.firePropertyChange("zoom", e, this._zoom)
    }, getZoom: function () {
        return this._zoom
    }, zoomOverview: function (t) {
        if (this.realWidth <= 0 || this.realHeight <= 0) {
            return
        }
        var e = this.realWidth / this.getZoom();
        var i = this.realHeight / this.getZoom();
        var n = this.viewRect.width / e;
        var s = this.viewRect.height / i;
        var r = Math.min(n, s);
        this.setZoom(r)
    }, zoomReset: function () {
        this.setZoom(1)
    }, zoomIn: function () {
        this.setZoom(this.getZoom() * 1.2)
    }, zoomOut: function () {
        this.setZoom(this.getZoom() / 1.2)
    }, upSubNetwork: function (t, e) {
        if (this._currentSubNetwork) {
            this.setCurrentSubNetwork(a.getSubNetwork(this._currentSubNetwork), t, e)
        }
    }, getCurrentSubNetwork: function () {
        return this._currentSubNetwork
    }, setCurrentSubNetwork: function (t, e, i) {
        twaver.animate.AnimateManager.endAnimate();
        if (e) {
            if (this._currentSubNetwork === t) {
                return
            }
            if (t && !this._box.contains(t)) {
                throw t + " is not contained in this network's elementBox"
            }
            var n = new twaver.animate.AnimateSubNetwork(this, t, i);
            twaver.animate.AnimateManager.start(n)
        } else {
            this._setCurrentSubNetwork(t);
            if (i) {
                i()
            }
        }
    }, _setCurrentSubNetwork: function (t) {
        if (this._currentSubNetwork === t) {
            return
        }
        if (t && !this._box.contains(t)) {
            throw t + " is not contained in this network's elementBox"
        }
        var e = this._currentSubNetwork;
        this._currentSubNetwork = t;
        this.firePropertyChange("currentSubNetwork", e, t);
        this.invalidateElementVisibility();
        this.invalidateCanvasSize()
    }, makeVisible: function (t) {
        var e = this.getElementUI(t);
        if (!e) {
            return
        }
        var i = a.getSubNetwork(t);
        if (i !== this._currentSubNetwork) {
            var n = this;
            this.setCurrentSubNetwork(i, this.isSubNetworkAnimate(), function () {
                _twaver.callLater(n.makeVisible, n, [t])
            });
            return
        }
        var s = t;
        while ((s = s.getParent()) && s !== i) {
            if (s instanceof twaver.Group) {
                s.setExpanded(true)
            }
        }
        var r = e.getViewRect();
        if (!r) {
            return
        }
        var o = {x: r.x * this.getZoom(), y: r.y * this.getZoom(), width: r.width * this.getZoom(), height: r.height * this.getZoom()};
        if (!u.intersects(this.viewRect, o)) {
            if (this.isVisible(t)) {
                _twaver.callLater(this.centerByLogicalPoint, this, [o.x + o.width / 2, o.y + o.height / 2])
            }
        }
    }, centerByLogicalPoint: function (t, e, i) {
        var n = t - this.viewRect.width / 2;
        var s = e - this.viewRect.height / 2;
        this.setViewRect(n, s, this.viewRect.width, this.viewRect.height)
    }, panByOffset: function (t, e) {
        this.setViewOffSet(t, e)
    }, getIconsNames: function (t) {
        return t.getStyle("icons.names")
    }, getIconsColors: function (t) {
        return t.getStyle("icons.colors")
    }, toCanvas: function (t, e, i) {
        if (!i) {
            i = l.createCanvas()
        }
        i.setAttribute("width", t);
        i.setAttribute("height", e);
        if (i._viewRect) {
            i._viewRect.width = t;
            i._viewRect.height = e
        } else {
            i._viewRect = {x: 0, y: 0, width: t, height: e}
        }
        var n = i.getContext("2d");
        n.clearRect(0, 0, t, e);
        if (this._view.clientWidth === 0 || this._view.clientHeight === 0) {
            return i
        }
        var s = t / this.realWidth * this._zoom;
        var r = e / this.realHeight * this._zoom;
        n.scale(s, r);
        var a = this.getElementBox().getDatas();
        var o = a.size();
        this._topAttachmentList = new twaver.List;
        var h = this.getElementBox().getLayerBox(), c = h.getRoots(), u = c.size(), v, d, f, g, w, _;
        for (v = 0; v < u; v++) {
            d = c.get(v);
            for (f = 0; f < o; f++) {
                g = a.get(f);
                if (h.getLayerByElement(g) === d && this.isVisible(g)) {
                    w = this.getElementUI(g);
                    if (w != null) {
                        w.paint(n)
                    }
                }
            }
        }
        o = this._topAttachmentList.size();
        for (f = 0; f < o; f++) {
            _ = this._topAttachmentList.get(f);
            _.getElementUI().paintAttachment(n, _)
        }
        return i
    }, toCanvasByRegion: function (t, e, i) {
        if (!i) {
            i = l.createCanvas()
        }
        var n = t.width * e;
        var s = t.height * e;
        i.setAttribute("width", n);
        i.setAttribute("height", s);
        if (i._viewRect) {
            i._viewRect.width = n;
            i._viewRect.height = s
        } else {
            i._viewRect = {x: 0, y: 0, width: n, height: s}
        }
        var r = i.getContext("2d");
        r.clearRect(0, 0, n, s);
        if (this._view.clientWidth === 0 || this._view.clientHeight === 0) {
            return i
        }
        r.scale(e, e);
        r.arc(t.width / 2, t.height / 2, Math.min(t.width, t.height) / 2, 0, Math.PI * 2, true);
        r.clip();
        r.beginPath();
        r.translate(-t.x, -t.y);
        var a = this.getElementBox().getDatas();
        var o = a.size();
        this._topAttachmentList = new twaver.List;
        var h = this.getElementBox().getLayerBox(), c = h.getDatas(), v = c.size(), d, f, g, w, _, m;
        for (d = 0; d < v; d++) {
            f = c.get(d);
            for (g = 0; g < o; g++) {
                w = a.get(g);
                if (h.getLayerByElement(w) === f && this.isVisible(w)) {
                    _ = this.getElementUI(w);
                    if (_ != null && u.intersects(t, _.getViewRect())) {
                        _.paint(r)
                    }
                }
            }
        }
        o = this._topAttachmentList.size();
        for (g = 0; g < o; g++) {
            m = this._topAttachmentList.get(g);
            m.getElementUI().paintAttachment(r, m)
        }
        return i
    }, getGroupChildrenRects: function (t) {
        var e = new p;
        t.getChildren().forEach(function (t) {
            if (t instanceof k) {
                var i = this.getElementUI(t);
                if (i) {
                    var n = i.getViewRect();
                    if (n) {
                        e.add(n)
                    }
                }
            }
        }, this);
        return e
    }});
    twaver.canvas.Overview = function (t) {
        twaver.canvas.Overview.superClass.constructor.apply(this, t);
        this._view = l.createView();
        this._rootDiv = l.createDiv();
        this._imageCanvas = l.createCanvas();
        this._imageDiv = l.createDiv();
        this._maskCanvas = l.createCanvas();
        this._selectDiv = l.createDiv();
        this._isNetworkDirty = false;
        this._isMaskDirty = false;
        l.setVisible(this._selectDiv, false);
        this._view.appendChild(this._rootDiv);
        this._rootDiv.appendChild(this._imageDiv);
        this._rootDiv.appendChild(this._maskCanvas);
        this._rootDiv.appendChild(this._selectDiv);
        this._imageDiv.appendChild(this._imageCanvas);
        this.setNetwork(t);
        var e;
        if (m.isMSToucheable) {
            e = twaver.canvas.OverviewMSTouchInteraction
        } else if (m.isTouchable) {
            e = twaver.canvas.OverviewTouchInteraction
        } else {
            e = twaver.canvas.OverviewInteraction
        }
        if (e) {
            new e(this)
        }
    };
    _twaver.ext("twaver.canvas.Overview", twaver.controls.ControlBase, {__accessor: ["fillColor", "outlineColor", "outlineWidth", "selectColor", "selectWidth", "padding", "maxPackingWidth", "maxPackingHeight"], __bool: ["animate"], _fillColor: y.OVERVIEW_FILL_COLOR, _outlineColor: y.OVERVIEW_OUTLINE_COLOR, _outlineWidth: y.OVERVIEW_OUTLINE_WIDTH, _selectColor: y.OVERVIEW_SELECT_COLOR, _selectWidth: y.OVERVIEW_SELECT_WIDTH, _padding: y.OVERVIEW_PADDING, _animate: y.OVERVIEW_ANIMATE, _maxPackingWidth: y.OVERVIEW_MAX_PACKING_WIDTH, _maxPackingHeight: y.OVERVIEW_MAX_PACKING_HEIGHT, getNetwork: function () {
        return this._network
    }, onPropertyChanged: function (t) {
        this._invalidateMask()
    }, setNetwork: function (t) {
        if (t === this._network) {
            return
        }
        if (this._network) {
            this._network.removePropertyChangeListener(this._handleNetworkPropertyChange, this);
            this._network.removeViewListener(this._handleNetworkViewChange, this);
            l.removeEventListener("scroll", "_handleScrollChange", this._network.getView(), this)
        }
        this._network = t;
        if (this._network) {
            this._network.addPropertyChangeListener(this._handleNetworkPropertyChange, this);
            this._network.addViewListener(this._handleNetworkViewChange, this);
            l.addEventListener("scroll", "_handleScrollChange", this._network.getView(), this)
        }
        this.invalidate()
    }, _handleNetworkPropertyChange: function (t) {
        if (t.property === "zoom" || t.property === "currentSubNetwork" || t.property === "elementBox" || t.property === "dataBox" || t.property === "canvasSizeChange") {
            this.invalidate()
        }
    }, _handleNetworkViewChange: function (t) {
        if (t.kind === "validateEnd") {
            this.invalidate()
        }
    }, _handleScrollChange: function () {
        this._invalidateMask()
    }, invalidate: function (t) {
        if (!this._isNetworkDirty || !this._isMaskDirty) {
            if (!this._isNetworkDirty) {
                this._isNetworkDirty = true
            }
            if (!this._isMaskDirty) {
                this._isMaskDirty = true
            }
            _twaver.callLater(this.validate, this, null, t)
        }
    }, _invalidateMask: function () {
        if (!this._isMaskDirty) {
            this._isMaskDirty = true;
            _twaver.callLater(this.validate, this, [], 100)
        }
    }, validate: function () {
        if ((this._isMaskDirty || this._isNetworkDirty) && this._network && (this._maxPackingWidth > 0 && this._maxPackingHeight > 0 || this._view.clientWidth > 0 && this._view.clientHeight > 0) && this._network.getViewRect().width !== 0 && this._network.getViewRect().height !== 0) {
            var t = this._maxPackingWidth > 0 && this._maxPackingHeight > 0;
            var e;
            if (t) {
                e = {x: 0, y: 0, width: this._maxPackingWidth, height: this._maxPackingHeight}
            } else {
                e = {x: 0, y: 0, width: this._view.clientWidth, height: this._view.clientHeight}
            }
            u.grow(e, -this._padding, -this._padding);
            var i = Math.min(e.width / this._network.getCanvasSize().width, e.height / this._network.getCanvasSize().height);
            if (t) {
                l.setDiv(this._view, {x: 0, y: 0, width: this._imageDiv._viewRect.width, height: this._imageDiv._viewRect.height}, null, 0, null);
                e.width = this._imageDiv._viewRect.width;
                e.height = this._imageDiv._viewRect.height
            }
            var n = this._network.getCanvasSize().width * i;
            var s = this._network.getCanvasSize().height * i;
            var r = e.x + (e.width - n) / 2;
            var a = e.y + (e.height - s) / 2;
            if (this._isNetworkDirty) {
                var h = {x: r, y: a, width: n, height: s};
                this._network.toCanvas(h.width, h.height, this._imageCanvas);
                l.setDiv(this._imageDiv, h, null, 0, null);
                if (this._network.getElementBox) {
                    this._imageDiv.style.backgroundColor = (this._network.getCurrentSubNetwork() || this._network.getElementBox()).getStyle("background.color") || ""
                }
                this._isNetworkDirty = false
            }
            if (this._isMaskDirty) {
                var c = {x: this._network.getViewRect().x * i, y: this._network.getViewRect().y * i, width: n * this._network._view.clientWidth / this._network.getCanvasSize().width, height: s * this._network._view.clientHeight / this._network.getCanvasSize().height};
                var v = l.setCanvas(this._maskCanvas, r, a, n, s);
                v.lineWidth = 0;
                v.fillStyle = this._fillColor;
                o.drawVector(v, "rectangle", null, r, a, n, s);
                v.closePath();
                v.fill();
                v.stroke();
                v.clearRect(r + c.x, a + c.y, c.width, c.height);
                v.lineWidth = this._outlineWidth;
                v.strokeStyle = this._outlineColor;
                o.drawVector(v, "rectangle", null, r + c.x + this._outlineWidth, a + c.y + this._outlineWidth, c.width - this._outlineWidth * 2, c.height - this._outlineWidth * 2);
                v.closePath();
                v.stroke();
                this._isMaskDirty = false
            }
        } else {
            this._isNetworkDirty = false;
            this._isMaskDirty = false
        }
    }, getLogicalPoint: function (t) {
        return l.getLogicalPoint(this._view, t, 1, this._rootDiv)
    }, centerNetwork: function (t, e) {
        var i = this._imageDiv._viewRect;
        if (u.containsPoint(i, t)) {
            this._network.centerByLogicalPoint((t.x - i.x) / i.width * this._network.getCanvasSize().width, (t.y - i.y) / i.height * this._network.getCanvasSize().height, e);
            this._invalidateMask()
        }
    }});
    twaver.canvas.OverviewTouchInteraction = function (t) {
        this.overview = t;
        this.network = t.getNetwork();
        this.view = t._view;
        l.addEventListener("touchstart", "handleTouchstart", this.view, this)
    };
    _twaver.ext("twaver.canvas.OverviewTouchInteraction", Object, {handleTouchstart: function (t) {
        l.preventDefault(t);
        this.clear();
        this.endPoint = this.overview.getLogicalPoint(t);
        if (_.isMultiTouch(t)) {
            this.distance = _.getDistance(t);
            this.zoom = this.network.getZoom()
        }
        l.addEventListener("touchmove", "handleTouchmove", this.view, this);
        l.addEventListener("touchend", "handleTouchend", this.view, this)
    }, handleTouchmove: function (t) {
        if (!this.moved) {
            this.moved = true
        }
        this.endPoint = this.overview.getLogicalPoint(t);
        if (_.isSingleTouch(t)) {
            this.overview.centerNetwork(this.endPoint, false)
        } else {
            if (this.distance) {
                var e = _.getDistance(t) / this.distance;
                this.network.setZoom(this.zoom * e, false)
            }
        }
    }, handleTouchend: function (t) {
        if (!this.moved) {
            this.endPoint = this.overview.getLogicalPoint(t);
            var e = this.lastPoint && this.lastTouchStartTime && (new Date).getTime() - this.lastTouchStartTime.getTime() <= 300 && Math.abs(this.endPoint.x - this.lastPoint.x) <= 10 && Math.abs(this.endPoint.y - this.lastPoint.y) <= 10;
            if (e) {
                this.lastPoint = null;
                this.lastTouchStartTime = null
            } else {
                this.lastPoint = this.endPoint;
                this.lastTouchStartTime = new Date
            }
            if (e) {
                _twaver.callLater(this.network.zoomReset, this.network, [this.overview._animate])
            } else {
                this.overview.centerNetwork(this.endPoint, this.overview._animate)
            }
        }
        this.clear()
    }, clear: function () {
        if (this.endPoint) {
            this.endPoint = null;
            l.removeEventListener("touchmove", this.view, this);
            l.removeEventListener("touchend", this.view, this)
        }
        this.moved = false
    }});
    twaver.canvas.OverviewMSTouchInteraction = function (t) {
        this.overview = t;
        this.network = t.getNetwork();
        this.view = t._view;
        this._pointerMap = {};
        this._pointerIdArray = [];
        var e = this;
        this.view.addEventListener("MSPointerDown", function (t) {
            e.handleTouchstart(t)
        }, false);
        this.view.addEventListener("MSPointerMove", function (t) {
            e.handleTouchmove(t)
        }, false);
        this.view.addEventListener("MSPointerUp", function (t) {
            e.handleTouchend(t)
        }, false);
        this.view.addEventListener("MSPointerCancel", function (t) {
            e.handleTouchend(t)
        }, false)
    };
    _twaver.ext("twaver.canvas.OverviewMSTouchInteraction", Object, {handleTouchstart: function (t) {
        l.preventDefault(t);
        if (t.isPrimary && this._pointerIdArray.length > 0) {
            this._pointerMap = {};
            this._pointerIdArray = []
        }
        if (!this._pointerMap[t.pointerId] && this.overview.getLogicalPoint(t)) {
            this._pointerIdArray.push(t.pointerId);
            this._pointerMap[t.pointerId] = t
        }
        if (this._pointerIdArray.length == 1) {
            this._startTouchPoint = this.overview.getLogicalPoint(t);
            this._startTouchTime = new Date
        } else if (this._pointerIdArray.length == 2) {
            this._distance = this._getDistance();
            this._zoom = this.network.getZoom()
        }
    }, handleTouchmove: function (t) {
        if (this._pointerIdArray.length == 0 || !this._pointerMap[t.pointerId] || u.getDistance({x: this._pointerMap[t.pointerId].pageX, y: this._pointerMap[t.pointerId].pageY}, {x: t.pageX, y: t.pageY}) <= 10) {
            return
        }
        this._pointerMap[t.pointerId] = t;
        if (this._pointerIdArray.length == 2) {
            var e = this._getDistance() / this._distance;
            this.network.setZoom(this._zoom * e, false)
        } else if (this._pointerIdArray.length == 1) {
            if (this._startTouchPoint) {
                var i = this.overview.getLogicalPoint(t);
                if (i == null) {
                    return
                }
                this._startTouchPoint = i;
                this.overview.centerNetwork(this._startTouchPoint, false)
            }
        }
    }, handleTouchend: function (t) {
        var e = this.overview.getLogicalPoint(t);
        if (this._pointerIdArray.length == 1 && e) {
            var i = this._endTouchPoint && this._endTouchTime && (new Date).getTime() - this._endTouchTime.getTime() <= 500 && u.getDistance(this._endTouchPoint, e) <= 10;
            if (i) {
                this._endTouchPoint = null;
                this._endTouchTime = null
            } else {
                this._endTouchPoint = e;
                this._endTouchTime = new Date
            }
            if (i) {
                _twaver.callLater(this.network.zoomReset, this.network, [this.overview._animate])
            } else {
                this.overview.centerNetwork(this._endTouchPoint, this.overview._animate)
            }
        }
        this._pointerMap = {};
        this._pointerIdArray = []
    }, _getDistance: function () {
        return u.getDistance({x: this._pointerMap[this._pointerIdArray[0]].pageX, y: this._pointerMap[this._pointerIdArray[0]].pageY}, {x: this._pointerMap[this._pointerIdArray[1]].pageX, y: this._pointerMap[this._pointerIdArray[1]].pageY})
    }});
    twaver.canvas.OverviewInteraction = function (t) {
        this.overview = t;
        this.network = t.getNetwork();
        this.view = t._view;
        l.addEventListener("mousedown", "handleMousedown", this.view, this)
    };
    _twaver.ext("twaver.canvas.OverviewInteraction", Object, {handleMousedown: function (t) {
        this.clear();
        this.endPoint = this.overview.getLogicalPoint(t);
        if (_twaver.isCtrlDown(t)) {
            this.startPoint = this.endPoint;
            l.setVisible(this.overview._selectDiv, true)
        }
        l.addEventListener("mousemove", "handleMousemove", this.view, this);
        l.addEventListener("mouseup", "handleMouseup", this.view, this)
    }, handleMouseup: function (t) {
        this.endPoint = this.overview.getLogicalPoint(t);
        if ("detail"in t && t.detail === 2) {
            _twaver.callLater(this.network.zoomReset, this.network, [this.overview._animate])
        } else {
            if (l.isVisible(this.overview._selectDiv) && this.startPoint) {
                var e = this.overview._imageDiv._viewRect;
                var i = this.overview._selectDiv._viewRect.x;
                var n = this.overview._selectDiv._viewRect.y;
                var s = e.width / this.overview._selectDiv._viewRect.width;
                var r = e.height / this.overview._selectDiv._viewRect.height;
                var a = Math.min(s, r);
                this.network.setZoom(a * Math.min(this.network.getViewRect().width / this.network.getCanvasSize().width, this.network.getViewRect().height / this.network.getCanvasSize().height) * this.network.getZoom(), false);
                var o = this.network.getCanvasSize().width * ((i - e.x + this.overview._selectDiv._viewRect.width / 2) / e.width);
                var h = this.network.getCanvasSize().height * ((n - e.y + this.overview._selectDiv._viewRect.height / 2) / e.height);
                _twaver.callLater(this.network.centerByLogicalPoint, this.network, [o, h, this.overview._animate]);
                l.setVisible(this.overview._selectDiv, false);
                l.setDiv(this.overview._selectDiv, {x: 0, y: 0, width: 0, height: 0}, null, 0, null);
                this.startPoint = null
            } else {
                this.overview.centerNetwork(this.endPoint, this.overview._animate)
            }
        }
        this.clear()
    }, handleMousemove: function (t) {
        var e = this.overview.getLogicalPoint(t);
        this.endPoint = e;
        if (l.isVisible(this.overview._selectDiv) && this.startPoint) {
            var i = e.x > this.startPoint.x ? this.startPoint.x : e.x;
            var n = e.x > this.startPoint.x ? this.startPoint.y : e.y;
            if (e.x > this.startPoint.x && e.y < this.startPoint.y) {
                n = e.y
            }
            if (e.x < this.startPoint.x && e.y > this.startPoint.y) {
                n = this.startPoint.y
            }
            var s = this.overview._imageDiv._viewRect;
            if (i < s.x) {
                i = s.x
            }
            if (i > s.x + s.width) {
                i = s.x + s.width
            }
            if (n < s.y) {
                n = s.y
            }
            if (n > s.y + s.height) {
                n = s.y + s.height
            }
            var r = Math.abs(e.x - this.startPoint.x);
            var a = Math.abs(e.y - this.startPoint.y);
            if (i + r > s.x + s.width) {
                r = s.x + s.width - i
            }
            if (n + a > s.y + s.height) {
                a = s.y + s.height - n
            }
            l.setDiv(this.overview._selectDiv, {x: i, y: n, width: r, height: a}, null, this.overview._selectWidth, this.overview._selectColor)
        } else {
            this.overview.centerNetwork(e, false)
        }
    }, clear: function () {
        if (this.endPoint) {
            this.endPoint = null;
            l.removeEventListener("mousemove", this.view, this);
            l.removeEventListener("mouseup", this.view, this)
        }
    }});
    twaver.canvas.ElementUI = function (t, e) {
        this._network = t;
        this._element = e;
        this._attachments = new twaver.List;
        this._bodyBounds = new twaver.List;
        this._hitTest = false;
        this._hitTest = false;
        this._intersectTest = false;
        this.invalidate(true)
    };
    _twaver.ext("twaver.canvas.ElementUI", Object, {getElement: function () {
        return this._element
    }, getNetwork: function () {
        return this._network
    }, handlePropertyChange: function (t) {
        this.invalidate(true)
    }, handleSelectionChange: function (t) {
        this.invalidate(true)
    }, invalidate: function (t) {
        if (t === e) {
            t = true
        }
        if (t) {
            this._invalidateAttachmentsFlag = true
        }
        if (this._invalidateFlag) {
            return
        }
        this._hotSpot = null;
        this._bodyRect = null;
        this._invalidateFlag = true;
        this._network.invalidateElementVisibility()
    }, updateStyle: function () {
        this._innerColor = this._network.getInnerColor(this._element);
        this._outerColor = this._network.getOuterColor(this._element);
        this._shadowColor = this._network.getShadowColor(this._element);
        this._shadowXOffset = this._element.getStyle("shadow.xoffset");
        this._shadowYOffset = this._element.getStyle("shadow.yoffset");
        this._shadowBlur = this._element.getStyle("shadow.blur");
        this._wholeAlpha = this._element.getStyle("whole.alpha")
    }, validate: function () {
        if (this._invalidateFlag == false) {
            return
        }
        this._bodyBounds.clear();
        if (this._invalidateAttachmentsFlag) {
            this._invalidateAttachmentsFlag = false;
            this.checkAttachments()
        }
        this._invalidateFlag = false;
        this.updateStyle();
        this.validateImpl();
        this._attachments.forEach(function (t) {
            t.validate()
        });
        var t;
        this._bodyBounds.forEach(function (e) {
            t = u.unionRect(t, e)
        });
        this._unionBodyBounds = _twaver.clone(t);
        this._attachments.forEach(function (e) {
            t = u.unionRect(t, e.getViewRect())
        });
        this._viewRect = t
    }, validateImpl: function () {
    }, setShadow: function (t, e) {
        var i = t.isShadowable() && this._shadowColor && !this._editAttachment;
        if (e.shadowOffsetX === this._shadowXOffset && e.shadowOffsetY === this._shadowYOffset && e.shadowBlur === this._shadowBlur) {
            return e
        }
        if (i) {
            e.shadowOffsetX = this._shadowXOffset;
            e.shadowOffsetY = this._shadowYOffset;
            e.shadowBlur = this._shadowBlur;
            e.shadowColor = this._shadowColor
        }
        return e
    }, clearShadow: function (t) {
        if (t.shadowOffsetX != 0 || t.shadowOffsetY != 0 || t.shadowBlur != 0) {
            t.shadowOffsetX = 0;
            t.shadowOffsetY = 0;
            t.shadowBlur = 0
        }
    }, appendShadowBound: function (t, e) {
        var i = t.isShadowable() && this._shadowColor && !this._editAttachment;
        if (i) {
            if (this._shadowXOffset > 0) {
                e.width += this._shadowXOffset
            } else {
                e.x += this._shadowXOffset;
                e.width += -this._shadowXOffset
            }
            if (this._shadowYOffset > 0) {
                e.height += this._shadowYOffset
            } else {
                e.y += this._shadowYOffset;
                e.height += -this._shadowYOffset
            }
            u.grow(e, this._shadowBlur, this._shadowBlur)
        }
        return e
    }, isShadowable: function () {
        if (this._shadowColor && this._network.isSelected(this._element) && this._element.getStyle("select.style") === "shadow") {
            return true
        }
        return false
    }, addAttachment: function (t) {
        this._attachments.add(t);
        this.invalidate(false)
    }, removeAttachment: function (t) {
        this._attachments.remove(t);
        this.invalidate(false)
    }, getAttachments: function () {
        return this._attachments
    }, checkAttachments: function () {
        this.checkLabelAttachment();
        this.checkAlarmAttachment();
        this.checkIconsAttachment();
        this.checkEditAttachment()
    }, checkLabelAttachment: function () {
        var t = this._network.getLabel(this._element);
        if (t != null && t !== "") {
            if (!this._labelAttachment) {
                this._labelAttachment = new twaver.canvas.LabelAttachment(this);
                this.addAttachment(this._labelAttachment)
            }
        } else {
            if (this._labelAttachment) {
                this.removeAttachment(this._labelAttachment);
                this._labelAttachment = null
            }
        }
    }, checkAlarmAttachment: function () {
        var t = this._network.getAlarmLabel(this._element);
        if (t != null && t !== "") {
            if (!this._alarmAttachment) {
                this._alarmAttachment = new twaver.canvas.AlarmAttachment(this, y.SHOW_ALARM_IN_ATTACHMENT_DIV);
                this.addAttachment(this._alarmAttachment)
            }
        } else {
            if (this._alarmAttachment) {
                this.removeAttachment(this._alarmAttachment);
                this._alarmAttachment = null
            }
        }
    }, checkIconsAttachment: function () {
        var t = this._network.getIconsNames(this._element);
        if (t && t.length > 0) {
            if (!this._iconsAttachment) {
                this._iconsAttachment = new twaver.canvas.IconsAttachment(this);
                this.addAttachment(this._iconsAttachment)
            }
        } else {
            if (this._iconsAttachment) {
                this.removeAttachment(this._iconsAttachment);
                this._iconsAttachment = null
            }
        }
    }, checkEditAttachment: function () {
        if (this._network.hasEditInteraction() && this._network.isSelected(this._element) && this._network.isEditable(this._element) && this.isEditable()) {
            if (!this._editAttachment) {
                this._editAttachment = new twaver.canvas.EditAttachment(this);
                this.addAttachment(this._editAttachment)
            }
        } else {
            if (this._editAttachment) {
                this.removeAttachment(this._editAttachment);
                this._editAttachment = null
            }
        }
    }, getLabelAttachment: function () {
        return this._labelAttachment
    }, getAlarmAttachment: function () {
        return this._alarmAttachment
    }, getIconsAttachment: function () {
        return this._iconsAttachment
    }, getEditAttachment: function () {
        return this._editAttachment
    }, isEditable: function () {
        return true
    }, getInnerColor: function () {
        return this._innerColor
    }, getOuterColor: function () {
        return this._outerColor
    }, getShadowColor: function () {
        return this._shadowColor
    }, getDyeColor: function (t) {
        if (this._innerColor) {
            return this._innerColor
        }
        return this.getStyle(t)
    }, getStyle: function (t) {
        return this._element.getStyle(t)
    }, getFont: function (t) {
        var e = this._element.getStyle(t);
        return e ? e : twaver.Defaults.FONT
    }, paint: function (t) {
        t.save();
        t.globalAlpha = this._wholeAlpha;
        t.beginPath();
        this.paintBody(t);
        this.clearShadow(t);
        t.closePath();
        t.beginPath();
        this.paintAttachments(t);
        t.closePath();
        t.restore()
    }, paintBody: function (t) {
    }, paintAttachments: function (t) {
        t.beginPath();
        var e = this._attachments.size();
        for (var i = 0; i < e; i++) {
            var n = this._attachments.get(i);
            if (this._hitTest == true) {
                if (n.isShowOnTop() == false) {
                    this.paintAttachment(t, n)
                }
            }
            if (this._intersectTest == true) {
                this.paintAttachment(t, n)
            }
            if (this._hitTest == false && this._intersectTest == false) {
                if (n.isShowOnTop()) {
                    this._network._topAttachmentList.add(n)
                } else {
                    this.paintAttachment(t, n)
                }
            }
        }
    }, paintAttachment: function (t, e) {
        t.beginPath();
        e.paint(t);
        this.clearShadow(t)
    }, getViewRect: function () {
        return _twaver.clone(this._viewRect)
    }, getUnionBodyBounds: function () {
        return _twaver.clone(this._unionBodyBounds)
    }, addBodyBounds: function (t) {
        if (t) {
            this._bodyBounds.add(t)
        }
    }, getBodyRect: function () {
        if (!this._bodyRect) {
            this._bodyRect = this.createBodyRect()
        }
        return _twaver.clone(this._bodyRect)
    }, getHotSpot: function () {
        if (this._hotSpot) {
            return _twaver.clone(this._hotSpot)
        }
        return{x: 0, y: 0}
    }, setHotSpot: function (t) {
        this._hotSpot = t
    }, hit: function (t, e) {
        return false
    }, intersects: function (t) {
        if (u.contains(t, this.getViewRect())) {
            return true
        }
        return false
    }, hitCanvasRectAtBody: function (t) {
        var e = E.getHitCanvas(t.width, t.height);
        var i = E.getCtx(e);
        i.save();
        i.translate(-t.x, -t.y);
        this.paintBody(i);
        try {
            var n = i.getImageData(0, 0, t.width, t.height);
            var s = n.data;
            for (var r = 0; r < n.width; r++) {
                for (var a = 0; a < n.height; a++) {
                    var o = 4 * (a * n.width + r);
                    var h = s[o + 3];
                    if (h !== 0) {
                        i.restore();
                        return 1
                    }
                }
            }
        } catch (l) {
            E.disposeHitCanvas();
            if (u.contains(this.getUnionBodyBounds(), t)) {
                return 0
            }
        }
        i.restore();
        return-1
    }, hitCanvasRectAtAttachments: function (t) {
        var e = E.getHitCanvas(t.width, t.height);
        var i = E.getCtx(e);
        i.save();
        i.translate(-t.x, -t.y);
        this.paintAttachments(i);
        try {
            var n = i.getImageData(0, 0, t.width, t.height);
            var s = n.data;
            for (var r = 0; r < n.width; r++) {
                for (var a = 0; a < n.height; a++) {
                    var o = 4 * (a * n.width + r);
                    var h = s[o + 3];
                    if (h !== 0) {
                        i.restore();
                        return 1
                    }
                }
            }
        } catch (l) {
            E.disposeHitCanvas()
        }
        i.restore();
        return-1
    }, hitCanvasRect: function (t) {
        this._intersectTest = true;
        if (this._hitTest == true) {
            this._intersectTest = false
        }
        var e = u.intersection(t, this._viewRect);
        var i = this.hitCanvasRectAtBody(e);
        if (i == 1) {
            this._intersectTest = false;
            return true
        }
        var n = this.hitCanvasRectAtAttachments(e);
        if (n == 1) {
            this._intersectTest = false;
            return true
        }
        this._intersectTest = false;
        return i == 0
    }, hitCanvasPoint: function (t, e) {
        if (!u.containsPoint(this._viewRect, t, e)) {
            return false
        }
        this._hitTest = true;
        var i = this.hitCanvasRect({x: t - 1, y: e - 1, width: 2, height: 2});
        this._hitTest = false;
        return i
    }, hitTest: function (t, e) {
        if (!u.containsPoint(this._viewRect, t, e)) {
            return null
        }
        var i = {x: t - 1, y: e - 1, width: 2, height: 2};
        var n = u.intersection(i, this._viewRect);
        var s = this.hitCanvasRectAtBody(n);
        if (s == 1) {
            return this
        }
        var r = this._attachments.size();
        for (var a = 0; a < r; a++) {
            var o = this._attachments.get(a);
            if (o.hit(t, e)) {
                return o
            }
        }
        if (s == 0) {
            return this
        }
        return null
    }});
    twaver.canvas.NodeUI = function (t, e) {
        twaver.canvas.NodeUI.superClass.constructor.call(this, t, e)
    };
    _twaver.ext("twaver.canvas.NodeUI", twaver.canvas.ElementUI, {invalidate: function () {
        twaver.canvas.NodeUI.superClass.invalidate.call(this);
        var t = this._element.getAgentLinks();
        if (t) {
            t.forEach(function (t) {
                this._network.invalidateElementUI(t, false)
            }, this)
        }
    }, createBodyRect: function () {
        return this._element.getRect()
    }, validateImpl: function () {
        twaver.canvas.NodeUI.superClass.validateImpl.call(this);
        var t = this.getStyle("vector.shape");
        var e = this.getBodyRect();
        this._hotSpot = u.getHotSpot(e.x, e.y, e.width, e.height, t);
        this.validateBodyBounds()
    }, validate: function () {
        if (this._invalidateFlag == false) {
            return
        }
        twaver.canvas.NodeUI.superClass.validate.call(this);
        var t = this._element.getParent();
        if (t instanceof twaver.Group) {
            this._network.invalidateElementUI(t, false)
        }
    }, validateBodyBounds: function () {
        var t = this.getStyle("body.type");
        if (t === "default") {
            this.addBodyBounds(this.getDefaultBodyRect())
        } else if (t === "vector") {
            this.addBodyBounds(this.getVectorBody())
        } else if (t === "default.vector") {
            this.addBodyBounds(this.getVectorBody());
            this.addBodyBounds(this.getDefaultBodyRect())
        } else if (t === "vector.default") {
            this.addBodyBounds(this.getDefaultBodyRect());
            this.addBodyBounds(this.getVectorBody())
        }
        if (this._outerColor) {
            this.addBodyBounds(this.getOuterBorderRect())
        }
        if (!this._editAttachment && this.getStyle("select.style") === "border" && this._network.isSelected(this._element)) {
            this.addBodyBounds(this.getSelectBorderRect())
        }
    }, getDefaultBodyRect: function () {
        var t = this._element;
        var e = _twaver.getImageAsset(t.getImage());
        var i = this.getBodyRect();
        if (!e) {
            return i
        }
        u.addPadding(i, this._element, "image.padding", 1);
        var n = _twaver.clone(i);
        this.appendShadowBound(this, n);
        i = n;
        return i
    }, getVectorBody: function () {
        var t = this.getPathRect("vector");
        return t
    }, getOuterBorderRect: function () {
        return this._getBorderRect("outer")
    }, getSelectBorderRect: function () {
        return this._getBorderRect("select")
    }, _getBorderRect: function (t) {
        var e = this._element;
        var i = e.getStyle(t + ".width");
        if (i > 0) {
            var n = this.getBodyRect();
            u.addPadding(n, e, t + ".padding", 1);
            var s = _twaver.clone(n);
            u.grow(s, i / 2, i / 2);
            return s
        }
        return null
    }, getPathRect: function (t, e) {
        var i = this._element;
        var n = this.getBodyRect();
        if (e) {
            u.addPadding(n, i, t + ".padding", 1)
        }
        var s = _twaver.clone(n);
        var r = i.getStyle(t + ".outline.width");
        if (r > 0) {
            u.grow(s, r / 2, r / 2)
        }
        this.appendShadowBound(this, s);
        return s
    }, paintBody: function (t) {
        var e = this.getStyle("body.type");
        if (e === "default") {
            this.drawDefaultBody(t)
        } else if (e === "vector") {
            this.drawVectorBody(t)
        } else if (e === "default.vector") {
            this.drawVectorBody(t);
            this.drawDefaultBody(t)
        } else if (e === "vector.default") {
            this.drawDefaultBody(t);
            this.drawVectorBody(t)
        }
        if (this._outerColor) {
            this.drawOuterBorder(t)
        }
        if (this.getStyle("select.style") === "border" && this._network.isSelected(this._element)) {
            this.drawSelectBorder(t)
        }
    }, drawOuterBorder: function (t) {
        var e = this._element;
        var i = e.getStyle("outer.width");
        if (i > 0) {
            var n = this.getBodyRect();
            u.addPadding(n, e, "outer.padding", 1);
            t.lineWidth = i;
            t.lineCap = e.getStyle("outer.cap");
            t.lineJoin = e.getStyle("outer.join");
            t.strokeStyle = this._outerColor;
            o.drawVector(t, e.getStyle("outer.shape"), null, n);
            t.stroke()
        }
    }, drawDefaultBody: function (t) {
        var e = this._element;
        var i = _twaver.getImageAsset(e.getImage());
        var n = e.getRect();
        if (!i) {
            return
        }
        u.addPadding(n, this._element, "image.padding", 1);
        if (i.getImage()) {
            this.setShadow(this, t);
            t.drawImage(i.getImage(this.getInnerColor()), n.x, n.y, n.width, n.height)
        }
    }, drawSelectBorder: function (t) {
        var e = this._element;
        var i = e.getStyle("select.width");
        if (i > 0) {
            var n = this.getBodyRect();
            u.addPadding(n, e, "select.padding", 1);
            var s = _twaver.clone(n);
            u.grow(s, i / 2, i / 2);
            t.lineWidth = i;
            t.lineCap = e.getStyle("select.cap");
            t.lineJoin = e.getStyle("select.join");
            t.strokeStyle = e.getStyle("select.color");
            o.drawVector(t, e.getStyle("select.shape"), null, n);
            t.stroke()
        }
    }, drawVectorBody: function (t) {
        this.drawPath(t, "vector", true, this._element.getStyle("vector.outline.pattern"));
        var e = this.getStyle("vector.deep");
        var i = this.getStyle("vector.fill.color");
        if (e !== 0 && i) {
            if (this.getStyle("vector.shape") === "rectangle") {
                o.draw3DRect(t, i, e, this.getBodyRect())
            }
        }
    }, drawPath: function (t, e, i, n, s, r, h) {
        var l = this._element;
        var c = this.getBodyRect();
        if (i) {
            u.addPadding(c, l, e + ".padding", 1)
        }
        var v = l.getStyle(e + ".outline.width");
        this.setShadow(this, t);
        var d = l.getStyle(e + ".fill");
        var f;
        if (d) {
            if (this._innerColor && !a.hasDefault(this._element)) {
                f = this._innerColor
            } else {
                f = l.getStyle(e + ".fill.color")
            }
            var g = l.getStyle(e + ".gradient");
            if (g) {
                o.fill(t, f, g, l.getStyle(e + ".gradient.color"), c)
            } else {
                t.fillStyle = f
            }
        }
        var w = l.getStyle(e + ".shape");
        if (d) {
            t.beginPath();
            if (s) {
                o.drawLinePoints(t, s, null, r, h)
            } else {
                o.drawVector(t, w, null, c)
            }
            t.fill()
        }
        if (v > 0) {
            t.lineWidth = v;
            t.lineCap = l.getStyle(e + ".cap");
            t.lineJoin = l.getStyle(e + ".join");
            t.strokeStyle = l.getStyle(e + ".outline.color");
            t.beginPath();
            if (s) {
                o.drawLinePoints(t, s, n, r, h)
            } else {
                o.drawVector(t, w, n, c)
            }
            t.stroke()
        }
    }, hit: function (t, e) {
        if (u.containsPoint(this.getViewRect(), t, e)) {
            return this.hitCanvasPoint(t, e)
        }
        return false
    }, intersects: function (t) {
        var e = twaver.canvas.NodeUI.superClass.intersects.apply(this, arguments);
        if (e == true) {
            return true
        }
        if (u.intersects(t, this.getViewRect())) {
            return this.hitCanvasRect(t)
        }
        return false
    }});
    twaver.canvas.LinkUI = function (t, e) {
        twaver.canvas.LinkUI.superClass.constructor.call(this, t, e)
    };
    _twaver.ext("twaver.canvas.LinkUI", twaver.canvas.ElementUI, {isEditable: function () {
        if (c.isOrthogonalLink(this._element) && this.getControlPoint()) {
            return true
        }
        return false
    }, invalidate: function (t) {
        this._linkPoints = null;
        this._fromPoint = null;
        this._toPoint = null;
        twaver.canvas.LinkUI.superClass.invalidate.call(this, t)
    }, validateImpl: function () {
        this.validateBodyBounds();
        twaver.canvas.LinkUI.superClass.validateImpl.call(this)
    }, validateBodyBounds: function () {
        var t = this.getLinkPoints();
        if (!t || t.size() < 2) {
            return
        }
        var e = this._element;
        var n = u.getLineRect(t);
        var s = e.getStyle("link.width");
        var r = s;
        if (this._outerColor) {
            var a = e.getStyle("outer.width");
            r += a * 2
        }
        var o = !this._editAttachment && e.getStyle("select.style") === "border" && this._network.isSelected(this._element);
        if (o) {
            var h = e.getStyle("select.width");
            r += h * 2
        }
        u.grow(n, r / 2, r / 2);
        if (e.getStyle("arrow.from")) {
            n = u.unionRect(n, i.getArrowRect(t, true, e.getStyle("arrow.from.shape"), e.getStyle("arrow.from.width"), e.getStyle("arrow.from.height"), e.getStyle("arrow.from.xoffset"), e.getStyle("arrow.from.yoffset")))
        }
        if (e.getStyle("arrow.to")) {
            n = u.unionRect(n, i.getArrowRect(t, false, e.getStyle("arrow.to.shape"), e.getStyle("arrow.to.width"), e.getStyle("arrow.to.height"), e.getStyle("arrow.to.xoffset"), e.getStyle("arrow.to.yoffset")))
        }
        this.appendShadowBound(this, n);
        this.addBodyBounds(n)
    }, createBodyRect: function () {
        var t = this.getHotSpot();
        if (t) {
            return{x: t.x - 1, y: t.y - 1, width: 2, height: 2}
        }
        return null
    }, paintBody: function (t) {
        var e = this.getLinkPoints();
        if (!e || e.size() < 2) {
            return
        }
        var n = this._element;
        var s = n.getStyle("link.width");
        var r = s;
        if (this._outerColor) {
            var a = n.getStyle("outer.width");
            r += a * 2
        }
        var o = !this._editAttachment && n.getStyle("select.style") === "border" && this._network.isSelected(this._element);
        if (o) {
            var h = n.getStyle("select.width");
            r += h * 2
        }
        this.setShadow(this, t);
        t.lineCap = n.getStyle("link.cap");
        t.lineJoin = n.getStyle("link.join");
        var l = n.getStyle("link.pattern");
        if (o) {
            this.drawLinePoints(t, e, r, n.getStyle("select.color"), l)
        }
        if (this._outerColor) {
            this.drawLinePoints(t, e, s + a * 2, this._outerColor, l)
        }
        this.drawLinePoints(t, e, s, this._innerColor || n.getStyle("link.color"), l);
        i.drawLinkArrow(this, t, e)
    }, drawLinePoints: function (t, e, i, n, s) {
        t.lineWidth = i;
        t.strokeStyle = n;
        t.beginPath();
        o.drawLinePoints(t, e, s);
        t.stroke()
    }, getLinkPoints: function () {
        if (!this._linkPoints) {
            this._linkPoints = this.createLinkPoints();
            this._lineLength = u.calculateLineLength(this._linkPoints)
        }
        return this._linkPoints
    }, getFromPosition: function (t, e) {
        var i = this.getFromPoint();
        if (i) {
            return{x: i.x + t, y: i.y + e}
        }
        return null
    }, getToPosition: function (t, e) {
        var i = this.getToPoint();
        if (i) {
            return{x: i.x + t, y: i.y + e}
        }
        return null
    }, getFromPoint: function () {
        if (!this._fromPoint) {
            this._fromPoint = c.createFromPoint(this)
        }
        return this._fromPoint
    }, getToPoint: function () {
        if (!this._toPoint) {
            this._toPoint = c.createToPoint(this)
        }
        return this._toPoint
    }, createLinkPoints: function () {
        var t = this.getFromPoint();
        var e = this.getToPoint();
        var i = this.getStyle("link.type");
        if (c.isOrthogonalOrFlexionalLink(this._element)) {
            return c.orthogonalAndFlexional(this, i)
        }
        var n = new twaver.List;
        if (this._element.isLooped()) {
            var s = this._network.getElementUI(this._element.getFromAgent());
            if (s == null) {
                return null
            }
            this._hotSpot = c.fillLoopedPoints(this, s.getBodyRect(), n)
        } else if (i === "arc" || i === "triangle" || i === "parallel") {
            this._hotSpot = c.fillBundlePoints(this, i, t, e, n)
        } else {
            throw"Can not resolve link type '" + i + "'"
        }
        return n
    }, checkAttachments: function () {
        twaver.canvas.LinkUI.superClass.checkAttachments.call(this);
        this.checkLinkHandlerAttachment()
    }, checkLinkHandlerAttachment: function () {
        var t = this._network.getLinkHandlerLabel(this._element);
        if (t != null && t !== "") {
            if (!this._linkHandlerAttachment) {
                this._linkHandlerAttachment = new twaver.canvas.LinkHandlerAttachment(this);
                this.addAttachment(this._linkHandlerAttachment)
            }
        } else {
            if (this._linkHandlerAttachment) {
                this.removeAttachment(this._linkHandlerAttachment);
                this._linkHandlerAttachment = null
            }
        }
    }, getLinkHandlerAttachment: function () {
        return this._linkHandlerAttachment
    }, getControlPoint: function () {
        return c.getControlPoint(this._element, this)
    }, setControlPoint: function (t) {
        if (!t) {
            return
        }
        var e = this.getStyle("link.type");
        if (!c.hasControlPoint(e)) {
            return
        }
        var i = c.getLinkSourceBounds(this);
        var n = c.getLinkTargetBounds(this);
        c.setParamsByControlPoint(t, i, n, e, this._element)
    }, getLineLength: function () {
        return this._lineLength
    }, hit: function (t, e) {
        if (u.containsPoint(this.getViewRect(), t, e)) {
            return this.hitCanvasPoint(t, e)
        }
        return false
    }, intersects: function (t) {
        var e = twaver.canvas.NodeUI.superClass.intersects.apply(this, arguments);
        if (e == true) {
            return true
        }
        if (u.intersects(t, this.getViewRect()) == false) {
            return false
        }
        var i = this.getLinkPoints();
        var n = i.size();
        if (n == 2) {
            for (var s = 0; s < n; s += 2) {
                var r = i.get(s);
                if (s + 1 < n) {
                    var a = i.get(s + 1);
                    if (E.intersectsLine(r.x, r.y, a.x, a.y, t.x, t.y, t.width, t.height)) {
                        return true
                    }
                }
            }
        }
        return this.hitCanvasRect(t)
    }});
    twaver.canvas.GroupUI = function (t, e) {
        twaver.canvas.GroupUI.superClass.constructor.call(this, t, e)
    };
    _twaver.ext("twaver.canvas.GroupUI", twaver.canvas.NodeUI, {isEditable: function () {
        return!this._element.isExpanded()
    }, paintBody: function (t) {
        if (this._shapeRect) {
            this.drawExpandedGroup(t)
        } else {
            twaver.canvas.GroupUI.superClass.paintBody.apply(this, arguments)
        }
    }, validateBodyBounds: function () {
        this.getBodyRect();
        if (this._shapeRect) {
            this.addBodyBounds(this.getPathRect("group", false))
        } else {
            twaver.canvas.GroupUI.superClass.validateBodyBounds.call(this)
        }
    }, drawExpandedGroup: function (t) {
        this.drawPath(t, "group", false, this._element.getStyle("vector.outline.pattern"));
        var e = this.getStyle("group.deep");
        var i = this.getStyle("group.fill.color");
        if (e !== 0 && i) {
            if (this.getStyle("group.shape") === "rectangle") {
                o.draw3DRect(t, i, e, this._bodyRect)
            }
        }
    }, getChildrenRects: function () {
        return this._network.getGroupChildrenRects(this._element)
    }, createBodyRect: function () {
        this._shapeRect = null;
        var t = this._element;
        if (t.isExpanded()) {
            var e = this.getChildrenRects();
            if (!e.isEmpty()) {
                var i = t.getStyle("group.shape");
                var n = h[i];
                if (!n) {
                    throw"Can not resolve group shape '" + i + "'"
                }
                this._shapeRect = n(e)
            }
        }
        if (this._shapeRect) {
            u.addPadding(this._shapeRect, t, "group.padding", 1);
            return this._shapeRect
        } else {
            return twaver.canvas.GroupUI.superClass.createBodyRect.call(this)
        }
    }});
    twaver.canvas.ShapeNodeUI = function (t, e) {
        twaver.canvas.ShapeNodeUI.superClass.constructor.call(this, t, e)
    };
    _twaver.ext("twaver.canvas.ShapeNodeUI", twaver.canvas.NodeUI, {getDefaultBodyRect: function () {
        if (this._element._points.size() < 2) {
            return null
        }
        return this.getPathRect("vector", true)
    }, drawDefaultBody: function (t) {
        if (this._element._points.size() < 2) {
            return
        }
        this.drawPath(t, "vector", true, this._element.getStyle("vector.outline.pattern"), this._element._points, this._element._segments, this._element.getStyle("shapenode.closed"));
        i.drawLinkArrow(this, t, u.getPointObject(this._element._points, this._element._segments))
    }});
    twaver.canvas.ShapeLinkUI = function (t, e) {
        twaver.canvas.ShapeLinkUI.superClass.constructor.call(this, t, e)
    };
    _twaver.ext("twaver.canvas.ShapeLinkUI", twaver.canvas.LinkUI, {isEditable: function () {
        return true
    }, createLinkPoints: function () {
        var t = this.getFromPoint();
        var e = this.getToPoint();
        var i = new twaver.List;
        var n = this.getStyle("shapelink.type");
        i.add(t);
        if (this._element._points != null) {
            i.addAll(this._element._points)
        }
        i.add(e);
        var s = i.size();
        var r = Math.ceil(s / 2);
        if (s % 2 === 0) {
            var a = i.get(r);
            var o = i.get(r - 1);
            this._hotSpot = {x: (a.x + o.x) / 2, y: (a.y + o.y) / 2}
        } else {
            this._hotSpot = _twaver.clone(i.get(r))
        }
        var h, l, c;
        if (n === "lineto") {
        } else if (n === "quadto") {
            h = new twaver.List(i.get(0));
            for (l = 1, s = i.size(); l < s; l++) {
                if (l < s - 1) {
                    h.add(new twaver.List([i.get(l++), i.get(l)]))
                } else {
                    h.add(i.get(l))
                }
            }
            i = h
        } else if (n === "cubicto") {
            h = new twaver.List(i.get(0));
            for (l = 1, s = i.size(); l < s; l++) {
                if (l < s - 2) {
                    h.add(new twaver.List([i.get(l++), i.get(l++), i.get(l)]))
                } else if (l < s - 1) {
                    h.add(new twaver.List([i.get(l++), i.get(l)]))
                } else {
                    h.add(i.get(l))
                }
            }
            i = h
        } else if (n === "orthogonalto") {
            c = i.get(0);
            h = new twaver.List(c);
            for (l = 1, s = i.size(); l < s; l++) {
                if (l < s - 1) {
                    var u = _twaver.clone(i.get(l));
                    var v = u.x;
                    var d = u.y;
                    var f = v - c.x;
                    var g = d - c.y;
                    if (Math.abs(f) > Math.abs(g)) {
                        u.x = v;
                        u.y = c.y
                    } else {
                        u.x = c.x;
                        u.y = d
                    }
                    c = u;
                    h.add(c)
                } else {
                    h.add(i.get(l))
                }
            }
            i = h
        } else {
            throw"Can not resolve shapelink type '" + n + "'"
        }
        return i
    }});
    twaver.canvas.GridUI = function (t, e) {
        twaver.canvas.GridUI.superClass.constructor.call(this, t, e)
    };
    _twaver.ext("twaver.canvas.GridUI", twaver.canvas.NodeUI, {drawDefaultBody: function (t) {
        if (this._element.getImage()) {
            twaver.network.GridUI.superClass.drawDefaultBody.apply(this, arguments)
        } else {
            this.drawGridBody(t)
        }
    }, validateBodyBounds: function () {
        if (this._element.getImage()) {
            twaver.canvas.GridUI.superClass.validateBodyBounds.call(this)
        } else {
            var t = this.getBodyRect();
            var e = _twaver.clone(t);
            this.appendShadowBound(this, e);
            this.addBodyBounds(e)
        }
    }, drawGridBody: function (t) {
        var e = this.getStyle("grid.fill");
        var i = this.getStyle("grid.deep");
        var n = this.getStyle("grid.cell.deep");
        if (!e && i === 0 && n === 0) {
            return
        }
        t.beginPath();
        var s = this._element.getRect();
        var r = this.getDyeColor("grid.fill.color");
        this.setShadow(this, t);
        if (e) {
            t.fillStyle = r;
            t.rect(s.x, s.y, s.width, s.height);
            t.fill()
        }
        t.closePath();
        this.clearShadow(t);
        t.beginPath();
        if (i != 0) {
            o.draw3DRect(t, r, i, s.x, s.y, s.width, s.height)
        }
        t.closePath();
        if (n != 0) {
            var a = this.getStyle("grid.row.count");
            var h = this.getStyle("grid.column.count");
            for (var l = 0; l < a; l++) {
                for (var c = 0; c < h; c++) {
                    var u = this._element.getCellRect(l, c);
                    if (u != null) {
                        t.beginPath();
                        o.draw3DRect(t, r, n, u.x, u.y, u.width, u.height);
                        t.closePath()
                    }
                }
            }
        }
    }});
    twaver.canvas.RotatableNodeUI = function (t, e) {
        twaver.canvas.RotatableNodeUI.superClass.constructor.call(this, t, e)
    };
    _twaver.ext("twaver.canvas.RotatableNodeUI", twaver.canvas.NodeUI, {isEditable: function () {
        return false
    }, getDefaultBodyRect: function () {
        var t = this._element;
        var e = _twaver.getImageAsset(t.getImage());
        var i = this.getBodyRect();
        if (!e) {
            return i
        }
        u.addPadding(i, this._element, "image.padding", 1);
        return i
    }, drawDefaultBody: function (t) {
        var e = this._element;
        var i = _twaver.getImageAsset(e.getImage());
        var n = this.getBodyRect();
        u.addPadding(n, this._element, "image.padding", 1);
        if (i.getImage()) {
            var s = this._element._getOrignalWidth(), r = this._element._getOrignalHeight(), a = this._element._getRotateRect();
            t.save();
            t.translate(n.x - a.x + s / 2, n.y - a.y + r / 2);
            t.rotate(this._element._angle * Math.PI / 180);
            t.drawImage(i.getImage(this._innerColor), -s / 2, -r / 2, s, r);
            t.restore()
        } else if (i.getSrc()) {
        } else if (i.getFunction()) {
        } else {
            throw"ImageAsset '" + e.getImage() + " ' is empty"
        }
    }});
    twaver.canvas.Attachment = function (t, e) {
        this._ui = t;
        this._element = this._ui.getElement();
        this._network = t.getNetwork();
        this._showOnTop = e
    };
    _twaver.ext("twaver.canvas.Attachment", Object, {getElement: function () {
        return this._element
    }, getElementUI: function () {
        return this._ui
    }, getNetwork: function () {
        return this._network
    }, isShowOnTop: function () {
        return this._showOnTop === true
    }, setShowOnTop: function (t) {
        this._showOnTop = t
    }, getStyle: function (t) {
        return this._ui.getStyle(t)
    }, getFont: function (t) {
        return this._ui.getFont(t)
    }, getViewRect: function () {
        return _twaver.clone(this._viewRect)
    }, getAlpha: function () {
        return 1
    }, validate: function () {
    }, paint: function (t) {
    }, hit: function (t, e) {
        if (u.containsPoint(this._viewRect, t, e)) {
            return this.hitCanvasRect({x: t - 1, y: e - 1, width: 2, height: 2})
        }
        return false
    }, hitCanvasRect: function (t) {
        var e = E.getHitCanvas(t.width, t.height);
        var i = E.getCtx(e);
        i.save();
        i.translate(-t.x, -t.y);
        this.paint(i);
        try {
            var n = i.getImageData(0, 0, t.width, t.height);
            var s = n.data;
            for (var r = 0; r < n.width; r++) {
                for (var a = 0; a < n.height; a++) {
                    var o = 4 * (a * n.width + r);
                    var h = s[o + 3];
                    if (h !== 0) {
                        i.restore();
                        return true
                    }
                }
            }
        } catch (l) {
            E.disposeHitCanvas()
        }
        i.restore();
        return false
    }});
    twaver.canvas.BasicAttachment = function (t, e) {
        twaver.canvas.BasicAttachment.superClass.constructor.call(this, t, e);
        this._roundRect = {x: 0, y: 0, width: 0, height: 0};
        this._contentRect = {x: 0, y: 0, width: 0, height: 0}
    };
    _twaver.ext("twaver.canvas.BasicAttachment", twaver.canvas.Attachment, {paint: function (t) {
        twaver.canvas.BasicAttachment.superClass.paint.apply(this, arguments);
        var e = this.isFill();
        var i = this.getOutlineWidth();
        this.getElementUI().setShadow(this, t);
        if (i > 0 || e) {
            o.drawRoundRect(t, this._roundRect.x, this._roundRect.y, this._roundRect.width, this._roundRect.height, this.getCornerRadius());
            if (this._pointers) {
                t.moveTo(this._pointers[0].x, this._pointers[0].y);
                t.lineTo(this._pointers[1].x, this._pointers[1].y);
                t.lineTo(this._pointers[2].x, this._pointers[2].y)
            }
            t.closePath();
            if (i > 0) {
                t.lineWidth = i;
                t.strokeStyle = this.getOutlineColor();
                t.lineCap = this.getCap();
                t.lineJoin = this.getJoin();
                t.stroke()
            }
            if (e) {
                var n = this.getFillColor();
                var s = this.getGradient();
                if (s) {
                    o.fill(t, n, s, this.getGradientColor(), this._viewRect)
                } else {
                    t.fillStyle = n
                }
                t.fill()
            }
        }
    }, validate: function () {
        twaver.canvas.BasicAttachment.superClass.validate.call(this);
        this.calculateMeasure();
        var t = this.getOutlineWidth();
        this._viewRect = u.getRect(this._pointers);
        this._viewRect = u.unionRect(this._viewRect, this._roundRect);
        if (t > 0) {
            u.grow(this._viewRect, t / 2, t / 2)
        }
        this._viewRect = this._ui.appendShadowBound(this, this._viewRect)
    }, calculateMeasure: function () {
        var t = this.getContentWidth();
        var e = this.getContentHeight();
        var i = this.getCornerRadius();
        var n = this.getPointerLength();
        var s = this.getPointerWidth();
        var r = this.getPosition();
        var a = this.getXOffset();
        var o = this.getYOffset();
        var h = this._roundRect;
        h.width = t + i * 2;
        h.height = e;
        var l;
        if (n > 0) {
            var c = this.getDirection();
            l = this._network.getPosition(r, this._ui, null, a, o);
            var v;
            if (c === "aboveleft") {
                h.y = l.y - n - h.height;
                h.x = l.x - (h.width - i);
                v = Math.max(l.x - s, h.x + i / 2);
                this._pointers = [l, {x: l.x, y: l.y - n}, {x: v, y: l.y - n}]
            } else if (c === "aboveright") {
                h.y = l.y - n - h.height;
                h.x = l.x - i;
                v = Math.min(l.x + s, h.x + h.width - i / 2);
                this._pointers = [l, {x: l.x, y: l.y - n}, {x: v, y: l.y - n}]
            } else if (c === "belowleft") {
                h.y = l.y + n;
                h.x = l.x - (h.width - i);
                v = Math.max(l.x - s, h.x + i / 2);
                this._pointers = [l, {x: l.x, y: l.y + n}, {x: v, y: l.y + n}]
            } else if (c === "belowright") {
                h.y = l.y + n;
                h.x = l.x - i;
                v = Math.min(l.x + s, h.x + h.width - i / 2);
                this._pointers = [l, {x: l.x, y: l.y + n}, {x: v, y: l.y + n}]
            } else if (c === "leftabove") {
                h.y = l.y + i - h.height;
                h.x = l.x - n - h.width;
                v = Math.max(l.y - s, h.y + i / 2);
                this._pointers = [l, {x: l.x - n, y: l.y}, {x: l.x - n, y: v}]
            } else if (c === "leftbelow") {
                h.y = l.y - i;
                h.x = l.x - n - h.width;
                v = Math.min(l.y + s, h.y + h.height - i / 2);
                this._pointers = [l, {x: l.x - n, y: l.y}, {x: l.x - n, y: v}]
            } else if (c === "rightabove") {
                h.y = l.y + i - h.height;
                h.x = l.x + n;
                v = Math.max(l.y - s, h.y + i / 2);
                this._pointers = [l, {x: l.x + n, y: l.y}, {x: l.x + n, y: v}]
            } else if (c === "rightbelow") {
                h.y = l.y - i;
                h.x = l.x + n;
                v = Math.min(l.y + s, h.y + h.height - i / 2);
                this._pointers = [l, {x: l.x + n, y: l.y}, {x: l.x + n, y: v}]
            } else if (c === "above") {
                h.y = l.y - n - h.height;
                h.x = l.x - h.width / 2;
                v = Math.min(t / 2, s / 2);
                this._pointers = [l, {x: l.x - v, y: l.y - n}, {x: l.x + v, y: l.y - n}]
            } else if (c === "below") {
                h.y = l.y + n;
                h.x = l.x - h.width / 2;
                v = Math.min(t / 2, s / 2);
                this._pointers = [l, {x: l.x - v, y: l.y + n}, {x: l.x + v, y: l.y + n}]
            } else if (c === "left") {
                h.y = l.y - h.height / 2;
                h.x = l.x - n - h.width;
                v = Math.min(e / 2, s / 2);
                this._pointers = [l, {x: l.x - n, y: l.y + v}, {x: l.x - n, y: l.y - v}]
            } else if (c === "right") {
                h.y = l.y - h.height / 2;
                h.x = l.x + n;
                v = Math.min(e / 2, s / 2);
                this._pointers = [l, {x: l.x + n, y: l.y + v}, {x: l.x + n, y: l.y - v}]
            } else {
                throw"Can not resolve '" + c + "' attachment direction"
            }
        } else {
            l = this._network.getPosition(r, this._ui, {width: h.width, height: h.height}, a, o);
            h.x = l.x;
            h.y = l.y;
            this._pointers = null
        }
        this._contentRect.x = h.x + (h.width - t) / 2;
        this._contentRect.y = h.y + (h.height - e) / 2;
        this._contentRect.width = t;
        this._contentRect.height = e;
        var d = this.getPadding();
        if (d != 0) {
            u.grow(h, d, d)
        }
        d = this.getPaddingLeft();
        if (d != 0) {
            h.x -= d;
            h.width += d
        }
        d = this.getPaddingRight();
        if (d != 0) {
            h.width += d
        }
        d = this.getPaddingTop();
        if (d != 0) {
            h.y -= d;
            h.height += d
        }
        d = this.getPaddingBottom();
        if (d != 0) {
            h.height += d
        }
        if (h.width < 0) {
            h.width = h.width;
            h.x -= h.width
        }
        if (h.height < 0) {
            h.height = -h.height;
            h.y -= h.height
        }
    }, getContentWidth: function () {
        return twaver.Defaults.ATTACHMENT_CONTENT_WIDTH
    }, getContentHeight: function () {
        return twaver.Defaults.ATTACHMENT_CONTENT_HEIGHT
    }, getCornerRadius: function () {
        return twaver.Defaults.ATTACHMENT_CORNER_RADIUS
    }, getPointerLength: function () {
        return twaver.Defaults.ATTACHMENT_POINTER_LENGTH
    }, getPointerWidth: function () {
        return twaver.Defaults.ATTACHMENT_POINTER_WIDTH
    }, getPosition: function () {
        return twaver.Defaults.ATTACHMENT_POSITION
    }, getXOffset: function () {
        return twaver.Defaults.ATTACHMENT_XOFFSET
    }, getYOffset: function () {
        return twaver.Defaults.ATTACHMENT_YOFFSET
    }, getPadding: function () {
        return twaver.Defaults.ATTACHMENT_PADDING
    }, getPaddingLeft: function () {
        return twaver.Defaults.ATTACHMENT_PADDING_LEFT
    }, getPaddingRight: function () {
        return twaver.Defaults.ATTACHMENT_PADDING_RIGHT
    }, getPaddingTop: function () {
        return twaver.Defaults.ATTACHMENT_PADDING_TOP
    }, getPaddingBottom: function () {
        return twaver.Defaults.ATTACHMENT_PADDING_BOTTOM
    }, getDirection: function () {
        return twaver.Defaults.ATTACHMENT_DIRECTION
    }, isFill: function () {
        return twaver.Defaults.ATTACHMENT_FILL
    }, getFillColor: function () {
        return twaver.Defaults.ATTACHMENT_FILL_COLOR
    }, getGradient: function () {
        return twaver.Defaults.ATTACHMENT_GRADIENT
    }, getGradientColor: function () {
        return twaver.Defaults.ATTACHMENT_GRADIENT_COLOR
    }, getOutlineWidth: function () {
        return twaver.Defaults.ATTACHMENT_OUTLINE_WIDTH
    }, getOutlineColor: function () {
        return twaver.Defaults.ATTACHMENT_OUTLINE_COLOR
    }, getCap: function () {
        return twaver.Defaults.ATTACHMENT_CAP
    }, getJoin: function () {
        return twaver.Defaults.ATTACHMENT_JOIN
    }, isShadowable: function () {
        return twaver.Defaults.ATTACHMENT_SHADOWABLE
    }, getRoundRect: function () {
        return _twaver.clone(this._roundRect)
    }, getContentRect: function () {
        return _twaver.clone(this._contentRect)
    }});
    twaver.canvas.LabelAttachment = function (t, e) {
        twaver.canvas.LabelAttachment.superClass.constructor.call(this, t, e)
    };
    _twaver.ext("twaver.canvas.LabelAttachment", twaver.canvas.BasicAttachment, {paint: function (t) {
        twaver.canvas.LabelAttachment.superClass.paint.apply(this, arguments);
        o.drawText(t, this.text, this._contentRect, this.font, this.getStyle("label.color"))
    }, validate: function () {
        this.font = this.getFont("label.font");
        this.text = this.getLabel();
        this._textSize = o.getTextSize(this.font, this.text);
        twaver.canvas.LabelAttachment.superClass.validate.call(this)
    }, getLabel: function () {
        return this._network.getLabel(this._element)
    }, getContentWidth: function () {
        return this._textSize ? this._textSize.width : 0
    }, getContentHeight: function () {
        return this._textSize ? this._textSize.height : 0
    }, getCornerRadius: function () {
        return this.getStyle("label.corner.radius")
    }, getPointerLength: function () {
        return this.getStyle("label.pointer.length")
    }, getPointerWidth: function () {
        return this.getStyle("label.pointer.width")
    }, getPosition: function () {
        return this.getStyle("label.position")
    }, getXOffset: function () {
        return this.getStyle("label.xoffset")
    }, getYOffset: function () {
        return this.getStyle("label.yoffset")
    }, getPadding: function () {
        return this.getStyle("label.padding")
    }, getPaddingLeft: function () {
        return this.getStyle("label.padding.left")
    }, getPaddingRight: function () {
        return this.getStyle("label.padding.right")
    }, getPaddingTop: function () {
        return this.getStyle("label.padding.top")
    }, getPaddingBottom: function () {
        return this.getStyle("label.padding.bottom")
    }, getDirection: function () {
        return this.getStyle("label.direction")
    }, isFill: function () {
        return this.getStyle("label.fill")
    }, getFillColor: function () {
        return this.getStyle("label.fill.color")
    }, getGradient: function () {
        return this.getStyle("label.gradient")
    }, getGradientColor: function () {
        return this.getStyle("label.gradient.color")
    }, getOutlineWidth: function () {
        return this.getStyle("label.outline.width")
    }, getOutlineColor: function () {
        return this.getStyle("label.outline.color")
    }, getCap: function () {
        return this.getStyle("label.cap")
    }, getJoin: function () {
        return this.getStyle("label.join")
    }, getAlpha: function () {
        return this.getStyle("label.alpha")
    }, isShadowable: function () {
        return this.getStyle("label.shadowable")
    }});
    twaver.canvas.AlarmAttachment = function (t, e) {
        twaver.canvas.AlarmAttachment.superClass.constructor.call(this, t, e)
    };
    _twaver.ext("twaver.canvas.AlarmAttachment", twaver.canvas.BasicAttachment, {paint: function (t) {
        twaver.canvas.AlarmAttachment.superClass.paint.apply(this, arguments);
        o.drawText(t, this.text, this._contentRect, this.font, this.getStyle("alarm.color"))
    }, validate: function () {
        this.font = this.getFont("alarm.font");
        this.text = this._network.getAlarmLabel(this._element);
        this._textSize = o.getTextSize(this.font, this.text);
        this._fillColor = this._network.getAlarmFillColor(this._element);
        twaver.canvas.LabelAttachment.superClass.validate.call(this)
    }, getContentWidth: function () {
        return this._textSize ? this._textSize.width : 0
    }, getContentHeight: function () {
        return this._textSize ? this._textSize.height : 0
    }, getCornerRadius: function () {
        return this.getStyle("alarm.corner.radius")
    }, getPointerLength: function () {
        return this.getStyle("alarm.pointer.length")
    }, getPointerWidth: function () {
        return this.getStyle("alarm.pointer.width")
    }, getPosition: function () {
        return this.getStyle("alarm.position")
    }, getXOffset: function () {
        return this.getStyle("alarm.xoffset")
    }, getYOffset: function () {
        return this.getStyle("alarm.yoffset")
    }, getPadding: function () {
        return this.getStyle("alarm.padding")
    }, getPaddingLeft: function () {
        return this.getStyle("alarm.padding.left")
    }, getPaddingRight: function () {
        return this.getStyle("alarm.padding.right")
    }, getPaddingTop: function () {
        return this.getStyle("alarm.padding.top")
    }, getPaddingBottom: function () {
        return this.getStyle("alarm.padding.bottom")
    }, getDirection: function () {
        return this.getStyle("alarm.direction")
    }, isFill: function () {
        return this._fillColor != null
    }, getFillColor: function () {
        return this._fillColor
    }, getGradient: function () {
        return this.getStyle("alarm.gradient")
    }, getGradientColor: function () {
        return this.getStyle("alarm.gradient.color")
    }, getOutlineWidth: function () {
        return this.getStyle("alarm.outline.width")
    }, getOutlineColor: function () {
        return this.getStyle("alarm.outline.color")
    }, getCap: function () {
        return this.getStyle("alarm.cap")
    }, getJoin: function () {
        return this.getStyle("alarm.join")
    }, getAlpha: function () {
        return this.getStyle("alarm.alpha")
    }, isShadowable: function () {
        return this.getStyle("alarm.shadowable")
    }});
    twaver.canvas.LinkHandlerAttachment = function (t, e) {
        twaver.canvas.LinkHandlerAttachment.superClass.constructor.call(this, t, e)
    };
    _twaver.ext("twaver.canvas.LinkHandlerAttachment", twaver.canvas.BasicAttachment, {paint: function (t) {
        twaver.canvas.LinkHandlerAttachment.superClass.paint.apply(this, arguments);
        o.drawText(t, this.linkHandlerLabel, this._contentRect, this.linkHandlerFont, this.getStyle("link.handler.color"))
    }, validate: function () {
        this.linkHandlerFont = this.getFont("link.handler.font");
        this.linkHandlerLabel = this._network.getLinkHandlerLabel(this._element);
        this._textSize = o.getTextSize(this.linkHandlerFont, this.linkHandlerLabel);
        twaver.canvas.LinkHandlerAttachment.superClass.validate.call(this)
    }, getContentWidth: function () {
        return this._textSize ? this._textSize.width : 0
    }, getContentHeight: function () {
        return this._textSize ? this._textSize.height : 0
    }, getCornerRadius: function () {
        return this.getStyle("link.handler.corner.radius")
    }, getPointerLength: function () {
        return this.getStyle("link.handler.pointer.length")
    }, getPointerWidth: function () {
        return this.getStyle("link.handler.pointer.width")
    }, getPosition: function () {
        return this.getStyle("link.handler.position")
    }, getXOffset: function () {
        return this.getStyle("link.handler.xoffset")
    }, getYOffset: function () {
        return this.getStyle("link.handler.yoffset")
    }, getPadding: function () {
        return this.getStyle("link.handler.padding")
    }, getPaddingLeft: function () {
        return this.getStyle("link.handler.padding.left")
    }, getPaddingRight: function () {
        return this.getStyle("link.handler.padding.right")
    }, getPaddingTop: function () {
        return this.getStyle("link.handler.padding.top")
    }, getPaddingBottom: function () {
        return this.getStyle("link.handler.padding.bottom")
    }, getDirection: function () {
        return this.getStyle("link.handler.direction")
    }, isFill: function () {
        return this.getStyle("link.handler.fill")
    }, getFillColor: function () {
        return this.getStyle("link.handler.fill.color")
    }, getGradient: function () {
        return this.getStyle("link.handler.gradient")
    }, getGradientColor: function () {
        return this.getStyle("link.handler.gradient.color")
    }, getOutlineWidth: function () {
        return this.getStyle("link.handler.outline.width")
    }, getOutlineColor: function () {
        return this.getStyle("link.handler.outline.color")
    }, getCap: function () {
        return this.getStyle("link.handler.cap")
    }, getJoin: function () {
        return this.getStyle("link.handler.join")
    }, getAlpha: function () {
        return this.getStyle("link.handler.alpha")
    }, isShadowable: function () {
        return this.getStyle("link.handler.shadowable")
    }});
    twaver.canvas.IconsAttachment = function (t, e) {
        twaver.canvas.IconsAttachment.superClass.constructor.call(this, t, e)
    };
    _twaver.ext("twaver.canvas.IconsAttachment", twaver.canvas.Attachment, {isShadowable: function () {
        return twaver.Defaults.ATTACHMENT_SHADOWABLE
    }, validate: function () {
        twaver.canvas.IconsAttachment.superClass.validate.call(this);
        this.iconsNames = this._network.getIconsNames(this._element);
        if (!this.iconsNames || this.iconsNames.length == 0) {
            return
        }
        this.iconsColors = this._network.getIconsColors(this._element);
        this.iconsOrientation = this._element.getStyle("icons.orientation");
        this.iconsPosition = this._element.getStyle("icons.position");
        this.iconsXoffset = this._element.getStyle("icons.xoffset");
        this.iconsYoffset = this._element.getStyle("icons.yoffset");
        this.iconsXgap = this._element.getStyle("icons.xgap");
        this.iconsYgap = this._element.getStyle("icons.ygap");
        var t = this._getIconsSize(this.iconsNames, this.iconsOrientation, this.iconsXgap, this.iconsYgap);
        if (!t) {
            return
        }
        this.location = this._network.getPosition(this.iconsPosition, this._ui, t, this.iconsXoffset, this.iconsYoffset);
        this._viewRect = {x: this.location.x, y: this.location.y, width: t.width, height: t.height};
        if (this.iconsOrientation === "top") {
            this.location.y += t.height
        } else if (this.iconsOrientation === "left") {
            this.location.x += t.width
        }
    }, paint: function (t) {
        twaver.canvas.IconsAttachment.superClass.paint.apply(this, arguments);
        if (!this.iconsNames || this.iconsNames.length == 0) {
            return
        }
        var e = this.location.x;
        var i = this.location.y;
        var n = 0;
        for (var s in this.iconsNames) {
            var r = null;
            var a = null;
            if (this.iconsColors && this.iconsColors.length > n) {
                a = this.iconsColors[n++]
            }
            var o = _twaver.getImageAsset(this.iconsNames[s]);
            if (o == null) {
                continue
            }
            if (this.iconsOrientation === "right") {
                r = {x: e, y: i, width: o.getWidth(), height: o.getHeight()};
                e += r.width + this.iconsXgap
            } else if (this.iconsOrientation === "left") {
                r = {x: e - o.getWidth(), y: i, width: o.getWidth(), height: o.getHeight()};
                e -= r.width + this.iconsXgap
            } else if (this.iconsOrientation === "top") {
                r = {x: e, y: i - o.getHeight(), width: o.getWidth(), height: o.getHeight()};
                i -= r.height + this.iconsYgap
            } else if (this.iconsOrientation === "bottom") {
                r = {x: e, y: i, width: o.getWidth(), height: o.getHeight()};
                i += r.height + this.iconsYgap
            } else {
                throw"Can not resolve '" + this.iconsOrientation + "' orientation"
            }
            t.drawImage(o.getImage(a), r.x, r.y, r.width, r.height)
        }
    }, _getIconsSize: function (t, e, i, n) {
        var s = 0;
        var r = 0;
        var a = null;
        var o = null;
        var h = null;
        for (var l in t) {
            o = _twaver.getImageAsset(t[l]);
            if (!o) {
                continue
            }
            if (e === "right") {
                a = {x: s, y: r, width: o.getWidth(), height: o.getHeight()};
                s += a.width + i
            } else if (e === "left") {
                a = {x: s - o.getWidth(), y: r, width: o.getWidth(), height: o.getHeight()};
                s -= a.width + i
            } else if (e === "top") {
                a = {x: s, y: r - o.getHeight(), width: o.getWidth(), height: o.getHeight()};
                r -= a.height + n
            } else if (e === "bottom") {
                a = {x: s, y: r, width: o.getWidth(), height: o.getHeight()};
                r += a.height + n
            } else {
                throw"Can not resolve '" + e + "' orientation"
            }
            if (h == null) {
                h = _twaver.clone(a)
            } else {
                h = u.unionRect(h, a)
            }
        }
        if (h) {
            return{width: Math.abs(h.width), height: Math.abs(h.height)}
        }
        return null
    }});
    twaver.canvas.EditAttachment = function (t, e) {
        twaver.canvas.EditAttachment.superClass.constructor.call(this, t, e)
    };
    _twaver.ext("twaver.canvas.EditAttachment", twaver.canvas.Attachment, {paint: function (t) {
        twaver.canvas.EditAttachment.superClass.paint.apply(this, arguments);
        this.paintResizingPoints(t);
        this.paintEditPoints(t)
    }, paintResizingPoints: function (t) {
        var e = this.resizingPoints.size();
        if (e <= 0) {
            return
        }
        var i = this.editPointSize * 2;
        var n = this.editPointSize * 2;
        var s = this._network.getResizePointFillColor();
        var r = this._network.getResizePointOutlineWidth();
        var a = this._network.getResizePointOutlineColor();
        t.lineWidth = r;
        for (var o = 0; o < e; o++) {
            var h = this.resizingPoints.get(o);
            E.rect(t, h.x - this.editPointSize, h.y - this.editPointSize, i, n)
        }
        t.fillStyle = s;
        t.strokeStyle = a;
        t.fill();
        t.stroke()
    }, paintEditPoints: function (t) {
        var e = this.editPoints.size();
        if (e <= 0) {
            return
        }
        var i = this._network.getEditPointOutlineColor();
        var n = this._network.getEditPointFillColor();
        var s = this._network.getEditPointOutlineWidth();
        t.beginPath();
        t.lineWidth = s;
        for (var r = 0; r < e; r++) {
            var a = this.editPoints.get(r);
            t.beginPath();
            E.circle(t, a.x, a.y, this.editPointSize, n, i);
            t.closePath()
        }
    }, validate: function () {
        twaver.canvas.EditAttachment.superClass.validate.call(this);
        this.editPointSize = this._network.getEditPointSize();
        this.resizingPoints = new twaver.List;
        this.editPoints = new twaver.List;
        if (this._element instanceof twaver.Node) {
            this._addResizingPoint(this._element)
        }
        if (this._element instanceof twaver.ShapeNode) {
            this._addShapeNodePoint(this._element)
        }
        if (this._ui instanceof twaver.canvas.ShapeLinkUI) {
            this._addShapeLinkPoints(this._element)
        }
        if (this._ui instanceof twaver.canvas.LinkUI) {
            this._addLinkControlPoint(this._ui)
        }
    }, _addResizingPoint: function (t) {
        var e = t.getRect();
        if (!e) {
            return
        }
        var i = new twaver.List([
            {x: e.x, y: e.y},
            {x: e.x + e.width / 2, y: e.y},
            {x: e.x + e.width, y: e.y},
            {x: e.x, y: e.y + e.height / 2},
            {x: e.x + e.width, y: e.y + e.height / 2},
            {x: e.x, y: e.y + e.height},
            {x: e.x + e.width / 2, y: e.y + e.height},
            {x: e.x + e.width, y: e.y + e.height}
        ]);
        var n = this._network.getResizePointOutlineWidth();
        this._addPoints(e, i, n, true)
    }, _addShapeNodePoint: function (t) {
        this._addEditPoints(t.getPoints())
    }, _addShapeLinkPoints: function (t) {
        this._addEditPoints(t.getPoints())
    }, _addLinkControlPoint: function (t) {
        if (c.isOrthogonalLink(t._element)) {
            var e = t.getControlPoint();
            if (e) {
                var i = new twaver.List;
                i.add(e);
                this._addEditPoints(i)
            }
        }
    }, _addEditPoints: function (t) {
        var e = u.getRect(t);
        if (!e) {
            return
        }
        var i = this._network.getEditPointOutlineWidth();
        this._addPoints(e, t, i, false)
    }, _addPoints: function (t, e, i, n) {
        var s = this.editPointSize + i;
        u.grow(t, s, s);
        this._viewRect = t;
        if (n == true) {
            this.resizingPoints = e
        } else {
            this.editPoints = e
        }
    }});
    twaver.canvas.interaction.BaseInteraction = function (t) {
        this.network = t
    };
    _twaver.ext("twaver.canvas.interaction.BaseInteraction", Object, {setUp: function () {
    }, tearDown: function () {
    }, repaint: function () {
        this.network.repaintTopCanvas()
    }, convertPointFromView: function (t) {
        var e = t.x * this.network.getZoom() - this.network.getViewRect().x;
        var i = t.y * this.network.getZoom() - this.network.getViewRect().y;
        return{x: e, y: i}
    }, convertFromUIToMarkerRect: function (t, e, i) {
        var n = this.network.getZoom();
        return{x: t.x * n - this.network.getViewRect().x + e * n, y: t.y * n - this.network.getViewRect().y + i * n, width: t.width * n, height: t.height * n}
    }, getMarkerPoint: function (t) {
        var e;
        if (m.isTouchable && t.changedTouches && t.changedTouches.length > 0) {
            var i = t.changedTouches[0];
            e = {x: i.clientX, y: i.clientY};
            return e
        }
        if (m.isFirefox) {
            e = {x: t.layerX, y: t.layerY}
        } else {
            e = {x: t.offsetX, y: t.offsetY}
        }
        return e
    }, paint: function (t) {
    }, addListener: function () {
        for (var t = 0; t < arguments.length; t++) {
            var e = arguments[t];
            l.addEventListener(e, "handle_" + e, this.network.getView(), this)
        }
    }, removeListener: function () {
        for (var t = 0; t < arguments.length; t++) {
            l.removeEventListener(arguments[t], this.network.getView(), this)
        }
    }});
    twaver.canvas.interaction.SelectInteraction = function (t) {
        twaver.canvas.interaction.SelectInteraction.superClass.constructor.call(this, t)
    };
    _twaver.ext("twaver.canvas.interaction.SelectInteraction", twaver.canvas.interaction.BaseInteraction, {setUp: function () {
        this.addListener("mousedown", "mouseup");
        this.network.addMarker(this)
    }, tearDown: function () {
        this.removeListener("mousedown", "mouseup");
        this.end();
        this.network.removeMarker(this)
    }, paint: function (t) {
        if (this.startPoint == null || this.endPoint == null) {
            return
        }
        var e = this.convertPointFromView(this.startPoint);
        var i = this.convertPointFromView(this.endPoint);
        var n = e.x;
        var s = e.y;
        var r = i.x;
        var a = i.y;
        var o = u.getRect([
            {x: n, y: s},
            {x: r, y: a}
        ]);
        if (o != null) {
            t.beginPath();
            var h = this.network.getSelectOutlineWidth();
            var l = this.getIntersectMode() ? this.network.getSelectFillColor() : null;
            t.strokeStyle = this.network.getSelectOutlineColor();
            t.lineWidth = h;
            E.rect(t, o.x, o.y, o.width, o.height, l, this.network.getSelectOutlineColor());
            t.closePath()
        }
    }, handle_mousedown: function (t) {
        if (!this.network.isValidEvent(t) || this.network.isMovingElement() || this.network.isEditingElement()) {
            return
        }
        if (t.shiftKey) {
            return
        }
        var e = this.network.getElementAt(t);
        var i = this.network.getSelectionModel();
        if (e) {
            if (_twaver.isCtrlDown(t)) {
                if (i.contains(e)) {
                    i.removeSelection(e)
                } else {
                    i.appendSelection(e)
                }
            } else {
                if (!i.contains(e)) {
                    i.setSelection(e)
                }
            }
        } else {
            if (!_twaver.isCtrlDown(t)) {
                i.clearSelection()
            }
            this.end(t);
            this.startPoint = this.network.getLogicalPoint(t);
            if (this.startPoint && this.network.isRectSelectEnabled()) {
                this.addListener("mousemove")
            }
        }
    }, handle_mouseup: function (t) {
        this.end(t)
    }, handle_mousemove: function (t) {
        if (this.network.isMovingElement() || this.network.isEditingElement()) {
            this.end(t);
            return
        }
        var e = this.network.getLogicalPoint(t);
        if (!e) {
            return
        }
        this.network.setSelectingElement(true);
        if (this.endPoint == null) {
            this.network.fireInteractionEvent({kind: "selectStart", event: t})
        } else {
            this.network.fireInteractionEvent({kind: "selectBetween", event: t})
        }
        this.endPoint = e;
        this.repaint()
    }, end: function (t) {
        if (this.startPoint) {
            if (this.endPoint && this.startPoint.x !== this.endPoint.x && this.startPoint.y !== this.endPoint.y) {
                var e = u.getRect([this.startPoint, this.endPoint]);
                var i = this.network.getElementsAtRect(e, this.getIntersectMode(), this.network.getRectSelectFilter());
                if (i && i.size() > 0) {
                    var n = this.network.getSelectionModel();
                    var s = n.toSelection();
                    i.forEach(function (t) {
                        if (n.contains(t)) {
                            s.remove(t)
                        } else {
                            s.add(t)
                        }
                    }, this);
                    n.setSelection(s)
                }
                this.network.fireInteractionEvent({kind: "selectEnd", event: t})
            }
            this.network.setSelectingElement(false);
            this.removeListener("mousemove");
            this.startPoint = null;
            this.endPoint = null;
            this.repaint()
        }
    }, getIntersectMode: function () {
        if (this.network.getSelectMode() === "intersect") {
            return true
        }
        if (this.network.getSelectMode() === "contain") {
            return false
        }
        return this.startPoint.x > this.endPoint.x && this.startPoint.y > this.endPoint.y
    }});
    twaver.canvas.interaction.MoveInteraction = function (t, e) {
        this.lazyMode = e;
        twaver.canvas.interaction.MoveInteraction.superClass.constructor.call(this, t)
    };
    _twaver.ext("twaver.canvas.interaction.MoveInteraction", twaver.canvas.interaction.BaseInteraction, {setUp: function () {
        this.addListener("mousedown", "mouseup");
        this.network.addMarker(this)
    }, tearDown: function () {
        this.removeListener("mousedown", "mouseup");
        this.end();
        this.network.removeMarker(this)
    }, paint: function (t) {
        if (this.lazyMode) {
            if (this.pressPoint == null || this.dragPoint == null) {
                return
            }
            t.beginPath();
            var e = this.dragPoint.x - this.pressPoint.x;
            var i = this.dragPoint.y - this.pressPoint.y;
            var n = this.network.getMovableSelectedElements();
            var s = n.size();
            var r = this.network.isLazyMoveFill() ? this.network.getLazyMoveFillColor() : null;
            var a = this.network.getLazyMoveOutlineWidth();
            var o = this.network.getLazyMoveOutlineColor();
            t.strokeStyle = o;
            t.lineWidth = a;
            t.fillStyle = r;
            for (var h = 0; h < s; h++) {
                var l = n.get(h);
                var c = this.network.getElementUI(l);
                if (c) {
                    var u = this.convertFromUIToMarkerRect(c.getViewRect(), e, i);
                    E.rect(t, u.x, u.y, u.width, u.height)
                }
            }
            t.fill();
            t.stroke()
        }
    }, handle_mousedown: function (t) {
        if (!this.network.isValidEvent(t) || this.network.isSelectingElement() || this.network.isEditingElement()) {
            return
        }
        var e = this.network.getElementAt(t);
        if (!this.network.isMovable(e)) {
            return
        }
        this.end(t);
        this.lastPoint = this.network.getLogicalPoint(t);
        if (this.lazyMode) {
            this.pressPoint = this.lastPoint
        }
        if (this.lastPoint) {
            this.addListener("mousemove")
        }
    }, handle_mouseup: function (t) {
        this.end(t)
    }, handle_mousemove: function (t) {
        if (this.network.isSelectingElement() || this.network.isEditingElement() || !this.network.hasMovableSelectedElements()) {
            this.end(t);
            return
        }
        var e = this.network.getLogicalPoint(t);
        if (!e) {
            return
        }
        this.xoffset = e.x - this.lastPoint.x;
        this.yoffset = e.y - this.lastPoint.y;
        if (Math.abs(this.xoffset) < 1 && Math.abs(this.yoffset) < 1) {
            return
        }
        if (this.lazyMode) {
            if (this.dragPoint == null) {
                this.network.fireInteractionEvent({kind: "lazyMoveStart", event: t});
                this.network.setMovingElement(true)
            } else {
                this.network.fireInteractionEvent({kind: "lazyMoveBetween", event: t})
            }
        } else {
            this.network.moveSelectedElements(this.xoffset, this.yoffset);
            this.lastPoint = e;
            if (this.network.isMovingElement()) {
                this.network.fireInteractionEvent({kind: "liveMoveBetween", event: t})
            } else {
                this.network.setMovingElement(true);
                this.network.fireInteractionEvent({kind: "liveMoveStart", event: t})
            }
        }
        if (this.lazyMode) {
            this.dragPoint = e;
            this.repaint()
        }
    }, end: function (t) {
        if (this.lazyMode) {
            if (this.dragPoint != null && this.pressPoint != null) {
                var e = this;
                var i = function () {
                    e.network.fireInteractionEvent({kind: "lazyMoveEnd", event: t});
                    e.network.setMovingElement(false)
                };
                var n = this.dragPoint.x - this.pressPoint.x;
                var s = this.dragPoint.y - this.pressPoint.y;
                this.network.moveSelectedElements(n, s, this.network.isLazyMoveAnimate(), i)
            }
        } else {
            if (this.network.isMovingElement()) {
                this.network.setMovingElement(false);
                this.network.fireInteractionEvent({kind: "liveMoveEnd", event: t})
            }
        }
        this.network.invalidateCanvasSize();
        this.removeListener("mousemove");
        this.lastPoint = null;
        this.dragPoint = null;
        this.pressPoint = null
    }});
    twaver.canvas.interaction.ScrollInteraction = function (t) {
        twaver.canvas.interaction.ScrollInteraction.superClass.constructor.call(this, t);
        this.hThumbRect = null;
        this.vThumbRect = null;
        this.scrollBarVisible = false
    };
    _twaver.ext("twaver.canvas.interaction.ScrollInteraction", twaver.canvas.interaction.BaseInteraction, {setUp: function () {
        this.addListener("mousedown", "mouseover", "mouseout");
        if (m.isFirefox) {
            l.addEventListener("DOMMouseScroll", "handleMouseWheel", this.network.getView(), this)
        } else {
            l.addEventListener("mousewheel", "handleMouseWheel", this.network.getView(), this)
        }
        l.addEventListener("mouseup", "handleMouseUp", t, this);
        l.addEventListener("mousemove", "handleMouseMove", t, this);
        this.network.addPropertyChangeListener(this.handleViewRectChange, this);
        this.validateScrollBar();
        this.network.addMarker(this)
    }, tearDown: function () {
        this.removeListener("mousedown", "mouseover", "mouseout");
        if (m.isFirefox) {
            l.removeEventListener("DOMMouseScroll", this.network.getView(), this)
        } else {
            l.removeEventListener("mousewheel", this.network.getView(), this)
        }
        l.removeEventListener("mouseup", t, this);
        l.removeEventListener("mousemove", t, this);
        this.network.removePropertyChangeListener(this.handleViewRectChange, this);
        this.end();
        this.network.removeMarker(this)
    }, handleViewRectChange: function (t) {
        if (t.property == "viewRect" || t.property == "canvasSizeChange") {
            this.validateScrollBar()
        }
    }, getScrollBarWidth: function () {
        return this.network.getScrollBarWidth()
    }, getScrollBarColor: function () {
        return"#cccccc"
    }, validateScrollBar: function () {
        this.hThumbRect = null;
        this.vThumbRect = null;
        if (this.network.isScrollBarVisible() == false) {
            this.repaint();
            return
        }
        var t = this.network.getViewRect().height;
        var e = this.network.getViewRect().width;
        var i = this.network.getViewRect().x;
        var n = this.network.getViewRect().y;
        var s = this.network.getCanvasSize();
        var r = s.width;
        var a = s.height;
        if (r > e) {
            if (i < 0 || i + e > r) {
                this.repaint();
                return
            }
        }
        if (a > t) {
            if (n < 0 || n + t > a) {
                this.repaint();
                return
            }
        }
        var o = 0;
        var h = t < a;
        var l = e < r;
        var c = this.getScrollBarWidth();
        if (t < a) {
            if (l) {
                o = t * (t - c) / a
            } else {
                o = t * t / a
            }
            var u = n / (a - t) * (t - o - c);
            this.vThumbRect = {x: e - c, y: u, width: c, height: o}
        }
        var v = 0;
        if (e < r) {
            if (h) {
                v = e * (e - c) / r
            } else {
                v = e * e / r
            }
            var d = i / (r - e) * (e - v - c);
            this.hThumbRect = {x: d, y: t - c, width: v, height: c}
        }
        this.network.setHScrollBarVisible(this.hThumbRect != null);
        this.network.setVScrollBarVisible(this.vThumbRect != null);
        this.repaint()
    }, scrollXOffset: function (t) {
        var e = this.network.getViewRect().height;
        var i = this.network.getViewRect().width;
        var n = this.network.getViewRect().x;
        var s = this.network.getViewRect().y;
        var r = 30;
        if (t) {
            r = -30
        }
        this.network.setViewRect(n + r, s, i, e)
    }, scrollYOffset: function (t) {
        var e = this.network.getViewRect().height;
        var i = this.network.getViewRect().width;
        var n = this.network.getViewRect().x;
        var s = this.network.getViewRect().y;
        var r = 30;
        if (t) {
            r = -30
        }
        this.network.setViewRect(n, s + r, i, e)
    }, handle_mousedown: function (t) {
        if (this.network.isValidEvent(t) == true) {
            return
        }
        var e = this.getMarkerPoint(t);
        this.hBarDownPoint = null;
        this.vBarDownPoint = null;
        if (this.vThumbRect != null) {
            if (u.containsPoint(this.vThumbRect, e.x, e.y)) {
                this.vBarDownPoint = {x: t.screenX, y: t.screenY};
                this.vBarDownOffset = this.vBarDownPoint.y - this.vThumbRect.y
            }
        }
        if (this.hThumbRect != null) {
            if (u.containsPoint(this.hThumbRect, e.x, e.y)) {
                this.hBarDownPoint = {x: t.screenX, y: t.screenY};
                this.hBarDownOffset = this.hBarDownPoint.x - this.hThumbRect.x
            }
        }
    }, handle_mouseover: function (t) {
        if (this.scrollBarVisible == true) {
            return
        }
        this.scrollBarVisible = true;
        this.repaint()
    }, handle_mouseout: function (t) {
        if (this.scrollBarVisible == false) {
            return
        }
        this.scrollBarVisible = false;
        this.repaint()
    }, handleMouseUp: function (t) {
        this.vBarDownPoint = null;
        this.hBarDownPoint = null;
        this.repaint()
    }, handleMouseMove: function (t) {
        var e = {x: t.screenX, y: t.screenY};
        var i = this.network.getCanvasSize();
        var n = this.network.getViewRect().height;
        var s = this.network.getViewRect().width;
        var r = this.getScrollBarWidth();
        if (this.hBarDownPoint != null) {
            var a = e.x - this.hBarDownPoint.x;
            this.hBarDownPoint = e;
            this.network.setViewOffSet(a * i.width / (s - r), 0);
            return
        }
        if (this.vBarDownPoint != null) {
            var o = e.y - this.vBarDownPoint.y;
            this.vBarDownPoint = e;
            this.network.setViewOffSet(0, o * i.height / (n - r));
            return
        }
    }, handleMouseWheel: function (t) {
        var e = false;
        var i = false;
        if (t.wheelDelta !== t.wheelDeltaX) {
            if (t.wheelDelta) {
                if (t.wheelDelta > 0) {
                    e = true
                }
            } else {
                if (t.detail < 0) {
                    e = true
                }
            }
            this.scrollYOffset(e)
        } else {
            if (t.wheelDelta) {
                if (t.wheelDelta > 0) {
                    i = true
                }
            } else {
                if (t.detail < 0) {
                    i = true
                }
            }
            this.scrollXOffset(i)
        }
    }, paintRoundRect: function (t, e, i, n, s, r, a, h) {
        t.beginPath();
        t.globalAlpha = i;
        t.fillStyle = e;
        o.drawRoundRect(t, n, s, r, a, h);
        t.fill()
    }, end: function () {
    }, paint: function (t) {
        if (this.network.isScrollBarVisible() == false) {
            return
        }
        if (this.scrollBarVisible == false) {
            if (this.hBarDownPoint == null && this.vBarDownPoint == null) {
                return
            }
        }
        var e = this.getScrollBarWidth();
        var i = this.network.getViewRect().height;
        var n = this.network.getViewRect().width;
        t.save();
        var s;
        var r = this.getScrollBarColor();
        if (this.hThumbRect != null) {
            s = t.createLinearGradient(this.hThumbRect.x, this.hThumbRect.y, this.hThumbRect.x, this.hThumbRect.y + this.hThumbRect.height);
            s.addColorStop(0, r);
            s.addColorStop(1, "#666666");
            this.paintRoundRect(t, this.getScrollBarColor(), .5, 0, i - e, n - e, e, e / 2);
            this.paintRoundRect(t, s, .9, this.hThumbRect.x, this.hThumbRect.y + 1, this.hThumbRect.width, this.hThumbRect.height - 2, e / 2)
        }
        if (this.vThumbRect != null) {
            s = t.createLinearGradient(this.vThumbRect.x, this.vThumbRect.y, this.vThumbRect.x + this.vThumbRect.width, this.vThumbRect.y);
            s.addColorStop(0, r);
            s.addColorStop(1, "#666666");
            this.paintRoundRect(t, this.getScrollBarColor(), .5, n - e, 0, e, i - e, e / 2);
            this.paintRoundRect(t, s, .9, this.vThumbRect.x + 1, this.vThumbRect.y, this.vThumbRect.width - 2, this.vThumbRect.height, e / 2)
        }
        t.restore()
    }});
    twaver.canvas.interaction.DefaultInteraction = function (t) {
        twaver.canvas.interaction.DefaultInteraction.superClass.constructor.call(this, t)
    };
    _twaver.ext("twaver.canvas.interaction.DefaultInteraction", twaver.canvas.interaction.BaseInteraction, {setUp: function () {
        this.addListener("mousedown", "keydown")
    }, tearDown: function () {
        this.removeListener("mousedown", "keydown")
    }, handle_mousedown: function (t) {
        if (!this.network.isValidEvent(t)) {
            return
        }
        if (this.network.isFocusOnClick()) {
            twaver.Util.setFocus(this.network.getView())
        }
        var e = this.network.getElementAt(t);
        if (t.detail === 2) {
            this.handleDoubleClicked(t, e)
        } else {
            this.handleClicked(t, e)
        }
    }, handleClicked: function (t, e) {
        d.handleClicked(this.network, t, e)
    }, handleDoubleClicked: function (t, e) {
        d.handleDoubleClicked(this.network, t, e)
    }, handle_keydown: function (t) {
        d.handleKeyDown(this.network, t)
    }});
    twaver.canvas.interaction.PanInteraction = function (t) {
        twaver.canvas.interaction.PanInteraction.superClass.constructor.call(this, t)
    };
    _twaver.ext("twaver.canvas.interaction.PanInteraction", twaver.canvas.interaction.BaseInteraction, {setUp: function () {
        this.addListener("mousedown", "mouseup");
        this._oldCursor = this.network.getView().style.cursor
    }, tearDown: function () {
        this.removeListener("mousedown", "mouseup")
    }, handle_mousedown: function (t) {
        if (!this.network.isValidEvent(t)) {
            return
        }
        this.lastPoint = this.getMarkerPoint(t);
        if (this.lastPoint) {
            this.addListener("mousemove");
            this.network.getView().style.cursor = "pointer"
        }
    }, handle_mouseup: function (t) {
        this._clear()
    }, handle_mousemove: function (t) {
        if (!this.lastPoint) {
            return
        }
        var e = this.getMarkerPoint(t);
        if (!e) {
            return
        }
        var i = e.x - this.lastPoint.x;
        var n = e.y - this.lastPoint.y;
        this.network.panByOffset(-i, -n);
        this.lastPoint = e
    }, _clear: function (t) {
        if (this.lastPoint) {
            this.lastPoint = null;
            this.network.getView().style.cursor = this._oldCursor;
            this.removeListener("mousemove")
        }
    }});
    twaver.canvas.interaction.CreateElementInteraction = function (t, e) {
        if (!e) {
            e = twaver.Node
        }
        if (twaver.Util.isTypeOf(e, twaver.Node)) {
            this.elementFunction = function (t) {
                var i = new e;
                if (i instanceof twaver.Node) {
                    i.setCenterLocation(t)
                }
                return i
            }
        } else {
            this.elementFunction = e
        }
        twaver.canvas.interaction.CreateElementInteraction.superClass.constructor.call(this, t)
    };
    _twaver.ext("twaver.canvas.interaction.CreateElementInteraction", twaver.canvas.interaction.BaseInteraction, {setUp: function () {
        this.addListener("mousedown")
    }, tearDown: function () {
        this.removeListener("mousedown")
    }, handle_mousedown: function (t) {
        var e = this.network.getLogicalPoint(t);
        if (e) {
            var i = this.elementFunction(e);
            if (i) {
                this.network.addElementByInteraction(i)
            }
        }
    }});
    twaver.canvas.interaction.EditInteraction = function (t, e) {
        this.lazyMode = e;
        this.pointIndex = -1;
        twaver.canvas.interaction.EditInteraction.superClass.constructor.call(this, t)
    };
    _twaver.ext("twaver.canvas.interaction.EditInteraction", twaver.canvas.interaction.BaseInteraction, {setUp: function () {
        this.addListener("mousedown", "mouseup", "mousemove");
        this.oldCursor = this.network.getView().style.cursor;
        this.network.setHasEditInteraction(true);
        this.network.addMarker(this)
    }, tearDown: function () {
        this.removeListener("mousedown", "mouseup", "mousemove");
        this.network.getView().style.cursor = this.oldCursor;
        this.network.setHasEditInteraction(false);
        this.clear();
        this.network.removeMarker(this)
    }, paint: function (t) {
        if (this.lazyMode == true && this.resizingRect != null) {
            t.lineWidth = this.network.getResizeLineWidth();
            var e = this.convertFromUIToMarkerRect(this.resizingRect, 0, 0);
            t.beginPath();
            E.rect(t, e.x, e.y, e.width, e.height, null, this.network.getResizeLineColor())
        }
    }, clear: function () {
        this.network.setEditingElement(false);
        this.isStart = false;
        this.node = null;
        this.shapeNode = null;
        this.shapeLink = null;
        this.linkUI = null;
        this.resizingRect = null;
        this.resizeDirection = null;
        this.pointIndex = -1;
        this._removeCursor();
        this.oldCursor = null
    }, _removeCursor: function () {
        if (this.cursorID) {
            this.network.getView().style.cursor = this.oldCursor || "default";
            this.cursorID = null
        }
        this.resizeDirection = null;
        this.isCrossCursor = false
    }, _setCrossCursor: function () {
        if (!this.isCrossCursor) {
            this._removeCursor();
            this._setCursor("crosshair");
            this.isCrossCursor = true
        }
    }, _setCursor: function (t) {
        this.cursorID = t;
        if (this.network.getView().style.cursor !== this.cursorID) {
            this.network.getView().style.cursor = this.cursorID
        }
    }, handle_mousedown: function (t) {
        if (!this.network.isEditingElement()) {
            return
        }
        if (!this.isStart) {
            if (this.node && this.resizeDirection) {
                this.isStart = true;
                this.network.fireInteractionEvent({kind: this.lazyMode ? "lazyResizeStart" : "liveResizeStart", event: t, element: this.node, resizeDirection: this.resizeDirection})
            } else if (this.shapeNode && this.pointIndex >= 0) {
                this.isStart = true;
                this.network.fireInteractionEvent({kind: "liveMovePointStart", event: t, element: this.shapeNode, pointIndex: this.pointIndex})
            } else if (this.shapeLink && this.pointIndex >= 0) {
                this.isStart = true;
                this.network.fireInteractionEvent({kind: "liveMovePointStart", event: t, element: this.shapeLink, pointIndex: this.pointIndex})
            } else if (this.linkUI) {
                this.isStart = true;
                this.network.fireInteractionEvent({kind: "liveMovePointStart", event: t, element: this.linkUI._element})
            }
        }
    }, handle_mouseup: function (t) {
        if (this.isStart) {
            var e = this.network.getLogicalPoint(t);
            if (this.resizingRect) {
                if (this.lazyMode) {
                    if (this.network.ResizeAnimate) {
                        var i = this;
                        var n = new twaver.animaate.AnimateBounds(this.node, this.resizingRect, function () {
                            i.network.fireInteractionEvent({kind: "lazyResizeEnd", event: t, element: i.node, resizeDirection: i.resizeDirection})
                        });
                        twaver.animate.AnimateManager.start(n)
                    } else {
                        this.node.setLocation(this.resizingRect.x, this.resizingRect.y);
                        this.node.setSize(this.resizingRect.width, this.resizingRect.height);
                        this.network.fireInteractionEvent({kind: "lazyResizeEnd", event: t, element: this.node, resizeDirection: this.resizeDirection})
                    }
                } else {
                    this.node.setLocation(this.resizingRect.x, this.resizingRect.y);
                    this.node.setSize(this.resizingRect.width, this.resizingRect.height);
                    this.network.fireInteractionEvent({kind: "liveResizeEnd", event: t, element: this.node, resizeDirection: this.resizeDirection})
                }
            } else if (this.shapeNode && this.pointIndex >= 0 && e) {
                this.shapeNode.setPoint(this.pointIndex, e);
                this.network.fireInteractionEvent({kind: "liveMovePointEnd", event: t, element: this.shapeNode, pointIndex: this.pointIndex})
            } else if (this.shapeLink && this.pointIndex >= 0 && e) {
                this.shapeLink.setPoint(this.pointIndex, e);
                this.network.fireInteractionEvent({kind: "liveMovePointEnd", event: t, element: this.shapeLink, pointIndex: this.pointIndex})
            } else if (this.linkUI && e) {
                this.linkUI.setControlPoint(e);
                this.network.fireInteractionEvent({kind: "liveMovePointEnd", event: t, element: this.linkUI._element})
            }
        }
        this.clear()
    }, handle_mousemove: function (t) {
        if (!this.network.isValidEvent(t)) {
            return
        }
        if (this.isStart && this.shapeNode && this.pointIndex >= 0) {
            this._handleMovingShapeNodePoint(t);
            return
        }
        if (this.isStart && this.shapeLink && this.pointIndex >= 0) {
            this._handleMovingShapeLinkPoint(t);
            return
        }
        if (this.isStart && this.node && this.resizeDirection) {
            this._handleResizing(t);
            return
        }
        if (this.isStart && this.linkUI) {
            this._handleMovingLinkControlPoint(t);
            return
        }
        if (this.network.isSelectingElement() || this.network.isMovingElement() || this.network.getSelectionModel().size() === 0) {
            this.clear();
            return
        }
        var e = this.network.getElementAt(t);
        var i = this.network.getElementUI(e);
        if (!i || !i.getEditAttachment()) {
            this.clear();
            return
        }
        var n = this.network.getLogicalPoint(t);
        if (e instanceof twaver.Node) {
            this.node = e;
            if (this._isEditingShapeNode(n) || this._isResizingNode(n)) {
                this.network.setEditingElement(true);
                return
            }
        } else if (e instanceof twaver.ShapeLink) {
            this.shapeLink = e;
            if (this._isEditingShapeLink(n)) {
                this.network.setEditingElement(true);
                return
            }
        } else if (i instanceof twaver.canvas.LinkUI) {
            if (c.isOrthogonalLink(i._element)) {
                this.linkUI = i;
                var s = this.linkUI.getControlPoint();
                if (s && this._contains(n, s)) {
                    this._setCrossCursor();
                    this.network.setEditingElement(true)
                }
                return
            }
        }
        this.clear()
    }, _handleMovingShapeNodePoint: function (t) {
        var e = this.network.getLogicalPoint(t);
        this.shapeNode.setPoint(this.pointIndex, e);
        this.network.fireInteractionEvent({kind: "liveMovePointBetween", e: t, element: this.shapeNode, pointIndex: this.pointIndex})
    }, _handleMovingShapeLinkPoint: function (t) {
        var e = this.network.getLogicalPoint(t);
        this.shapeLink.setPoint(this.pointIndex, e);
        this.network.fireInteractionEvent({kind: "liveMovePointBetween", e: t, element: this.shapeLink, pointIndex: this.pointIndex})
    }, _handleMovingLinkControlPoint: function (t) {
        this.linkUI.setControlPoint(this.network.getLogicalPoint(t));
        this.network.fireInteractionEvent({kind: "liveMovePointBetween", e: t, element: this.linkUI._element})
    }, _handleResizing: function (t) {
        var e = this.network.getLogicalPoint(t);
        var i = this.node.getRect();
        if (this.resizeDirection === "northwest") {
            this.resizingRect = this._getRect(e.x, e.y, i.x + i.width, i.y + i.height)
        }
        if (this.resizeDirection === "north") {
            this.resizingRect = this._getRect(i.x, e.y, i.x + i.width, i.y + i.height)
        }
        if (this.resizeDirection === "northeast") {
            this.resizingRect = this._getRect(i.x, e.y, e.x, i.y + i.height)
        }
        if (this.resizeDirection === "west") {
            this.resizingRect = this._getRect(e.x, i.y, i.x + i.width, i.y + i.height)
        }
        if (this.resizeDirection === "east") {
            this.resizingRect = this._getRect(i.x, i.y, e.x, i.y + i.height)
        }
        if (this.resizeDirection === "southwest") {
            this.resizingRect = this._getRect(e.x, i.y, i.x + i.width, e.y)
        }
        if (this.resizeDirection === "south") {
            this.resizingRect = this._getRect(i.x, i.y, i.x + i.width, e.y)
        }
        if (this.resizeDirection === "southeast") {
            this.resizingRect = this._getRect(i.x, i.y, e.x, e.y)
        }
        if (this.lazyMode) {
            this.repaint();
            this.network.fireInteractionEvent({kind: "lazyResizeBetween", event: t, element: this.node, resizeDirection: this.resizeDirection})
        } else {
            this.node.setLocation(this.resizingRect.x, this.resizingRect.y);
            this.node.setSize(this.resizingRect.width, this.resizingRect.height);
            this.network.fireInteractionEvent({kind: "liveResizeBetween", event: t, element: this.node, resizeDirection: this.resizeDirection})
        }
    }, _isEditingShapeNode: function (t) {
        if (this.node instanceof twaver.ShapeNode) {
            this.shapeNode = this.node;
            var e = this.shapeNode.getPoints();
            for (var i = 0, n = e.size(); i < n; i++) {
                var s = e.get(i);
                if (this._contains(t, s)) {
                    this._setCrossCursor();
                    this.pointIndex = i;
                    return true
                }
            }
        }
        this.pointIndex = -1;
        return false
    }, _isEditingShapeLink: function (t) {
        var e = this.shapeLink.getPoints();
        for (var i = 0, n = e.size(); i < n; i++) {
            var s = e.get(i);
            if (this._contains(t, s)) {
                this._setCrossCursor();
                this.pointIndex = i;
                return true
            }
        }
        this.pointIndex = -1;
        return false
    }, _isResizingNode: function (t) {
        var e = this.node.getRect();
        if (this._isResizing(t, e.x, e.y, "northwest", "nwse-resize")) {
            return true
        }
        if (this._isResizing(t, e.x + e.width / 2, e.y, "north", "ns-resize")) {
            return true
        }
        if (this._isResizing(t, e.x + e.width, e.y, "northeast", "nesw-resize")) {
            return true
        }
        if (this._isResizing(t, e.x, e.y + e.height / 2, "west", "ew-resize")) {
            return true
        }
        if (this._isResizing(t, e.x + e.width, e.y + e.height / 2, "east", "ew-resize")) {
            return true
        }
        if (this._isResizing(t, e.x, e.y + e.height, "southwest", "nesw-resize")) {
            return true
        }
        if (this._isResizing(t, e.x + e.width / 2, e.y + e.height, "south", "ns-resize")) {
            return true
        }
        if (this._isResizing(t, e.x + e.width, e.y + e.height, "southeast", "nwse-resize")) {
            return true
        }
        return false
    }, _isResizing: function (t, e, i, n, s) {
        if (this._contains(t, {x: e, y: i})) {
            if (this.resizeDirection !== n) {
                this._removeCursor();
                this._setCursor(s);
                this.resizeDirection = n
            }
            return true
        }
        return false
    }, _getRect: function (t, e, i, n) {
        var s = t < i ? t : i;
        var r = e < n ? e : n;
        var a = Math.abs(t - i);
        var o = Math.abs(e - n);
        return{x: s, y: r, width: a, height: o}
    }, _contains: function (t, e) {
        var i = this.network.getEditPointSize();
        var n = {x: e.x - i, y: e.y - i, width: i * 2, height: i * 2};
        return u.containsPoint(n, t)
    }});
    twaver.canvas.interaction.CreateLinkInteraction = function (t, e) {
        if (!e) {
            e = twaver.Link
        }
        if (twaver.Util.isTypeOf(e, twaver.Link)) {
            this.linkFunction = function (t, i) {
                var n = new e;
                if (n instanceof twaver.Link) {
                    n.setFromNode(t);
                    n.setToNode(i)
                }
                return n
            }
        } else {
            this.linkFunction = e
        }
        twaver.canvas.interaction.CreateLinkInteraction.superClass.constructor.call(this, t)
    };
    _twaver.ext("twaver.canvas.interaction.CreateLinkInteraction", twaver.canvas.interaction.BaseInteraction, {setUp: function () {
        this.addListener("mousedown", "mousemove");
        this.network.addMarker(this)
    }, tearDown: function () {
        this.removeListener("mousedown", "mousemove");
        this.clear();
        this.network.removeMarker(this)
    }, paint: function (t) {
        t.beginPath();
        var e;
        var i;
        t.lineWidth = this.network.getEditLineWidth();
        var n = this.network.getEditLineColor();
        if (this.currentNode && this.currentNode !== this.fromNode) {
            e = this.network.getElementUI(this.currentNode).getViewRect();
            i = this.convertFromUIToMarkerRect(e, 0, 0);
            E.rect(t, i.x, i.y, i.width, i.height, null, n)
        }
        if (this.fromNode) {
            e = this.network.getElementUI(this.fromNode).getViewRect();
            i = this.convertFromUIToMarkerRect(e, 0, 0);
            E.rect(t, i.x, i.y, i.width, i.height, null, n)
        }
        if (this.currentPoint) {
            this.paintLine(t)
        }
        t.closePath()
    }, paintLine: function (t) {
        var e = this.network.getEditLineColor();
        var i = this.convertPointFromView(this.fromNode.getCenterLocation());
        var n = i.x, s = i.y;
        var r = this.currentPoint.x, a = this.currentPoint.y;
        t.strokeStyle = e;
        t.beginPath();
        t.moveTo(n, s);
        t.lineTo(r, a);
        t.stroke()
    }, clear: function () {
        this.currentPoint = null;
        this.currentNode = null;
        this.fromNode = null;
        this.toNode = null
    }, createLink: function () {
        return this.linkFunction(this.fromNode, this.toNode)
    }, handle_mousedown: function (t) {
        if (!this.network.isValidEvent(t)) {
            return
        }
        if (this.fromNode) {
            this.toNode = this.currentNode;
            if (this.toNode) {
                var e = this.createLink();
                if (e) {
                    this.network.addElementByInteraction(e)
                }
            }
            this.clear()
        } else {
            this.fromNode = this.currentNode;
            this.currentNode = null;
            this.currentPoint = null;
            this.repaint()
        }
    }, handle_mousemove: function (t) {
        var e = this.getMarkerPoint(t);
        if (!e) {
            return
        }
        if (this.network.isMovingElement() || this.network.isEditingElement()) {
            this.clear();
            return
        }
        var i = null;
        if (this.fromNode) {
            this.currentNode = this.getToNode(t);
            this.currentPoint = e;
            this.repaint()
        } else {
            i = this.getFromNode(t);
            if (this.currentNode !== i) {
                this.currentNode = i;
                this.repaint()
            }
        }
    }, getFromNode: function (t) {
        var e = this.network.getElementAt(t);
        if (e instanceof twaver.Node) {
            return e
        }
        return null
    }, getToNode: function (t) {
        var e = this.network.getElementAt(t);
        if (e instanceof twaver.Node) {
            return e
        }
        return null
    }});
    twaver.canvas.interaction.CreateShapeLinkInteraction = function (t, e) {
        twaver.canvas.interaction.CreateShapeLinkInteraction.superClass.constructor.call(this, t);
        if (!e) {
            e = twaver.ShapeLink
        }
        if (twaver.Util.isTypeOf(e, twaver.ShapeLink)) {
            this.linkFunction = function (t, i, n) {
                var s = new e;
                if (s instanceof twaver.ShapeLink) {
                    s.setFromNode(t);
                    s.setToNode(i);
                    if (n) {
                        s.setPoints(n)
                    }
                }
                return s
            }
        } else {
            this.linkFunction = e
        }
    };
    _twaver.ext("twaver.canvas.interaction.CreateShapeLinkInteraction", twaver.canvas.interaction.CreateLinkInteraction, {clear: function () {
        this.points = null;
        twaver.canvas.interaction.CreateShapeLinkInteraction.superClass.clear.call(this)
    }, createLink: function () {
        return this.linkFunction(this.fromNode, this.toNode, this.points)
    }, handle_mousedown: function (t) {
        var e = this.network.getLogicalPoint(t);
        if (!e) {
            return
        }
        if (this.fromNode) {
            this.toNode = this.currentNode;
            if (this.toNode) {
                var i = this.createLink();
                if (i) {
                    this.network.addElementByInteraction(i)
                }
                this.clear()
            } else {
                if (!this.points) {
                    this.points = new twaver.List
                }
                if (this.points.size() > 0) {
                    var n = this.points.get(this.points.size() - 1);
                    if (n.x === e.x && n.y === e.y) {
                        return
                    }
                }
                this.points.add(e)
            }
        } else {
            this.fromNode = this.currentNode;
            this.points = null;
            this.currentNode = null;
            this.currentPoint = null
        }
        this.repaint()
    }, paintLine: function (t) {
        if (this.currentPoint) {
            var e = new twaver.List;
            var i;
            i = this.convertPointFromView(this.fromNode.getCenterLocation());
            e.add(i, 0);
            if (this.points && this.points.size() > 0) {
                var n = this.points.size();
                for (var s = 0; s < n; s++) {
                    i = this.convertPointFromView(this.points.get(s));
                    e.add(i)
                }
            }
            i = this.convertPointFromView(this.currentPoint);
            e.add(i);
            t.lineWidth = this.network.getEditLineWidth();
            t.strokeStyle = this.network.getEditLineColor();
            t.beginPath();
            o.drawLinePoints(t, e);
            t.stroke()
        }
    }});
    twaver.canvas.interaction.CreateShapeNodeInteraction = function (t, e) {
        if (!e) {
            e = twaver.ShapeNode
        }
        if (twaver.Util.isTypeOf(e, twaver.ShapeNode)) {
            this.shapeNodeFunction = function (t) {
                var i = new e;
                if (i instanceof twaver.ShapeNode) {
                    if (t) {
                        i.setPoints(t)
                    }
                }
                return i
            }
        } else {
            this.shapeNodeFunction = e
        }
        twaver.canvas.interaction.CreateShapeNodeInteraction.superClass.constructor.call(this, t)
    };
    _twaver.ext("twaver.canvas.interaction.CreateShapeNodeInteraction", twaver.canvas.interaction.BaseInteraction, {setUp: function () {
        this.addListener("mousedown", "mousemove");
        this.network.addMarker(this)
    }, tearDown: function () {
        this.removeListener("mousedown", "mousemove");
        this.clear();
        this.network.removeMarker(this);
        this.network.setEditingElement(false)
    }, clear: function () {
        this.points = null;
        this.currentPoint = null
    }, paint: function (t) {
        if (this.points && this.points.size() > 0) {
            if (this.currentPoint) {
                var e = new twaver.List;
                var i = this.points.size();
                var n;
                for (var s = 0; s < i; s++) {
                    n = this.convertPointFromView(this.points.get(s));
                    e.add(n)
                }
                n = this.convertPointFromView(this.currentPoint);
                e.add(n);
                t.lineWidth = this.network.getEditLineWidth();
                t.strokeStyle = this.network.getEditLineColor();
                t.beginPath();
                o.drawLinePoints(t, e);
                t.stroke()
            }
        }
    }, handle_mousedown: function (t) {
        var e = this.network.getLogicalPoint(t);
        if (!e) {
            return
        }
        if (t.detail === 2) {
            if (this.points) {
                var i = this.shapeNodeFunction(this.points);
                this.network.addElementByInteraction(i);
                this.clear();
                var n = this;
                setTimeout(function () {
                    n.network.setEditingElement(false)
                }, 0)
            }
        } else {
            if (!this.network.isEditingElement()) {
                this.network.setEditingElement(true)
            }
            if (!this.points) {
                this.points = new twaver.List
            }
            if (this.points.size() > 0) {
                var s = this.points.get(this.points.size() - 1);
                if (s.x === e.x && s.y === e.y) {
                    return
                }
            }
            this.points.add(e)
        }
        this.repaint()
    }, handle_mousemove: function (t) {
        if (this.points) {
            this.currentPoint = this.network.getLogicalPoint(t);
            this.repaint()
        }
    }});
    twaver.canvas.interaction.MagnifyInteraction = function (t, e, i, n) {
        twaver.canvas.interaction.MagnifyInteraction.superClass.constructor.call(this, t);
        this.scale = e || 2;
        this.xRadius = i || 100;
        this.yRadius = n || 100;
        this.markCanvas = l.createCanvas()
    };
    _twaver.ext("twaver.canvas.interaction.MagnifyInteraction", twaver.canvas.interaction.BaseInteraction, {setUp: function () {
        this.addListener("mousemove");
        this.network.addMarker(this)
    }, tearDown: function () {
        this.removeListener("mousemove");
        this.network.removeMarker(this)
    }, paint: function (t) {
        if (this.point) {
            var e = this.xRadius / this.scale / this.network._zoom;
            var i = this.yRadius / this.scale / this.network._zoom;
            var n = {x: this.point.x - e, y: this.point.y - i, width: e * 2, height: i * 2};
            this.network.toCanvasByRegion(n, this.scale * this.network._zoom, this.markCanvas);
            t.drawImage(this.markCanvas, this.point.x * this.network._zoom - this.xRadius - this.network.viewRect.x, this.point.y * this.network._zoom - this.yRadius - this.network.viewRect.y)
        }
    }, handle_mousemove: function (t) {
        this.point = this.network.getLogicalPoint(t);
        if (!this.point) {
            return
        }
        this.repaint()
    }});
    twaver.canvas.interaction.TouchInteraction = function (t) {
        twaver.network.interaction.TouchInteraction.superClass.constructor.call(this, t)
    };
    _twaver.ext("twaver.canvas.interaction.TouchInteraction", twaver.canvas.interaction.BaseInteraction, {setUp: function () {
        var t = this.network.getView();
        l.addEventListener("touchstart", "handleTouchstart", t, this);
        l.addEventListener("touchmove", "handleTouchmove", t, this);
        l.addEventListener("touchend", "handleTouchend", t, this);
        l.addEventListener("touchcancel", "handleTouchend", t, this);
        this.network.addMarker(this)
    }, tearDown: function () {
        var t = this.network.getView();
        l.removeEventListener("touchstart", this.network.getView(), this);
        l.removeEventListener("touchmove", t, this);
        l.removeEventListener("touchend", t, this);
        l.removeEventListener("touchcancel", t, this);
        this.network.removeMarker(this)
    }, handleTouchstart: function (t) {
        l.preventDefault(t);
        if (t.touches && t.touches.length == 1) {
            var e = this.network.getLogicalPoint(t);
            var i = this.network.getElementAt(e);
            this._startTouchTime = new Date;
            this._startTouchPoint = e;
            this._startTouchClient = this.getMarkerPoint(t);
            if (i) {
                this._haveElementUnderTouch = true;
                this._startTouchElement = i
            } else {
                this._haveElementUnderTouch = false;
                this._startTouchElement = null
            }
        } else if (t.touches && t.touches.length == 2) {
            this._distance = _.getDistance(t);
            this._zoom = this.network.getZoom()
        }
        this._touchCount = t.touches.length
    }, handleTouchmove: function (t) {
        l.preventDefault(t);
        if (this._touchCount == 2 && t.touches && t.touches.length == 2) {
            var e = _.getDistance(t) / this._distance;
            this.network.setZoom(this._zoom * e, false)
        } else if (this._touchCount == 1 && t.touches && t.touches.length == 1) {
            if (this._haveElementUnderTouch || !this.network.isRectSelectEnabled()) {
                var i = this.network.getLogicalPoint(t);
                var n = this.network.getElementAt(i);
                if (this.network.isMovingElement() || this._startTouchElement != null && this._startTouchElement == n && this.network.getMovableSelectedElements().contains(n)) {
                    var s = i.x - this._startTouchPoint.x;
                    var r = i.y - this._startTouchPoint.y;
                    this._startTouchPoint = i;
                    this.network.moveSelectedElements(s, r);
                    if (this.network.isMovingElement()) {
                        this.network.fireInteractionEvent({kind: "liveMoveBetween", event: t})
                    } else {
                        this.network.setMovingElement(true);
                        this.network.fireInteractionEvent({kind: "liveMoveStart", event: t})
                    }
                } else {
                    var a = this.getMarkerPoint(t);
                    var s = this._startTouchClient.x - a.x;
                    var r = this._startTouchClient.y - a.y;
                    this.network.panByOffset(s, r);
                    this._startTouchClient = a
                }
            } else {
                var o = this.network.getLogicalPoint(t);
                if (!o) {
                    return
                }
                this.network.setSelectingElement(true);
                if (this._moveTouchPoint) {
                    this.network.fireInteractionEvent({kind: "selectBetween", event: t})
                } else {
                    this.network.fireInteractionEvent({kind: "selectStart", event: t})
                }
                this._moveTouchPoint = o;
                this.repaint()
            }
        }
    }, handleTouchend: function (t) {
        l.preventDefault(t);
        if (this.network.isMovingElement()) {
            this.network.setMovingElement(false);
            this.network.fireInteractionEvent({kind: "liveMoveEnd", event: t})
        } else if (this.network.isSelectingElement()) {
            var e = u.getRect([this._startTouchPoint, this._moveTouchPoint]);
            var i = this.network.getElementsAtRect(e, this.getIntersectMode(), this.network.getRectSelectFilter());
            if (i && i.size() > 0) {
                var n = this.network.getSelectionModel();
                var s = n.toSelection();
                i.forEach(function (t) {
                    if (n.contains(t)) {
                        s.remove(t)
                    } else {
                        s.add(t)
                    }
                }, this);
                n.setSelection(s)
            }
            this.network.fireInteractionEvent({kind: "selectEnd", event: t});
            this._moveTouchPoint = null;
            this.network.setSelectingElement(false);
            this.repaint()
        } else if (this._startTouchPoint) {
            var r = new Date;
            var a = this.network.getLogicalPoint(t);
            var o = this.network.getElementAt(this._startTouchPoint);
            if (a && r.getTime() - this._startTouchTime.getTime() <= 500 && u.getDistance(this._startTouchPoint, a) <= 20) {
                if (o) {
                    if (!this.network.getSelectionModel().contains(o)) {
                        this.network.getSelectionModel().setSelection(o)
                    }
                } else {
                    this.network.getSelectionModel().clearSelection()
                }
                d.handleClicked(this.network, t, o);
                if (this._endTouchTime && r.getTime() - this._endTouchTime.getTime() <= 500 && u.getDistance(this._endTouchPoint, a) <= 20) {
                    delete this._endTouchTime;
                    delete this._endTouchPoint;
                    d.handleDoubleClicked(this.network, t, o)
                } else {
                    this._endTouchTime = r;
                    this._endTouchPoint = a
                }
            }
        }
    }, paint: function (t) {
        if (!this._startTouchPoint || !this._moveTouchPoint) {
            return
        }
        var e = this.convertPointFromView(this._startTouchPoint);
        var i = this.convertPointFromView(this._moveTouchPoint);
        var n = e.x;
        var s = e.y;
        var r = i.x;
        var a = i.y;
        var o = u.getRect([
            {x: n, y: s},
            {x: r, y: a}
        ]);
        if (o != null) {
            t.beginPath();
            var h = this.network.getSelectOutlineWidth();
            var l = this.getIntersectMode() ? this.network.getSelectFillColor() : null;
            t.strokeStyle = this.network.getSelectOutlineColor();
            t.lineWidth = h;
            E.rect(t, o.x, o.y, o.width, o.height, l, this.network.getSelectOutlineColor());
            t.closePath()
        }
    }, getIntersectMode: function () {
        if (this.network.getSelectMode() === "intersect") {
            return true
        }
        if (this.network.getSelectMode() === "contain") {
            return false
        }
        return this._startTouchPoint.x > this._moveTouchPoint.x && this._startTouchPoint.y > this._moveTouchPoint.y
    }});
    twaver.canvas.interaction.MSTouchInteraction = function (t) {
        twaver.network.interaction.MSTouchInteraction.superClass.constructor.call(this, t);
        this._pointerMap = {};
        this._pointerIdArray = []
    };
    _twaver.ext("twaver.canvas.interaction.MSTouchInteraction", twaver.canvas.interaction.BaseInteraction, {setUp: function () {
        var t = this.network.getView();
        l.addEventListener("MSPointerDown", "handleTouchstart", t, this);
        l.addEventListener("MSPointerMove", "handleTouchmove", t, this);
        l.addEventListener("MSPointerUp", "handleTouchend", t, this);
        l.addEventListener("MSPointerCancel", "handleTouchend", t, this);
        this.network.addMarker(this)
    }, tearDown: function () {
        var t = this.network.getView();
        l.removeEventListener("MSPointerDown", t, this);
        l.removeEventListener("MSPointerMove", t, this);
        l.removeEventListener("MSPointerUp", t, this);
        l.removeEventListener("MSPointerCancel", t, this);
        this.network.removeMarker(this)
    }, handleTouchstart: function (t) {
        if (this.network.isFocusOnClick()) {
            twaver.Util.setFocus(this.network._view)
        }
        if (this.network.isSelectingElement() && t.pointerType == t.MSPOINTER_TYPE_MOUSE) {
            return
        }
        var e = this.network.getLogicalPoint(t);
        var i = new Date;
        if (t.isPrimary && this._pointerIdArray.length > 0) {
            this.handle_mouseup(t)
        }
        if (!this._pointerMap[t.pointerId]) {
            this._pointerIdArray.push(t.pointerId);
            this._pointerMap[t.pointerId] = t
        }
        if (this._pointerIdArray.length == 1) {
            var n = this.network.getElementAt(e);
            this._startTouchElement = n;
            this._startClientPoint = {x: t.clientX, y: t.clientY};
            d.handleClicked(this.network, t, n);
            if (this._startTouchTime && this._startTouchPoint && i.getTime() - this._startTouchTime.getTime() <= 500 && u.getDistance(this._startTouchPoint, e) <= 20) {
                d.handleDoubleClicked(this.network, t, n);
                this._doubleClick = true
            } else {
                l.handle_mousedown(this, t);
                this._startTouchPoint = e;
                this._startTouchTime = i
            }
            var s = this.network.getSelectionModel();
            if (n) {
                if (_twaver.isCtrlDown(t)) {
                    if (s.contains(n)) {
                        s.removeSelection(n)
                    } else {
                        s.appendSelection(n)
                    }
                } else {
                    if (!s.contains(n)) {
                        s.setSelection(n)
                    }
                }
            } else {
                if (!_twaver.isCtrlDown(t)) {
                    s.clearSelection()
                }
            }
        } else if (this._pointerIdArray.length == 2) {
            this._distance = this._getDistance();
            this._zoom = this.network.getZoom()
        }
    }, handleTouchmove: function (t) {
        if (this._startTouchPoint == null || this._pointerIdArray.length == 0 || !this._pointerMap[t.pointerId] || u.getDistance({x: this._pointerMap[t.pointerId].pageX, y: this._pointerMap[t.pointerId].pageY}, {x: t.pageX, y: t.pageY}) <= 10) {
            return
        }
        this._pointerMap[t.pointerId] = t;
        if (this._pointerIdArray.length == 2) {
            var e = this._getDistance() / this._distance;
            this.network.setZoom(this._zoom * e, false)
        }
    }, handleTouchend: function (t) {
        if (this.network.isMovingElement()) {
            this.network.setMovingElement(false);
            this.network.fireInteractionEvent({kind: "liveMoveEnd", event: t})
        }
        if (this.network.isSelectingElement()) {
            var e = u.getRect([this._startTouchPoint, this._moveTouchPoint]);
            var i = this.network.getElementsAtRect(e, this.getIntersectMode(), this.network.getRectSelectFilter());
            if (i && i.size() > 0) {
                var n = this.network.getSelectionModel();
                var s = n.toSelection();
                i.forEach(function (t) {
                    if (n.contains(t)) {
                        s.remove(t)
                    } else {
                        s.add(t)
                    }
                }, this);
                n.setSelection(s)
            }
            this.network.fireInteractionEvent({kind: "selectEnd", event: t});
            this._moveTouchPoint = null;
            this.network.setSelectingElement(false);
            this.repaint()
        }
        if (this._doubleClick) {
            delete this._doubleClick;
            delete this._startTouchPoint;
            delete this._startTouchTime
        }
        var r = -1;
        for (var a = 0; a < this._pointerIdArray.length; a++) {
            if (this._pointerIdArray[a] == t.pointerId) {
                r = a;
                break
            }
        }
        if (r >= 0)this._pointerIdArray.splice(r, 1);
        delete this._pointerMap[t.pointerId];
        this._startTouchPoint = null;
        this._moveTouchPoint = null
    }, _getDistance: function () {
        return u.getDistance({x: this._pointerMap[this._pointerIdArray[0]].pageX, y: this._pointerMap[this._pointerIdArray[0]].pageY}, {x: this._pointerMap[this._pointerIdArray[1]].pageX, y: this._pointerMap[this._pointerIdArray[1]].pageY})
    }, getIntersectMode: function () {
        if (this.network.getSelectMode() === "intersect") {
            return true
        }
        if (this.network.getSelectMode() === "contain") {
            return false
        }
        return this._startTouchPoint.x > this._moveTouchPoint.x && this._startTouchPoint.y > this._moveTouchPoint.y
    }, handle_mousemove: function (t) {
        var e = {x: t.clientX, y: t.clientY};
        if (u.getDistance(this._startClientPoint, e) < 3)return;
        if (this._startTouchPoint && this._pointerIdArray.length == 1) {
            this._moveTouchPoint = {x: this._startTouchPoint.x + (e.x - this._startClientPoint.x) / this.network.getZoom(), y: this._startTouchPoint.y + (e.y - this._startClientPoint.y) / this.network.getZoom()};
            if (this._startTouchElement == null && this.network.isRectSelectEnabled()) {
                var i = this.network.getLogicalPoint(t);
                if (!i) {
                    return
                }
                this.network.setSelectingElement(true);
                if (this._moveTouchPoint) {
                    this.network.fireInteractionEvent({kind: "selectBetween", event: t})
                } else {
                    this.network.fireInteractionEvent({kind: "selectStart", event: t})
                }
                this.repaint()
            } else {
                var n = this.network.getElementAt(this._moveTouchPoint);
                if (this._startTouchElement == null && !this.network.isRectSelectEnabled()) {
                    var s = this._startClientPoint.x - e.x;
                    var r = this._startClientPoint.y - e.y;
                    this.network.panByOffset(s, r)
                } else if (this.network.isMovingElement() || this._startTouchElement != null && n == this._startTouchElement && this.network.getMovableSelectedElements().contains(n)) {
                    var s = this._moveTouchPoint.x - this._startTouchPoint.x;
                    var r = this._moveTouchPoint.y - this._startTouchPoint.y;
                    this.network.moveSelectedElements(s, r);
                    if (this.network.isMovingElement()) {
                        this.network.fireInteractionEvent({kind: "liveMoveBetween", event: t})
                    } else {
                        this.network.setMovingElement(true);
                        this.network.fireInteractionEvent({kind: "liveMoveStart", event: t})
                    }
                }
                this._startClientPoint = e
            }
        }
    }, handle_mouseup: function (t) {
        this.handleTouchend(t);
        this._pointerIdArray = [];
        this._pointerMap = {}
    }, paint: function (t) {
        if (!this._startTouchPoint || !this._moveTouchPoint || this._startTouchElement || !this.network.isRectSelectEnabled()) {
            return
        }
        var e = this.convertPointFromView(this._startTouchPoint);
        var i = this.convertPointFromView(this._moveTouchPoint);
        var n = e.x;
        var s = e.y;
        var r = i.x;
        var a = i.y;
        var o = u.getRect([
            {x: n, y: s},
            {x: r, y: a}
        ]);
        if (o != null) {
            t.beginPath();
            var h = this.network.getSelectOutlineWidth();
            var l = this.getIntersectMode() ? this.network.getSelectFillColor() : null;
            t.strokeStyle = this.network.getSelectOutlineColor();
            t.lineWidth = h;
            E.rect(t, o.x, o.y, o.width, o.height, l, this.network.getSelectOutlineColor());
            t.closePath()
        }
    }})
})(window);
(function (t, e) {
    var a = _twaver.extend;
    var s = _twaver.g;
    var h = _twaver.html;
    var r = _twaver.math;
    var o = _twaver.popup;
    var l = _twaver.render;
    var _ = _twaver.touch;
    var c = _twaver.ua;
    var u = twaver.List;
    var d = twaver.Defaults;
    twaver.charts.IS_INVALIDATE_PROPERTY = {xZoom: 1, xTranslate: 1, yZoom: 1, yTranslate: 1};
    twaver.charts.ChartBase = function (t) {
        twaver.charts.ChartBase.superClass.constructor.apply(this, arguments);
        this._uniqueColors = {};
        this._nonDataColors = {};
        this._publishedDatas = new u;
        this._view = h.createView("hidden");
        this._canvas = h.createCanvas();
        this._view.appendChild(this._canvas);
        this.setDataBox(t ? t : new twaver.ElementBox);
        this.invalidate();
        var i;
        if (c.isMSToucheable) {
            i = twaver.charts.ChartMSTouchInteraction
        } else if (c.isTouchable) {
            i = twaver.charts.ChartTouchInteraction
        } else {
            i = twaver.charts.ChartInteraction
        }
        if (i) {
            new i(this)
        }
        this.setToolTipEnabled(d.CHART_TOOLTIP_ENABLED)
    };
    _twaver.ext("twaver.charts.ChartBase", twaver.controls.ViewBase, {__accessor: ["xGap", "yGap", "xTranslate", "yTranslate", "valueVisible", "sortFunction", "visibleFunction", "xTranslateEnabled", "yTranslateEnabled", "xZoomEnabled", "yZoomEnabled", "selectTolerance", "backgroundVisible", "backgroundFill", "backgroundFillColor", "backgroundOutlineWidth", "backgroundOutlineColor", "backgroundGradient", "backgroundGradientColor", "outerZoom"], __bool: ["doubleClickToReset", "focusOnClick"], _backgroundVisible: d.CHART_BACKGROUND_VISIBLE, _backgroundFill: d.CHART_BACKGROUND_FILL, _backgroundFillColor: d.CHART_BACKGROUND_FILL_COLOR, _backgroundOutlineWidth: d.CHART_BACKGROUND_OUTLINE_WIDTH, _backgroundOutlineColor: d.CHART_BACKGROUND_OUTLINE_COLOR, _backgroundGradient: d.CHART_BACKGROUND_GRADIENT, _backgroundGradientColor: d.CHART_BACKGROUND_GRADIENT_COLOR, _selectTolerance: d.CHART_SELECT_TOLERANCE, _doubleClickToReset: d.CHART_DOUBLE_CLICK_TO_RESET, _focusOnClick: d.FOCUS_ON_CLICK, _sortFunction: null, _visibleFunction: null, _canvasWidth: 0, _canvasHeight: 0, _outerZoomL: 1, _xGap: d.CHART_XGAP, _yGap: d.CHART_YGAP, _xTranslate: 0, _yTranslate: 0, _xTranslateEnabled: d.CHART_XTRANSLATE_ENABLED, _yTranslateEnabled: d.CHART_YTRANSLATE_ENABLED, _xZoom: 1, _yZoom: 1, _maxZoom: d.ZOOM_MAX, _minZoom: d.ZOOM_MIN, _xZoomEnabled: d.CHART_XZOOM_ENABLED, _yZoomEnabled: d.CHART_YZOOM_ENABLED, _valueVisible: d.CHART_VALUE_VISIBLE, _valueFont: d.CHART_VALUE_FONT, isToolTipEnabled: function () {
        return this._toolTipListener ? true : false
    }, setToolTipEnabled: function (t) {
        if (t) {
            if (!this._toolTipListener) {
                var i = this;
                this._toolTipListener = function (t) {
                    o.showToolTip(t, i.getToolTip(t))
                };
                this._canvas.addEventListener("mousemove", this._toolTipListener, true);
                this.firePropertyChange("toolTipEnabled", false, true)
            }
        } else {
            if (this._toolTipListener) {
                o.hideToolTip();
                this._canvas.removeEventListener("mousemove", this._toolTipListener, true);
                delete this._toolTipListener;
                this.firePropertyChange("toolTipEnabled", true, false)
            }
        }
    }, getToolTip: function (t) {
        if (this._toolTipInfos) {
            var i = this.getLogicalPoint(t);
            i.x -= this._xTranslate;
            i.y -= this._yTranslate;
            var e = this._toolTipInfos.size();
            for (var a = e - 1; a >= 0; a--) {
                var s = this._toolTipInfos.get(a);
                if (s.rect && r.containsPoint(s.rect, i)) {
                    return this.getToolTipByData(s.data, s)
                }
            }
        } else {
            var n = this.tryGetDataAt(t);
            if (n) {
                return this.getToolTipByData(n, {value: this.getValue(n)})
            }
        }
        return null
    }, getToolTipByData: function (t, i) {
        if (i.value !== e) {
            return this.formatValueText(i.value, t)
        }
        return null
    }, addToolTipInfo: function (t, i, e, a, s, n, h) {
        if (this._toolTipInfos) {
            this._toolTipInfos.add({data: n, rect: {x: t, y: i, width: e, height: a}, value: s, index: h})
        }
    }, getLogicalPoint: function (t) {
        return h.getLogicalPoint(this._canvas, t, this._outerZoom)
    }, getTextSize: function (t, i) {
        var e = s.getTextSize(t, i);
        if (e.width) {
            e.width += 4
        }
        return e
    }, getUniqueColor: function (t, i) {
        if (t == null) {
            return null
        }
        var a;
        if (!i) {
            a = this._nonDataColors[t];
            if (a) {
                return a
            }
        }
        var n = s.getColorArray(t);
        if (!i) {
            if (n[3] != 255) {
                a = t
            } else {
                a = "rgba(" + n[0] + "," + n[1] + "," + n[2] + ",0.99)"
            }
            this._nonDataColors[t] = a;
            return a
        }
        var h = "rgb(" + n[0] + "," + n[1] + "," + n[2] + ")";
        if (this._uniqueColors[h] === e || this._uniqueColors[h] === i) {
        } else {
            var r = 1;
            var o = -1;
            var l = 1;
            if (c.isOpera) {
                n = [n[0], n[1], n[2]]
            }
            while (true) {
                n[0] += r;
                if (n[0] >= 255) {
                    n[0] = 255;
                    r = -1
                } else if (n[0] <= 0) {
                    n[0] = 0;
                    r = 1
                }
                h = "rgb(" + n[0] + "," + n[1] + "," + n[2] + ")";
                if (this._uniqueColors[h] === e || this._uniqueColors[h] === i) {
                    break
                }
                n[1] += o;
                if (n[1] >= 255) {
                    n[1] = 255;
                    o = -1
                } else if (n[1] <= 0) {
                    n[1] = 0;
                    o = 1
                }
                h = "rgb(" + n[0] + "," + n[1] + "," + n[2] + ")";
                if (this._uniqueColors[h] === e || this._uniqueColors[h] === i) {
                    break
                }
                n[2] += l;
                if (n[2] >= 255) {
                    n[2] = 255;
                    l = -1
                } else if (n[2] <= 0) {
                    n[2] = 0;
                    l = 1
                }
                h = "rgb(" + n[0] + "," + n[1] + "," + n[2] + ")";
                if (this._uniqueColors[h] === e || this._uniqueColors[h] === i) {
                    break
                }
            }
        }
        this._uniqueColors[h] = i;
        return h
    }, tryGetDataAt: function (t, i) {
        if (i == null || i < 0) {
            i = this._selectTolerance
        }
        if (t.target) {
            t = h.getLogicalPoint(this._canvas, arguments[0], this._outerZoom)
        }
        if (!t) {
            return null
        }
        var e = t.x - i;
        var a = t.y - i;
        var s = i * 2 + 1;
        var r = i * 2 + 1;
        try {
            var o = this._canvas.getContext("2d").getImageData(e, a, s, r).data;
            for (var l = 0; n = o.length, l < n; l += 4) {
                if (o[l + 3] === 255) {
                    var _ = "rgb(" + o[l] + "," + o[l + 1] + "," + o[l + 2] + ")";
                    var c = this._uniqueColors[_];
                    if (c) {
                        return c
                    }
                }
            }
        } catch (u) {
        }
        return null
    }, _getPoint: function () {
        var t, i;
        if (arguments.length === 2) {
            t = arguments[0];
            i = arguments[1]
        } else if (arguments[0].target) {
            var e = h.getLogicalPoint(this._canvas, arguments[0], this._outerZoom);
            if (e) {
                t = e.x;
                i = e.y
            } else {
                return null
            }
        } else {
            t = arguments[0].x;
            i = arguments[0].y
        }
        return{x: t, y: i}
    }, getDataAt: function () {
        var t = this._getPoint.apply(this, arguments), i = t.x, e = t.y;
        if (i < 0 || e < 0 || i > this._canvasWidth || e > this._canvasHeight) {
            return null
        }
        try {
            var a = this._canvas.getContext("2d").getImageData(i, e, 1, 1).data;
            if (a[3] === 255) {
                var s = "rgb(" + a[0] + "," + a[1] + "," + a[2] + ")";
                var n = this._uniqueColors[s];
                if (n) {
                    return n
                }
            }
        } catch (h) {
        }
        return null
    }, getBackgroundRect: function () {
        return this._backgroundRect
    }, drawBackground: function (t, i) {
        this._backgroundRect = _twaver.clone(i);
        if (i != null && i.width > 0 && i.height > 0 && this._backgroundVisible) {
            if (this._backgroundFill) {
                s.fill(t, this.getUniqueColor(this._backgroundFillColor), this._backgroundGradient, this.getUniqueColor(this._backgroundGradientColor), i)
            }
            if (this._backgroundOutlineWidth > 0) {
                t.lineWidth = this._backgroundOutlineWidth;
                t.strokeStyle = this._backgroundOutlineColor
            }
            t.beginPath();
            t.rect(i.x, i.y, i.width, i.height);
            t.closePath();
            if (this._backgroundFill) {
                t.fill()
            }
            if (this._backgroundOutlineWidth > 0) {
                t.stroke()
            }
        }
    }, getName: function (t) {
        return t.getName()
    }, getColor: function (t) {
        return t.getStyle ? t.getStyle("chart.color") : t.getClient("chart.color")
    }, getValue: function (t) {
        return t.getStyle ? t.getStyle("chart.value") : 0
    }, getValueColor: function (t) {
        return t.getStyle ? t.getStyle("chart.value.color") : twaver.Styles.getStyle("chart.value.color")
    }, setValueFont: function (t) {
        if (t === this._valueFont) {
            return
        }
        var i = t;
        this._valueFont = t;
        this.firePropertyChange("valueFont", i, t)
    }, getValueFont: function (t) {
        if (t) {
            var i = t.getStyle ? t.getStyle("chart.value.font") : twaver.Styles.getStyle("chart.value.font");
            if (i) {
                return i
            }
        }
        return this._valueFont
    }, formatValueText: function (t, i) {
        return t
    }, getCanvasWidth: function () {
        return this._canvasWidth
    }, getCanvasHeight: function () {
        return this.canvasHeight
    }, getCanvas: function () {
        return this._canvas
    }, isVisible: function (t) {
        if (this._internalVisibleFunction && !this._internalVisibleFunction(t)) {
            return false
        }
        return this._visibleFunction ? this._visibleFunction(t) : true
    }, onPropertyChanged: function (t) {
        if (twaver.charts.IS_INVALIDATE_PROPERTY[t.property]) {
            this.invalidate()
        } else {
            this.invalidateModel()
        }
    }, getDataBox: function () {
        return this._box
    }, setDataBox: function (t) {
        if (!t) {
            throw"DataBox can not be null"
        }
        if (this._box === t) {
            return
        }
        var i = this._box;
        if (i) {
            i.removeDataBoxChangeListener(this.handleDataBoxChange, this);
            i.removeDataPropertyChangeListener(this.handlePropertyChange, this);
            i.removeHierarchyChangeListener(this.handleHierarchyChange, this);
            if (!this._selectionModel) {
                i.getSelectionModel().removeSelectionChangeListener(this.handleSelectionChange, this)
            }
        }
        this._box = t;
        this._box.addDataBoxChangeListener(this.handleDataBoxChange, this);
        this._box.addDataPropertyChangeListener(this.handlePropertyChange, this);
        this._box.addHierarchyChangeListener(this.handleHierarchyChange, this);
        if (this._selectionModel) {
            this._selectionModel._setDataBox(t)
        } else {
            this._box.getSelectionModel().addSelectionChangeListener(this.handleSelectionChange, this)
        }
        this.invalidateModel();
        this.firePropertyChange("dataBox", i, this._box)
    }, handleDataBoxChange: function (t) {
        this.invalidateModel()
    }, handlePropertyChange: function (t) {
        this.invalidateModel()
    }, handleHierarchyChange: function (t) {
        this.invalidateModel()
    }, handleSelectionChange: function (t) {
        this.invalidateModel()
    }, getUnfilteredDatas: function () {
        return this._unfilteredDatas ? this._unfilteredDatas : this._publishedDatas
    }, getPublishedDatas: function () {
        return this._publishedDatas
    }, createPublishedDatas: function () {
        this._unfilteredDatas = new u;
        this._buildChildren(this._box.getRoots(), this._unfilteredDatas);
        if (this._sortFunction) {
            this._unfilteredDatas.sort(this._sortFunction)
        }
        return this._unfilteredDatas.toList(this.isVisible, this)
    }, _buildChildren: function (t, i) {
        t.forEach(function (t) {
            i.add(t);
            this._buildChildren(t.getChildren(), i)
        }, this)
    }, invalidateModel: function () {
        if (this._invalidateModel) {
            return
        }
        this._invalidateModel = true;
        this.invalidate()
    }, validateImpl: function () {
        if (this._invalidateModel) {
            this._invalidateModel = false;
            this._uniqueColors = {};
            this._nonDataColors = {};
            this._publishedDatas = this.createPublishedDatas();
            this._publishedDatas.forEach(function (t) {
                if (t.IStyle) {
                    if (!t.getStyle("chart.color")) {
                        t.setStyle("chart.color", _twaver.nextColor())
                    }
                } else {
                    if (!t.getClient("chart.color")) {
                        t.setClient("chart.color", _twaver.nextColor())
                    }
                }
            });
            this.validateModel()
        }
        var t = this._canvas.getContext("2d");
        this._canvasWidth = this._view.clientWidth;
        this._canvasHeight = this._view.clientHeight;
        this._canvas.setAttribute("width", this._canvasWidth);
        this._canvas.setAttribute("height", this._canvasHeight);
        t.clearRect(0, 0, this._canvasWidth, this._canvasHeight);
        if (this._canvasWidth > 0 && this._canvasHeight > 0) {
            t.translate(this._xTranslate, this._yTranslate);
            this._valueTexts = this._valueVisible ? new u : null;
            this.validateDisplay(t, this._canvasWidth * this._xZoom, this._canvasHeight * this._yZoom);
            delete this._valueTexts;
            t.translate(-this._xTranslate, -this._yTranslate)
        }
    }, validateModel: function () {
    }, validateDisplay: function (t, i, e) {
    }, drawLine: function (t, i, e, a, s, n, h) {
        if (e > 0) {
            t.lineWidth = e;
            t.strokeStyle = this.getUniqueColor(i);
            t.beginPath();
            t.moveTo(a, s);
            t.lineTo(n, h);
            t.stroke()
        }
    }, drawValueTexts: function (t) {
        if (this._valueTexts) {
            this._valueTexts.forEach(function (i) {
                s.drawText(t, i.text, i, i.font, i.color)
            })
        }
    }, drawVerticalText: function (t, i, e, a, n) {
        n = this.getUniqueColor(n);
        t.translate(e.x, e.y);
        t.rotate(-Math.PI / 2);
        s.drawText(t, i, null, a, n);
        t.rotate(Math.PI / 2);
        t.translate(-e.x, -e.y)
    }, _getValueTextInfo: function (t, i) {
        if (this._valueTexts) {
            var e = this.formatValueText(i, t);
            if (e && e !== "") {
                var a = this.getValueColor(t);
                var s = {text: e, font: this.getValueFont(t), color: this.getUniqueColor(a, t)};
                this._valueTexts.add(s);
                return s
            }
        }
        return null
    }, getMaxZoom: function () {
        return this._maxZoom
    }, setMaxZoom: function (t) {
        if (t < 0) {
            return
        }
        var i = this._maxZoom;
        this._maxZoom = t;
        this.firePropertyChange("maxZoom", i, t);
        if (this.getXZoom() > t) {
            this.setXZoom(t, false)
        }
        if (this.getYZoom() > t) {
            this.setYZoom(t, false)
        }
    }, getMinZoom: function () {
        return this._minZoom
    }, setMinZoom: function (t) {
        if (t < 0) {
            return
        }
        var i = this._minZoom;
        this._minZoom = t;
        this.firePropertyChange("minZoom", i, t);
        if (this.getXZoom() < t) {
            this.setXZoom(t)
        }
        if (this.getYZoom() < t) {
            this.setYZoom(t)
        }
    }, zoomIn: function (t) {
        if (t == null) {
            t = d.ZOOM_ANIMATE
        }
        if (t) {
            twaver.animate.AnimateManager.start(new twaver.animate.AnimateXYZoom(this, this._xZoom * d.ZOOM_INCREMENT, this._yZoom * d.ZOOM_INCREMENT))
        } else {
            this.xZoomIn(false);
            this.yZoomIn(false)
        }
    }, zoomOut: function (t) {
        if (t == null) {
            t = d.ZOOM_ANIMATE
        }
        if (t) {
            twaver.animate.AnimateManager.start(new twaver.animate.AnimateXYZoom(this, this._xZoom / d.ZOOM_INCREMENT, this._yZoom / d.ZOOM_INCREMENT))
        } else {
            this.xZoomOut(false);
            this.yZoomOut(false)
        }
    }, zoomReset: function (t) {
        if (t == null) {
            t = d.ZOOM_ANIMATE
        }
        if (t) {
            twaver.animate.AnimateManager.start(new twaver.animate.AnimateXYZoom(this, 1, 1))
        } else {
            this.xZoomReset(false);
            this.yZoomReset(false)
        }
    }, getXZoom: function () {
        return this._xZoom
    }, onXZoomChanged: function (t, i) {
    }, xZoomIn: function (t) {
        this.setXZoom(this._xZoom * d.ZOOM_INCREMENT, t)
    }, xZoomOut: function (t) {
        this.setXZoom(this._xZoom / d.ZOOM_INCREMENT, t)
    }, xZoomReset: function (t) {
        this.setXZoom(1, t)
    }, setXZoom: function (t, i) {
        if (!_twaver.num(t) || t <= 0) {
            return
        }
        if (t < this._minZoom) {
            t = this._minZoom
        }
        if (t > this._maxZoom) {
            t = this._maxZoom
        }
        if (t === this.xZoom) {
            return
        }
        if (i == null) {
            i = d.ZOOM_ANIMATE
        }
        if (i) {
            twaver.animate.AnimateManager.start(new twaver.animate.AnimateXZoom(this, t))
        } else {
            var e = this._xZoom;
            var a = this._xTranslate - (this._canvasWidth / 2 - this._xTranslate) / e * (t - e);
            this._xZoom = t;
            this.firePropertyChange("xZoom", e, t);
            this.onXZoomChanged(e, t);
            this.setXTranslate(a)
        }
    }, getYZoom: function () {
        return this._yZoom
    }, onYZoomChanged: function (t, i) {
    }, yZoomIn: function (t) {
        this.setYZoom(this._yZoom * d.ZOOM_INCREMENT, t)
    }, yZoomOut: function (t) {
        this.setYZoom(this._yZoom / d.ZOOM_INCREMENT, t)
    }, yZoomReset: function (t) {
        this.setYZoom(1, t)
    }, setYZoom: function (t, i) {
        if (!_twaver.num(t) || t <= 0) {
            return
        }
        if (t < this._minZoom) {
            t = this._minZoom
        }
        if (t > this._maxZoom) {
            t = this._maxZoom
        }
        if (t === this.YZoom) {
            return
        }
        if (i == null) {
            i = d.ZOOM_ANIMATE
        }
        if (i) {
            twaver.animate.AnimateManager.start(new twaver.animate.AnimateYZoom(this, t))
        } else {
            var e = this._yZoom;
            var a = this._yTranslate - (this._canvasHeight / 2 - this._yTranslate) / e * (t - e);
            this._yZoom = t;
            this.firePropertyChange("yZoom", e, t);
            this.onYZoomChanged(e, t);
            this.setYTranslate(a)
        }
    }});
    twaver.charts.ScaleChart = function (t) {
        twaver.charts.ScaleChart.superClass.constructor.apply(this, arguments)
    };
    _twaver.ext("twaver.charts.ScaleChart", twaver.charts.ChartBase, {__accessor: ["upperLimit", "lowerLimit", "xAxisText", "xAxisLineColor", "xAxisLineWidth", "xAxisTextColor", "xAxisTextFont", "yAxisText", "yAxisLineColor", "yAxisLineWidth", "yAxisTextColor", "yAxisTextFont", "xScaleTexts", "xScaleTextFont", "xScaleTextColor", "xScaleTextOrientation", "yScaleTextVisible", "yScaleTextColor", "yScaleTextFont", "yScaleLineColor", "yScaleLineWidth", "yScaleValueGap", "yScalePixelGap", "yScaleMinTextVisible"], _reset: function () {
        this._map = {};
        this._max = 0;
        this._min = 0;
        this._columnCount = this._xScaleTexts ? this._xScaleTexts.size() : 0;
        if (this._upperLimit != null) {
            this._max = this._upperLimit
        }
        if (this._lowerLimit != null) {
            this._min = this._lowerLimit
        }
    }, getMin: function () {
        return this._min
    }, getMax: function () {
        return this._max
    }, getRange: function () {
        return this._range
    }, getColumnCount: function () {
        return this._columnCount
    }, getColumnWidth: function () {
        return this._columnWidth
    }, getValues: function (t) {
        return t.getStyle ? t.getStyle("chart.values") : null
    }, formatYScaleText: function (t) {
        return t.toFixed(2)
    }, _initRange: function () {
        if (this._lowerLimit == null) {
            if (this._min >= this._max) {
                this._min = this._max - Math.abs(this._max) * .1
            }
            this._min = this._min - (this._max - this._min) * .1
        }
        this._range = this._max - this._min
    }, _initValuesProportion: function () {
        this._publishedDatas.forEach(function (t) {
            var i = this._map[t.getId()];
            i.values.forEach(function (t) {
                if (t == null) {
                    i.proportions.add(null)
                } else {
                    i.proportions.add(this._range == 0 ? 0 : t / this._range)
                }
            }, this)
        }, this)
    }, _commonValidateModel: function () {
        this._publishedDatas.forEach(function (t) {
            var i = new u(this.getValues(t));
            if (i.size() > this._columnCount) {
                this._columnCount = i.size()
            }
            var e = {data: t, values: i, proportions: new u, color: this.getUniqueColor(this.getColor(t), t)};
            if (this._initInfo) {
                this._initInfo(t, e)
            }
            this._map[t.getId()] = e;
            if (this._upperLimit == null || this._lowerLimit == null) {
                i.forEach(function (t) {
                    if (t != null) {
                        if (this._upperLimit == null && t > this._max) {
                            this._max = t
                        }
                        if (this._lowerLimit == null && t < this._min) {
                            this._min = t
                        }
                    }
                }, this)
            }
        }, this);
        this._initRange();
        this._initValuesProportion()
    }, validateDisplay: function (t, i, e) {
        var a = 0;
        if (this._xAxisText) {
            a = this.getTextSize(this._xAxisTextFont, this._xAxisText).height
        }
        var n = 0;
        if (this._xScaleTexts) {
            this._xScaleTexts.forEach(function (t) {
                var i = this.getTextSize(this._xScaleTextFont, t);
                var e = this._xScaleTextOrientation === "vertical" ? i.width : i.height;
                if (e > n)n = e
            }, this)
        }
        var h = e - this._yGap - a - n;
        var r = h - this._yGap;
        var o = this._upperLimit == null ? r * .9 : r;
        var l = 0;
        if (this._yAxisText) {
            l = this.getTextSize(this._yAxisTextFont, this._yAxisText).height
        }
        var _, c;
        if (this._yScaleValueGap > 0) {
            _ = Math.max(this._yScaleValueGap / this._range * o, 1);
            c = this._yScaleValueGap
        } else {
            _ = Math.max(this._yScalePixelGap, 1);
            c = this._range * (_ / o)
        }
        var d = 0, f = new u, g, x;
        if (this._yScaleTextVisible) {
            g = this._yScaleMinTextVisible ? 0 : _;
            var v = this._min + (this._yScaleMinTextVisible ? 0 : c);
            while (g <= r + 1) {
                x = this.formatYScaleText(v);
                if (x) {
                    var T = this.getTextSize(this._yScaleTextFont, x);
                    if (T.width > d) {
                        d = T.width
                    }
                    f.add({text: x, size: T, cursor: g})
                }
                g += _;
                v += c
            }
        }
        var C = {x: this._xGap + l + d, y: this._yGap, width: i - this._xGap - l - d - this._xGap, height: e - this._yGap - n - a - this._yGap};
        this.drawBackground(t, C);
        if (this._columnCount > 0) {
            this._columnWidth = C.width / (this._columnCount * 3 + 1) * 2
        } else {
            this._columnWidth = C.width / 2
        }
        if (this._columnWidth === 0) {
            this._columnWidth = 1
        }
        if (this._yScaleLineWidth > 0) {
            g = 0;
            while (g <= r + 1) {
                this.drawLine(t, this._yScaleLineColor, this._yScaleLineWidth, C.x, h - g, C.x + C.width, h - g);
                g += _
            }
        }
        if (this._xAxisText) {
            s.drawText(t, this._xAxisText, {x: C.x + C.width / 2, y: h + n + a / 2}, this._xAxisTextFont, this.getUniqueColor(this._xAxisTextColor))
        }
        if (this._yAxisText) {
            this.drawVerticalText(t, this._yAxisText, {x: this._xGap + l / 2, y: r / 2 + this._yGap}, this._yAxisTextFont, this.getUniqueColor(this._yAxisTextColor))
        }
        this.drawLine(t, this._yAxisLineColor, this._yAxisLineWidth, C.x, C.y + C.height, C.x, C.y);
        var A = this.getUniqueColor(this._yScaleTextColor);
        f.forEach(function (i) {
            var e = {x: this._xGap + l + d - i.size.width / 2, y: h - i.cursor};
            s.drawText(t, i.text, e, this._yScaleTextFont, A)
        }, this);
        var y = C.y + C.height + n / 2;
        A = this.getUniqueColor(this._xScaleTextColor);
        var L = this._xScaleLineWidth > 0 ? this.getUniqueColor(this._xScaleLineColor) : null;
        for (var m = 0; m < this._columnCount; m++) {
            var p = C.x + this._columnWidth * (1 + m * 1.5);
            if (this._xScaleTexts && m < this._xScaleTexts.size()) {
                x = this._xScaleTexts.get(m);
                if (x) {
                    var R = {x: p, y: y};
                    if (this._xScaleTextOrientation === "vertical") {
                        this.drawVerticalText(t, x, R, this._yScaleTextFont, A)
                    } else {
                        s.drawText(t, x, R, this._xScaleTextFont, A)
                    }
                }
            }
            if (this._type !== "default" && L) {
                this.drawLine(t, L, this._xScaleLineWidth, p, C.y + C.height, p, C.y)
            }
        }
        var S = h + this._min / c * _;
        if (this._publishedDatas.size() > 0 && this._columnCount > 0) {
            this.drawContent(t, C, o, S)
        }
        this.drawLine(t, this._xAxisLineColor, this._xAxisLineWidth, C.x, C.y + C.height, C.x + C.width, C.y + C.height)
    }});
    twaver.charts.PieChart = function (t) {
        this._sum = 0;
        this._map = {};
        twaver.charts.PieChart.superClass.constructor.apply(this, arguments)
    };
    _twaver.ext("twaver.charts.PieChart", twaver.charts.ChartBase, {__accessor: ["type", "selectOffset", "startAngle", "shadowColor", "shadowOffset", "lineRate", "donutRate", "valuePosition"], _type: d.PIECHART_TYPE, _lineRate: d.PIECHART_LINE_RATE, _donutRate: d.PIECHART_DONUT_RATE, _startAngle: d.PIECHART_START_ANGLE, _shadowColor: d.PIECHART_SHADOW_COLOR, _shadowOffset: d.PIECHART_SHADOW_OFFSET, _selectOffset: d.PIECHART_SELECT_OFFSET, _valuePosition: d.PIECHART_VALUE_POSITION, getSum: function () {
        return this._sum
    }, validateModel: function () {
        this._sum = 0;
        this._map = {};
        this._publishedDatas.forEach(function (t) {
            var i = this.getValue(t);
            this._map[t.getId()] = {data: t, value: i, color: this.getUniqueColor(this.getColor(t), t)};
            this._sum += i
        }, this);
        var t = this._startAngle;
        this._publishedDatas.forEach(function (i) {
            var e = this._map[i.getId()];
            e.proportion = this._sum === 0 ? 0 : e.value / this._sum;
            if (this._type !== "line") {
                e.startAngle = t;
                e.arc = e.proportion * Math.PI * 2;
                t += e.arc
            }
        }, this)
    }, validateDisplay: function (t, i, e) {
        var a = {x: this._xGap, y: this._yGap, width: i - this._xGap * 2, height: e - this._yGap * 2};
        this.drawBackground(t, a);
        r.grow(a, -4, -4);
        if (a.width <= 0 || a.height <= 0) {
            return
        }
        var n = this._shadowOffset;
        if (n > 0) {
            t.shadowOffsetX = n;
            t.shadowOffsetY = n;
            t.shadowBlur = n * 1.5;
            t.shadowColor = this._shadowColor
        }
        if (this._type === "oval" || this._type === "circle") {
            var h = a.x + a.width / 2;
            var o = a.y + a.height / 2;
            var l = a.width / 2;
            var _ = a.height / 2;
            if (this._type === "circle") {
                l = _ = Math.min(l, _)
            }
            this._publishedDatas.forEach(function (i) {
                var e = this._map[i.getId()];
                if (e.arc === 0) {
                    return
                }
                var a = 0;
                var n = 0;
                if (this.isSelected(i)) {
                    var r = e.startAngle + e.arc / 2;
                    a = Math.cos(r) * this._selectOffset;
                    n = Math.sin(r) * this._selectOffset * _ / l
                }
                t.fillStyle = e.color;
                t.beginPath();
                t.moveTo(h + a, o - n);
                s.drawArc(t, h + a, o - n, e.startAngle, e.arc, l, _, true);
                t.closePath();
                t.fill();
                var c = this._getValueTextInfo(i, e.value);
                if (c) {
                    var r = e.startAngle + e.arc / 2;
                    c.x = h + a + Math.cos(r) * l * this._valuePosition;
                    c.y = o - n - Math.sin(r) * _ * this._valuePosition
                }
            }, this)
        } else if (this._type === "donut" || this._type === "ovalDonut") {
            var h = a.x + a.width / 2;
            var o = a.y + a.height / 2;
            var l = a.width / 2;
            var _ = a.height / 2;
            if (this._type === "donut") {
                l = _ = Math.min(l, _)
            }
            this._publishedDatas.forEach(function (i) {
                var e = this._map[i.getId()];
                if (e.arc === 0) {
                    return
                }
                var a = 0;
                var n = 0;
                if (this.isSelected(i)) {
                    var r = e.startAngle + e.arc / 2;
                    a = Math.cos(r) * this._selectOffset;
                    n = Math.sin(r) * this._selectOffset * _ / l
                }
                var c = h + Math.cos(e.startAngle) * l * this._donutRate;
                var u = o - Math.sin(e.startAngle) * _ * this._donutRate;
                var d = h + Math.cos(e.startAngle + e.arc) * l * this._donutRate;
                var f = o - Math.sin(e.startAngle + e.arc) * _ * this._donutRate;
                t.fillStyle = e.color;
                t.beginPath();
                t.moveTo(c + a, u - n);
                s.drawArc(t, h + a, o - n, e.startAngle, e.arc, l, _, true);
                t.lineTo(d + a, f - n);
                s.drawArc(t, h + a, o - n, e.startAngle + e.arc, -e.arc, l * this._donutRate, _ * this._donutRate, true);
                t.closePath();
                t.fill();
                var g = this._getValueTextInfo(i, e.value);
                if (g) {
                    var r = e.startAngle + e.arc / 2;
                    var x = this._donutRate + (1 - this._donutRate) * this._valuePosition;
                    g.x = h + a + Math.cos(r) * l * x;
                    g.y = o - n - Math.sin(r) * _ * x
                }
            }, this)
        } else if (this._type === "line") {
            var c = a.height * this._lineRate;
            a.y = a.y + a.height / 2 - c / 2;
            a.height = c;
            var u = a.x;
            this._publishedDatas.forEach(function (i) {
                var e = this._map[i.getId()];
                var s = a.width * e.proportion;
                if (s === 0) {
                    return
                }
                t.beginPath();
                t.fillStyle = e.color;
                var n = this.isSelected(i) ? -this._selectOffset : 0;
                t.rect(u, a.y + n, s, a.height);
                t.closePath();
                t.fill();
                var h = this._getValueTextInfo(i, e.value);
                if (h) {
                    h.x = u + s / 2;
                    h.y = a.y + a.height + n - a.height * this._valuePosition
                }
                u += s
            }, this)
        }
        if (this._shadowOffset > 0) {
            t.shadowOffsetX = 0;
            t.shadowOffsetY = 0;
            t.shadowBlur = 0
        }
        this.drawValueTexts(t)
    }});
    twaver.charts.BarChart = function (t) {
        twaver.charts.BarChart.superClass.constructor.apply(this, arguments)
    };
    _twaver.ext("twaver.charts.BarChart", twaver.charts.ScaleChart, {__accessor: ["type"], _upperLimit: d.BARCHART_UPPER_LIMIT, _lowerLimit: d.BARCHART_LOWER_LIMIT, _type: d.BARCHART_TYPE, _xAxisText: null, _xAxisTextColor: d.BARCHART_XAXIS_TEXT_COLOR, _xAxisTextFont: d.BARCHART_XAXIS_TEXT_FONT, _xAxisLineColor: d.BARCHART_XAXIS_LINE_COLOR, _xAxisLineWidth: d.BARCHART_XAXIS_LINE_WIDTH, _yAxisText: null, _yAxisTextColor: d.BARCHART_YAXIS_TEXT_COLOR, _yAxisTextFont: d.BARCHART_YAXIS_TEXT_FONT, _yAxisLineColor: d.BARCHART_YAXIS_LINE_COLOR, _yAxisLineWidth: d.BARCHART_YAXIS_LINE_WIDTH, _xScaleTexts: null, _xScaleTextFont: d.BARCHART_XSCALE_TEXT_FONT, _xScaleTextColor: d.BARCHART_XSCALE_TEXT_COLOR, _xScaleTextOrientation: d.BARCHART_XSCALE_TEXT_ORIENTATION, _yScaleTextVisible: d.BARCHART_YSCALE_TEXT_VISIBLE, _yScaleTextColor: d.BARCHART_YSCALE_TEXT_COLOR, _yScaleTextFont: d.BARCHART_YSCALE_TEXT_FONT, _yScaleLineColor: d.BARCHART_YSCALE_LINE_COLOR, _yScaleLineWidth: d.BARCHART_YSCALE_LINE_WIDTH, _yScaleValueGap: d.BARCHART_YSCALE_VALUE_GAP, _yScalePixelGap: d.BARCHART_YSCALE_PIXEL_GAP, _yScaleMinTextVisible: d.BARCHART_YSCALE_MIN_TEXT_VISIBLE, validateModel: function () {
        var t = this._type + "ValidateModel";
        if (this[t]) {
            this._reset();
            this[t]()
        }
    }, defaultValidateModel: function () {
        this._columnCount = this._publishedDatas.size();
        this._publishedDatas.forEach(function (t) {
            var i = this.getValue(t);
            if (this._upperLimit == null && i > this._max) {
                this._max = i
            }
            if (this._lowerLimit == null && i < this._min) {
                this._min = i
            }
            this._map[t.getId()] = {data: t, value: i, color: this.getUniqueColor(this.getColor(t), t)}
        }, this);
        this._initRange();
        this._publishedDatas.forEach(function (t) {
            var i = this._map[t.getId()];
            i.proportion = this._range == 0 ? 0 : i.value / this._range
        }, this)
    }, layerValidateModel: function () {
        this._commonValidateModel()
    }, groupValidateModel: function () {
        this._commonValidateModel()
    }, stackValidateModel: function () {
        this._publishedDatas.forEach(function (t) {
            var i = new u(this.getValues(t));
            if (i.size() > this._columnCount) {
                this._columnCount = i.size()
            }
            var e = {data: t, values: i, proportions: new u, color: this.getUniqueColor(this.getColor(t), t)};
            this._map[t.getId()] = e
        }, this);
        if (this._upperLimit == null || this._lowerLimit == null) {
            for (var t = 0; t < this._columnCount; t++) {
                var i = 0;
                var e = 0;
                this._publishedDatas.forEach(function (a) {
                    var s = this._map[a.getId()];
                    if (s.values.size() > t) {
                        var n = s.values.get(t);
                        if (n != null) {
                            if (n >= 0) {
                                i += n
                            } else {
                                e += n
                            }
                        }
                    }
                }, this);
                if (this._upperLimit == null && i > this._max) {
                    this._max = i
                }
                if (this._lowerLimit == null && e < this._min) {
                    this._min = e
                }
            }
        }
        this._initRange();
        this._initValuesProportion()
    }, percentValidateModel: function () {
        this._publishedDatas.forEach(function (t) {
            var i = new u(this.getValues(t));
            if (i.size() > this._columnCount) {
                this._columnCount = i.size()
            }
            var e = {data: t, values: i, proportions: new u, color: this.getUniqueColor(this.getColor(t), t)};
            this._map[t.getId()] = e
        }, this);
        var t = new u;
        for (var i = 0; i < this._columnCount; i++) {
            var e = 0;
            this._publishedDatas.forEach(function (t) {
                var a = this._map[t.getId()];
                if (a.values.size() > i) {
                    var s = a.values.get(i);
                    if (s != null) {
                        e += s
                    }
                }
            }, this);
            t.add(e)
        }
        for (var i = 0; i < this._columnCount; i++) {
            this._publishedDatas.forEach(function (e) {
                var a = this._map[e.getId()];
                var s = t.get(i);
                if (s !== 0 && a.values.size() > i) {
                    var n = a.values.get(i);
                    if (n != null) {
                        a.proportions.add(n / s);
                        return
                    }
                }
                a.proportions.add(null)
            }, this)
        }
        this._min = 0;
        this._max = 1;
        this._range = 1
    }, drawRect: function (t, i, e, a, n, h, r) {
        t.fillStyle = i;
        if (e) {
            this._selectInfos.add({x: a, y: n, w: h, h: r, color: this.getUniqueColor(s.darker(i))})
        }
        t.beginPath();
        t.rect(a, n, h, r);
        t.closePath();
        t.fill()
    }, drawContent: function (t, i, e, a) {
        this._selectInfos = new u;
        this._toolTipInfos = this.isToolTipEnabled() ? new u : null;
        if (this._type === "default") {
            this.drawDefaultContent(t, i, e, a)
        } else if (this._type === "group") {
            this.drawGroupContent(t, i, e, a)
        } else if (this._type === "percent") {
            this.drawPercentContent(t, i, e, a)
        } else if (this._type === "stack") {
            this.drawStackContent(t, i, e, a)
        } else if (this._type === "layer") {
            this.drawLayerContent(t, i, e, a)
        }
        this.drawValueTexts(t);
        this._selectInfos.forEach(function (i) {
            t.lineWidth = 2;
            t.strokeStyle = i.color;
            t.beginPath();
            t.rect(i.x, i.y, i.w, i.h);
            t.closePath();
            t.stroke()
        }, this);
        delete this._selectInfos
    }, drawDefaultContent: function (t, i, e, a) {
        var s = this._publishedDatas.size();
        var n = this._columnWidth;
        for (var h = 0; h < s; h++) {
            var r = this._publishedDatas.get(h);
            var o = this._map[r.getId()];
            var l = i.x + n * (.5 + h * 1.5);
            var _ = Math.abs(e * o.proportion);
            var c = o.proportion > 0 ? a - _ : a;
            this.drawRect(t, o.color, this.isSelected(r), l, c, n, _);
            this.addToolTipInfo(l, c, n, _, o.value, r);
            var u = this._getValueTextInfo(r, o.value);
            if (u) {
                var d = this.getTextSize(u.font, u.text);
                u.x = l + n / 2;
                u.y = c - d.height / 2 + 1
            }
        }
    }, drawPercentContent: function (t, i, e, a) {
        this.drawStackContent(t, i, e, a)
    }, drawStackContent: function (t, i, e, a) {
        var s = this._columnCount;
        var n = this._columnWidth;
        for (var h = 0; h < s; h++) {
            var r = a;
            var o = i.x + n * (.5 + h * 1.5);
            this._publishedDatas.forEach(function (i) {
                var a = this._map[i.getId()];
                if (h < a.proportions.size()) {
                    var s = a.proportions.get(h);
                    if (s != null) {
                        var l = e * s;
                        r -= l;
                        this.drawRect(t, a.color, this.isSelected(i), o, r, n, l);
                        this.addToolTipInfo(o, r, n, l, a.values.get(h), i);
                        var _ = this._getValueTextInfo(i, a.values.get(h));
                        if (_) {
                            _.x = o + n / 2;
                            _.y = r + l / 2
                        }
                    }
                }
            }, this)
        }
    }, drawLayerContent: function (t, i, e, a) {
        var s = this._publishedDatas.size();
        var n = this._columnCount;
        var h = this._columnWidth;
        var r = h * 3 / 8 / s;
        for (var o = 0; o < n; o++) {
            var l = i.x + h * (.5 + o * 1.5);
            var _ = 0;
            this._publishedDatas.forEach(function (i) {
                var n = this._map[i.getId()];
                if (o < n.proportions.size()) {
                    var c = n.proportions.get(o);
                    if (c != null) {
                        var u = e * c;
                        var d = a - u;
                        var f = l + h / 2 - h / 8 - r * (s - _);
                        var g = (h / 8 + r * (s - _)) * 2;
                        this.drawRect(t, n.color, this.isSelected(i), f, d, g, u);
                        this.addToolTipInfo(f, d, g, u, n.values.get(o), i);
                        var x = this._getValueTextInfo(i, n.values.get(o));
                        if (x) {
                            var v = this.getTextSize(x.font, x.text);
                            x.x = f + g / 2;
                            x.y = d - v.height / 2 + 1
                        }
                    }
                }
                _++
            }, this)
        }
    }, drawGroupContent: function (t, i, e, a) {
        var s = this._publishedDatas.size();
        var n = this._columnCount;
        var h = this._columnWidth;
        var r = h / s;
        for (var o = 0; o < n; o++) {
            var l = i.x + h * (.5 + o * 1.5);
            var _ = 0;
            this._publishedDatas.forEach(function (i) {
                var s = this._map[i.getId()];
                if (o < s.proportions.size()) {
                    var n = s.proportions.get(o);
                    if (n != null) {
                        var h = e * n;
                        var c = a - h;
                        this.drawRect(t, s.color, this.isSelected(i), l + r * _, c, r, h);
                        this.addToolTipInfo(l + r * _, c, r, h, s.values.get(o), i);
                        var u = this._getValueTextInfo(i, s.values.get(o));
                        if (u) {
                            var d = this.getTextSize(u.font, u.text);
                            u.x = l + r * _ + r / 2;
                            u.y = c - d.height / 2 + 1
                        }
                    }
                }
                _++
            }, this)
        }
    }});
    twaver.charts.LineChart = function (t) {
        twaver.charts.LineChart.superClass.constructor.apply(this, arguments);
        this._selectTolerance = 2
    };
    _twaver.ext("twaver.charts.LineChart", twaver.charts.ScaleChart, {__accessor: ["xScaleLineColor", "xScaleLineWidth", "interruptable"], _interruptable: d.LINECHART_INTERRUPTABLE, _upperLimit: d.LINECHART_UPPER_LIMIT, _lowerLimit: d.LINECHART_LOWER_LIMIT, _xAxisText: null, _xAxisTextColor: d.LINECHART_XAXIS_TEXT_COLOR, _xAxisTextFont: d.LINECHART_XAXIS_TEXT_FONT, _xAxisLineColor: d.LINECHART_XAXIS_LINE_COLOR, _xAxisLineWidth: d.LINECHART_XAXIS_LINE_WIDTH, _yAxisText: null, _yAxisTextColor: d.LINECHART_YAXIS_TEXT_COLOR, _yAxisTextFont: d.LINECHART_YAXIS_TEXT_FONT, _yAxisLineColor: d.LINECHART_YAXIS_LINE_COLOR, _yAxisLineWidth: d.LINECHART_YAXIS_LINE_WIDTH, _xScaleTexts: null, _xScaleTextFont: d.LINECHART_XSCALE_TEXT_FONT, _xScaleTextColor: d.LINECHART_XSCALE_TEXT_COLOR, _xScaleTextOrientation: d.LINECHART_XSCALE_TEXT_ORIENTATION, _xScaleLineColor: d.LINECHART_XSCALE_LINE_COLOR, _xScaleLineWidth: d.LINECHART_XSCALE_LINE_WIDTH, _yScaleTextVisible: d.LINECHART_YSCALE_TEXT_VISIBLE, _yScaleTextColor: d.LINECHART_YSCALE_TEXT_COLOR, _yScaleTextFont: d.LINECHART_YSCALE_TEXT_FONT, _yScaleLineColor: d.LINECHART_YSCALE_LINE_COLOR, _yScaleLineWidth: d.LINECHART_YSCALE_LINE_WIDTH, _yScaleValueGap: d.LINECHART_YSCALE_VALUE_GAP, _yScalePixelGap: d.LINECHART_YSCALE_PIXEL_GAP, _yScaleMinTextVisible: d.LINECHART_YSCALE_MIN_TEXT_VISIBLE, getLineWidth: function (t) {
        return t.getStyle ? t.getStyle("chart.line.width") : twaver.Styles.getStyle("chart.line.width")
    }, getMarkerShape: function (t) {
        return t.getStyle ? t.getStyle("chart.marker.shape") : twaver.Styles.getStyle("chart.marker.shape")
    }, getMarkerSize: function (t) {
        return t.getStyle ? t.getStyle("chart.marker.size") : twaver.Styles.getStyle("chart.marker.size")
    }, _initInfo: function (t, i) {
        i.markerShape = this.getMarkerShape(t);
        i.markerSize = this.getMarkerSize(t);
        i.lineWidth = this.getLineWidth(t);
        if (this.isSelected(t)) {
            i.lineWidth += 2
        }
    }, validateModel: function () {
        this._reset();
        this._commonValidateModel()
    }, getPointIndexAt: function () {
        var t = this._getPoint.apply(this, arguments), i = this.tryGetDataAt(t);
        if (!i) {
            return-1
        }
        var e = this._map[i.getId()], a = e.points, s = e.markerSize;
        for (var n = 0, h = a.size(), o; n < h; n++) {
            o = a.get(n);
            if (o) {
                if (r.getDistance(t, o) <= s) {
                    return n
                }
            }
        }
        return-1
    }, drawContent: function (t, i, e, a) {
        this._toolTipInfos = this.isToolTipEnabled() ? new u : null;
        this._publishedDatas.forEach(function (n) {
            var h = this._map[n.getId()];
            var r = h.markerSize > 0 ? new u : null;
            t.strokeStyle = h.color;
            t.lineWidth = h.lineWidth;
            t.beginPath();
            var o = h.proportions;
            var l = null;
            var _ = o.size();
            var c = new u;
            h.points = c;
            for (var d = 0; d < _; d++) {
                var f = o.get(d);
                if (f != null) {
                    var g = {x: i.x + this._columnWidth * (1 + d * 1.5), y: a - e * f};
                    c.add(g);
                    if (l == null) {
                        t.moveTo(g.x, g.y)
                    } else {
                        t.lineTo(g.x, g.y)
                    }
                    var x = h.values.get(d);
                    var v = this._getValueTextInfo(n, x);
                    if (v) {
                        var T = this.getTextSize(v.font, v.text);
                        v.x = g.x;
                        v.y = g.y - T.height / 2 + 2
                    }
                    if (r) {
                        r.add({point: g, value: x, data: n, index: d})
                    }
                    l = g
                } else if (this._interruptable) {
                    l = null;
                    c.add(null)
                }
            }
            t.stroke();
            if (r) {
                var C = h.markerSize / 2;
                r.forEach(function (i) {
                    t.fillStyle = h.color;
                    var e = i.point.x - C;
                    var a = i.point.y - C;
                    var n = h.markerSize;
                    var r = h.markerSize;
                    s.drawVector(t, h.markerShape, null, e, a, n, r);
                    t.fill();
                    this.addToolTipInfo(e, a, n, r, i.value, i.data, i.index)
                }, this)
            }
        }, this);
        this.drawValueTexts(t)
    }});
    twaver.charts.BubbleChart = function (t) {
        twaver.charts.BubbleChart.superClass.constructor.apply(this, arguments)
    };
    _twaver.ext("twaver.charts.BubbleChart", twaver.charts.ScaleChart, {__accessor: ["xAxisUpperLimit", "xAxisLowerLimit", "xScaleLineColor", "xScaleLineWidth", "selectShadowColor", "selectShadowOffset"], _upperLimit: d.BUBBLECHART_UPPER_LIMIT, _lowerLimit: d.BUBBLECHART_LOWER_LIMIT, _xAxisUpperLimit: d.BUBBLECHART_XAXIS_UPPER_LIMIT, _xAxisLowerLimit: d.BUBBLECHART_XAXIS_LOWER_LIMIT, _xAxisText: null, _xAxisTextColor: d.BUBBLECHART_XAXIS_TEXT_COLOR, _xAxisTextFont: d.BUBBLECHART_XAXIS_TEXT_FONT, _xAxisLineColor: d.BUBBLECHART_XAXIS_LINE_COLOR, _xAxisLineWidth: d.BUBBLECHART_XAXIS_LINE_WIDTH, _yAxisText: null, _yAxisTextColor: d.BUBBLECHART_YAXIS_TEXT_COLOR, _yAxisTextFont: d.BUBBLECHART_YAXIS_TEXT_FONT, _yAxisLineColor: d.BUBBLECHART_YAXIS_LINE_COLOR, _yAxisLineWidth: d.BUBBLECHART_YAXIS_LINE_WIDTH, _xScaleTexts: null, _xScaleTextFont: d.BUBBLECHART_XSCALE_TEXT_FONT, _xScaleTextColor: d.BUBBLECHART_XSCALE_TEXT_COLOR, _xScaleTextOrientation: d.BUBBLECHART_XSCALE_TEXT_ORIENTATION, _xScaleLineColor: d.BUBBLECHART_XSCALE_LINE_COLOR, _xScaleLineWidth: d.BUBBLECHART_XSCALE_LINE_WIDTH, _yScaleTextVisible: d.BUBBLECHART_YSCALE_TEXT_VISIBLE, _yScaleTextColor: d.BUBBLECHART_YSCALE_TEXT_COLOR, _yScaleTextFont: d.BUBBLECHART_YSCALE_TEXT_FONT, _yScaleLineColor: d.BUBBLECHART_YSCALE_LINE_COLOR, _yScaleLineWidth: d.BUBBLECHART_YSCALE_LINE_WIDTH, _yScaleValueGap: d.BUBBLECHART_YSCALE_VALUE_GAP, _yScalePixelGap: d.BUBBLECHART_YSCALE_PIXEL_GAP, _yScaleMinTextVisible: d.BUBBLECHART_YSCALE_MIN_TEXT_VISIBLE, _selectShadowColor: d.BUBBLECHART_SELECT_SHADOW_COLOR, _selectShadowOffset: d.BUBBLECHART_SELECT_SHADOW_OFFSET, _resetX: function () {
        this._xMax = 0;
        this._xMin = 0;
        if (this._xAxisUpperLimit != null) {
            this._xMax = this._xAxisUpperLimit
        }
        if (this._xAxisLowerLimit != null) {
            this._xMin = this._xAxisLowerLimit
        }
    }, getXMin: function () {
        return this._xMin
    }, getXMax: function () {
        return this._xMax
    }, getXRange: function () {
        return this._xRange
    }, getShape: function (t) {
        return t.getStyle ? t.getStyle("chart.bubble.shape") : twaver.Styles.getStyle("chart.bubble.shape")
    }, getSize: function (t, i) {
        return i
    }, getNames: function (t) {
        return t.getStyle ? t.getStyle("chart.names") : twaver.Styles.getStyle("chart.names")
    }, getXAxisValues: function (t) {
        return t.getStyle ? t.getStyle("chart.xaxis.values") : twaver.Styles.getStyle("chart.xaxis.values")
    }, getYAxisValues: function (t) {
        return t.getStyle ? t.getStyle("chart.yaxis.values") : twaver.Styles.getStyle("chart.yaxis.values")
    }, _initXRange: function () {
        if (this._xAxisLowerLimit == null) {
            if (this._xMin >= this._xMax) {
                this._xMin = this._xMax - Math.abs(this._xMax) * .1
            }
            this._xMin = this._xMin - (this._xMax - this._xMin) * .1
        }
        this._xRange = this._xMax - this._xMin
    }, _initXYValuesProportion: function () {
        this._publishedDatas.forEach(function (t) {
            var i = this._map[t.getId()];
            i.xAxisValues.forEach(function (t) {
                if (t == null) {
                    i.xAxisProportions.add(null)
                } else {
                    i.xAxisProportions.add(this._xRange == 0 ? 0 : t / this._xRange)
                }
            }, this);
            i.yAxisValues.forEach(function (t) {
                if (t == null) {
                    i.yAxisProportions.add(null)
                } else {
                    i.yAxisProportions.add(this._range == 0 ? 0 : t / this._range)
                }
            }, this)
        }, this)
    }, validateModel: function () {
        this._reset();
        this._resetX();
        this._columnCount = this._xScaleTexts == null ? 0 : this._xScaleTexts.size();
        this._publishedDatas.forEach(function (t) {
            var i = new u(this.getYAxisValues(t));
            var e = new u(this.getXAxisValues(t));
            var a = new u(this.getValues(t));
            if (a.size() > this._columnCount) {
                this._columnCount = a.size()
            }
            var s = {data: t, values: a, yAxisValues: i, xAxisValues: e, yAxisProportions: new u, xAxisProportions: new u, color: this.getUniqueColor(this.getColor(t), t), anchorShape: this.getShape(t)};
            this._map[t.getId()] = s;
            if (this._upperLimit == null || this._lowerLimit == null) {
                i.forEach(function (t) {
                    if (t != null) {
                        if (this._upperLimit == null && t > this._max) {
                            this._max = t
                        }
                        if (this._lowerLimit == null && t < this._min) {
                            this._min = t
                        }
                    }
                }, this)
            }
            if (this._upperLimit == null || this._lowerLimit == null) {
                e.forEach(function (t) {
                    if (t != null) {
                        if (this._xAxisUpperLimit == null && t > this._xMax) {
                            this._xMax = t
                        }
                        if (this._xAxisLowerLimit == null && t < this._xMin) {
                            this._xMin = t
                        }
                    }
                }, this)
            }
        }, this);
        this._initRange();
        this._initXRange();
        this._initXYValuesProportion()
    }, drawContent: function (t, i, e, a) {
        this._toolTipInfos = this.isToolTipEnabled() ? new u : null;
        this._publishedDatas.forEach(function (n) {
            var h = this._map[n.getId()];
            var r = h.yAxisProportions;
            var o = h.xAxisProportions;
            var l = h.values;
            var _ = h.yAxisProportions.size();
            var c = this._selectShadowOffset;
            if (this.isSelected(n) && c > 0) {
                t.shadowOffsetX = c;
                t.shadowOffsetY = c;
                t.shadowBlur = c * 2;
                t.shadowColor = this._selectShadowColor
            } else {
                t.shadowOffsetX = 0;
                t.shadowOffsetY = 0;
                t.shadowBlur = 0;
                t.shadowColor = h.color
            }
            t.fillStyle = h.color;
            for (var u = 0; u < _; u++) {
                var d = r.get(u);
                var f = o.get(u);
                if (d != null) {
                    var g = {x: i.x + i.width * f, y: a - e * d};
                    var x = l.get(u);
                    var v = this.getSize(n, x);
                    var c = v / 2;
                    var T = g.x - c;
                    var C = g.y - c;
                    var A = v;
                    var y = v;
                    s.drawVector(t, h.anchorShape, null, T, C, A, y);
                    t.fill();
                    this.addToolTipInfo(T, C, A, y, x, n, u);
                    var L = this._getValueTextInfo(n, x);
                    if (L) {
                        var v = this.getTextSize(L.font, L.text);
                        L.x = g.x;
                        L.y = g.y
                    }
                }
            }
        }, this);
        this.drawValueTexts(t)
    }});
    twaver.charts.DialChart = function (t) {
        twaver.charts.DialChart.superClass.constructor.apply(this, arguments)
    };
    _twaver.ext("twaver.charts.DialChart", twaver.charts.ChartBase, {__accessor: ["upperLimit", "lowerLimit", "startAngle", "endAngle", "innerRadius", "colorRangeFillColor", "outlineWidth", "outlineColor", "majorScaleCount", "majorScaleLineWidth", "majorScaleLineLength", "majorScaleLineColor", "minorScaleCount", "minorScaleLineWidth", "minorScaleLineLength", "minorScaleLineColor", "scaleTextVisible", "scaleUpperLimitTextVisible", "scaleLowerLimitTextVisible", "scaleTextFont", "scaleTextColor", "pivotRadius", "pivotFillColor", "pivotOutlineWidth", "pivotOutlineColor", "pivotGradient", "pivotGradientColor", "valuePosition", "colorRangeList", "innerDarkerRadius", "outerBrighterRadius", "selectShadowColor", "selectShadowOffset"], __bool: ["scaleInside", "pivotFill"], _upperLimit: d.DIALCHART_UPPER_LIMIT, _lowerLimit: d.DIALCHART_LOWER_LIMIT, _startAngle: d.DIALCHART_START_ANGLE, _endAngle: d.DIALCHART_END_ANGLE, _innerRadius: d.DIALCHART_INNER_RADIUS, _colorRangeFillColor: d.DIALCHART_COLOR_RANGE_FILL_COLOR, _outlineWidth: d.DIALCHART_OUTLINE_WIDTH, _outlineColor: d.DIALCHART_OUTLINE_COLOR, _scaleInside: d.DIALCHART_SCALE_INSIDE, _majorScaleCount: d.DIALCHART_MAJOR_SCALE_COUNT, _majorScaleLineWidth: d.DIALCHART_MAJOR_SCALE_LINE_WIDTH, _majorScaleLineLength: d.DIALCHART_MAJOR_SCALE_LINE_LENGTH, _majorScaleLineColor: d.DIALCHART_MAJOR_SCALE_LINE_COLOR, _minorScaleCount: d.DIALCHART_MINOR_SCALE_COUNT, _minorScaleLineWidth: d.DIALCHART_MINOR_SCALE_LINE_WIDTH, _minorScaleLineLength: d.DIALCHART_MINOR_SCALE_LINE_LENGTH, _minorScaleLineColor: d.DIALCHART_MINOR_SCALE_LINE_COLOR, _scaleTextVisible: d.DIALCHART_SCALE_TEXT_VISIBLE, _scaleUpperLimitTextVisible: d.DIALCHART_SCALE_UPPER_LIMIT_TEXT_VISIBLE, _scaleLowerLimitTextVisible: d.DIALCHART_SCALE_LOWER_LIMIT_TEXT_VISIBLE, _scaleTextFont: d.DIALCHART_SCALE_TEXT_FONT, _scaleTextColor: d.DIALCHART_SCALE_TEXT_COLOR, _pivotRadius: d.DIALCHART_PIVOT_RADIUS, _pivotFill: d.DIALCHART_PIVOT_FILL, _pivotFillColor: d.DIALCHART_PIVOT_FILL_COLOR, _pivotOutlineWidth: d.DIALCHART_PIVOT_OUTLINE_WIDTH, _pivotOutlineColor: d.DIALCHART_PIVOT_OUTLINE_COLOR, _pivotGradient: d.DIALCHART_PIVOT_GRADIENT, _pivotGradientColor: d.DIALCHART_PIVOT_GRADIENT_COLOR, _valuePosition: d.DIALCHART_VALUE_POSITION, _innerDarkerRadius: d.DIALCHART_INNER_DARKER_RADIUS, _outerBrighterRadius: d.DIALCHART_OUTER_BRIGHTER_RADIUS, _selectShadowColor: d.DIALCHART_SELECT_SHADOW_COLOR, _selectShadowOffset: d.DIALCHART_SELECT_SHADOW_OFFSET, formatScaleText: function (t) {
        return t.toFixed(2)
    }, validateModel: function () {
        this._map = {};
        this._valueRange = this._upperLimit - this._lowerLimit;
        var t = this._startAngle;
        if (t != 0) {
            t = (t % 360 + 360) % 360;
            if (t == 0) {
                t = 360
            }
        }
        this._positiveStartAngle = t;
        var i = this._endAngle;
        if (i != 0) {
            i = (i % 360 + 360) % 360;
            if (i == 0) {
                i = 360
            }
        }
        this._positiveEndAngle = i;
        this._whole = Math.abs(t - i) == 360;
        this._startAngleByRadian = t * Math.PI / 180;
        this._endAngleByRadian = i * Math.PI / 180;
        this._clockwise = this._startAngleByRadian > this._endAngleByRadian;
        this._angleRange = Math.abs(this._startAngleByRadian - this._endAngleByRadian);
        this._publishedDatas.forEach(function (t) {
            var i = this.getValue(t);
            this._map[t.getId()] = {data: t, value: i, color: this.getUniqueColor(this.getColor(t), t), angle: this._startAngleByRadian + (this._clockwise ? -1 : 1) * i / this._valueRange * this._angleRange}
        }, this)
    }, validateDisplay: function (t, i, e) {
        var a = {x: this._xGap, y: this._yGap, width: i - this._xGap * 2, height: e - this._yGap * 2};
        this.drawBackground(t, a);
        if (this._startAngleByRadian == this._endAngleByRadian) {
            return
        }
        var n;
        var h = this._lowerLimit;
        var o = this._majorScaleCount > 1 ? this._valueRange / (this._majorScaleCount - 1) : 0;
        var l = 0, _ = 0, c;
        var d = null;
        var f = null;
        if (this._scaleTextVisible) {
            d = new u;
            for (n = 0; n < this._majorScaleCount; n++) {
                if (n == 0 && !this._scaleLowerLimitTextVisible || n == this._majorScaleCount - 1 && !this._scaleUpperLimitTextVisible) {
                    c = null;
                    d.add({text: "", size: {width: 0, height: 0}})
                } else {
                    f = this.formatScaleText(h);
                    c = this.getTextSize(this._scaleTextFont, f);
                    d.add({text: f, size: c})
                }
                if (!this._scaleInside && c != null) {
                    if (c.width > l) {
                        l = c.width
                    }
                    if (c.height > _) {
                        _ = c.height
                    }
                }
                h += o
            }
        }
        if (this._angleRange <= Math.PI) {
            l = Math.max(l, this._pivotRadius);
            _ = Math.max(_, this._pivotRadius)
        }
        r.grow(a, -l, -_);
        this._calcluateCenterAndRadius(a);
        t.lineWidth = 0;
        if (this._colorRangeList == null || this._colorRangeList.size() == 0) {
            this._drawArcGroup(t, this._startAngleByRadian, this._endAngleByRadian, this.getUniqueColor(this._colorRangeFillColor));
            this._drawArcOutLine(t, this._startAngleByRadian, this._endAngleByRadian, true, true)
        } else {
            var g = this._angleRange / this._colorRangeList.size();
            var x = this._startAngleByRadian;
            for (n = 0; n < this._colorRangeList.size(); n++) {
                var v = this.getUniqueColor(this._colorRangeList.get(n));
                var T = x + (this._clockwise ? -1 : 1) * g;
                this._drawArcGroup(t, x, T, v);
                this._drawArcOutLine(t, x, x + (this._clockwise ? -1 : 1) * g, n == 0, n == this._colorRangeList.size() - 1);
                x += (this._clockwise ? -1 : 1) * g
            }
        }
        var C = this._startAngleByRadian;
        var A = this._majorScaleCount > 1 ? this._angleRange / (this._majorScaleCount - 1) : 0;
        var y, L, m, p, R, S, E, w;
        S = this._scaleInside ? this._innerRadiusByPixel : this._outerRadius;
        E = S + this._majorScaleLineLength * (this._scaleInside ? 1 : -1);
        w = S + this._minorScaleLineLength * (this._scaleInside ? 1 : -1);
        for (n = 0; n < this._majorScaleCount; n++) {
            L = this._center.x + Math.cos(C) * S;
            m = this._center.y + Math.sin(-C) * S;
            p = this._center.x + Math.cos(C) * E;
            R = this._center.y + Math.sin(-C) * E;
            t.lineWidth = this._majorScaleLineWidth;
            t.strokeStyle = this.getUniqueColor(this._majorScaleLineColor);
            t.beginPath();
            t.moveTo(L, m);
            t.lineTo(p, R);
            t.closePath();
            t.stroke();
            if (this._scaleTextVisible) {
                if (n == 0 && !this._scaleLowerLimitTextVisible || n == this._majorScaleCount - 1 && !this._scaleUpperLimitTextVisible) {
                } else {
                    var I = d.get(n);
                    if (I) {
                        var P = this.getScaleTextPosition(C / Math.PI * 180, L, m, I.size.width, I.size.height);
                        I.x = P.x;
                        I.y = P.y
                    }
                }
            }
            if (this._whole || !this._whole && n < this._majorScaleCount - 1) {
                var O = C;
                var M = this._minorScaleCount > 0 ? A / (this._minorScaleCount + 1) : 0;
                for (y = 0; y < this._minorScaleCount; y++) {
                    O += (this._clockwise ? -1 : 1) * M;
                    L = this._center.x + Math.cos(O) * S;
                    m = this._center.y + Math.sin(-O) * S;
                    p = this._center.x + Math.cos(O) * w;
                    R = this._center.y + Math.sin(-O) * w;
                    t.lineWidth = this._minorScaleLineWidth;
                    t.strokeStyle = this.getUniqueColor(this._minorScaleLineColor);
                    t.beginPath();
                    t.moveTo(L, m);
                    t.lineTo(p, R);
                    t.closePath();
                    t.stroke()
                }
            }
            C += (this._clockwise ? -1 : 1) * A
        }
        if (this._pivotFill) {
            s.fill(t, this.getUniqueColor(this._pivotFillColor), this._pivotGradient, this._pivotGradientColor, this._center.x - this._pivotRadius, this._center.y - this._pivotRadius, this._pivotRadius * 2, this._pivotRadius * 2)
        }
        t.lineWidth = this._pivotOutlineWidth;
        t.strokeStyle = this.getUniqueColor(this._pivotOutlineColor);
        t.beginPath();
        t.arc(this._center.x, this._center.y, this._pivotRadius, 0, Math.PI * 2, true);
        t.closePath();
        if (this._pivotFill) {
            t.fill()
        }
        if (d) {
            d.forEach(function (i) {
                if (i) {
                    s.drawText(t, i.text, i, this._scaleTextFont, this._scaleTextColor)
                }
            }, this)
        }
        this._publishedDatas.forEach(function (i) {
            var e = this._map[i.getId()];
            var a = this._getDataStyle("dialchart.rear.extension", i);
            var s = this._getDataStyle("dialchart.base.width", i);
            var n = this._getDataStyle("dialchart.top.width", i);
            var h = this._getDataStyle("dialchart.radius", i);
            if (h >= -1 && h <= 1) {
                h = h * this._innerRadiusByPixel
            }
            t.fillStyle = e.color;
            t.lineWidth = 0;
            var o = r.createMatrix(-e.angle, this._center.x, this._center.y);
            var l = o.transform(this._center.x + h, this._center.y + n / 2);
            var _ = o.transform(this._center.x + h, this._center.y - n / 2);
            var c = o.transform(this._center.x - a, this._center.y - s / 2);
            var u = o.transform(this._center.x - a, this._center.y + s / 2);
            var d = this._selectShadowOffset;
            if (this.isSelected(i) && d > 0) {
                t.shadowOffsetX = d;
                t.shadowOffsetY = d;
                t.shadowBlur = d * 2;
                t.shadowColor = this._selectShadowColor
            } else {
                t.shadowOffsetX = 0;
                t.shadowOffsetY = 0;
                t.shadowBlur = 0;
                t.shadowColor = e.color
            }
            t.beginPath();
            t.moveTo(l.x, l.y);
            t.lineTo(_.x, _.y);
            t.lineTo(c.x, c.y);
            t.lineTo(u.x, u.y);
            t.lineTo(l.x, l.y);
            t.closePath();
            t.fill();
            var f = this._getValueTextInfo(i, e.value);
            if (f) {
                var g = o.transform(this._center.x + h * this._valuePosition, this._center.y);
                f.x = g.x;
                f.y = g.y
            }
        }, this);
        this.drawValueTexts(t)
    }, _getDataStyle: function (t, i) {
        if (i.getStyle) {
            return i.getStyle(t)
        }
        return i.getClient(t)
    }, _calcluateCenterAndRadius: function (t) {
        var i = this._clockwise ? this._positiveEndAngle : this._positiveStartAngle;
        var e = this._clockwise ? this._positiveStartAngle : this._positiveEndAngle;
        var a = Math.abs(this._positiveEndAngle - this._positiveStartAngle);
        if (0 <= i && i < 90) {
            if (0 <= e && e <= 90) {
                this._outerRadius = Math.min(t.width, t.height);
                this._center = {x: t.x + (t.width - this._outerRadius) / 2, y: t.y + (t.height + this._outerRadius) / 2}
            } else if (90 < e && e <= 180) {
                this._outerRadius = Math.min(t.width / 2, t.height);
                this._center = {x: t.x + t.width / 2, y: t.y + (t.height + this._outerRadius) / 2}
            } else {
                this._center = {x: t.x + t.width / 2, y: t.y + t.height / 2};
                this._outerRadius = Math.min(t.width, t.height) / 2
            }
        } else if (90 <= i && i < 180) {
            if (90 <= e && e <= 180) {
                this._outerRadius = Math.min(t.width, t.height);
                this._center = {x: t.x + (t.width + this._outerRadius) / 2, y: t.y + (t.height + this._outerRadius) / 2}
            } else if (180 < e && e <= 270) {
                this._outerRadius = Math.min(t.width, t.height / 2);
                this._center = {x: t.x + (t.width + this._outerRadius) / 2, y: t.y + t.height / 2}
            } else {
                this._center = {x: t.x + t.width / 2, y: t.y + t.height / 2};
                this._outerRadius = Math.min(t.width, t.height) / 2
            }
        } else if (180 <= i && i < 270) {
            if (180 <= e && e <= 270) {
                this._outerRadius = Math.min(t.width, t.height);
                this._center = {x: t.x + (t.width + this._outerRadius) / 2, y: t.y + (t.height - this._outerRadius) / 2}
            } else {
                this._outerRadius = Math.min(t.width / 2, t.height);
                this._center = {x: t.x + t.width / 2, y: t.y + (t.height - this._outerRadius) / 2}
            }
        } else {
            this._outerRadius = Math.min(t.width, t.height);
            this._center = {x: t.x + (t.width - this._outerRadius) / 2, y: t.y + (t.height - this._outerRadius) / 2}
        }
        this._innerRadiusByPixel = this._innerRadius > 1 ? this._innerRadius : this._outerRadius * this._innerRadius;
        this._innerDarkerRadiusByPixel = this._innerDarkerRadius > 1 ? this._innerDarkerRadius : this._outerRadius * this._innerDarkerRadius;
        this._outerBrighterRadiusByPixel = this._outerBrighterRadius > 1 ? this._outerBrighterRadius : this._outerRadius * this._outerBrighterRadius
    }, _drawArcOutLine: function (t, i, e, a, n) {
        if (this._outlineWidth <= 0) {
            return
        }
        var h = Math.abs(i - e);
        var r = this._center.x + Math.cos(i) * this._innerRadiusByPixel;
        var o = this._center.y + Math.sin(-i) * this._innerRadiusByPixel;
        var l = this._center.x + Math.cos(i) * this._outerRadius;
        var _ = this._center.y + Math.sin(-i) * this._outerRadius;
        var c = this._center.x + Math.cos(e) * this._innerRadiusByPixel;
        var u = this._center.y + Math.sin(-e) * this._innerRadiusByPixel;
        var d = this._center.x + Math.cos(e) * this._outerRadius;
        var f = this._center.y + Math.sin(-e) * this._outerRadius;
        if (this._clockwise) {
            t.lineWidth = this._outlineWidth;
            t.strokeStyle = this.getUniqueColor(this._outlineColor);
            t.beginPath();
            t.moveTo(this._center.x, this._center.y);
            s.drawArc(t, this._center.x, this._center.y, e, h, this._outerRadius, this._outerRadius, false);
            t.stroke();
            if (!this._whole && a) {
                t.lineWidth = this._outlineWidth;
                t.strokeStyle = this.getUniqueColor(this._outlineColor)
            } else {
                t.lineWidth = 0
            }
            t.lineTo(r, o);
            t.stroke();
            t.beginPath();
            t.lineWidth = this._outlineWidth;
            t.strokeStyle = this.getUniqueColor(this._outlineColor);
            t.moveTo(this._center.x, this._center.y);
            s.drawArc(t, this._center.x, this._center.y, i, -h, this._innerRadiusByPixel, this._innerRadiusByPixel, false);
            t.stroke();
            if (!this._whole && n) {
                t.lineWidth = this._outlineWidth;
                t.strokeStyle = this.getUniqueColor(this._outlineColor)
            } else {
                t.lineWidth = 0
            }
            t.lineTo(d, f);
            t.stroke()
        } else {
            t.lineWidth = this._outlineWidth;
            t.strokeStyle = this.getUniqueColor(this._outlineColor);
            t.beginPath();
            t.moveTo(this._center.x, this._center.y);
            s.drawArc(t, this._center.x, this._center.y, i, h, this._outerRadius, this._outerRadius, false);
            t.stroke();
            if (!this._whole && n) {
                t.lineWidth = this._outlineWidth;
                t.strokeStyle = this.getUniqueColor(this._outlineColor)
            } else {
                t.lineWidth = 0
            }
            t.lineTo(c, u);
            t.stroke();
            t.lineWidth = this._outlineWidth;
            t.strokeStyle = this.getUniqueColor(this._outlineColor);
            t.beginPath();
            t.moveTo(this._center.x, this._center.y);
            s.drawArc(t, this._center.x, this._center.y, e, -h, this._innerRadiusByPixel, this._innerRadiusByPixel, false);
            t.stroke();
            if (!this._whole && a) {
                t.lineWidth = this._outlineWidth;
                t.strokeStyle = this.getUniqueColor(this._outlineColor)
            } else {
                t.lineWidth = 0
            }
            t.lineTo(l, _);
            t.stroke()
        }
    }, _drawArcGroup: function (t, i, e, a) {
        if (this._outerBrighterRadiusByPixel != 0) {
            this._drawArc(t, i, e, this._outerRadius - this._outerBrighterRadiusByPixel, this._outerRadius, s.brighter(a))
        }
        this._drawArc(t, i, e, this._innerRadiusByPixel + this._innerDarkerRadiusByPixel, this._outerRadius - this._outerBrighterRadiusByPixel, a);
        if (this._innerDarkerRadiusByPixel != 0) {
            this._drawArc(t, i, e, this._innerRadiusByPixel, this._innerRadiusByPixel + this._innerDarkerRadiusByPixel, s.darker(a, 20))
        }
    }, _drawArc: function (t, i, e, a, n, h) {
        var r = Math.abs(i - e);
        t.lineWidth = 0;
        t.fillStyle = h;
        var o = this._center.x + Math.cos(i) * a;
        var l = this._center.y + Math.sin(-i) * a;
        var _ = this._center.x + Math.cos(i) * n;
        var c = this._center.y + Math.sin(-i) * n;
        var u = this._center.x + Math.cos(e) * a;
        var d = this._center.y + Math.sin(-e) * a;
        var f = this._center.x + Math.cos(e) * n;
        var g = this._center.y + Math.sin(-e) * n;
        t.beginPath();
        if (this._clockwise) {
            t.moveTo(u, d);
            s.drawArc(t, this._center.x, this._center.y, e, r, n, n, true);
            t.lineTo(o, l);
            s.drawArc(t, this._center.x, this._center.y, i, -r, a, a, true);
            t.closePath()
        } else {
            t.moveTo(o, l);
            s.drawArc(t, this._center.x, this._center.y, i, r, n, n, true);
            t.lineTo(u, d);
            s.drawArc(t, this._center.x, this._center.y, e, -r, a, a, true);
            t.closePath()
        }
        t.fill()
    }, getScaleTextPosition: function (t, i, e, a, s) {
        t = (t % 360 + 360) % 360;
        var n = {x: i, y: e};
        if (t == 0) {
            n = this._scaleInside ? {x: i - a / 2, y: e} : {x: i + a / 2, y: e}
        }
        if (t == 180) {
            n = this._scaleInside ? {x: i + a / 2, y: e} : {x: i - a / 2, y: e}
        }
        if (t == 90) {
            n = this._scaleInside ? {x: i, y: e + s / 2} : {x: i, y: e - s / 2}
        }
        if (t == 270) {
            n = this._scaleInside ? {x: i, y: e - s / 2} : {x: i, y: e + s / 2}
        }
        if (t > 270 && t < 360) {
            n = this._scaleInside ? {x: i - a / 2, y: e - s / 2} : {x: i + a / 2, y: e + s / 2}
        }
        if (t > 180 && t < 270) {
            n = this._scaleInside ? {x: i + a / 2, y: e - s / 2} : {x: i - a / 2, y: e + s / 2}
        }
        if (t > 90 && t < 180) {
            n = this._scaleInside ? {x: i + a / 2, y: e + s / 2} : {x: i - a / 2, y: e - s / 2}
        }
        if (t > 0 && t < 90) {
            n = this._scaleInside ? {x: i - a / 2, y: e + s / 2} : {x: i + a / 2, y: e - s / 2}
        }
        return n
    }});
    twaver.charts.RadarChart = function (t) {
        twaver.charts.RadarChart.superClass.constructor.apply(this, arguments);
        this._selectTolerance = 2
    };
    _twaver.ext("twaver.charts.RadarChart", twaver.charts.ChartBase, {__accessor: ["axisTextVisible", "axisTextFont", "axisTextColor", "scaleTextVisible", "scaleTextFont", "scaleTextColor", "axisVisible", "axisLineColor", "axisLineWidth", "axisStartAngle", "ringVisible", "ringType", "ringLineColor", "ringLineWidth", "scaleCount", "scaleMaxValue", "scaleMinValue", "anchorVisible", "areaFillAlpha", "areaSelectFillAlpha", "axisList"], __bool: ["areaFill"], _axisTextVisible: d.RADARCHART_AXIS_TEXT_VISIBLE, _axisTextFont: d.RADARCHART_AXIS_TEXT_FONT, _axisTextColor: d.RADARCHART_AXIS_TEXT_COLOR, _scaleTextVisible: d.RADARCHART_SCALE_TEXT_VISIBLE, _scaleTextFont: d.RADARCHART_SCALE_TEXT_FONT, _scaleTextColor: d.RADARCHART_SCALE_TEXT_COLOR, _axisVisible: d.RADARCHART_AXIS_VISIBLE, _axisLineColor: d.RADARCHART_AXIS_LINE_COLOR, _axisLineWidth: d.RADARCHART_AXIS_LINE_WIDTH, _axisStartAngle: d.RADARCHART_AXIS_START_ANGLE, _ringVisible: d.RADARCHART_RING_VISIBLE, _ringType: d.RADARCHART_RING_TYPE, _ringLineColor: d.RADARCHART_RING_LINE_COLOR, _ringLineWidth: d.RADARCHART_RING_LINE_WIDTH, _scaleCount: d.RADARCHART_SCALE_COUNT, _scaleMaxValue: d.RADARCHART_SCALE_MAXVALUE, _scaleMinValue: d.RADARCHART_SCALE_MINVALUE, _anchorVisible: d.RADARCHART_ANCHOR_VISIBLE, _areaFill: d.RADARCHART_AREA_FILL, _areaFillAlpha: d.RADARCHART_AREA_FILL_ALPHA, _areaSelectFillAlpha: d.RADARCHART_AREA_SELECT_FILL_ALPHA, getAxisCount: function () {
        return this._axisCount
    }, formatScaleText: function (t, i) {
        return t.toFixed(2)
    }, getAnchorSize: function (t) {
        return t.getStyle ? t.getStyle("chart.marker.size") : twaver.Styles.getStyle("chart.marker.size")
    }, getAnchorShape: function (t) {
        return t.getStyle ? t.getStyle("chart.marker.shape") : twaver.Styles.getStyle("chart.marker.shape")
    }, getLineWidth: function (t) {
        return t.getStyle ? t.getStyle("chart.line.width") : twaver.Styles.getStyle("chart.line.width")
    }, getValues: function (t) {
        return t.getStyle ? t.getStyle("chart.values") : null
    }, tryGetDataAt: function (t, i) {
        if (i == null || i < 0) {
            i = this._selectTolerance
        }
        if (t.target) {
            t = h.getLogicalPoint(this._canvas, arguments[0], 1)
        }
        if (!t) {
            return null
        }
        if (!this._areaFill) {
            var e = t.x - i;
            var a = t.y - i;
            var s = i * 2 + 1;
            var o = i * 2 + 1;
            try {
                var l = this._canvas.getContext("2d").getImageData(e, a, s, o).data;
                for (var _ = 0; n = l.length, _ < n; _ += 4) {
                    if (l[_ + 3] === 255) {
                        var c = "rgb(" + l[_] + "," + l[_ + 1] + "," + l[_ + 2] + ")";
                        var u = this._uniqueColors[c];
                        if (u) {
                            return u
                        }
                    }
                }
            } catch (d) {
            }
            return null
        }
        if (!this._center) {
            return null
        }
        t = {x: t.x - this._xTranslate, y: t.y - this._yTranslate};
        for (var _ = this._publishedDatas.size() - 1; _ >= 0; _--) {
            var u = this._publishedDatas.get(_);
            var f = this._map[u.getId()];
            var g = r.isPointInPolygon(f.points, t);
            if (g) {
                return u
            }
        }
        return null
    }, getDataAt: function () {
        var t, i;
        if (arguments.length === 2) {
            t = arguments[0];
            i = arguments[1]
        } else if (arguments[0].target) {
            var e = h.getLogicalPoint(this._canvas, arguments[0], 1);
            if (e) {
                t = e.x;
                i = e.y
            } else {
                return
            }
        } else {
            t = arguments[0].x;
            i = arguments[0].y
        }
        if (t < 0 || i < 0 || t > this._canvasWidth || i > this._canvasHeight) {
            return null
        }
        if (!this._areaFill) {
            try {
                var a = this._canvas.getContext("2d").getImageData(t, i, 1, 1).data;
                if (a[3] === 255) {
                    var s = "rgb(" + a[0] + "," + a[1] + "," + a[2] + ")";
                    var n = this._uniqueColors[s];
                    if (n) {
                        return n
                    }
                }
            } catch (o) {
            }
            return null
        }
        for (var l = this._publishedDatas.size() - 1; l >= 0; l--) {
            var n = this._publishedDatas.get(l);
            var _ = this._map[n.getId()];
            var c = r.isPointInPolygon(_.points, {x: t - this._xTranslate, y: i - this._yTranslate});
            if (c) {
                return n
            }
        }
        return null
    }, validateModel: function () {
        this._map = {};
        this._axisTexts = new u;
        this._axisMaxValues = new u;
        this._axisMinValues = new u;
        this._axisRangeValues = new u;
        this._axisCount = this._axisList == null ? 0 : this._axisList.size();
        if (this._axisCount == 0) {
            return
        }
        this._averageAngleByRadian = Math.PI * 2 / this._axisCount;
        this._averageAngle = 360 / this._axisCount;
        this._axisList.forEach(function (t) {
            if (typeof t == "string") {
                this._axisTexts.add(t);
                this._axisMaxValues.add(this._scaleMaxValue);
                this._axisMinValues.add(this._scaleMinValue);
                this._axisRangeValues.add(this._scaleMaxValue - this._scaleMinValue)
            } else {
                this._axisTexts.add(t.text);
                var i = isNaN(t.max) ? this._scaleMaxValue : t.max;
                var e = isNaN(t.min) ? this._scaleMinValue : t.min;
                this._axisMaxValues.add(i);
                this._axisMinValues.add(e);
                this._axisRangeValues.add(i - e)
            }
        }, this);
        this._publishedDatas.forEach(function (t) {
            var i = new u(this.getValues(t));
            var e = {data: t, values: i, proportions: new u, color: this.getUniqueColor(this.getColor(t), t), anchorShape: this.getAnchorShape(t), anchorSize: this.getAnchorSize(t), lineWidth: this.getLineWidth(t), points: new u};
            if (this.isSelected(t)) {
                e.lineWidth += 2
            }
            this._map[t.getId()] = e
        }, this);
        for (var t = 0; t < this._axisCount; t++) {
            this._publishedDatas.forEach(function (i) {
                var e = this._map[i.getId()];
                var a = 0;
                if (e.values.size() > t) {
                    var s = e.values.get(t);
                    var n = this._axisMinValues.get(t);
                    var h = this._axisRangeValues.get(t);
                    if (h > 0) {
                        a = (s - n) / h
                    }
                }
                e.proportions.add(a)
            }, this)
        }
    }, validateDisplay: function (t, i, e) {
        var a = {x: this._xGap, y: this._yGap, width: i - this._xGap * 2, height: e - this._yGap * 2};
        this.drawBackground(t, a);
        if (a.width <= 0 || a.height <= 0 || this._axisCount < 3) {
            return
        }
        var n = 0, h = 0, r = 0, o = null, l = null, _ = null;
        var c = null;
        if (this._axisTextVisible) {
            c = new u;
            for (r = 0; r < this._axisCount; r++) {
                _ = this._axisTexts.get(r);
                o = this.getTextSize(this._axisTextFont, _);
                c.add({text: _, size: o});
                if (o.width > n) {
                    n = o.width
                }
                if (o.height > h) {
                    h = o.height
                }
            }
        }
        var d = a.width / 2 - n > a.height / 2 - h ? a.height / 2 - h * 2 : a.width / 2 - n;
        var f = {x: a.x + a.width / 2, y: a.y + a.height / 2};
        this._center = {x: f.x + this._xTranslate, y: f.y + this._yTranslate};
        var g = null;
        if (this._scaleTextVisible) {
            g = new u
        }
        var x = this._axisStartAngle / 180 * Math.PI;
        for (r = 0; r < this._axisCount; r++) {
            var v = x * 180 / Math.PI;
            var T = f.x + Math.cos(x) * d;
            var C = f.y + Math.sin(-x) * d;
            var A = null;
            if (g) {
                A = new u;
                g.add(A)
            }
            if (this._ringVisible && this._ringLineWidth > 0) {
                t.lineWidth = this._ringLineWidth;
                t.strokeStyle = this._ringLineColor
            }
            for (var y = 1; y <= this._scaleCount; y++) {
                var L = y / this._scaleCount;
                var m = d * L;
                var p = f.x + Math.cos(x) * m;
                var R = f.y + Math.sin(-x) * m;
                if (this._ringVisible && this._ringLineWidth > 0) {
                    var S = f.x + Math.cos(x + this._averageAngleByRadian) * m;
                    var E = f.y + Math.sin(-x - this._averageAngleByRadian) * m;
                    if (this._ringType == "line") {
                        this.drawLine(t, this._ringLineColor, this._ringLineWidth, p, R, S, E)
                    } else if (this._ringType == "arc") {
                        t.beginPath();
                        t.moveTo(f.x, f.y);
                        s.drawArc(t, f.x, f.y, x, this._averageAngleByRadian, m, m, true);
                        t.closePath();
                        t.stroke()
                    }
                }
                if (A) {
                    _ = this.formatScaleText(this._axisMinValues.get(r) + this._axisRangeValues.get(r) * L, r);
                    o = this.getTextSize(this._scaleTextFont, _);
                    l = this.getScaleTextPosition(v, p, R, o.width, o.height);
                    A.add({text: _, x: l.x, y: l.y})
                }
            }
            if (this._axisVisible) {
                this.drawLine(t, this._axisLineColor, this._axisLineWidth, f.x, f.y, T, C)
            }
            if (c) {
                var w = c.get(r);
                l = this.getAxisTextPosition(v, T, C, w.size.width, w.size.height);
                w.x = l.x;
                w.y = l.y
            }
            x += this._averageAngleByRadian
        }
        this._publishedDatas.forEach(function (i) {
            var e = this._map[i.getId()];
            e.points.clear();
            var a = e.anchorSize > 0 ? new u : null;
            var n = e.proportions;
            t.lineWidth = 0;
            t.globalAlpha = this.isSelected(i) ? this._areaSelectFillAlpha : this._areaFillAlpha;
            if (this._areaFill) {
                t.fillStyle = e.color
            }
            this._drawItem(t, n, f, d, a, e);
            if (this._areaFill) {
                t.fill()
            }
            t.lineWidth = e.lineWidth;
            t.strokeStyle = e.color;
            t.globalAlpha = 1;
            this._drawItem(t, n, f, d);
            t.lineWidth = 0;
            if (a != null && a.size() > 0) {
                var h = e.anchorSize / 2;
                a.forEach(function (i) {
                    t.fillStyle = e.color;
                    s.drawVector(t, e.anchorShape, null, i.x - h, i.y - h, e.anchorSize, e.anchorSize);
                    t.fill()
                })
            }
        }, this);
        if (g) {
            g.forEach(function (i) {
                i.forEach(function (i) {
                    s.drawText(t, i.text, i, this._scaleTextFont, this._scaleTextColor)
                }, this)
            }, this)
        }
        if (c) {
            c.forEach(function (i) {
                s.drawText(t, i.text, i, this._axisTextFont, this._axisTextColor)
            }, this)
        }
    }, _drawItem: function (t, e, a, s, n, h) {
        var r = this._axisStartAngle / 180 * Math.PI;
        var o = null;
        t.beginPath();
        for (i = 0; i < this._axisCount; i++) {
            var l = e.get(i);
            var _ = {x: a.x + Math.cos(r) * s * l, y: a.y + Math.sin(-r) * s * l};
            if (o == null) {
                t.moveTo(_.x, _.y)
            } else {
                t.lineTo(_.x, _.y)
            }
            if (n != null && this._anchorVisible) {
                n.add(_)
            }
            if (h) {
                h.points.add(_)
            }
            if (i == 0) {
                o = _
            }
            r += this._averageAngleByRadian
        }
        if (o != null) {
            t.lineTo(o.x, o.y)
        }
        t.closePath();
        t.stroke()
    }, getAxisTextPosition: function (t, i, e, a, s) {
        t = (t % 360 + 360) % 360;
        var n = {x: i, y: e};
        if (t == 0) {
            n = {x: i + a / 2, y: e}
        }
        if (t == 180) {
            n = {x: i - a / 2, y: e}
        }
        if (t == 90) {
            n = {x: i, y: e - s / 2}
        }
        if (t == 270) {
            n = {x: i, y: e + s / 2}
        }
        if (t > 270 && t < 360) {
            n = {x: i + a / 2, y: e + s / 2}
        }
        if (t > 180 && t < 270) {
            n = {x: i - a / 2, y: e + s / 2}
        }
        if (t > 90 && t < 180) {
            n = {x: i - a / 2, y: e - s / 2}
        }
        if (t > 0 && t < 90) {
            n = {x: i + a / 2, y: e - s / 2}
        }
        return n
    }, getScaleTextPosition: function (t, i, e, a, s) {
        t = (t % 360 + 360) % 360;
        var n = {x: i, y: e};
        if (t == 0) {
            n = {x: i, y: e + s / 2}
        }
        if (t == 180) {
            n = {x: i - a / 2, y: e + s / 2}
        }
        if (t == 90) {
            n = {x: i + a / 2, y: e}
        }
        if (t == 270) {
            n = {x: i + a / 2, y: e}
        }
        if (t > 270 && t < 360) {
            n = {x: i + a / 2, y: e - s / 2}
        }
        if (t > 180 && t < 270) {
            n = {x: i - a / 2, y: e - s / 2}
        }
        if (t > 90 && t < 180) {
            n = {x: i - a / 2, y: e + s / 2}
        }
        if (t > 0 && t < 90) {
            n = {x: i + a / 2, y: e + s / 2}
        }
        return n
    }});
    twaver.charts.LegendPane = function (t) {
        twaver.charts.LegendPane.superClass.constructor.apply(this, arguments);
        this._divPool = new twaver.Pool("div");
        this._iconPool = new twaver.Pool("div");
        this._textPool = new twaver.Pool("span");
        this._pools.add(this._divPool);
        this._pools.add(this._iconPool);
        this._pools.add(this._textPool);
        this._chart = t;
        this._chart.addViewListener(this.handleViewChange, this);
        this._view = h.createView("hidden");
        this._view.style.verticalAlign = "middle";
        this._legendDiv = h.createDiv();
        this._legendDiv.style.whiteSpace = "nowrap";
        this._legendDiv.style.verticalAlign = "middle";
        this._legendDiv.style.position = "";
        this._view.appendChild(this._legendDiv);
        this._hiddenMap = {};
        var i = this;
        this._chart._internalVisibleFunction = function (t) {
            return!i.isHidden(t)
        };
        var e;
        if (c.isTouchable && !c.isMSToucheable) {
            e = twaver.charts.LegendPaneTouchInteraction
        } else {
            e = twaver.charts.LegendPaneInteraction
        }
        if (e) {
            new e(this)
        }
    };
    _twaver.ext("twaver.charts.LegendPane", twaver.controls.ControlBase, {__accessor: ["iconWidth", "iconHeight", "iconRadius", "rowHeight", "orientation", "hiddenColor", "selectBackgroundColor", "selectForegroundColor"], _iconWidth: d.LEGENDPANE_ICON_WIDTH, _iconHeight: d.LEGENDPANE_ICON_HEIGHT, _iconRadius: d.LEGENDPANE_ICON_RADIUS, _rowHeight: d.LEGENDPANE_ROW_HEIGHT, _orientation: d.LEGENDPANE_ORIENTATION, _hiddenColor: d.LEGENDPANE_HIDDEN_COLOR, _selectBackgroundColor: d.LEGENDPANE_SELECT_BACKGROUND_COLOR, _selectForegroundColor: d.LEGENDPANE_SELECT_FOREGROUND_COLOR, onPropertyChanged: function (t) {
        this.invalidate()
    }, getChart: function () {
        return this._chart
    }, isHidden: function (t) {
        return this._hiddenMap[t.getId()] != null
    }, handleViewChange: function (t) {
        if (t.kind === "validateEnd") {
            this._invalidate = true;
            this.validate()
        }
    }, validate: function () {
        if (!this._invalidate) {
            return
        }
        this._invalidate = false;
        h.release(this._legendDiv);
        _twaver.keys(this._hiddenMap).forEach(function (t) {
            if (!this._chart.getDataBox().containsById(t)) {
                delete this._hiddenMap[t]
            }
        }, this);
        var t = new u(this._chart.getUnfilteredDatas());
        for (var i = 0; i < t.size(); i++) {
            var e = t.get(i);
            if (!this._chart.isVisible(e) && !this.isHidden(e)) {
                t.removeAt(i);
                i--
            }
        }
        var a = t.size();
        var s = this._view.style;
        var n = this._orientation === "horizontal";
        if (n) {
            s.textAlign = "center";
            s.height = this._rowHeight + "px"
        } else {
            s.textAlign = "";
            s.height = this._rowHeight * a + "px"
        }
        s.lineHeight = this._rowHeight - 2 + "px";
        for (i = 0; i < a; i++) {
            var e = t.get(i);
            var r = this._divPool.get();
            r._data = e;
            r.style.cursor = "pointer";
            r.style.height = this._rowHeight + "px";
            if (n) {
                r.style.display = "inline-block"
            } else {
                r.style.display = "block"
            }
            this._legendDiv.appendChild(r);
            this.renderLegend(r, e);
            this.onLegendRendered(r, e)
        }
        this._pools.forEach(function (t) {
            t.clear()
        })
    }, renderLegend: function (t, i) {
        var e = !this.isHidden(i);
        var a = this._chart.isSelected(i);
        var s = this._iconPool.get();
        var n = s.style;
        n.display = "inline-block";
        n.verticalAlign = "middle";
        n.marginLeft = "4px";
        n.width = this.getIconWidth() + "px";
        n.height = this.getIconHeight() + "px";
        if (e) {
            n.backgroundColor = this._chart.getColor(i)
        } else {
            n.backgroundColor = this.getHiddenColor()
        }
        t.appendChild(s);
        var h = this._textPool.get();
        n = h.style;
        n.paddingLeft = "2px";
        n.paddingRight = "4px";
        n.display = "inline-block";
        n.verticalAlign = "middle";
        if (e) {
            n.color = a ? this._selectForegroundColor : ""
        } else {
            n.color = this.getHiddenColor()
        }
        h.innerHTML = this._chart.getName(i);
        t.appendChild(h);
        if (e && a) {
            t.style.backgroundColor = this._selectBackgroundColor
        } else {
            t.style.backgroundColor = ""
        }
    }, onLegendRendered: function (t, i) {
    }});
    twaver.charts.ChartPane = function (t, i, e, a) {
        twaver.charts.ChartPane.superClass.constructor.apply(this, arguments);
        this.invalidate();
        this._chart = t;
        this._legendPane = new twaver.charts.LegendPane(t);
        this._titleDiv = h.createDiv();
        this._titleDiv.style.verticalAlign = "middle";
        this._titleDiv.style.whiteSpace = "nowrap";
        this._view = h.createView("hidden");
        this._view.appendChild(this._titleDiv);
        this._view.appendChild(this._legendPane.getView());
        this._view.appendChild(this._chart.getView());
        var s = this;
        this._legendPane.addPropertyChangeListener(function (t) {
            if (t.property === "rowHeight" || t.porperty === "orientation") {
                s.invalidate()
            }
        });
        if (arguments.length > 1)this.setTitle(i);
        if (arguments.length > 2)this.setLegendOrientation(e);
        if (arguments.length > 3)this.setLegendWidth(a)
    };
    _twaver.ext("twaver.charts.ChartPane", twaver.controls.ControlBase, {__accessor: ["title", "titleHorizontalAlign", "titleHeight", "legendWidth"], _title: null, _titleHeight: d.CHARTPANE_TITLE_HEIGHT, _titleHorizontalAlign: d.CHARTPANE_TITLE_HORIZONTAL_ALIGN, _legendOrientation: d.CHARTPANE_LEGEND_ORIENTATION, _legendWidth: d.CHARTPANE_LEGEND_WIDTH, getLegendOrientation: function () {
        return this._legendOrientation
    }, setLegendOrientation: function (t) {
        if (this._legendOrientation === t) {
            return
        }
        var i = this._legendOrientation;
        this._legendOrientation = t;
        this.firePropertyChange("orientation", i, t);
        this._adjustLegendOrientation()
    }, _adjustLegendOrientation: function () {
        if (this._legendOrientation === "left" || this._legendOrientation === "right") {
            this._legendPane.setOrientation("vertical")
        } else {
            this._legendPane.setOrientation("horizontal")
        }
    }, onPropertyChanged: function (t) {
        this.invalidate()
    }, getTitleDiv: function () {
        return this._titleDiv
    }, getChart: function () {
        return this._chart
    }, getLegendPane: function () {
        return this._legendPane
    }, validateImpl: function () {
        this._adjustLegendOrientation();
        var t = this._view.offsetWidth;
        var i = this._view.offsetHeight;
        var e = this._legendPane.getRowHeight();
        var a;
        if (this._title && this._title !== "") {
            a = this._titleHeight;
            this._titleDiv.innerHTML = this._title
        } else {
            a = 0;
            this._titleDiv.innerHTML = ""
        }
        this._titleDiv.innerHTML = this._title ? this._title : "";
        this._titleDiv.style.textAlign = this._titleHorizontalAlign;
        this._titleDiv.style.lineHeight = this._titleHeight - 2 + "px";
        var s = this._titleDiv.style;
        s.left = "0px";
        s.top = "0px";
        s.width = t + "px";
        s.height = a + "px";
        var n;
        var h;
        if (this._legendOrientation === "bottom") {
            n = {x: 0, y: a, width: t, height: Math.max(i - a - e, 0)};
            h = {x: 0, y: Math.max(i - e, 0), width: t, height: e}
        } else if (this._legendOrientation === "right") {
            n = {x: 0, y: a, width: Math.max(t - this._legendWidth, 0), height: Math.max(i - a, 0)};
            h = {x: Math.max(t - this._legendWidth, 0), y: a, width: this._legendWidth, height: Math.max(i - a, 0)}
        } else if (this._legendOrientation === "top") {
            n = {x: 0, y: a + e, width: t, height: Math.max(i - a - e, 0)};
            h = {x: 0, y: a, width: t, height: e}
        } else if (this._legendOrientation === "left") {
            n = {x: this._legendWidth, y: a, width: Math.max(t - this._legendWidth, 0), height: Math.max(i - a, 0)};
            h = {x: 0, y: a, width: this._legendWidth, height: Math.max(i - a, 0)}
        }
        if (n) {
            this._chart.adjustBounds(n)
        }
        if (h) {
            this._legendPane.adjustBounds(h)
        }
    }});
    twaver.charts.ChartInteraction = function (t) {
        this.chart = t;
        this.canvas = t._canvas;
        var i = this;
        this.canvas.addEventListener("mousedown", function (t) {
            if (t.button === 0) {
                i.handleMouseDown(t)
            }
            t.preventDefault()
        }, false);
        var e = c.isFirefox ? "DOMMouseScroll" : "mousewheel";
        this.canvas.addEventListener(e, function (t) {
            i.handleMouseWheel(t)
        }, false)
    };
    _twaver.ext("twaver.charts.ChartInteraction", Object, {handleMouseDown: function (t) {
        if (this.chart.isFocusOnClick()) {
            twaver.Util.setFocus(this.canvas)
        }
        this.lastPoint = this.chart.getLogicalPoint(t);
        var i = this.chart.tryGetDataAt(t);
        if (t.detail === 2 && i == null) {
            if (this.chart.isDoubleClickToReset()) {
                this.chart.zoomReset(false);
                this.chart.setXTranslate(0);
                this.chart.setYTranslate(0)
            }
        } else {
            this._startLogical = this.lastPoint;
            this._startClient = h.getClientPoint(t);
            h.handle_mousedown(this, t)
        }
    }, handleMouseMove: function (t) {
        if (this.lastPoint) {
            var i = {x: this._startLogical.x + t.clientX - this._startClient.x, y: this._startLogical.y + t.clientY - this._startClient.y};
            if (!this.startPan && r.getDistance(this.lastPoint, i) > 3) {
                this.startPan = true;
                this.lastPoint = i
            }
            if (this.startPan) {
                if (this.chart.isXTranslateEnabled()) {
                    this.chart.setXTranslate(this.chart.getXTranslate() + i.x - this.lastPoint.x)
                }
                if (this.chart.isYTranslateEnabled()) {
                    this.chart.setYTranslate(this.chart.getYTranslate() + i.y - this.lastPoint.y)
                }
                this.lastPoint = i
            }
        }
    }, handleMouseUp: function (t) {
        if (!this.startPan && t.detail === 1) {
            var i = this.chart.tryGetDataAt(t);
            var e = this.chart.getSelectionModel();
            if (i) {
                if (_twaver.isCtrlDown(t)) {
                    if (e.contains(i)) {
                        e.removeSelection(i)
                    } else {
                        e.appendSelection(i)
                    }
                } else {
                    if (!e.contains(i)) {
                        e.setSelection(i)
                    }
                }
            } else {
                if (!_twaver.isCtrlDown(t)) {
                    e.clearSelection()
                }
            }
        }
        delete this.lastPoint;
        delete this.startPan;
        delete this._startClient;
        delete this._startLogical
    }, handleMouseWheel: function (t) {
        h.preventDefault(t);
        var i = c.isFirefox ? -t.detail : t.wheelDelta;
        if (i > 0) {
            if (this.chart.isXZoomEnabled()) {
                this.chart.setXZoom(this.chart.getXZoom() * 1.1, false)
            }
            if (this.chart.isYZoomEnabled()) {
                this.chart.setYZoom(this.chart.getYZoom() * 1.1, false)
            }
        } else if (i < 0) {
            if (this.chart.isXZoomEnabled()) {
                this.chart.setXZoom(this.chart.getXZoom() / 1.1, false)
            }
            if (this.chart.isYZoomEnabled()) {
                this.chart.setYZoom(this.chart.getYZoom() / 1.1, false)
            }
        }
    }});
    twaver.charts.ChartTouchInteraction = function (t) {
        this.chart = t;
        this.canvas = t._canvas;
        h.addEventListener("touchstart", "handleTouchstart", this.canvas, this)
    };
    _twaver.ext("twaver.charts.ChartTouchInteraction", Object, {handleTouchstart: function (t) {
        h.preventDefault(t);
        if (this.chart.isFocusOnClick()) {
            twaver.Util.setFocus(this.canvas)
        }
        this.endPoint = this.chart.getLogicalPoint(t);
        if (_.isMultiTouch(t)) {
            this.distance = _.getDistance(t);
            this.xZoom = this.chart.getXZoom();
            this.yZoom = this.chart.getYZoom()
        }
        h.addEventListener("touchmove", "handleTouchmove", this.canvas, this);
        h.addEventListener("touchend", "handleTouchend", this.canvas, this)
    }, handleTouchmove: function (t) {
        h.preventDefault(t);
        if (!this.endPoint) {
            return
        }
        var i = this.chart.getLogicalPoint(t);
        if (!this.moved && r.getDistance(this.endPoint, i) > 10) {
            this.moved = true;
            this.lastPoint = i
        }
        if (!this.moved) {
            return
        }
        if (_.isSingleTouch(t)) {
            if (this.endPoint) {
                if (this.chart.isXTranslateEnabled()) {
                    this.chart.setXTranslate(this.chart.getXTranslate() + i.x - this.endPoint.x)
                }
                if (this.chart.isYTranslateEnabled()) {
                    this.chart.setYTranslate(this.chart.getYTranslate() + i.y - this.endPoint.y)
                }
                this.endPoint = i
            }
        } else {
            if (this.distance) {
                var e = _.getDistance(t) / this.distance;
                var a = this.xZoom * e;
                var s = this.yZoom * e;
                if (this.chart.isXZoomEnabled()) {
                    this.chart.setXZoom(a, false)
                }
                if (this.chart.isYZoomEnabled()) {
                    this.chart.setYZoom(s, false)
                }
            }
        }
    }, handleTouchend: function (t) {
        h.preventDefault(t);
        if (!this.moved) {
            this.endPoint = this.chart.getLogicalPoint(t);
            var i = this.lastPoint && this.lastTouchStartTime && (new Date).getTime() - this.lastTouchStartTime.getTime() <= 300 && Math.abs(this.endPoint.x - this.lastPoint.x) <= 10 && Math.abs(this.endPoint.y - this.lastPoint.y) <= 10;
            if (i) {
                this.lastPoint = null;
                this.lastTouchStartTime = null
            } else {
                this.lastPoint = this.endPoint;
                this.lastTouchStartTime = new Date
            }
            var e = this.chart.tryGetDataAt(t);
            if (i && e == null) {
                if (this.chart.isDoubleClickToReset()) {
                    this.chart.zoomReset(false);
                    this.chart.setXTranslate(0);
                    this.chart.setYTranslate(0)
                }
            } else {
                var a = this.chart.getSelectionModel();
                if (e) {
                    if (!a.contains(e)) {
                        a.setSelection(e)
                    }
                } else {
                    a.clearSelection()
                }
            }
        }
        delete this.endPoint;
        delete this.distance;
        delete this.xZoom;
        delete this.yZoom;
        delete this.moved;
        h.removeEventListener("touchmove", this.canvas, this);
        h.removeEventListener("touchend", this.canvas, this)
    }});
    twaver.charts.ChartMSTouchInteraction = function (t) {
        this.chart = t;
        this.canvas = t._canvas;
        this._pointerMap = {};
        this._pointerIdArray = [];
        var i = this;
        this.canvas.addEventListener("MSPointerDown", function (t) {
            i.handleTouchstart(t)
        }, false);
        this.canvas.addEventListener("MSPointerMove", function (t) {
            i.handleTouchmove(t)
        }, false);
        this.canvas.addEventListener("MSPointerUp", function (t) {
            i.handleTouchend(t)
        }, false);
        this.canvas.addEventListener("MSPointerCancel", function (t) {
            i.handleTouchend(t)
        }, false);
        var e = c.isFirefox ? "DOMMouseScroll" : "mousewheel";
        this.canvas.addEventListener(e, function (t) {
            i.handleMouseWheel(t)
        }, false)
    };
    _twaver.ext("twaver.charts.ChartMSTouchInteraction", Object, {handleTouchstart: function (t) {
        if (this.chart.isFocusOnClick()) {
            twaver.Util.setFocus(this.canvas)
        }
        var i = this.chart.getLogicalPoint(t);
        if (t.isPrimary && this._pointerIdArray.length > 0) {
            this._pointerMap = {};
            this._pointerIdArray = []
        }
        if (!this._pointerMap[t.pointerId] && i) {
            this._pointerIdArray.push(t.pointerId);
            this._pointerMap[t.pointerId] = t
        }
        var e = this.chart.tryGetDataAt(t);
        if (this._pointerIdArray.length == 1 && i) {
            var a = this._startTouchPoint && this._startTouchTime && (new Date).getTime() - this._startTouchTime.getTime() <= 500 && r.getDistance(this._startTouchPoint, i) <= 10;
            if (a && e == null) {
                if (this.chart.isDoubleClickToReset()) {
                    this.chart.zoomReset(false);
                    this.chart.setXTranslate(0);
                    this.chart.setYTranslate(0);
                    this._startTouchPoint = null;
                    this._startTouchTime = null;
                    this._startClientPoint = null
                }
            } else {
                this._startTouchPoint = i;
                this._startTouchTime = new Date;
                this._startClientPoint = {x: t.clientX, y: t.clientY};
                h.handle_mousedown(this, t)
            }
        } else if (this._pointerIdArray.length == 2) {
            this.xZoom = this.chart.getXZoom();
            this.yZoom = this.chart.getYZoom();
            this._distance = this._getDistance()
        }
    }, handleTouchmove: function (t) {
        if (this._pointerIdArray.length == 0 || !this._pointerMap[t.pointerId] || r.getDistance({x: this._pointerMap[t.pointerId].pageX, y: this._pointerMap[t.pointerId].pageY}, {x: t.pageX, y: t.pageY}) <= 3) {
            return
        }
        this._pointerMap[t.pointerId] = t;
        if (this._pointerIdArray.length == 2) {
            var i = this._getDistance() / this._distance;
            var e = this.xZoom * i;
            var a = this.yZoom * i;
            if (this.chart.isXZoomEnabled()) {
                this.chart.setXZoom(e, false)
            }
            if (this.chart.isYZoomEnabled()) {
                this.chart.setYZoom(a, false)
            }
        }
    }, handleTouchend: function (t) {
        var i = this.chart.getLogicalPoint(t);
        if (this._pointerIdArray.length == 1 && i && !this.moved) {
            var e = this.chart.tryGetDataAt(t);
            var a = this._startTouchPoint && this._startTouchTime && (new Date).getTime() - this._startTouchTime.getTime() <= 500 && r.getDistance(this._startTouchPoint, i) <= 10;
            var s = this.chart.getSelectionModel();
            if (e && a) {
                if (_twaver.isCtrlDown(t)) {
                    if (s.contains(e)) {
                        s.removeSelection(e)
                    } else {
                        s.appendSelection(e)
                    }
                } else {
                    if (!s.contains(e)) {
                        s.setSelection(e)
                    }
                }
            } else {
                if (!_twaver.isCtrlDown(t)) {
                    s.clearSelection()
                }
            }
        }
        this.moved = false;
        this._pointerMap = {};
        this._pointerIdArray = []
    }, handleMouseWheel: function (t) {
        h.preventDefault(t);
        var i = c.isFirefox ? -t.detail : t.wheelDelta;
        if (i > 0) {
            if (this.chart.isXZoomEnabled()) {
                this.chart.setXZoom(this.chart.getXZoom() * 1.1, false)
            }
            if (this.chart.isYZoomEnabled()) {
                this.chart.setYZoom(this.chart.getYZoom() * 1.1, false)
            }
        } else if (i < 0) {
            if (this.chart.isXZoomEnabled()) {
                this.chart.setXZoom(this.chart.getXZoom() / 1.1, false)
            }
            if (this.chart.isYZoomEnabled()) {
                this.chart.setYZoom(this.chart.getYZoom() / 1.1, false)
            }
        }
    }, handle_mousemove: function (t) {
        if (this._pointerIdArray.length == 1 && this._startTouchPoint && this._startClientPoint) {
            var i = {x: this._startTouchPoint.x + (t.clientX - this._startClientPoint.x) / this.chart.getXZoom(), y: this._startTouchPoint.y + (t.clientY - this._startClientPoint.y) / this.chart.getYZoom()};
            if (r.getDistance(this._startTouchPoint, i) > 3) {
                this.moved = true;
                if (this.chart.isXTranslateEnabled()) {
                    this.chart.setXTranslate(this.chart.getXTranslate() + i.x - this._startTouchPoint.x)
                }
                if (this.chart.isYTranslateEnabled()) {
                    this.chart.setYTranslate(this.chart.getYTranslate() + i.y - this._startTouchPoint.y)
                }
                this._startClientPoint.x = t.clientX;
                this._startClientPoint.y = t.clientY
            }
        }
    }, handle_mouseup: function (t) {
        this.handleTouchend(t)
    }, _getDistance: function () {
        return r.getDistance({x: this._pointerMap[this._pointerIdArray[0]].pageX, y: this._pointerMap[this._pointerIdArray[0]].pageY}, {x: this._pointerMap[this._pointerIdArray[1]].pageX, y: this._pointerMap[this._pointerIdArray[1]].pageY})
    }});
    twaver.charts.LegendPaneInteraction = function (t) {
        this.legendPane = t;
        var i = this;
        this.legendPane._legendDiv.addEventListener("mousedown", function (t) {
            i.handleMouseDown(t)
        }, false)
    };
    _twaver.ext("twaver.charts.LegendPaneInteraction", Object, {handleMouseDown: function (t) {
        if (t.button !== 0) {
            return
        }
        var i = t.target._data;
        if (!i) {
            i = t.target.parentNode._data
        }
        if (i) {
            if (this.legendPane._hiddenMap[i.getId()]) {
                delete this.legendPane._hiddenMap[i.getId()]
            } else {
                this.legendPane._hiddenMap[i.getId()] = i
            }
            this.legendPane._chart.invalidateModel()
        }
    }});
    twaver.charts.LegendPaneTouchInteraction = function (t) {
        this.legendPane = t;
        h.addEventListener("touchstart", "handleTouchstart", this.legendPane._legendDiv, this)
    };
    _twaver.ext("twaver.charts.LegendPaneTouchInteraction", Object, {handleTouchstart: function (t) {
        h.preventDefault(t);
        var i = t.target._data;
        if (!i) {
            i = t.target.parentNode._data
        }
        if (i) {
            if (this.legendPane._hiddenMap[i.getId()]) {
                delete this.legendPane._hiddenMap[i.getId()]
            } else {
                this.legendPane._hiddenMap[i.getId()] = i
            }
            this.legendPane._chart.invalidateModel()
        }
    }})
})(window);
(function (t, e) {
    var i = _twaver.extend;
    var s = _twaver.g;
    var n = _twaver.html;
    var o = _twaver.math;
    var r = _twaver.popup;
    var a = _twaver.render;
    var h = _twaver.touch;
    var l = _twaver.ua;
    var d = twaver.List;
    var c = twaver.Defaults;
    i.__tree = function (t, e) {
        t._rootVisible = true;
        t._initTree = function (t) {
            this._rootData = null;
            this._expandMap = {};
            this._levelMap = {}
        };
        t.validateModel = function () {
            this._rowDatas.clear();
            this._levelMap = {};
            this._dataRowMap = {};
            this._currentLevel = 0;
            if (this._rootData) {
                if (this._rootVisible) {
                    if (this.isVisible(this._rootData)) {
                        this._buildData(this._rootData)
                    }
                } else {
                    this._buildChildren(this._rootData)
                }
            } else {
                this._buildChildren()
            }
            delete this._currentLevel
        };
        t._buildData = function (t) {
            this._dataRowMap[t.getId()] = this._rowDatas.size();
            this._rowDatas.add(t);
            this._levelMap[t.getId()] = this._currentLevel;
            if (this.isExpanded(t)) {
                this._currentLevel++;
                this._buildChildren(t);
                this._currentLevel--
            }
        };
        t._buildChildren = function (t) {
            var e = t ? t.getChildren() : this._box.getRoots();
            var i = this.getCurrentSortFunction();
            if (i && this.isChildrenSortable(t)) {
                e.toList(this.isVisible, this).sort(i).forEach(function (t) {
                    this._buildData(t)
                }, this)
            } else {
                e.forEach(function (t) {
                    if (this.isVisible(t)) {
                        this._buildData(t)
                    }
                }, this)
            }
        };
        t.getLevel = function (t) {
            return this._levelMap[t.getId()]
        };
        t.getToggleImage = function (t) {
            if (t.getChildrenSize() > 0) {
                return this.isExpanded(t) ? this._expandIcon : this._collapseIcon
            }
            return null
        };
        t.isCheckable = function (t) {
            return this.isCheckMode()
        };
        t.isCheckMode = function () {
            return i.__tree._checkMap[this._checkMode] === 1
        };
        t.isChildrenSortable = function (t) {
            return true
        };
        t.handleDataBoxChange = function (t) {
            if (t.kind === "remove") {
                delete this._expandMap[t.data.getId()]
            } else if (t.kind === "clear") {
                this._expandMap = {}
            }
            this.invalidateModel()
        };
        t.isExpanded = function (t) {
            return this._expandMap[t.getId()] === 1
        };
        t.expand = function (t) {
            if (this.isExpanded(t)) {
                return
            }
            var e = t.getParent();
            while (e != null && e !== this._rootData) {
                this._expandMap[e.getId()] = 1;
                e = e.getParent()
            }
            this._expandMap[t.getId()] = 1;
            this.invalidateModel()
        };
        t.collapse = function (t) {
            if (!this.isExpanded(t)) {
                return
            }
            delete this._expandMap[t.getId()];
            this.invalidateModel()
        };
        t.expandAll = function () {
            this._box.forEach(function (t) {
                this._expandMap[t.getId()] = 1
            }, this);
            this.invalidateModel()
        };
        t.collapseAll = function () {
            this._expandMap = {};
            this.invalidateModel()
        };
        t._handleClick = function (t) {
            if (this.isFocusOnClick()) {
                twaver.Util.setFocus(this._view)
            }
            if (this._isValidating) {
                return
            }
            var e;
            if (t.target._expandData) {
                e = t.target._expandData;
                if (this.isExpanded(e)) {
                    this.collapse(e);
                    this.fireInteractionEvent({kind: "collapse", data: e})
                } else {
                    this.expand(e);
                    this.fireInteractionEvent({kind: "expand", data: e})
                }
            } else if (t.target._selectData || t.target.parentNode._selectData) {
                this._handlePressSelection(t.target._selectData || t.target.parentNode._selectData, t);
                if (this.isCheckMode()) {
                    var i = this.getRowIndexAt(t);
                    if (i >= 0) {
                        this._focusedRow = i;
                        this.invalidateDisplay()
                    }
                }
            } else if (this._treeColumn) {
                e = this.getDataAt(t);
                if (e) {
                    if (this.isCheckMode()) {
                        if (!t.target._checkData) {
                            this._focusedRow = this.getRowIndexByData(e);
                            this.invalidateDisplay()
                        }
                    } else {
                        this._handlePressSelection(e, t)
                    }
                }
            } else if (this.isCheckMode() && !t.target._checkData) {
                this._focusedRow = this.getRowIndexAt(t);
                this.invalidateDisplay()
            }
            if (this._currentEditor && !this._isCommitting) {
                this._isCommitting = true;
                this.commitEditValue(this._currentEditor._editInfo, this._currentEditor)
            }
            if (this.updateCurrentEditor) {
                this.updateCurrentEditor(t)
            }
        };
        t.handleChange = function (t) {
            if (this._isCommitting || this._isCanceling || this._isValidating) {
                return
            }
            var e = t.target._checkData;
            if (e) {
                var i = this.isSelected(e);
                var s = this.getSelectionModel();
                var n;
                if (this._checkMode === "default") {
                    if (i) {
                        s.removeSelection(e)
                    } else {
                        s.appendSelection(e)
                    }
                } else if (this._checkMode === "children") {
                    n = new d(e);
                    n.addAll(e.getChildren())
                } else if (this._checkMode === "descendant") {
                    n = new d;
                    _twaver.fillDescendant(e, n)
                } else if (this._checkMode === "descendantAncestor") {
                    n = new d;
                    _twaver.fillDescendant(e, n);
                    if (!i) {
                        var o = e.getParent();
                        while (o) {
                            n.add(o);
                            o = o.getParent()
                        }
                    }
                }
                if (i) {
                    s.removeSelection(n)
                } else {
                    s.appendSelection(n)
                }
            }
            if (t.target._editInfo && this.commitEditValue) {
                this._isCommitting = true;
                this.commitEditValue(t.target._editInfo, t.target)
            }
        };
        t.onLabelRendered = function (t, e, i, s, n, o) {
        };
        t._renderTree = function (t, e, i, s) {
            var n = this._levelMap[e.getId()];
            var o = this.getToggleImage(e);
            var r = this.__spanPool.get();
            if (o) {
                r.style.width = this._indent * n + "px"
            } else {
                r.style.width = this._indent * (n + 1) + "px"
            }
            r.style.display = "inline-block";
            t.appendChild(r);
            if (o) {
                var a = this.__imagePool.get();
                a.setAttribute("src", _twaver.getImageSrc(o));
                a.style.verticalAlign = "middle";
                a._expandData = e;
                t.appendChild(a)
            }
            var h = this.isCheckable(e);
            var l = this.getUncheckableStyle() === "disabled";
            if (h || l) {
                var d = this._addCheckBox(t, e, s);
                d.disabled = !h
            }
            var c = this.getIcon(e);
            if (c) {
                var v = this.isCheckMode() || this._treeColumn ? null : e;
                this._addIcon(t, e, c, v)
            }
            var _ = this.getLabel(e);
            if (_) {
                r = this.__textPool.get();
                r.style.whiteSpace = "nowrap";
                r.style.verticalAlign = "middle";
                r.style.padding = "1px 2px 1px 2px";
                _twaver.setText(r, _, this._treeColumn ? this._treeColumn.isInnerText() : this._innerText);
                if (!this.isCheckMode() && !this._treeColumn) {
                    r._selectData = e;
                    r.style.backgroundColor = s ? this.getSelectColor(e) : ""
                } else if (this._focusedRow === i) {
                    r.style.backgroundColor = this.getSelectColor(e)
                }
                this.onLabelRendered(r, e, _, i, n, s);
                t.appendChild(r)
            }
        }
    };
    i.__tree._checkMap = {"default": 1, children: 1, descendant: 1, descendantAncestor: 1};
    twaver.Column = function (t) {
        twaver.Column.superClass.constructor.call(this, t)
    };
    _twaver.ext("twaver.Column", twaver.Data, {IColumn: true, __property: 1, __accessor: ["width", "horizontalAlign", "valueType", "propertyType", "propertyName", "editable", "visible", "sortable", "resizable", "movable", "sortDirection", "sortFunction", "enumInfo"], __bool: ["innerText"], _innerText: c.COLUMN_INNER_TEXT, _width: c.COLUMN_WIDTH, _horizontalAlign: c.COLUMN_HORIZONTAL_ALIGN, _propertyName: null, _propertyType: c.COLUMN_PROPERTY_TYPE, _valueType: c.COLUMN_VALUE_TYPE, _editable: c.COLUMN_EDITABLE, _sortable: c.COLUMN_SORTABLE, _visible: c.COLUMN_VISIBLE, _resizable: c.COLUMN_RESIZABLE, _movable: c.COLUMN_MOVABLE, _sortDirection: "asc", _sortFunction: c.SORT_FUNCTION, _enumInfo: null, renderCell: c.COLUMN_RENDER_CELL, renderHeader: c.COLUMN_RENDER_HEADER, setParent: function (t) {
        throw"parent not supported"
    }});
    twaver.ColumnBox = function (t) {
        twaver.ColumnBox.superClass.constructor.apply(this, arguments)
    };
    _twaver.ext("twaver.ColumnBox", twaver.DataBox, {_name: "ColumnBox", add: function (t, e) {
        if (!t.IColumn) {
            throw"Only IColumn can be added into ColumnBox"
        }
        twaver.ColumnBox.superClass.add.apply(this, arguments)
    }});
    twaver.Property = function (t) {
        twaver.Property.superClass.constructor.call(this, t)
    };
    _twaver.ext("twaver.Property", twaver.Data, {IProperty: true, __property: 1, __accessor: ["horizontalAlign", "valueType", "editable", "propertyType", "propertyName", "categoryName", "enumInfo"], __bool: ["innerText"], _innerText: c.PROPERTY_INNER_TEXT, _horizontalAlign: c.PROPERTY_HORIZONTAL_ALIGN, _propertyName: null, _propertyType: c.PROPERTY_PROPERTY_TYPE, _valueType: c.PROPERTY_VALUE_TYPE, _editable: c.PROPERTY_EDITABLE, _categoryName: c.PROPERTY_CATEGORY_NAME, _enumInfo: null, renderName: c.PROPERTY_RENDER_NAME, renderValue: c.PROPERTY_RENDER_VALUE, isVisible: null, setParent: function (t) {
        throw"parent not supported"
    }, setPropertyName: function (t) {
        var e = this._propertyName;
        this._propertyName = t;
        this.firePropertyChange("propertyName", e, t)
    }, setPropertyType: function (t) {
        var e = this._propertyType;
        this._propertyType = t;
        this.firePropertyChange("propertyType", e, t)
    }});
    twaver.PropertyBox = function (t) {
        twaver.PropertyBox.superClass.constructor.apply(this, arguments)
    };
    _twaver.ext("twaver.PropertyBox", twaver.DataBox, {_name: "PropertyBox", add: function (t, e) {
        if (!t.IProperty) {
            throw"Only IProperty can be added into PropertyBox"
        }
        twaver.PropertyBox.superClass.add.apply(this, arguments)
    }});
    twaver.Tab = function (t) {
        twaver.Tab.superClass.constructor.call(this, t)
    };
    _twaver.ext("twaver.Tab", twaver.Data, {ITab: true, __accessor: ["view", "width", "closable", "resizable", "movable", "disabled", "visible"], _icon: null, _width: c.TAB_WIDTH, _closable: c.TAB_CLOSABLE, _resizable: c.TAB_RESIZABLE, _movable: c.TAB_MOVABLE, _disabled: c.TAB_DISABLED, _visible: c.TAB_VISIBLE, setParent: function (t) {
        throw"parent not supported"
    }});
    twaver.TabBox = function (t) {
        twaver.TabBox.superClass.constructor.apply(this, arguments);
        this.getSelectionModel().setSelectionMode("singleSelection")
    };
    _twaver.ext("twaver.TabBox", twaver.DataBox, {_name: "TabBox", add: function (t, e) {
        if (!t.ITab) {
            throw"Only ITab can be added into TabBox"
        }
        twaver.TabBox.superClass.add.apply(this, arguments)
    }});
    twaver.controls.ListBase = function (t) {
        twaver.controls.ListBase.superClass.constructor.apply(this, arguments);
        this._invalidate = false;
        this._invalidateModel = false;
        this._invalidateDisplay = false;
        this._invalidateDatas = null;
        this._rowDatas = new d;
        this._startRowIndex = 0;
        this._endRowIndex = 0;
        this._renderMap = {};
        this._dataRowMap = {};
        this.__divPool = new twaver.Pool("div", 20);
        this.__imagePool = new twaver.Pool("img", 20);
        this.__canvasPool = new twaver.Pool("canvas", 20);
        this.__spanPool = new twaver.Pool("span", 20);
        this.__textPool = new twaver.Pool("span", 20);
        this.__checkBoxPool = new twaver.Pool("input", 20);
        this._pools.add(this.__divPool);
        this._pools.add(this.__imagePool);
        this._pools.add(this.__canvasPool);
        this._pools.add(this.__spanPool);
        this._pools.add(this.__textPool);
        this._pools.add(this.__checkBoxPool);
        this._view = n.createView("auto");
        this._rootDiv = n.createDiv();
        this._dataDiv = n.createDiv();
        this._dataDiv.style.width = "1px";
        this._view.appendChild(this._rootDiv);
        this._rootDiv.appendChild(this._dataDiv);
        this.setDataBox(t ? t : new twaver.DataBox);
        var e = this;
        if (e.handleChange) {
            e._view.addEventListener("change", function (t) {
                e.handleChange(t)
            }, false)
        }
        var i;
        if (l.isMSToucheable) {
            i = twaver.controls.ListBaseMSTouchInteraction
        } else if (l.isTouchable) {
            i = twaver.controls.ListBaseTouchInteraction
        } else {
            i = twaver.controls.ListBaseInteraction
        }
        if (i) {
            new i(this)
        }
    };
    _twaver.ext("twaver.controls.ListBase", twaver.controls.View, {__bool: ["innerText"], _innerText: c.LISTBASE_INNER_TEXT, getDataDiv: function () {
        return this._dataDiv
    }, getStartRowIndex: function () {
        return this._startRowIndex
    }, getEndRowIndex: function () {
        return this._endRowIndex
    }, getRowDatas: function () {
        return this._rowDatas
    }, getRowIndexByData: function (t) {
        return this._dataRowMap[t.getId()]
    }, getRowIndexById: function (t) {
        return this._dataRowMap[t]
    }, getRowSize: function () {
        return this._rowDatas.size()
    }, getDataBox: function () {
        return this._box
    }, setDataBox: function (t) {
        if (!t) {
            throw"DataBox can not be null"
        }
        if (this._box === t) {
            return
        }
        var e = this._box;
        if (e) {
            e.removeDataBoxChangeListener(this.handleDataBoxChange, this);
            e.removeDataPropertyChangeListener(this.handlePropertyChange, this);
            e.removeHierarchyChangeListener(this.handleHierarchyChange, this);
            if (!this._selectionModel) {
                e.getSelectionModel().removeSelectionChangeListener(this.handleSelectionChange, this)
            }
        }
        this._box = t;
        this._box.addDataBoxChangeListener(this.handleDataBoxChange, this);
        this._box.addDataPropertyChangeListener(this.handlePropertyChange, this);
        this._box.addHierarchyChangeListener(this.handleHierarchyChange, this);
        if (this._selectionModel) {
            this._selectionModel._setDataBox(t)
        } else {
            this._box.getSelectionModel().addSelectionChangeListener(this.handleSelectionChange, this)
        }
        this.invalidateModel();
        this.firePropertyChange("dataBox", e, this._box)
    }, onPropertyChanged: function (t) {
        if (t.property === "zoom") {
            this.invalidate()
        } else {
            this.invalidateModel()
        }
    }, invalidateModel: function () {
        if (this._invalidateModel) {
            return
        }
        this._invalidateModel = true;
        this._invalidateDisplay = true;
        this._invalidateDatas = null;
        this.invalidate()
    }, invalidateDisplay: function () {
        if (this._invalidateDisplay) {
            return
        }
        this._invalidateDisplay = true;
        this._invalidateDatas = null;
        this.invalidate()
    }, invalidateData: function (t) {
        if (this._invalidateDisplay) {
            return
        }
        if (!this._invalidateDatas) {
            this._invalidateDatas = {}
        }
        this._invalidateDatas[t.getId()] = t;
        this.invalidate()
    }, validateImpl: function () {
        var t = this._view.scrollLeft;
        var e = this._view.scrollTop;
        if (this._invalidateModel) {
            this._invalidateModel = false;
            this.validateModel()
        }
        if (this._invalidateDisplay) {
            this._invalidateDisplay = false;
            this._renderMap = {};
            n.release(this._dataDiv);
            this._dataDiv.style.height = this.getRowSize() * this._rowHeight + "px"
        }
        var i;
        if (this._invalidateDatas) {
            for (i in this._invalidateDatas) {
                var s = this._renderMap[i];
                if (s) {
                    n.release(s);
                    this._dataDiv.removeChild(s);
                    delete this._renderMap[i]
                }
            }
            this._invalidateDatas = null
        }
        var o = this._view.scrollTop / this._zoom;
        var r = this._view.clientHeight / this._zoom;
        this._startRowIndex = Math.floor(o / this._rowHeight) - 2;
        this._endRowIndex = Math.ceil((o + r) / this._rowHeight) + 2;
        if (this._startRowIndex < 0)this._startRowIndex = 0;
        if (this._endRowIndex > this._rowDatas.size())this._endRowIndex = this._rowDatas.size();
        var a = this._rowHeight - this._rowLineWidth - 2 + "px";
        var h = this._rowLineWidth + "px";
        for (var l = this._startRowIndex; l < this._endRowIndex; l++) {
            var d = this._rowDatas.get(l);
            i = d.getId();
            var c = this._renderMap[i];
            if (!c) {
                c = this.__divPool.get();
                var v = c.style;
                v.position = "absolute";
                v.whiteSpace = "nowrap";
                v.lineHeight = a;
                v.top = l * this._rowHeight + "px";
                v.borderStyle = "solid";
                v.borderWidth = "0px";
                v.borderBottomWidth = h;
                v.borderBottomColor = this._rowLineColor;
                this._dataDiv.appendChild(c);
                this._renderMap[i] = c;
                var _ = this.isSelected(d);
                this.renderData(c, d, l, _);
                this.onDataRendered(c, d, l, _)
            }
        }
        _twaver.keys(this._renderMap).forEach(function (t) {
            var e = this.getRowIndexById(t);
            if (e < this._startRowIndex || e >= this._endRowIndex) {
                var i = this._renderMap[t];
                n.release(i);
                this._dataDiv.removeChild(i);
                delete this._renderMap[t]
            }
        }, this);
        this._pools.forEach(function (t) {
            t.clear()
        });
        if (this._view.scrollLeft !== t) {
            this._view.scrollLeft = t
        }
        if (this._view.scrollTop !== e) {
            this._view.scrollTop = e
        }
        this.adjustRowSize();
        this.onValidated()
    }, adjustRowSize: function () {
        var t, e;
        var i = this._rowHeight - this._rowLineWidth + "px";
        var s = Math.floor((this._view.scrollLeft + this._view.clientWidth) / this._zoom) + "px";
        for (t in this._renderMap) {
            e = this._renderMap[t];
            e.style.height = i;
            e.style.width = s
        }
    }, onValidated: function () {
    }, onDataRendered: function (t, e, i, s) {
    }, _addCheckBox: function (t, e, i) {
        var s = this.__checkBoxPool.get();
        s.keepDefault = true;
        s.type = "checkbox";
        s.style.margin = "0px 2px";
        s.style.verticalAlign = "middle";
        s._checkData = e;
        s.checked = i;
        s.disabled = false;
        t.appendChild(s);
        return s
    }, _addIcon: function (t, e, i, n) {
        var o = _twaver.getImageAsset(i);
        var r = this.getInnerColor(e);
        var a = this.getOuterColor(e);
        var h = this.getAlarmFillColor(e);
        var l;
        if ((r || a || h) && o && o.getImage()) {
            var d = o.getWidth();
            var c = o.getHeight();
            l = this.__canvasPool.get();
            l.style.verticalAlign = "middle";
            l.setAttribute("width", d);
            l.setAttribute("height", c);
            var v = l.getContext("2d");
            v.clearRect(0, 0, d, c);
            v.drawImage(o.getImage(r), 0, 0, d, c);
            if (a) {
                v.lineWidth = 2;
                v.strokeStyle = a;
                v.beginPath();
                v.rect(0, 0, d, c);
                v.closePath();
                v.stroke()
            }
            if (h) {
                v.fillStyle = s.createRadialGradient(v, h, "white", 1, c - 9, 8, 8, .75, .25);
                v.beginPath();
                v.arc(5, c - 5, 4, 0, Math.PI * 2, true);
                v.closePath();
                v.fill()
            }
        } else {
            l = this.__imagePool.get();
            l.style.verticalAlign = "middle";
            l.setAttribute("src", _twaver.getImageSrc(i))
        }
        l.style.margin = "0px 1px 0px 1px";
        l._selectData = n;
        t.appendChild(l)
    }, isVisible: function (t) {
        if (!this._box.contains(t)) {
            return false
        }
        return this._visibleFunction ? this._visibleFunction(t) : true
    }, handleDataBoxChange: function (t) {
        this.invalidateModel()
    }, handlePropertyChange: function (t) {
        if (t.property === "parent") {
            this.invalidateModel()
        } else {
            this.invalidateData(t.source)
        }
    }, handleHierarchyChange: function (t) {
        this.invalidateModel()
    }, handleSelectionChange: function (t) {
        t.datas.forEach(function (t) {
            this.invalidateData(t)
        }, this);
        this.onSelectionChanged(t)
    }, getRowIndexAt: function (t) {
        var e = this.getLogicalPoint(t);
        if (!e) {
            return-1
        }
        var i = parseInt(e.y / this._rowHeight);
        return i >= 0 && i < this._rowDatas.size() ? i : -1
    }, getDataAt: function (t) {
        var e = this.getRowIndexAt(t);
        return e >= 0 ? this._rowDatas.get(e) : null
    }, getCurrentSortFunction: function () {
        return this._sortFunction
    }, validateModel: function () {
        this._rowDatas.clear();
        this._dataRowMap = {};
        this._buildChildren(this._box.getRoots());
        this._rowDatas = this._rowDatas.toList(this.isVisible, this);
        var t = this.getCurrentSortFunction();
        if (t) {
            this._rowDatas.sort(t)
        }
        var e = this._rowDatas.size();
        for (var i = 0; i < e; i++) {
            this._dataRowMap[this._rowDatas.get(i).getId()] = i
        }
    }, _buildChildren: function (t) {
        t.forEach(function (t) {
            this._rowDatas.add(t);
            this._buildChildren(t.getChildren())
        }, this)
    }, _handlePressSelection: function (t, e) {
        var i = this.getSelectionModel();
        if (_twaver.isCtrlDown(e)) {
            if (i.contains(t)) {
                i.removeSelection(t)
            } else {
                i.appendSelection(t)
            }
        } else if (e.shiftKey && i.getLastData()) {
            var s = i.getLastData();
            var n = this.getRowIndexByData(s);
            var o = this.getRowIndexByData(t);
            var r = new d;
            r.add(this.getRowDatas().get(n));
            while (n !== o) {
                n += o > n ? +1 : -1;
                r.add(this.getRowDatas().get(n))
            }
            i.setSelection(r)
        } else {
            if (i.size() !== 1 || !i.contains(t)) {
                i.setSelection(t)
            }
        }
        this.fireInteractionEvent({kind: e.detail === 2 ? "doubleClick" : "click", data: t})
    }, _handleClick: function (t) {
        if (this.isFocusOnClick()) {
            twaver.Util.setFocus(this._view)
        }
        var e = this.getDataAt(t);
        if (e) {
            if (this.isCheckMode() && !t.target._checkData) {
                this._focusedRow = this.getRowIndexByData(e);
                this.invalidateDisplay()
            }
            if (!this.isCheckMode()) {
                this._handlePressSelection(e, t)
            }
        }
        if (this._currentEditor) {
            this.commitEditValue(this._currentEditor._editInfo, this._currentEditor)
        }
        if (this.updateCurrentEditor) {
            this.updateCurrentEditor(t)
        }
    }, handleChange: function (t) {
        if (this._isCanceling || this._isValidating) {
            return
        }
        var e = t.target._checkData;
        if (e) {
            var i = this.isSelected(e);
            var s = this.getSelectionModel();
            if (i) {
                s.removeSelection(e)
            } else {
                s.appendSelection(e)
            }
        }
        if (t.target._editInfo && this.commitEditValue) {
            this.commitEditValue(t.target._editInfo, t.target)
        }
    }, scrollToData: function (t) {
        var e = this.getRowIndexById(t.getId());
        if (e < 0) {
            return
        }
        var i = e * this._rowHeight * this._zoom;
        var s = i + this._rowHeight * this._zoom;
        var n = this._view.scrollTop;
        if (this._view.scrollTop > i) {
            n = i
        }
        if (this._view.scrollTop + this._view.clientHeight < s) {
            n = s - this._view.clientHeight
        }
        if (this._view.scrollTop != n) {
            this._view.scrollTop = n;
            this.invalidate()
        }
    }, makeVisible: function (t) {
        if (!this.isVisible(t)) {
            return
        }
        if (this.expand) {
            this.expand(t)
        }
        _twaver.callLater(this.scrollToData, this, [t], c.CALL_LATER_DELAY * 2)
    }, onSelectionChanged: function (t) {
        if (this._makeVisibleOnSelected) {
            if (t.kind === "append" || t.kind === "set" || t.kind === "all") {
                if (this.expand) {
                    this.getSelectionModel().getSelection().forEach(function (t) {
                        if (t.getParent()) {
                            this.expand(t.getParent())
                        }
                    }, this)
                }
                _twaver.callLater(this.scrollToData, this, [this.getSelectionModel().getLastData()], c.CALL_LATER_DELAY * 2)
            }
        }
    }, onShareSelectionModelChanged: function () {
        this.invalidateModel()
    }});
    twaver.controls.TableBase = function (t) {
        this._columnBox = new twaver.ColumnBox;
        this._columnBox.addDataBoxChangeListener(this.handleColumnBoxChange, this);
        this._columnBox.addDataPropertyChangeListener(this.handleColumnPropertyChange, this);
        this._columnBox.addHierarchyChangeListener(this.handleColumnHierarchyChange, this);
        twaver.controls.TableBase.superClass.constructor.apply(this, arguments);
        this._cellPool = new twaver.Pool("div", 20);
        this._stringPool = new twaver.Pool("span", 20);
        this._booleanPool = new twaver.Pool("input", 20);
        this._colorPool = new twaver.Pool("div", 20);
        this._pools.add(this._cellPool);
        this._pools.add(this._stringPool);
        this._pools.add(this._booleanPool);
        this._pools.add(this._colorPool)
    };
    _twaver.ext("twaver.controls.TableBase", twaver.controls.ListBase, {getColumnBox: function () {
        return this._columnBox
    }, handleColumnBoxChange: function (t) {
        this.invalidateDisplay()
    }, handleColumnPropertyChange: function (t) {
        if (t.source === this._sortColumn && (t.property === "sortDirection" || t.property === "sortFunction" || t.property === "sortable")) {
            this.invalidateModel()
        } else {
            this.invalidateDisplay()
        }
    }, handleColumnHierarchyChange: function (t) {
        this.invalidateDisplay()
    }, renderData: function (t, e, i, s) {
        var n = this._columnBox.getRoots();
        var o = n.size();
        var r = 0;
        var a = this._rowHeight - this._rowLineWidth + "px";
        var h;
        for (var l = 0; l < o; l++) {
            var d = n.get(l);
            var c = d.getWidth();
            if (c < 0)c = 0;
            var v = Math.min(this._columnLineWidth, c);
            if (d.isVisible()) {
                var _ = this._cellPool.get();
                h = _.style;
                h.position = "absolute";
                h.whiteSpace = "nowrap";
                h.verticalAlign = "middle";
                h.textAlign = d.getHorizontalAlign();
                h.overflow = "hidden";
                h.textOverflow = "ellipsis";
                h.left = r + "px";
                h.width = c - v + "px";
                h.height = a;
                h.borderStyle = "solid";
                h.borderWidth = "0px";
                h.borderRightWidth = v + "px";
                h.borderRightColor = this._columnLineColor;
                t.appendChild(_);
                var u = {data: e, value: this.getValue(e, d), div: _, view: this, column: d, rowIndex: i, selected: s};
                this.renderCell(u);
                this.onCellRendered(u);
                r += c
            }
        }
        h = t.style;
        h.width = r + "px";
        h.height = a;
        h.backgroundColor = this.isCheckMode() && this._focusedRow === i || !this.isCheckMode() && s ? this.getSelectColor(e) : ""
    }, adjustRowSize: function () {
    }, onCellRendered: function (t) {
    }, getCurrentSortFunction: function () {
        var t = this._sortColumn;
        if (t) {
            var e = t.getSortFunction();
            if (e) {
                var i = this;
                var s = "asc" === t.getSortDirection() ? 1 : -1;
                return function (n, o) {
                    var r = i.getValue(n, t);
                    var a = i.getValue(o, t);
                    return e.call(i, r, a, n, o) * s
                }
            }
        }
        return this._sortFunction
    }, renderCell: function (t) {
        var e = t.column;
        if (e.renderCell) {
            e.renderCell(t);
            return
        }
        var i = t.value;
        var s = e.getEnumInfo();
        if (s && s.values) {
            i = s.map[i]
        }
        if (t.view.isCellEditable(t.data, e)) {
            t.enumInfo = s;
            t.div._editInfo = t
        }
        a.render(e.getValueType(), i, t.div, t.view, e.isInnerText())
    }, getValue: function (t, e) {
        return e.getValue(t, this)
    }, setValue: function (t, e, i) {
        e.setValue(t, i, this)
    }, getColumnAt: function (t) {
        var e = this.getLogicalPoint(t);
        if (!e) {
            return null
        }
        var i = this._columnBox.getRoots();
        for (var s = 0, n = i.size(), o = 0; s < n; s++) {
            var r = i.get(s);
            var a = r.getWidth();
            if (a < 0)a = 0;
            if (e.x > o && e.x < o + a) {
                return r
            }
            o += a
        }
        return null
    }, isCellEditable: function (t, e) {
        return this.isEditable() && e.isEditable()
    }, commitEditValue: function (t, e) {
        if (this._isCanceling) {
            return
        }
        var i;
        if (e.type === "checkbox") {
            i = e.checked
        } else {
            i = e.value
        }
        var s = t.column;
        var n = s.getValueType();
        if (n === "int" && typeof i === "string") {
            i = parseInt(i)
        } else if (n === "number" && typeof i === "string") {
            i = parseFloat(i)
        }
        this.setValue(t.data, s, i);
        if (this._currentEditor) {
            var o = this._currentEditor;
            delete this._currentEditor;
            this._rootDiv.removeChild(o);
            twaver.Util.setFocus(this._view)
        }
        delete this._isCommitting
    }, cancelEditing: function () {
        if (this._currentEditor) {
            this._isCanceling = true;
            var t = this._currentEditor;
            delete this._currentEditor;
            this._rootDiv.removeChild(t);
            twaver.Util.setFocus(this._view);
            delete this._isCanceling
        }
    }, updateCurrentEditor: function (t) {
        var e = t.target;
        if (e === this._currentEditor || e.parentNode === this._currentEditor) {
            return
        }
        var i;
        while (e && e !== this._view && !(i = e._editInfo)) {
            e = e.parentNode
        }
        if (i && e === i.div) {
            if (i.enumInfo) {
                this._currentEditor = n.createSelect(i.enumInfo, i.value)
            } else {
                this._currentEditor = document.createElement("input");
                if (i.value != null) {
                    this._currentEditor.value = i.value
                }
            }
            if (this._currentEditor) {
                this._currentEditor.addEventListener("keydown", function (t) {
                    var e = t.target._editInfo.view;
                    if (t.keyCode === 13) {
                        e.commitEditValue(t.target._editInfo, t.target)
                    } else if (t.keyCode === 27) {
                        e.cancelEditing()
                    }
                }, false);
                self = this;
                this._currentEditor.addEventListener("blur", function (t) {
                    var e = t.target._editInfo.view;
                    if (e._isCanceling) {
                        return
                    }
                    e.commitEditValue(t.target._editInfo, t.target)
                }, false);
                this._currentEditor.keepDefault = true;
                this._currentEditor._editInfo = i;
                var s = this._currentEditor.style;
                s.position = "absolute";
                s.margin = "0px";
                s.border = "0px";
                s.padding = "0px";
                s.left = i.div.style.left;
                s.top = i.div.parentNode.style.top;
                s.width = i.div.style.width;
                s.height = i.div.style.height;
                this._rootDiv.appendChild(this._currentEditor);
                twaver.Util.setFocus(this._currentEditor)
            }
        }
    }, onColumnSorted: function (t) {
    }, getCurrentEditor: function () {
        return this._currentEditor
    }});
    twaver.controls.List = function (t) {
        twaver.controls.List.superClass.constructor.apply(this, arguments)
    };
    _twaver.ext("twaver.controls.List", twaver.controls.ListBase, {__accessor: ["rowHeight", "indent", "rowLineWidth", "rowLineColor", "sortFunction", "visibleFunction"], __bool: ["makeVisibleOnSelected", "keyboardRemoveEnabled", "keyboardSelectEnabled"], _checkMode: false, _rowHeight: c.LIST_ROW_HEIGHT, _indent: c.LIST_INDENT, _rowLineWidth: c.LIST_ROW_LINE_WIDTH, _rowLineColor: c.LIST_ROW_LINE_COLOR, _makeVisibleOnSelected: c.LIST_MAKE_VISIBLE_ON_SELECTED, _keyboardRemoveEnabled: c.LIST_KEYBOARD_REMOVE_ENABLED, _keyboardSelectEnabled: c.LIST_KEYBOARD_SELECT_ENABLED, isCheckMode: function () {
        return this._checkMode
    }, setCheckMode: function (t) {
        delete this._focusedRow;
        var e = this._checkMode;
        this._checkMode = t;
        this.firePropertyChange("checkMode", e, t)
    }, isCheckable: function (t) {
        return this._checkMode === true
    }, renderData: function (t, e, i, s) {
        var n;
        if (this._indent > 0) {
            n = this.__spanPool.get();
            n.style.width = this._indent + "px";
            n.style.display = "inline-block";
            t.appendChild(n)
        }
        var o = this.isCheckable(e);
        if (o) {
            this._addCheckBox(t, e, s)
        }
        var r = this.getIcon(e);
        if (r) {
            this._addIcon(t, e, r)
        }
        var a = this.getLabel(e);
        if (a) {
            n = this.__textPool.get();
            var h = n.style;
            h.whiteSpace = "nowrap";
            h.verticalAlign = "middle";
            h.padding = "1px 2px 1px 2px";
            h.display = "inline-block";
            _twaver.setText(n, a, this._innerText);
            this.onLabelRendered(n, e, a, i, s);
            t.appendChild(n)
        }
        if (this.isCheckMode()) {
            t.style.backgroundColor = this._focusedRow === i ? this.getSelectColor(e) : ""
        } else {
            t.style.backgroundColor = s ? this.getSelectColor(e) : ""
        }
    }, onLabelRendered: function (t, e, i, s, n) {
    }});
    twaver.controls.ListBaseInteraction = function (t) {
        this.listBase = t;
        this.view = t._view;
        var e = this;
        this.view.addEventListener("scroll", function (t) {
            e.handleScroll(t)
        }, false);
        this.view.addEventListener("mousedown", function (t) {
            e.handleMouseDown(t)
        }, false);
        this.view.addEventListener("keydown", function (t) {
            e.handleKeyDown(t)
        }, false)
    };
    _twaver.ext("twaver.controls.ListBaseInteraction", Object, {handleMouseDown: function (t) {
        var e = this.listBase;
        if (t.target === e._currentEditor || t.target.parentNode === e._currentEditor) {
            return
        }
        e._handleClick(t)
    }, handleKeyDown: function (t) {
        var e = this.listBase;
        if (e._currentEditor) {
            return
        }
        if (_twaver.isCtrlDown(t) && t.keyCode == 65) {
            if (e.isKeyboardSelectEnabled() && e.selectAll().size() > 0) {
                e.fireInteractionEvent({kind: "selectAll"})
            }
            n.preventDefault(t)
        } else if (t.keyCode == 46) {
            if (e.isKeyboardRemoveEnabled() && e.removeSelection()) {
                e.fireInteractionEvent({kind: "removeElement"})
            }
            n.preventDefault(t)
        } else if (!e.isCheckMode() && (t.keyCode === 38 || t.keyCode === 40 || t.keyCode === 37 || t.keyCode === 39)) {
            var i = e.getSelectionModel().getLastData();
            if (i) {
                if (t.keyCode === 38 || t.keyCode === 40) {
                    var s = e.getRowDatas();
                    var o = e.getRowIndexByData(i);
                    if (o >= 0) {
                        if (t.keyCode === 38) {
                            if (o !== 0) {
                                i = s.get(o - 1);
                                e.getSelectionModel().setSelection(i)
                            }
                        } else {
                            if (o !== s.size() - 1) {
                                i = s.get(o + 1);
                                e.getSelectionModel().setSelection(i)
                            }
                        }
                    }
                } else if (e.expand && (t.keyCode === 37 || t.keyCode === 39)) {
                    if (i.hasChildren()) {
                        if (t.keyCode === 37) {
                            e.collapse(i)
                        } else {
                            e.expand(i)
                        }
                    }
                }
            } else {
                if (e.getRowDatas().size() > 0) {
                    i = e.getRowDatas().get(0);
                    e.getSelectionModel().setSelection(i)
                }
            }
        } else {
            _twaver.showVersion(t)
        }
    }, handleScroll: function (t) {
        this.listBase.invalidate()
    }});
    twaver.controls.ListBaseTouchInteraction = function (t) {
        this.listBase = t;
        this.view = t._view;
        n.addEventListener("touchstart", "handleTouchstart", this.view, this)
    };
    _twaver.ext("twaver.controls.ListBaseTouchInteraction", Object, {handleTouchstart: function (t) {
        n.preventDefault(t);
        this.lastPoint = this.listBase.getLogicalPoint(t);
        n.addEventListener("touchmove", "handleTouchmove", this.view, this);
        n.addEventListener("touchend", "handleTouchend", this.view, this);
        if (h.isMultiTouch(t)) {
            this.distance = h.getDistance(t);
            this.zoom = this.listBase._zoom
        }
    }, handleTouchmove: function (t) {
        n.preventDefault(t);
        if (!this.moved) {
            this.moved = true
        }
        if (h.isSingleTouch(t)) {
            if (this.lastPoint) {
                var e = this.listBase.getLogicalPoint(t);
                var i = this.lastPoint.x - e.x;
                var s = this.lastPoint.y - e.y;
                var o = this.listBase.panByOffset(i, s);
                this.listBase.invalidate();
                this.lastPoint.x -= i - o.x;
                this.lastPoint.y -= s - o.y
            }
        } else {
            if (this.distance) {
                var r = h.getDistance(t) / this.distance;
                this.listBase.setZoom(this.zoom * r, false)
            }
        }
    }, handleTouchend: function (t) {
        n.preventDefault(t);
        if (!this.moved && t.target !== this.listBase._currentEditor && t.target.parentNode !== this.listBase._currentEditor) {
            this.listBase._handleClick(t)
        }
        delete this.lastPoint;
        delete this.moved;
        delete this.distance;
        delete this.zoom;
        n.removeEventListener("touchmove", this.view, this);
        n.removeEventListener("touchend", this.view, this)
    }});
    twaver.controls.ListBaseMSTouchInteraction = function (t) {
        twaver.controls.ListBaseMSTouchInteraction.superClass.constructor.apply(this, arguments);
        this._pointerMap = {};
        this._pointerIdArray = [];
        var e = this;
        this.view.addEventListener("MSPointerDown", function (t) {
            e.handleTouchstart(t)
        }, false);
        this.view.addEventListener("MSPointerMove", function (t) {
            e.handleTouchmove(t)
        }, false);
        this.view.addEventListener("MSPointerUp", function (t) {
            e.handleTouchend(t)
        }, false);
        this.view.addEventListener("MSPointerCancel", function (t) {
            e.handleTouchend(t)
        }, false);
        this.superHandleMouseDown = twaver.controls.ListBaseMSTouchInteraction.superClass.handleMouseDown
    };
    _twaver.ext("twaver.controls.ListBaseMSTouchInteraction", twaver.controls.ListBaseInteraction, {handleMouseDown: function (t) {
    }, handleTouchstart: function (t) {
        if (t.isPrimary && this._pointerIdArray.length > 0) {
            this._pointerMap = {};
            this._pointerIdArray = []
        }
        if (!this._pointerMap[t.pointerId] && this.listBase.getLogicalPoint(t) != null) {
            this._pointerIdArray.push(t.pointerId);
            this._pointerMap[t.pointerId] = t
        }
        if (this._pointerIdArray.length == 1 && t.pointerType == t.MSPOINTER_TYPE_MOUSE) {
            this.superHandleMouseDown(t)
        }
        if (this._pointerIdArray.length == 1) {
            this._startTouchPoint = this.listBase.getLogicalPoint(t);
            this._startTouchTime = new Date
        } else if (this._pointerIdArray.length == 2) {
            this._distance = this._getDistance();
            this._zoom = this.listBase.getZoom()
        }
    }, handleTouchmove: function (t) {
        if (this._startTouchPoint == null || this._pointerIdArray.length == 0 || !this._pointerMap[t.pointerId] || o.getDistance({x: this._pointerMap[t.pointerId].pageX, y: this._pointerMap[t.pointerId].pageY}, {x: t.pageX, y: t.pageY}) <= 10) {
            return
        }
        this._pointerMap[t.pointerId] = t;
        if (this._pointerIdArray.length == 2) {
            var e = this._getDistance() / this._distance;
            this.listBase.setZoom(this._zoom * e, false)
        } else if (this._pointerIdArray.length == 1 && t.pointerType != t.MSPOINTER_TYPE_MOUSE) {
            if (this._startTouchPoint) {
                var i = this.listBase.getLogicalPoint(t);
                if (i == null) {
                    return
                }
                var s = this._startTouchPoint.x - i.x;
                var n = this._startTouchPoint.y - i.y;
                var r = this.listBase.panByOffset(s, n);
                this.listBase.invalidate();
                this._startTouchPoint.x -= s - r.x;
                this._startTouchPoint.y -= n - r.y
            }
        }
    }, handleTouchend: function (t) {
        if (this._startTouchPoint && this._pointerIdArray.length == 1 && t.pointerType != t.MSPOINTER_TYPE_MOUSE) {
            var e = this.listBase.getLogicalPoint(t);
            if (e) {
                var i = new Date;
                if (i.getTime() - this._startTouchTime.getTime() <= 500 && o.getDistance(this._startTouchPoint, e) <= 20) {
                    this.superHandleMouseDown(t)
                }
            }
        }
        this._pointerMap = {};
        this._pointerIdArray = []
    }, _getDistance: function () {
        return o.getDistance({x: this._pointerMap[this._pointerIdArray[0]].pageX, y: this._pointerMap[this._pointerIdArray[0]].pageY}, {x: this._pointerMap[this._pointerIdArray[1]].pageX, y: this._pointerMap[this._pointerIdArray[1]].pageY})
    }});
    twaver.controls.Tree = function (t) {
        this._interactionDispatcher = new twaver.EventDispatcher;
        this._initTree(t);
        twaver.controls.Tree.superClass.constructor.apply(this, arguments)
    };
    _twaver.ext("twaver.controls.Tree", twaver.controls.ListBase, {__tree: 1, __accessor: ["rootData", "sortFunction", "visibleFunction", "indent", "rowHeight", "rowLineWidth", "rowLineColor", "expandIcon", "collapseIcon", "uncheckableStyle"], __bool: ["rootVisible", "makeVisibleOnSelected", "keyboardRemoveEnabled", "keyboardSelectEnabled"], _checkMode: false, _indent: c.TREE_INDENT, _rowHeight: c.TREE_ROW_HEIGHT, _rowLineWidth: c.TREE_ROW_LINE_WIDTH, _rowLineColor: c.TREE_ROW_LINE_COLOR, _makeVisibleOnSelected: c.TREE_MAKE_VISIBLE_ON_SELECTED, _keyboardRemoveEnabled: c.TREE_KEYBOARD_REMOVE_ENABLED, _keyboardSelectEnabled: c.TREE_KEYBOARD_SELECT_ENABLED, _expandIcon: c.TREE_EXPAND_ICON, _collapseIcon: c.TREE_COLLAPSE_ICON, _uncheckableStyle: "none", getCheckMode: function () {
        return this._checkMode
    }, setCheckMode: function (t) {
        delete this._focusedRow;
        var e = this._checkMode;
        this._checkMode = t;
        this.firePropertyChange("checkMode", e, t)
    }, renderData: function (t, e, i, s) {
        this._renderTree(t, e, i, s)
    }});
    twaver.controls.Table = function (t) {
        this._checkColumn = new twaver.Column;
        this._checkColumn.setName("check");
        this._checkColumn.setEditable(true);
        this._checkColumn.setWidth(40);
        this._checkColumn.setHorizontalAlign("center");
        this._checkColumn.renderCell = this.renderCheckCell;
        var e = this;
        this._checkColumn.getValue = function (t, i) {
            return e.isSelected(t)
        };
        twaver.controls.Table.superClass.constructor.apply(this, arguments)
    };
    _twaver.ext("twaver.controls.Table", twaver.controls.TableBase, {__accessor: ["rowHeight", "rowLineWidth", "rowLineColor", "columnLineWidth", "columnLineColor", "sortFunction", "visibleFunction", "sortColumn"], __bool: ["editable", "makeVisibleOnSelected", "keyboardRemoveEnabled", "keyboardSelectEnabled"], _editable: c.TABLE_EDITABLE, _rowHeight: c.TABLE_ROW_HEIGHT, _rowLineWidth: c.TABLE_ROW_LINE_WIDTH, _rowLineColor: c.TABLE_ROW_LINE_COLOR, _columnLineWidth: c.TABLE_COLUMN_LINE_WIDTH, _columnLineColor: c.TABLE_COLUMN_LINE_COLOR, _makeVisibleOnSelected: c.TABLE_MAKE_VISIBLE_ON_SELECTED, _keyboardRemoveEnabled: c.TABLE_KEYBOARD_REMOVE_ENABLED, _keyboardSelectEnabled: c.TABLE_KEYBOARD_SELECT_ENABLED, getCheckColumn: function () {
        return this._checkColumn
    }, isCheckMode: function () {
        return this._columnBox.contains(this._checkColumn)
    }, setCheckMode: function (t) {
        if (t === this.isCheckMode()) {
            return
        }
        delete this._focusedRow;
        if (t) {
            this._columnBox.add(this._checkColumn, 0)
        } else {
            this._columnBox.remove(this._checkColumn)
        }
        this.firePropertyChange("checkMode", !t, t)
    }, renderCheckCell: function (t) {
        var e = t.view._booleanPool.get();
        e.disabled = false;
        e.type = "checkbox";
        e.style.margin = "0px 2px";
        e.style.verticalAlign = "middle";
        e.checked = t.selected;
        var i = t.div;
        i.appendChild(e);
        if (i.style.textAlign === "") {
            i.style.textAlign = "center"
        }
        e._checkData = t.data
    }});
    twaver.controls.TableHeader = function (t) {
        twaver.controls.TableHeader.superClass.constructor.apply(this, arguments);
        this._invalidateScroll = false;
        this._invalidateDisplay = false;
        this._divPool = new twaver.Pool("div");
        this._imagePool = new twaver.Pool("img");
        this._textPool = new twaver.Pool("span");
        this._resizePool = new twaver.Pool("div");
        this._pools.add(this._divPool);
        this._pools.add(this._imagePool);
        this._pools.add(this._textPool);
        this._pools.add(this._resizePool);
        this._table = t;
        this._tableView = t.getView();
        this._columnBox = t.getColumnBox();
        this._columnBox.addDataBoxChangeListener(this.handleColumnBoxChange, this);
        this._columnBox.addDataPropertyChangeListener(this.handleColumnPropertyChange, this);
        this._columnBox.addHierarchyChangeListener(this.handleColumnHierarchyChange, this);
        var e = this;
        t.getView().addEventListener("scroll", function (t) {
            e.invalidateScroll()
        }, false);
        t.addPropertyChangeListener(function (t) {
            e.invalidateDisplay()
        }, this);
        this._view = n.createView("hidden");
        this._view.tabIndex = -1;
        this._view.style.background = c.TABLEHEADER_BACKGROUND;
        this._rootDiv = n.createDiv();
        this._view.appendChild(this._rootDiv);
        this.invalidateDisplay();
        var i;
        if (l.isTouchable && !l.isMSToucheable) {
            i = twaver.controls.TableHeaderTouchInteraction
        } else {
            i = twaver.controls.TableHeaderInteraction
        }
        if (i) {
            new i(this)
        }
    };
    _twaver.ext("twaver.controls.TableHeader", twaver.controls.ControlBase, {__accessor: ["height", "moveBackground", "insertBackground", "columnLineColor", "resizeTolerance", "sortDescIcon", "sortAscIcon", "sortIconPosition"], _height: c.TABLEHEADER_HEIGHT, _moveBackground: c.TABLEHEADER_MOVE_BACKGROUND, _insertBackground: c.TABLEHEADER_INSERT_BACKGROUND, _columnLineColor: c.TABLEHEADER_COLUMN_LINE_COLOR, _resizeTolerance: c.TABLEHEADER_RESIZE_TOLERANCE, _sortDescIcon: c.TABLEHEADER_SORT_DESC_ICON, _sortAscIcon: c.TABLEHEADER_SORT_ASC_ICON, _sortIconPosition: c.TABLEHEADER_SORT_ICON_POSITION, getRootDiv: function () {
        return this._rootDiv
    }, handleColumnBoxChange: function (t) {
        this.invalidateDisplay()
    }, handleColumnPropertyChange: function (t) {
        this.invalidateDisplay()
    }, handleColumnHierarchyChange: function (t) {
        this.invalidateDisplay()
    }, onPropertyChanged: function (t) {
        this.invalidateDisplay()
    }, invalidateScroll: function () {
        if (this._invalidateScroll) {
            return
        }
        this._invalidateScroll = true;
        this.invalidate()
    }, invalidateDisplay: function () {
        if (this._invalidateDisplay) {
            return
        }
        this._invalidateDisplay = true;
        this._invalidateScroll = true;
        this.invalidate()
    }, validate: function () {
        if (!this._invalidate) {
            return
        }
        this._invalidate = false;
        if (this._invalidateDisplay) {
            this._invalidateDisplay = false;
            this.validateDisplay()
        }
        if (this._invalidateScroll) {
            this._invalidateScroll = false;
            this._rootDiv.style.left = -this._tableView.scrollLeft + "px"
        }
    }, validateDisplay: function () {
        n.release(this._rootDiv);
        var t = this._table.getZoom();
        var e = this.getHeight() + "px";
        var i = this.getHeight() - 2 + "px";
        var s = this._table.getColumnBox().getRoots();
        var o = s.size();
        var r = 0;
        var a = this._table._columnLineWidth * t;
        for (var h = 0; h < o; h++) {
            var l = s.get(h);
            if (l.isVisible()) {
                var d = l.getWidth() * t;
                if (d < 0)d = 0;
                var c = Math.min(a, d);
                var v = this._divPool.get();
                v._column = l;
                var _ = v.style;
                _.position = "absolute";
                _.whiteSpace = "nowrap";
                _.lineHeight = i;
                _.overflow = "hidden";
                _.textOverflow = "ellipsis";
                _.backgroundPosition = this._sortIconPosition ? this._sortIconPosition : "";
                _.backgroundRepeat = "no-repeat";
                _.backgroundImage = "";
                _.textAlign = l.getHorizontalAlign();
                _.borderStyle = "solid";
                _.borderWidth = "0px";
                _.borderRightWidth = c + "px";
                _.borderRightColor = this._columnLineColor;
                _.left = r + "px";
                _.width = d - c + "px";
                _.height = e;
                v._x = r;
                v._width = d - c;
                this._rootDiv.insertBefore(v, this._rootDiv.firstChild);
                this.renderColumn(v, l);
                this.onColumnRendered(v, l);
                r += d;
                if (l.isResizable()) {
                    v = this._resizePool.get();
                    v._resizeColumn = l;
                    _ = v.style;
                    _.position = "absolute";
                    _.backgroundColor = "white";
                    _.opacity = 0;
                    _.left = r - c - this._resizeTolerance + "px";
                    _.width = c + this._resizeTolerance * 2 + "px";
                    _.height = e;
                    this._rootDiv.appendChild(v)
                }
            }
        }
        this._pools.forEach(function (t) {
            t.clear()
        });
        this._rootDiv.style.width = r + "px";
        this._rootDiv.style.height = e
    }, renderColumn: function (t, e) {
        if (e.renderHeader) {
            e.renderHeader(t)
        } else {
            var i = this._textPool.get();
            i.style.whiteSpace = "nowrap";
            i.style.verticalAlign = "middle";
            i.style.padding = "1px 2px 1px 2px";
            i.innerHTML = e.getName() ? e.getName() : e.getPropertyName();
            i.setAttribute("title", i.innerHTML);
            t.appendChild(i);
            if (l.isOpera) {
                var s = t.cloneNode(false);
                s.style.left = "0px";
                s.style.top = "0px";
                s.style.opacity = 0;
                t.appendChild(s)
            }
        }
        if (this._table.getSortColumn() === e && e.isSortable()) {
            var n = e.getSortDirection() === "asc" ? this._sortAscIcon : this._sortDescIcon;
            var o = _twaver.getImageSrc(n);
            if (!this._sortIconPosition || this._sortIconPosition === "") {
                var r = this._imagePool.get();
                r.setAttribute("src", o);
                r.style.verticalAlign = "middle";
                t.appendChild(r)
            } else {
                t.style.backgroundImage = "url(" + o + ")"
            }
        }
    }, onColumnRendered: function (t, e) {
    }});
    twaver.controls.TableHeaderInteraction = function (t) {
        this.header = t;
        this.table = t._table;
        this.view = t._view;
        var e = this;
        this.view.addEventListener("mousedown", function (t) {
            e.handleMouseDown(t)
        }, false);
        this.view.addEventListener("mousemove", function (t) {
            e.handleMouseMove(t)
        }, false)
    };
    _twaver.ext("twaver.controls.TableHeaderInteraction", Object, {handleMouseDown: function (t) {
        if (t.button !== 0) {
            return
        }
        if (this.movableDiv) {
            this.handleMouseUp(t);
            return
        }
        this.resizeColumn = t.target._resizeColumn;
        if (!this.resizeColumn) {
            this.movableDiv = this.getMovableDivAt(t)
        }
        this.changeCursor(t);
        this._startClient = n.getClientPoint(t);
        this.lastX = this.getX(t);
        this._startLogicalX = this.lastX;
        n.handle_mousedown(this, t)
    }, changeCursor: function (t) {
        var e = "";
        if (t.target._resizeColumn) {
            e = "ew-resize"
        } else {
            var i = this.getColumnAt(t);
            if (i && (i.isMovable() || i.isSortable())) {
                e = "pointer"
            }
        }
        this.view.style.cursor = e
    }, handleMouseMove: function (t) {
        if (this.lastX == null) {
            this.changeCursor(t);
            return
        }
        if (n.target !== this) {
            return
        }
        var e = this._startLogicalX + t.clientX - this._startClient.x;
        if (this.resizeColumn) {
            if (this.stopX != null) {
                if (e < this.stopX) {
                    return
                } else {
                    delete this.stopX
                }
            }
            var i = this.resizeColumn.getWidth() + (e - this.lastX) / this.table.getZoom();
            if (i < 10) {
                i = 10;
                this.stopX = e
            }
            this.resizeColumn.setWidth(i);
            this.lastX = e
        } else if (this.movableDiv) {
            var s = e - this.lastX;
            if (!this.cloneDiv) {
                if (Math.abs(s) < 3) {
                    return
                }
                this.cloneDiv = this.movableDiv.cloneNode(true);
                this.cloneDiv._x = this.movableDiv._x;
                this.cloneDiv.style.background = this.header.getMoveBackground();
                this.insertDiv = n.createDiv();
                this.insertDiv.style.width = "1px";
                this.insertDiv.style.height = this.cloneDiv.style.height;
                this.insertDiv.style.background = this.header.getInsertBackground();
                this.movableDiv.parentNode.appendChild(this.cloneDiv);
                this.movableDiv.parentNode.appendChild(this.insertDiv)
            }
            var o = this.cloneDiv._x + s;
            this.cloneDiv.style.left = o + "px";
            this.cloneDiv._x = o;
            this.lastX = e;
            this.columnInfo = this.getColumnInfoAt(t);
            if (this.columnInfo) {
                this.insertDiv.style.left = this.columnInfo.position
            }
        }
    }, handleMouseUp: function (t) {
        if (t.button !== 0) {
            return
        }
        var e;
        if (this.resizeColumn) {
        } else if (this.movableDiv && this.columnInfo) {
            e = this.movableDiv._column;
            var i = this.columnInfo.index;
            this.table.getColumnBox().moveTo(e, i)
        } else {
            e = this.getColumnAt(t);
            if (e && e.isSortable()) {
                var s = e.getSortDirection();
                if (this.table.getSortColumn() === e) {
                    if (s === "desc") {
                        this.table.setSortColumn(null)
                    }
                    e.setSortDirection(s === "asc" ? "desc" : "asc")
                } else {
                    this.table.setSortColumn(e)
                }
                this.table.onColumnSorted(this.table.getSortColumn())
            }
        }
        this.clear()
    }, clear: function () {
        this.view.style.cursor = "";
        if (this.cloneDiv && this.movableDiv) {
            this.movableDiv.parentNode.removeChild(this.cloneDiv)
        }
        if (this.insertDiv && this.movableDiv) {
            this.movableDiv.parentNode.removeChild(this.insertDiv)
        }
        delete this.movableDiv;
        delete this.columnInfo;
        delete this.insertDiv;
        delete this.cloneDiv;
        delete this.resizeColumn;
        delete this.stopX;
        delete this.lastX;
        delete this._startClient;
        delete this._startLogicalX
    }, getColumnAt: function (t) {
        t = t.target;
        var e;
        while (t && t !== this.view && !(e = t._column)) {
            t = t.parentNode
        }
        return e
    }, getMovableDivAt: function (t) {
        t = t.target;
        var e;
        while (t && t !== this.view && !(e = t._column)) {
            t = t.parentNode
        }
        if (e && e.isMovable()) {
            return t
        }
        return null
    }, getX: function (t) {
        var e = n.getLogicalPoint(this.view, t);
        return e ? e.x : null
    }, getColumnInfoAt: function (t) {
        var e = this._startLogicalX + t.clientX - this._startClient.x + this.table.getView().scrollLeft;
        var i = this.table.getColumnBox().getRoots();
        var s = i.size();
        var n = this.table.getZoom();
        var o = 0;
        var r = false;
        for (var a = 0; a < s; a++) {
            var h = i.get(a);
            if (h === this.movableDiv._column) {
                r = true
            }
            if (h.isVisible()) {
                var l = h.getWidth() * n;
                if (l <= 0) {
                    continue
                }
                if (e >= o && e <= o + l) {
                    var d = e < o + l / 2;
                    if (r && !(h === this.movableDiv._column && d)) {
                        a--
                    }
                    var c = d ? Math.max(0, a) : Math.min(a + 1, s);
                    var v = d ? o : o + l;
                    v = Math.max(0, v - 1);
                    return{index: c, column: h, position: v + "px"}
                }
                o += l
            }
        }
        return this.columnInfo
    }});
    twaver.controls.TableHeaderTouchInteraction = function (t) {
        this.header = t;
        this.table = t._table;
        this.view = t._view;
        n.addEventListener("touchstart", "handleTouchstart", this.view, this)
    };
    _twaver.ext("twaver.controls.TableHeaderTouchInteraction", Object, {handleTouchstart: function (t) {
        n.preventDefault(t);
        if (this.movableDiv) {
            this.handleTouchend(t);
            return
        }
        this.resizeColumn = t.target._resizeColumn;
        if (!this.resizeColumn) {
            this.movableDiv = this.getMovableDivAt(t)
        }
        this.lastX = this.getX(t);
        n.addEventListener("touchmove", "handleTouchmove", this.view, this);
        n.addEventListener("touchend", "handleTouchend", this.view, this)
    }, handleTouchmove: function (t) {
        n.preventDefault(t);
        if (this.lastX == null) {
            return
        }
        var e;
        if (this.resizeColumn) {
            e = this.getX(t);
            if (this.stopX != null) {
                if (e < this.stopX) {
                    return
                } else {
                    delete this.stopX
                }
            }
            var i = this.resizeColumn.getWidth() + (e - this.lastX) / this.table.getZoom();
            if (i < 0) {
                i = 0;
                this.stopX = e
            }
            this.resizeColumn.setWidth(i);
            this.lastX = e
        } else if (this.movableDiv) {
            e = this.getX(t);
            var s = e - this.lastX;
            if (!this.cloneDiv) {
                if (Math.abs(s) < 3) {
                    return
                }
                this.cloneDiv = this.movableDiv.cloneNode(true);
                this.cloneDiv._x = this.movableDiv._x;
                this.cloneDiv.style.background = this.header.getMoveBackground();
                this.insertDiv = n.createDiv();
                this.insertDiv.style.width = "1px";
                this.insertDiv.style.height = this.cloneDiv.style.height;
                this.insertDiv.style.background = this.header.getInsertBackground();
                this.movableDiv.parentNode.appendChild(this.cloneDiv);
                this.movableDiv.parentNode.appendChild(this.insertDiv)
            }
            var o = this.cloneDiv._x + s;
            this.cloneDiv.style.left = o + "px";
            this.cloneDiv._x = o;
            this.lastX = e;
            this.columnInfo = this.getColumnInfoAt(t);
            if (this.columnInfo) {
                this.insertDiv.style.left = this.columnInfo.position
            }
        }
    }, handleTouchend: function (t) {
        n.preventDefault(t);
        var e;
        if (this.resizeColumn) {
        } else if (this.movableDiv && this.columnInfo) {
            e = this.movableDiv._column;
            var i = this.columnInfo.index;
            this.table.getColumnBox().moveTo(e, i)
        } else {
            e = this.getColumnAt(t);
            if (e && e.isSortable()) {
                var s = e.getSortDirection();
                if (this.table.getSortColumn() === e) {
                    if (s === "desc") {
                        this.table.setSortColumn(null)
                    }
                    e.setSortDirection(s === "asc" ? "desc" : "asc")
                } else {
                    this.table.setSortColumn(e)
                }
            }
        }
        this.clear();
        n.removeEventListener("touchmove", this.view, this);
        n.removeEventListener("touchend", this.view, this)
    }, clear: function () {
        if (this.cloneDiv && this.movableDiv) {
            this.movableDiv.parentNode.removeChild(this.cloneDiv)
        }
        if (this.insertDiv && this.movableDiv) {
            this.movableDiv.parentNode.removeChild(this.insertDiv)
        }
        delete this.movableDiv;
        delete this.columnInfo;
        delete this.insertDiv;
        delete this.cloneDiv;
        delete this.resizeColumn;
        delete this.stopX;
        delete this.lastX
    }, getColumnAt: function (t) {
        t = t.target;
        var e;
        while (t && t !== this.view && !(e = t._column)) {
            t = t.parentNode
        }
        return e
    }, getMovableDivAt: function (t) {
        t = t.target;
        var e;
        while (t && t !== this.view && !(e = t._column)) {
            t = t.parentNode
        }
        if (e && e.isMovable()) {
            return t
        }
        return null
    }, getX: function (t) {
        var e = n.getLogicalPoint(this.view, t);
        return e ? e.x : null
    }, getColumnInfoAt: function (t) {
        var e = this.getX(t) + this.table.getView().scrollLeft;
        var i = this.table.getColumnBox().getRoots();
        var s = i.size();
        var n = this.table.getZoom();
        var o = 0;
        var r = false;
        for (var a = 0; a < s; a++) {
            var h = i.get(a);
            if (h === this.movableDiv._column) {
                r = true
            }
            if (h.isVisible()) {
                var l = h.getWidth() * n;
                if (l <= 0) {
                    continue
                }
                if (e >= o && e <= o + l) {
                    var d = e < o + l / 2;
                    if (r && !(h === this.movableDiv._column && d)) {
                        a--
                    }
                    var c = d ? Math.max(0, a) : Math.min(a + 1, s);
                    var v = d ? o : o + l;
                    v = Math.max(0, v - 1);
                    return{index: c, column: h, position: v + "px"}
                }
                o += l
            }
        }
        return this.columnInfo
    }});
    twaver.controls.TablePane = function (t, e) {
        twaver.controls.TablePane.superClass.constructor.apply(this, arguments);
        this.invalidate();
        this._table = t;
        this._tableHeader = e ? e : new twaver.controls.TableHeader(t);
        this._view = n.createView("hidden");
        this._view.tabIndex = -1;
        this._view.appendChild(this._tableHeader.getView());
        this._view.appendChild(this._table.getView());
        var i = this;
        this._tableHeader.addPropertyChangeListener(function (t) {
            if (t.property === "height") {
                i.invalidate()
            }
        })
    };
    _twaver.ext("twaver.controls.TablePane", twaver.controls.ControlBase, {onPropertyChanged: function (t) {
        this.invalidate()
    }, getTable: function () {
        return this._table
    }, getTableHeader: function () {
        return this._tableHeader
    }, validateImpl: function () {
        var t = this._view.offsetWidth;
        var e = this._view.offsetHeight;
        var i = this._tableHeader.getHeight();
        this._tableHeader.adjustBounds({x: 0, y: 0, width: t, height: i});
        this._table.adjustBounds({x: 0, y: i, width: t, height: Math.max(0, e - i)})
    }});
    twaver.controls.TreeTable = function (t) {
        this._treeColumn = new twaver.Column;
        this._treeColumn.setName("tree");
        this._treeColumn.setWidth(120);
        this._treeColumn.renderCell = this.renderTreeCell;
        this._treeColumn.getValue = this.getTreeValue;
        this._treeColumn.setValue = this.setTreeValue;
        this._initTree(t);
        twaver.controls.TreeTable.superClass.constructor.apply(this, arguments);
        this._columnBox.add(this._treeColumn)
    };
    _twaver.ext("twaver.controls.TreeTable", twaver.controls.TableBase, {__tree: 1, __accessor: ["sortFunction", "visibleFunction", "checkMode", "rootData", "sortColumn", "indent", "rowHeight", "rowLineWidth", "rowLineColor", "columnLineWidth", "columnLineColor", "expandIcon", "collapseIcon", "uncheckableStyle"], __bool: ["editable", "rootVisible", "makeVisibleOnSelected", "keyboardRemoveEnabled", "keyboardSelectEnabled"], _editable: c.TREETABLE_EDITABLE, _indent: c.TREETABLE_INDENT, _rowHeight: c.TREETABLE_ROW_HEIGHT, _rowLineWidth: c.TREETABLE_ROW_LINE_WIDTH, _rowLineColor: c.TREETABLE_ROW_LINE_COLOR, _columnLineWidth: c.TREETABLE_COLUMN_LINE_WIDTH, _columnLineColor: c.TREETABLE_COLUMN_LINE_COLOR, _makeVisibleOnSelected: c.TREETABLE_MAKE_VISIBLE_ON_SELECTED, _keyboardRemoveEnabled: c.TREETABLE_KEYBOARD_REMOVE_ENABLED, _keyboardSelectEnabled: c.TREETABLE_KEYBOARD_SELECT_ENABLED, _expandIcon: c.TREETABLE_EXPAND_ICON, _collapseIcon: c.TREETABLE_COLLAPSE_ICON, getTreeColumn: function () {
        return this._treeColumn
    }, renderTreeCell: function (t) {
        t.view._renderTree(t.div, t.data, t.rowIndex, t.selected)
    }, getTreeValue: function (t, e) {
        return e.getLabel(t)
    }, setTreeValue: function (t, e, i) {
        t.setName(e)
    }});
    twaver.controls.PropertySheet = function (t) {
        twaver.controls.PropertySheet.superClass.constructor.apply(this, arguments);
        this._currentRowIndex = -1;
        this._currentEditor = null;
        this._currentData = null;
        this._invalidate = false;
        this._resizeDiv = n.createDiv();
        this._resizeDiv.style.backgroundColor = "white";
        this._resizeDiv.style.opacity = 0;
        this._resizeDiv.style.top = "0px";
        this._categoryList = new d;
        this._categoryMap = {};
        this._rowList = new d;
        this._propertyBox = new twaver.PropertyBox;
        this._propertyBox.addDataBoxChangeListener(this.invalidatePropertyBox, this);
        this._propertyBox.addDataPropertyChangeListener(this.invalidatePropertyBox, this);
        this._propertyBox.addHierarchyChangeListener(this.invalidatePropertyBox, this);
        this.__divPool = new twaver.Pool("div", 2);
        this.__cellPool = new twaver.Pool("div", 2);
        this.__imagePool = new twaver.Pool("img", 2);
        this.__textPool = new twaver.Pool("span", 2);
        this._stringPool = new twaver.Pool("span", 2);
        this._booleanPool = new twaver.Pool("input", 2);
        this._colorPool = new twaver.Pool("div", 2);
        this._pools.add(this.__divPool);
        this._pools.add(this.__cellPool);
        this._pools.add(this.__imagePool);
        this._pools.add(this.__textPool);
        this._pools.add(this._stringPool);
        this._pools.add(this._booleanPool);
        this._pools.add(this._colorPool);
        this._view = n.createView("auto");
        this._rootDiv = n.createDiv();
        this._dataDiv = n.createDiv();
        this._view.appendChild(this._rootDiv);
        this._rootDiv.appendChild(this._dataDiv);
        this.setDataBox(t ? t : new twaver.DataBox);
        var e = this;
        this._view.addEventListener("change", function (t) {
            e.handleChange(t)
        }, false);
        var i;
        if (l.isMSToucheable) {
            i = twaver.controls.PropertySheetMSTouchInteraction
        } else if (l.isTouchable) {
            i = twaver.controls.PropertySheetTouchInteraction
        } else {
            i = twaver.controls.PropertySheetInteraction
        }
        if (i) {
            new i(this)
        }
    };
    _twaver.ext("twaver.controls.PropertySheet", twaver.controls.View, {__accessor: ["indent", "rowHeight", "sumWidth", "propertyNameWidth", "propertyNameHorizontalAlign", "autoAdjustable", "rowLineWidth", "columnLineWidth", "borderColor", "categorizable", "resizeTolerance", "editable", "selectColor", "expandIcon", "collapseIcon", "sortFunction", "visibleFunction"], _autoAdjustable: c.PROPERTYSHEET_AUTO_ADJUSTABLE, _selectColor: c.SELECT_COLOR, _categorizable: c.PROPERTYSHEET_CATEGORIZABLE, _editable: c.PROPERTYSHEET_EDITABLE, _propertyNameWidth: c.PROPERTYSHEET_PROPERTY_NAME_WIDTH, _propertyNameHorizontalAlign: c.PROPERTYSHEET_PROPERTY_NAME_HORIZONTAL_ALIGN, _sumWidth: c.PROPERTYSHEET_SUM_WIDTH, _indent: c.PROPERTYSHEET_INDENT, _rowHeight: c.PROPERTYSHEET_ROW_HEIGHT, _rowLineWidth: c.PROPERTYSHEET_ROW_LINE_WIDTH, _columnLineWidth: c.PROPERTYSHEET_COLUMN_LINE_WIDTH, _borderColor: c.PROPERTYSHEET_BORDER_COLOR, _expandIcon: c.PROPERTYSHEET_EXPAND_ICON, _collapseIcon: c.PROPERTYSHEET_COLLAPSE_ICON, _resizeTolerance: c.PROPERTYSHEET_RESIZE_TOLERANCE, getPropertyBox: function () {
        return this._propertyBox
    }, getCurrentData: function () {
        return this._currentData
    }, getDataDiv: function () {
        return this._dataDiv
    }, getDataBox: function () {
        return this._box
    }, setDataBox: function (t) {
        if (!t) {
            throw"DataBox can not be null"
        }
        if (this._box === t) {
            return
        }
        var e = this._box;
        if (e) {
            e.removeDataPropertyChangeListener(this.handlePropertyChange, this);
            if (!this._selectionModel) {
                e.getSelectionModel().removeSelectionChangeListener(this.handleSelectionChange, this)
            }
        }
        this._box = t;
        this._box.addDataPropertyChangeListener(this.handlePropertyChange, this);
        if (this._selectionModel) {
            this._selectionModel._setDataBox(t)
        } else {
            this._box.getSelectionModel().addSelectionChangeListener(this.handleSelectionChange, this)
        }
        this.invalidate();
        this.firePropertyChange("dataBox", e, this._box)
    }, invalidatePropertyBox: function () {
        if (!this._isValidating) {
            this.invalidate()
        }
    }, onPropertyChanged: function (t) {
        if (t.property !== "zoom") {
            this.invalidate()
        }
    }, isVisible: function (t) {
        if (t.isVisible && !t.isVisible(this._currentData, this)) {
            return false
        }
        return this._visibleFunction ? this._visibleFunction(t) : true
    }, handlePropertyChange: function (t) {
        if (this._currentData === t.source) {
            this.invalidate()
        }
    }, handleSelectionChange: function (t) {
        if (this._currentData !== this.getSelectionModel().getLastData()) {
            this._currentRowIndex = -1;
            this.invalidate()
        }
    }, isExpanded: function (t) {
        if (!t) {
            return true
        }
        var e = this._categoryMap[t];
        return e ? e.isExpanded : c.PROPERTYSHEET_EXPAND_CATEGORY
    }, expand: function (t) {
        if (!t) {
            return
        }
        var e = this._categoryMap[t];
        if (!e || e.isExpanded) {
            return
        }
        e.isExpanded = true;
        this.invalidate()
    }, expandAll: function () {
        for (var t in this._categoryMap) {
            var e = this._categoryMap[t];
            if (e) {
                e.isExpanded = true
            }
        }
        this.invalidate()
    }, collapse: function (t) {
        if (!t) {
            return
        }
        var e = this._categoryMap[t];
        if (!e || !e.isExpanded) {
            return
        }
        e.isExpanded = false;
        this.invalidate()
    }, collapseAll: function () {
        for (var t in this._categoryMap) {
            var e = this._categoryMap[t];
            if (e) {
                e.isExpanded = false
            }
        }
        this.invalidate()
    }, getCategoryName: function (t) {
        if (!this.isCategorizable()) {
            return"null"
        }
        var e = t.getCategoryName();
        return e ? e : "null"
    }, validateModel: function () {
        this._rowList.clear();
        this._categoryList.clear();
        var t = {};
        var e = new d;
        var i = this._currentData ? this._propertyBox.getRoots() : new d;
        var s, n, o, r, a;
        r = i.size();
        for (s = 0; s < r; s++) {
            a = i.get(s);
            if (this.isVisible(a)) {
                e.add(a);
                o = this.getCategoryName(a);
                if (!t[o]) {
                    this._categoryList.add(o);
                    t[o] = {isExpanded: this.isExpanded(o), properties: new d}
                }
            }
        }
        if (this._sortFunction) {
            e.sort(this._sortFunction)
        }
        this._categoryMap = t;
        r = e.size();
        for (s = 0; s < this._categoryList.size(); s++) {
            o = this._categoryList.get(s);
            if (o !== "null") {
                this._rowList.add(o)
            }
            var h = t[o];
            if (h.isExpanded) {
                for (n = 0; n < r; n++) {
                    a = e.get(n);
                    if (this.getCategoryName(a) === o) {
                        h.properties.add(a);
                        this._rowList.add({view: this, data: this._currentData, property: a, value: this._currentData ? this.getValue(this._currentData, a) : null})
                    }
                }
            }
        }
    }, adjustWidth: function () {
        var t = this._view.offsetWidth;
        var e = this._view.offsetHeight;
        if (t <= this._indent || e <= 0) {
            return
        }
        t -= this._indent;
        if (this._rowList.size() * this._rowHeight > e) {
            t -= c.SCROLL_BAR_WIDTH;
            if (t <= 0) {
                return
            }
        }
        if (this._sumWidth === 0 || this._propertyNameWidth > this._sumWidth) {
            this._propertyNameWidth = t / 2
        } else {
            this._propertyNameWidth = t * (this._propertyNameWidth / this._sumWidth)
        }
        this._sumWidth = t;
        this._view.style.overflowX = "hidden";
        this._view.style.overflowY = "auto"
    }, validateDisplay: function () {
        var t = this._rowList.size();
        var e = this._borderColor;
        var i = this._indent;
        var s = this._rowHeight;
        var n = this._propertyNameWidth;
        var o = Math.max(0, this._sumWidth - n);
        var r = this._rowLineWidth;
        var a = this._columnLineWidth;
        var h = s - r + "px";
        var l = s - r - 2 + "px";
        var d = i + "px";
        var c = n - a + "px";
        var v = o - a + "px";
        var _ = n + o + "px";
        var u = r + "px";
        var f = a + "px";
        var p = n + "px";
        var g = this._dataDiv;
        var w = g.style;
        w.height = t * s + "px";
        w.width = i + n + o + "px";
        var m = this.__divPool.get();
        w = m.style;
        w.position = "absolute";
        w.left = "0px";
        w.top = "0px";
        w.width = d;
        w.height = g.style.height;
        w.borderWidth = "0px";
        w.backgroundColor = e;
        g.appendChild(m);
        for (var b = 0; b < t; b++) {
            var D = this._rowList.get(b);
            var C = b * s + "px";
            var E = this.__divPool.get();
            D.rowDiv = E;
            w = E.style;
            w.position = "absolute";
            w.whiteSpace = "nowrap";
            w.overflow = "hidden";
            w.textOverflow = "ellipsis";
            w.left = d;
            w.top = C;
            w.width = _;
            w.height = h;
            w.lineHeight = l;
            w.borderStyle = "solid";
            w.borderWidth = "0px";
            w.borderBottomWidth = u;
            w.borderBottomColor = e;
            g.appendChild(E);
            if (typeof D === "string") {
                w.backgroundColor = e;
                m = this.__divPool.get();
                w = m.style;
                w.position = "absolute";
                w.left = "0px";
                w.top = C;
                w.width = d;
                w.height = h;
                w.lineHeight = l;
                w.borderWidth = "0px";
                g.appendChild(m);
                var x = this.__imagePool.get();
                var T = this.isExpanded(D) ? this._expandIcon : this._collapseIcon;
                x.setAttribute("src", _twaver.getImageSrc(T));
                w = x.style;
                w.verticalAlign = "middle";
                x._expandData = D;
                m.appendChild(x);
                this.renderCategory(E, D);
                this.onCategoryRendered(E, D)
            } else {
                var y = D.property;
                var I = this.__cellPool.get();
                D.nameRender = I;
                w = I.style;
                if (this._currentRowIndex === b) {
                    w.backgroundColor = this.getSelectColor()
                }
                w.position = "absolute";
                w.verticalAlign = "middle";
                w.textAlign = this._propertyNameHorizontalAlign;
                w.overflow = "hidden";
                w.textOverflow = "ellipsis";
                w.whiteSpace = "nowrap";
                w.left = "0px";
                w.top = "0px";
                w.width = c;
                w.height = h;
                w.borderStyle = "solid";
                w.borderWidth = "0px";
                w.borderRightWidth = f;
                w.borderRightColor = e;
                E.appendChild(I);
                this.renderName(D);
                this.onNameRendered(D);
                I = this.__cellPool.get();
                D.valueRender = I;
                w = I.style;
                w.position = "absolute";
                w.verticalAlign = "middle";
                w.textAlign = y.getHorizontalAlign();
                w.whiteSpace = "nowrap";
                w.overflow = "hidden";
                w.textOverflow = "ellipsis";
                w.left = p;
                w.top = "0px";
                w.width = v;
                w.height = h;
                w.borderStyle = "solid";
                w.borderWidth = "0px";
                w.borderRightWidth = f;
                w.borderRightColor = e;
                E.appendChild(I);
                this.renderValue(D);
                this.onValueRendered(D)
            }
        }
        w = this._resizeDiv.style;
        w.left = i + n - a - this._resizeTolerance + "px";
        w.width = a + this._resizeTolerance * 2 + "px";
        w.height = g.style.height;
        g.appendChild(this._resizeDiv)
    }, renderCategory: function (t, e) {
        var i = this.__textPool.get();
        style = i.style;
        style.fontWeight = "bold";
        style.whiteSpace = "nowrap";
        style.overflow = "hidden";
        style.textOverflow = "ellipsis";
        style.verticalAlign = "middle";
        style.padding = "1px 2px 1px 2px";
        i.innerHTML = e;
        i.setAttribute("title", e);
        t.appendChild(i)
    }, onCategoryRendered: function (t, e) {
    }, renderName: function (t) {
        if (t.property.renderName) {
            t.property.renderName(t);
            return
        }
        var e = this.__textPool.get();
        style = e.style;
        style.fontWeight = "";
        style.whiteSpace = "nowrap";
        style.verticalAlign = "middle";
        style.padding = "1px 2px 1px 2px";
        var i = t.property.getName();
        if (!i) {
            i = t.property.getPropertyName()
        }
        e.innerHTML = i;
        e.setAttribute("title", i);
        t.nameRender.appendChild(e)
    }, onNameRendered: function (t) {
    }, renderValue: function (t) {
        var e = t.property;
        if (e.renderValue) {
            e.renderValue(t);
            return
        }
        var i = t.value;
        var s = e.getEnumInfo();
        if (s && s.values) {
            i = s.map[i]
        }
        if (t.view.isCellEditable(t.data, e)) {
            t.enumInfo = s;
            t.valueRender._editInfo = t
        }
        a.render(e.getValueType(), i, t.valueRender, t.view, e.isInnerText())
    }, onValueRendered: function (t) {
    }, updateCurrentData: function () {
        this._currentData = this.getSelectionModel().getLastData()
    }, validateImpl: function () {
        var t = this._view.scrollLeft;
        var e = this._view.scrollTop;
        n.release(this._dataDiv);
        this.updateCurrentData();
        this.validateModel();
        if (this.isAutoAdjustable()) {
            this.adjustWidth()
        }
        this.validateDisplay();
        this._pools.forEach(function (t) {
            t.clear()
        });
        if (this._view.scrollLeft !== t) {
            this._view.scrollLeft = t
        }
        if (this._view.scrollTop !== e) {
            this._view.scrollTop = e
        }
    }, getValue: function (t, e) {
        if (!t) {
            return null
        }
        return e.getValue(t, this)
    }, setValue: function (t, e, i) {
        if (!t) {
            return
        }
        e.setValue(t, i, this)
    }, isCellEditable: function (t, e) {
        if (!t) {
            return false
        }
        return this.isEditable() && e.isEditable()
    }, getRowIndexAt: function (t) {
        var e = this.getLogicalPoint(t);
        if (!e) {
            return-1
        }
        var i = parseInt(e.y / this._rowHeight);
        return i >= 0 && i < this._rowList.size() ? i : -1
    }, handleChange: function (t) {
        if (this._isCommitting || this._isCanceling || this._isValidating) {
            return
        }
        if (t.target._editInfo && this.commitEditValue) {
            this.commitEditValue(t.target._editInfo, t.target)
        }
    }, commitEditValue: function (t, e) {
        var i;
        if (e.type === "checkbox") {
            i = e.checked
        } else {
            i = e.value
        }
        var s = t.property;
        var n = s.getValueType();
        if (n === "int" && typeof i === "string") {
            i = parseInt(i)
        } else if (n === "number" && typeof i === "string") {
            i = parseFloat(i)
        } else if (n === "array.string") {
            i = i.split(",")
        } else if (n === "array.number") {
            i = i.split(",");
            for (var o = 0, r = i.length; o < r; o++) {
                i[o] = parseFloat(i[o])
            }
        }
        this.setValue(t.data, s, i);
        twaver.Util.setFocus(this._view);
        if (this._currentEditor) {
            this._rootDiv.removeChild(this._currentEditor);
            delete this._currentEditor
        }
        delete this._isCommitting
    }, cancelEditing: function () {
        if (this._currentEditor) {
            this._rootDiv.removeChild(this._currentEditor);
            delete this._currentEditor;
            delete this._isCanceling
        }
    }, updateCurrentRowIndex: function (t) {
        var e = this._rowList.size();
        if (t < 0 || t >= e) {
            t = -1
        }
        var i = this._currentRowIndex, s;
        if (t !== i) {
            if (i >= 0 && i < e) {
                s = this._rowList.get(i);
                if (s.nameRender) {
                    s.nameRender.style.backgroundColor = ""
                }
            }
            this._currentRowIndex = t
        }
        if (t >= 0) {
            s = this._rowList.get(t);
            if (s.nameRender) {
                s.nameRender.style.backgroundColor = this.getSelectColor();
                if (!this._currentEditor) {
                    if (s.valueRender && s.valueRender._editInfo) {
                        var o = s.valueRender._editInfo;
                        if (o.enumInfo) {
                            this._currentEditor = n.createSelect(o.enumInfo, o.value)
                        } else {
                            this._currentEditor = document.createElement("input");
                            if (o.value != null) {
                                this._currentEditor.value = o.value
                            }
                        }
                        if (this._currentEditor) {
                            this._currentEditor.addEventListener("keydown", function (t) {
                                var e = t.target._editInfo.view;
                                if (t.keyCode === 13) {
                                    if (e._isCommitting) {
                                        return
                                    }
                                    e._isCommitting = true;
                                    e.commitEditValue(t.target._editInfo, t.target)
                                } else if (t.keyCode === 27) {
                                    e._isCanceling = true;
                                    e.cancelEditing()
                                }
                            }, false);
                            this._currentEditor.addEventListener("blur", function (t) {
                                var e = t.target._editInfo.view;
                                if (e._isCommitting || e._isCanceling) {
                                    return
                                }
                                e._isCommitting = true;
                                e.commitEditValue(t.target._editInfo, t.target)
                            }, false);
                            this._currentEditor.keepDefault = true;
                            this._currentEditor._editInfo = o;
                            var r = this._currentEditor.style;
                            r.position = "absolute";
                            r.margin = "0px";
                            r.border = "0px";
                            r.padding = "0px";
                            r.left = this._indent + this._propertyNameWidth + "px";
                            r.top = s.rowDiv.style.top;
                            r.width = s.valueRender.style.width;
                            r.height = s.valueRender.style.height;
                            this._rootDiv.appendChild(this._currentEditor);
                            twaver.Util.setFocus(this._currentEditor)
                        }
                    }
                }
            }
        }
    }});
    twaver.controls.PropertySheetInteraction = function (t) {
        this.sheet = t;
        this.view = t._view;
        this.resizeDiv = t._resizeDiv;
        var e = this;
        this.view.addEventListener("mousedown", function (t) {
            if (t.button === 0) {
                e.handleMouseDown(t)
            }
        }, false);
        this.view.addEventListener("mousemove", function (t) {
            e.handleMouseMove(t)
        }, false)
    };
    _twaver.ext("twaver.controls.PropertySheetInteraction", Object, {minGap: 10, handleMouseDown: function (t) {
        if (t.target === this.sheet._currentEditor || t.target.parentNode === this.sheet._currentEditor) {
            return
        }
        if (this.sheet.isFocusOnClick()) {
            twaver.Util.setFocus(this.view)
        }
        if (this.sheet._isValidating) {
            return
        }
        if (t.target._expandData) {
            var e = t.target._expandData;
            if (this.sheet.isExpanded(e)) {
                this.sheet.collapse(e)
            } else {
                this.sheet.expand(e)
            }
        } else if (t.target === this.resizeDiv) {
            this.lastX = this.getX(t);
            n.handle_mousedown(this, t)
        } else {
            if (this.sheet._currentEditor && !this.sheet._isCommitting) {
                this.sheet._isCommitting = true;
                this.sheet.commitEditValue(this.sheet._currentEditor._editInfo, this.sheet._currentEditor)
            }
            var i = this.sheet.getRowIndexAt(t);
            this.sheet.updateCurrentRowIndex(i)
        }
    }, handleMouseMove: function (t) {
        if (this.lastX == null && !n.target) {
            this.changeCursor(t);
            return
        }
        if (n.target !== this || this.lastX == null) {
            return
        }
        var e = this.getX(t);
        if (this.stopLeft != null) {
            if (e < this.stopLeft) {
                return
            } else {
                delete this.stopLeft
            }
        }
        if (this.stopRight != null) {
            if (e > this.stopRight) {
                return
            } else {
                delete this.stopRight
            }
        }
        var i = this.sheet.getPropertyNameWidth() + (e - this.lastX);
        if (i < this.minGap) {
            i = this.minGap;
            this.stopLeft = e
        } else if (i > this.sheet.getSumWidth() - this.minGap) {
            i = this.sheet.getSumWidth() - this.minGap;
            this.stopRight = e
        }
        this.sheet.setPropertyNameWidth(i);
        this.lastX = e
    }, handleMouseUp: function (t) {
        if (t.button !== 0) {
            return
        }
        this.view.style.cursor = "default";
        delete this.stopLeft;
        delete this.stopRight;
        delete this.lastX
    }, changeCursor: function (t) {
        this.view.style.cursor = t.target === this.resizeDiv ? "ew-resize" : "default"
    }, getX: function (t) {
        return t.clientX / this.sheet.getZoom()
    }});
    twaver.controls.PropertySheetTouchInteraction = function (t) {
        this.sheet = t;
        this.view = t._view;
        this.resizeDiv = t._resizeDiv;
        n.addEventListener("touchstart", "handleTouchstart", this.view, this)
    };
    _twaver.ext("twaver.controls.PropertySheetTouchInteraction", Object, {minGap: 10, handleTouchstart: function (t) {
        n.preventDefault(t);
        if (t.target === this.sheet._currentEditor || t.target.parentNode === this.sheet._currentEditor) {
            return
        }
        if (this.sheet.isFocusOnClick()) {
            twaver.Util.setFocus(this.view)
        }
        if (this.sheet._isValidating) {
            return
        }
        if (t.target === this.resizeDiv) {
            this.lastX = this.getX(t)
        }
        this.lastPoint = this.sheet.getLogicalPoint(t);
        if (h.isMultiTouch(t)) {
            this.distance = h.getDistance(t);
            this.zoom = this.sheet.getZoom()
        }
        n.addEventListener("touchmove", "handleTouchmove", this.view, this);
        n.addEventListener("touchend", "handleTouchend", this.view, this)
    }, handleTouchmove: function (t) {
        n.preventDefault(t);
        if (!this.moved) {
            this.moved = true
        }
        if (this.lastX == null) {
            if (h.isSingleTouch(t)) {
                if (this.lastPoint) {
                    var e = this.sheet.getLogicalPoint(t);
                    var i = this.lastPoint.x - e.x;
                    var s = this.lastPoint.y - e.y;
                    var o = this.sheet.panByOffset(i, s);
                    this.lastPoint.x -= i - o.x;
                    this.lastPoint.y -= s - o.y
                }
            } else {
                if (this.distance) {
                    var r = h.getDistance(t) / this.distance;
                    this.sheet.setZoom(this.zoom * r, false)
                }
            }
            return
        }
        var a = this.getX(t);
        if (this.stopLeft != null) {
            if (a < this.stopLeft) {
                return
            } else {
                delete this.stopLeft
            }
        }
        if (this.stopRight != null) {
            if (a > this.stopRight) {
                return
            } else {
                delete this.stopRight
            }
        }
        var l = this.sheet.getPropertyNameWidth() + (a - this.lastX);
        if (l < this.minGap) {
            l = this.minGap;
            this.stopLeft = a
        } else if (l > this.sheet.getSumWidth() - this.minGap) {
            l = this.sheet.getSumWidth() - this.minGap;
            this.stopRight = a
        }
        this.sheet.setPropertyNameWidth(l);
        this.lastX = a
    }, handleTouchend: function (t) {
        n.preventDefault(t);
        if (!this.moved) {
            if (t.target._expandData) {
                var e = t.target._expandData;
                if (this.sheet.isExpanded(e)) {
                    this.sheet.collapse(e)
                } else {
                    this.sheet.expand(e)
                }
            } else if (t.target === this.resizeDiv) {
            } else {
                var i = this.sheet.getRowIndexAt(t);
                this.sheet.updateCurrentRowIndex(i)
            }
        }
        delete this.stopLeft;
        delete this.stopRight;
        delete this.lastX;
        delete this.lastPoint;
        delete this.distance;
        delete this.zoom;
        delete this.moved;
        n.removeEventListener("touchmove", this.view, this);
        n.removeEventListener("touchend", this.view, this)
    }, getX: function (t) {
        var e = t.changedTouches[0];
        return e.clientX
    }});
    twaver.controls.PropertySheetMSTouchInteraction = function (t) {
        this.sheet = t;
        this.view = t._view;
        this.resizeDiv = t._resizeDiv;
        this._pointerMap = {};
        this._pointerIdArray = [];
        var e = this;
        this.view.addEventListener("MSPointerDown", function (t) {
            e.handleTouchstart(t)
        }, false);
        this.view.addEventListener("MSPointerMove", function (t) {
            e.handleTouchmove(t)
        }, false);
        this.view.addEventListener("MSPointerUp", function (t) {
            e.handleTouchend(t)
        }, false);
        this.view.addEventListener("MSPointerCancel", function (t) {
            e.handleTouchend(t)
        }, false);
        this.superHandleMouseDown = twaver.controls.PropertySheetMSTouchInteraction.superClass.handleMouseDown
    };
    _twaver.ext("twaver.controls.PropertySheetMSTouchInteraction", twaver.controls.PropertySheetInteraction, {handleMouseDown: function (t) {
    }, handleTouchstart: function (t) {
        if (t.isPrimary && this._pointerIdArray.length > 0) {
            this._pointerMap = {};
            this._pointerIdArray = []
        }
        if (!this._pointerMap[t.pointerId] && this.sheet.getLogicalPoint(t) != null) {
            this._pointerIdArray.push(t.pointerId);
            this._pointerMap[t.pointerId] = t
        }
        if (this._pointerIdArray.length == 1 && t.pointerType == t.MSPOINTER_TYPE_MOUSE) {
            this.superHandleMouseDown(t)
        }
        if (this._pointerIdArray.length == 1) {
            this._startTouchPoint = this.sheet.getLogicalPoint(t);
            this._startTouchTime = new Date
        } else if (this._pointerIdArray.length == 2) {
            this._distance = this._getDistance();
            this._zoom = this.sheet.getZoom()
        }
    }, handleTouchmove: function (t) {
        if (this._pointerIdArray.length == 0 || !this._pointerMap[t.pointerId] || o.getDistance({x: this._pointerMap[t.pointerId].pageX, y: this._pointerMap[t.pointerId].pageY}, {x: t.pageX, y: t.pageY}) <= 10) {
            return
        }
        this._pointerMap[t.pointerId] = t;
        if (this._pointerIdArray.length == 2) {
            var e = this._getDistance() / this._distance;
            this.sheet.setZoom(this._zoom * e, false)
        } else if (this._pointerIdArray.length == 1 && t.pointerType != t.MSPOINTER_TYPE_MOUSE) {
            if (this._startTouchPoint) {
                var i = this.sheet.getLogicalPoint(t);
                if (i == null) {
                    return
                }
                var s = this._startTouchPoint.x - i.x;
                var n = this._startTouchPoint.y - i.y;
                var r = this.sheet.panByOffset(s, n);
                this._startTouchPoint.x -= s - r.x;
                this._startTouchPoint.y -= n - r.y
            }
        }
    }, handleTouchend: function (t) {
        if (this._pointerIdArray.length == 1 && t.pointerType != t.MSPOINTER_TYPE_MOUSE) {
            var e = this.sheet.getLogicalPoint(t);
            var i = new Date;
            if (i.getTime() - this._startTouchTime.getTime() <= 500 && o.getDistance(this._startTouchPoint, e) <= 20) {
                this.superHandleMouseDown(t)
            }
        }
        this._pointerMap = {};
        this._pointerIdArray = []
    }, _getDistance: function () {
        return o.getDistance({x: this._pointerMap[this._pointerIdArray[0]].pageX, y: this._pointerMap[this._pointerIdArray[0]].pageY}, {x: this._pointerMap[this._pointerIdArray[1]].pageX, y: this._pointerMap[this._pointerIdArray[1]].pageY})
    }});
    twaver.controls.SplitPane = function (t, e, i, s) {
        twaver.controls.SplitPane.superClass.constructor.apply(this, arguments);
        this._view = n.createView("hidden", true);
        this._view.tabIndex = -1;
        this._dividerDiv = n.createDiv();
        this._dividerDiv.tabIndex = -1;
        this._view.appendChild(this._dividerDiv);
        if (t)this.setFirstView(t);
        if (e)this.setNextView(e);
        if (i)this.setOrientation(i);
        if (s != null)this.setPosition(s);
        this.invalidate();
        var o;
        if (l.isTouchable && !l.isMSToucheable) {
            o = twaver.controls.SplitPaneTouchInteraction
        } else {
            o = twaver.controls.SplitPaneInteraction
        }
        if (o) {
            new o(this)
        }
    };
    _twaver.ext("twaver.controls.SplitPane", twaver.controls.ControlBase, {__accessor: ["orientation", "dividerWidth", "dividerBackground", "dividerOpacity", "maskBackground"], _position: c.SPLITPANE_POSITION, _orientation: c.SPLITPANE_ORIENTATION, _dividerWidth: c.SPLITPANE_DIVIDER_WIDTH, _dividerBackground: c.SPLITPANE_DIVIDER_BACKGROUND, _dividerOpacity: c.SPLITPANE_DIVIDER_OPACITY, _maskBackground: c.SPLITPANE_MASK_BACKGROUND, onPropertyChanged: function (t) {
        this.invalidate()
    }, getDividerDiv: function () {
        return this._dividerDiv
    }, getPosition: function () {
        return this._position
    }, setPosition: function (t) {
        if (t < 0)t = 0;
        if (t > 1)t = 1;
        if (t === this._position) {
            return
        }
        var e = this._position;
        this._position = t;
        this.firePropertyChange("position", e, t)
    }, setFirstView: function (t) {
        if (this._firstView === t) {
            return
        }
        var e = this._firstView;
        if (e) {
            if (e.getView) {
                this._view.removeChild(e.getView())
            } else {
                this._view.removeChild(e)
            }
        }
        this._firstView = t;
        if (t) {
            if (t.getView) {
                this._view.insertBefore(t.getView(), this._dividerDiv)
            } else {
                this._view.insertBefore(t, this._dividerDiv)
            }
        }
        this.firePropertyChange("firstView", e, t)
    }, getFirstView: function () {
        return this._firstView
    }, setNextView: function (t) {
        if (this._nextView === t) {
            return
        }
        var e = this._nextView;
        if (e) {
            if (e.getView) {
                this._view.removeChild(e.getView())
            } else {
                this._view.removeChild(e)
            }
        }
        this._nextView = t;
        if (t) {
            if (t.getView) {
                this._view.insertBefore(t.getView(), this._dividerDiv)
            } else {
                this._view.insertBefore(t, this._dividerDiv)
            }
        }
        this.firePropertyChange("nextView", e, t)
    }, getNextView: function () {
        return this._nextView
    }, validateImpl: function () {
        var t = this._position;
        var e = this._view.offsetWidth;
        var i = this._view.offsetHeight;
        var s = this._dividerWidth;
        if (s >= 8 || s === 0) {
            if (this._coverDiv) {
                this._dividerDiv.removeChild(this._coverDiv);
                delete this._coverDiv
            }
        } else {
            if (!this._coverDiv) {
                this._coverDiv = n.createDiv();
                this._coverDiv.tabIndex = -1;
                this._dividerDiv.appendChild(this._coverDiv)
            }
        }
        if (this._orientation === "horizontal") {
            if (s > e)s = e;
            var o = (e - s) * t;
            var r = e - s - o + 1;
            _twaver.setViewBounds(this._firstView, {x: 0, y: 0, width: o, height: i});
            _twaver.setViewBounds(this._nextView, {x: o + s, y: 0, width: r, height: i});
            _twaver.setViewBounds(this._dividerDiv, {x: o, y: 0, width: s, height: i});
            this._dividerDiv.position = o;
            if (this._coverDiv) {
                _twaver.setViewBounds(this._coverDiv, {x: s / 2 - 4, y: 0, width: 8, height: i})
            }
        } else {
            if (s > i)s = i;
            var a = (i - s) * t;
            var h = i - s - a;
            _twaver.setViewBounds(this._firstView, {x: 0, y: 0, width: e, height: a});
            _twaver.setViewBounds(this._nextView, {x: 0, y: a + s, width: e, height: h});
            _twaver.setViewBounds(this._dividerDiv, {x: 0, y: a, width: e, height: s});
            this._dividerDiv.position = a;
            if (this._coverDiv) {
                _twaver.setViewBounds(this._coverDiv, {x: 0, y: s / 2 - 4, width: e, height: 8})
            }
        }
        var l = this._dividerDiv.style;
        l.background = this._dividerBackground
    }});
    twaver.controls.SplitPaneInteraction = function (t) {
        this.splitPane = t;
        this.view = t._view;
        this.dividerDiv = t._dividerDiv;
        var e = this;
        this.view.addEventListener("mousedown", function (t) {
            if (t.button === 0) {
                e.handleMouseDown(t)
            }
        }, false);
        this.view.addEventListener("mousemove", function (t) {
            e.handleMouseMove(t)
        }, false)
    };
    _twaver.ext("twaver.controls.SplitPaneInteraction", Object, {handleMouseDown: function (t) {
        if (this.resizeDiv) {
            this.clear(t)
        } else if (t.target === this.dividerDiv || t.target === this.splitPane._coverDiv) {
            this.resizeDiv = n.createDiv();
            var e = this.resizeDiv.style;
            e.left = this.dividerDiv.style.left;
            e.top = this.dividerDiv.style.top;
            e.width = this.dividerDiv.style.width;
            e.height = this.dividerDiv.style.height;
            e.opacity = this.splitPane.getDividerOpacity();
            e.background = this.splitPane.getDividerBackground();
            this.resizeDiv.lastPosition = this.splitPane._orientation === "horizontal" ? t.clientX : t.clientY;
            this.resizeDiv.maskDiv = n.createDiv();
            e = this.resizeDiv.maskDiv.style;
            e.left = "0px";
            e.top = "0px";
            e.width = this.view.clientWidth + "px";
            e.height = this.view.clientHeight + "px";
            e.background = this.splitPane.getMaskBackground();
            this.view.appendChild(this.resizeDiv.maskDiv);
            this.view.appendChild(this.resizeDiv);
            n.handle_mousedown(this, t);
            t.preventDefault()
        }
    }, handleMouseMove: function (t) {
        if (!this.resizeDiv && !n.target) {
            var e = this.splitPane._orientation === "horizontal" ? "ew-resize" : "ns-resize";
            this.view.style.cursor = t.target === this.dividerDiv || t.target === this.splitPane._coverDiv ? e : "default"
        } else if (this.resizeDiv && n.target === this) {
            if (this.splitPane._orientation === "horizontal") {
                this.resizeDiv.style.left = this.dividerDiv.position + t.clientX - this.resizeDiv.lastPosition + "px"
            } else {
                this.resizeDiv.style.top = this.dividerDiv.position + t.clientY - this.resizeDiv.lastPosition + "px"
            }
        }
    }, handleMouseUp: function (t) {
        if (t.button === 0) {
            this.clear(t)
        }
    }, clear: function (t) {
        if (this.resizeDiv) {
            var e = this.splitPane._dividerWidth, i;
            if (this.splitPane._orientation === "horizontal") {
                var s = this.view.clientWidth;
                if (e > s)e = s;
                i = this.dividerDiv.position + t.clientX - this.resizeDiv.lastPosition;
                this.splitPane.setPosition(i / (s - e))
            } else {
                var n = this.view.clientHeight;
                if (e > n)e = n;
                i = this.dividerDiv.position + t.clientY - this.resizeDiv.lastPosition;
                this.splitPane.setPosition(i / (n - e))
            }
            this.view.removeChild(this.resizeDiv.maskDiv);
            this.view.removeChild(this.resizeDiv);
            delete this.resizeDiv
        }
    }});
    twaver.controls.SplitPaneTouchInteraction = function (t) {
        this.splitPane = t;
        this.view = t._view;
        this.dividerDiv = t._dividerDiv;
        n.addEventListener("touchstart", "handleTouchstart", this.view, this)
    };
    _twaver.ext("twaver.controls.SplitPaneTouchInteraction", Object, {handleTouchstart: function (t) {
        n.preventDefault(t);
        if (this.resizeDiv) {
            this.clear(t)
        } else if (t.target === this.dividerDiv || t.target === this.splitPane._coverDiv) {
            this.resizeDiv = n.createDiv();
            var e = this.resizeDiv.style;
            e.left = this.dividerDiv.style.left;
            e.top = this.dividerDiv.style.top;
            e.width = this.dividerDiv.style.width;
            e.height = this.dividerDiv.style.height;
            e.opacity = this.splitPane.getDividerOpacity();
            e.background = this.splitPane.getDividerBackground();
            var i = t.changedTouches[0];
            this.resizeDiv.lastPosition = this.splitPane._orientation === "horizontal" ? i.clientX : i.clientY;
            this.resizeDiv.maskDiv = n.createDiv();
            var e = this.resizeDiv.maskDiv.style;
            e.left = "0px";
            e.top = "0px";
            e.width = this.view.clientWidth + "px";
            e.height = this.view.clientHeight + "px";
            e.background = this.splitPane.getMaskBackground();
            this.view.appendChild(this.resizeDiv.maskDiv);
            this.view.appendChild(this.resizeDiv)
        }
        n.addEventListener("touchmove", "handleTouchmove", this.view, this);
        n.addEventListener("touchend", "handleTouchend", this.view, this)
    }, handleTouchmove: function (t) {
        n.preventDefault(t);
        if (!this.resizeDiv) {
        } else {
            var e = t.changedTouches[0];
            if (this.splitPane._orientation === "horizontal") {
                this.resizeDiv.style.left = this.dividerDiv.position + e.clientX - this.resizeDiv.lastPosition + "px"
            } else {
                this.resizeDiv.style.top = this.dividerDiv.position + e.clientY - this.resizeDiv.lastPosition + "px"
            }
        }
    }, handleTouchend: function (t) {
        n.removeEventListener("touchmove", this.view, this);
        n.removeEventListener("touchend", this.view, this);
        this.clear(t)
    }, clear: function (t) {
        var e = t.changedTouches[0];
        if (this.resizeDiv) {
            var i = this.splitPane._dividerWidth;
            if (this.splitPane._orientation === "horizontal") {
                var s = this.view.clientWidth;
                if (i > s)i = s;
                var n = this.dividerDiv.position + e.clientX - this.resizeDiv.lastPosition;
                this.splitPane.setPosition(n / (s - i))
            } else {
                var o = this.view.clientHeight;
                if (i > o)i = o;
                var n = this.dividerDiv.position + e.clientY - this.resizeDiv.lastPosition;
                this.splitPane.setPosition(n / (o - i))
            }
            this.view.removeChild(this.resizeDiv.maskDiv);
            this.view.removeChild(this.resizeDiv);
            delete this.resizeDiv
        }
    }});
    twaver.controls.TabPane = function () {
        twaver.controls.TabPane.superClass.constructor.apply(this, arguments);
        this._tabBox = new twaver.TabBox;
        this._tabBox.addDataBoxChangeListener(this.handleTabChange, this);
        this._tabBox.addDataPropertyChangeListener(this.handleTabChange, this);
        this._tabBox.addHierarchyChangeListener(this.handleTabChange, this);
        this._tabBox.getSelectionModel().addSelectionChangeListener(this.handleTabChange, this);
        this._view = n.createView("hidden", true);
        this._tabDiv = n.createDiv();
        this._tabDiv.onmousedown = n.preventDefault;
        this._tabDiv.onkeydown = n.preventDefault;
        this._contentDiv = n.createDiv();
        this._view.appendChild(this._tabDiv);
        this._view.appendChild(this._contentDiv);
        this._divPool = new twaver.Pool("div");
        this._iconPool = new twaver.Pool("img");
        this._closePool = new twaver.Pool("img");
        this._textPool = new twaver.Pool("span");
        this._resizePool = new twaver.Pool("div");
        this._pools.add(this._divPool);
        this._pools.add(this._iconPool);
        this._pools.add(this._closePool);
        this._pools.add(this._textPool);
        this._pools.add(this._resizePool);
        this.invalidateTab();
        var t;
        if (l.isTouchable && !l.isMSToucheable) {
            t = twaver.controls.TabPaneTouchInteraction
        } else {
            t = twaver.controls.TabPaneInteraction
        }
        if (t) {
            new t(this)
        }
    };
    _twaver.ext("twaver.controls.TabPane", twaver.controls.ControlBase, {__accessor: ["tabGap", "tabRadius", "tabHeight", "horizontalAlign", "tabOrientation", "resizeTolerance", "tabBackground", "selectBackground", "moveBackground", "insertBackground", "closeIcon", "disabledColor"], __bool: ["selectNextOnClose", "selectNextOnInVisible"], _tabGap: c.TABPANE_TAB_GAP, _tabRadius: c.TABPANE_TAB_RADIUS, _tabHeight: c.TABPANE_TAB_HEIGHT, _resizeTolerance: c.TABPANE_RESIZE_TOLERANCE, _tabOrientation: c.TABPANE_TAB_ORIENTATION, _tabBackground: c.TABPANE_TAB_BACKGROUND, _disabledColor: c.TABPANE_DISABLED_COLOR, _selectBackground: c.TABPANE_SELECT_BACKGROUND, _moveBackground: c.TABPANE_MOVE_BACKGROUND, _insertBackground: c.TABPANE_INSERT_BACKGROUND, _horizontalAlign: c.TABPANE_HORIZONTAL_ALIGN, _closeIcon: c.TABPANE_CLOSE_ICON, _selectNextOnClose: c.TABPANE_SELECT_NEXT_ON_CLOSE, _selectNextOnInVisible: c.TABPANE_SELECT_NEXT_ON_INVISIBLE, onPropertyChanged: function (t) {
        this.invalidateTab()
    }, getTabBox: function () {
        return this._tabBox
    }, getTabDiv: function () {
        return this._tabDiv
    }, getContentDiv: function () {
        return this._contentDiv
    }, handleTabChange: function (t) {
        if (this._selectNextOnInVisible && t.property === "visible" && !t.newValue && this._tabBox.getSelectionModel().contains(t.source)) {
            var e = t.source, i = this._tabBox.getRoots().indexOf(e), s = this._tabBox.getRoots(), n = s.size(), o = i, r, a;
            while (o < n - 1) {
                r = s.get(++o);
                if (r.isVisible() && !r.isDisabled()) {
                    a = r;
                    break
                }
            }
            if (!a) {
                o = i;
                while (o > 0) {
                    r = s.get(--o);
                    if (r.isVisible() && !r.isDisabled()) {
                        a = r;
                        break
                    }
                }
            }
            this._tabBox.getSelectionModel().setSelection(a)
        }
        this.invalidateTab()
    }, invalidateTab: function (t) {
        if (!this._invalidateTab) {
            this._invalidateTab = true;
            this.invalidate(t)
        }
    }, validateImpl: function () {
        if (this._invalidateTab) {
            this._invalidateTab = false;
            this.validateTab()
        }
        var t = this._view.offsetWidth;
        var e = this._view.offsetHeight;
        var i;
        if (this._tabOrientation === "top") {
            this._tabDiv.style.top = "0px";
            i = {x: 0, y: this._tabHeight, width: t, height: Math.max(0, e - this._tabHeight)}
        } else {
            this._tabDiv.style.top = e - this._tabHeight + "px";
            i = {x: 0, y: 0, width: t, height: Math.max(0, e - this._tabHeight)}
        }
        if (this._currentView) {
            _twaver.setViewBounds(this._currentView, i)
        }
    }, getCurrentTab: function () {
        return this._currentTab
    }, getCurrentView: function () {
        return this._currentView
    }, onViewRemoved: function (t) {
    }, onViewAdded: function (t) {
    }, validateTab: function () {
        this._currentTab = this._tabBox.getSelectionModel().getLastData();
        var t = this._currentTab ? this._currentTab.getView() : null;
        if (t !== this._currentView) {
            var e, i;
            if (this._currentView) {
                e = this._currentView.getView ? this._currentView.getView() : this._currentView;
                e.style.visibility = "hidden";
                this.onViewRemoved(this._currentView)
            }
            if (t) {
                i = t.getView ? t.getView() : t;
                i.style.visibility = "visible";
                if (!i.parentNode) {
                    this._contentDiv.appendChild(i)
                }
                this.onViewAdded(t)
            }
            this._currentView = t
        }
        n.release(this._tabDiv);
        var s = this._tabBox.getRoots();
        var o = this._tabHeight + "px";
        var r = this._tabHeight - 2 + "px";
        var a = this._tabRadius + "px";
        var h = s.size();
        var l = 0;
        for (var d = 0; d < h; d++) {
            var c = s.get(d);
            if (c.isVisible()) {
                var v = this._currentTab === c;
                var _ = c.getWidth();
                if (_ < 0)_ = 0;
                var u = Math.min(this._tabGap, _);
                var f = this._divPool.get();
                f._tab = c;
                var p = f.style;
                p.position = "absolute";
                p.whiteSpace = "nowrap";
                p.lineHeight = r;
                p.overflow = "hidden";
                p.textOverflow = "ellipsis";
                p.background = v ? this._selectBackground : this._tabBackground;
                p.textAlign = this._horizontalAlign;
                if (this._tabOrientation === "top") {
                    p.borderTopLeftRadius = a;
                    p.borderTopRightRadius = a;
                    p.borderBottomLeftRadius = "0px";
                    p.borderBottomRightRadius = "0px"
                } else {
                    p.borderTopLeftRadius = "0px";
                    p.borderTopRightRadius = "0px";
                    p.borderBottomLeftRadius = a;
                    p.borderBottomRightRadius = a
                }
                p.left = l + "px";
                p.width = _ - u + "px";
                p.height = o;
                f._x = l;
                f._width = _ - u;
                this.renderTab(f, c);
                this.onTabRendered(f, c);
                this._tabDiv.insertBefore(f, this._tabDiv.firstChild);
                l += _;
                if (c.isResizable()) {
                    f = this._resizePool.get();
                    f._resizeTab = c;
                    p = f.style;
                    p.position = "absolute";
                    p.backgroundColor = "white";
                    p.opacity = 0;
                    p.left = l - u - this._resizeTolerance + "px";
                    p.width = u + this._resizeTolerance * 2 + "px";
                    p.height = o;
                    this._tabDiv.appendChild(f)
                }
            }
        }
        this._tabDiv.style.left = "0px";
        this._tabDiv.style.width = l + "px";
        this._tabDiv.style.height = this._tabHeight + "px";
        this._pools.forEach(function (t) {
            t.clear()
        })
    }, renderTab: function (t, e) {
        if (e.renderTab) {
            e.renderTab(t)
        } else {
            var i = e.getIcon();
            if (i) {
                var s = this._iconPool.get();
                s.setAttribute("src", _twaver.getImageSrc(i));
                s.style.paddingLeft = "4px";
                s.style.verticalAlign = "middle";
                t.appendChild(s)
            }
            var n = e.getName();
            if (n) {
                var o = this._textPool.get();
                o.style.whiteSpace = "nowrap";
                o.style.verticalAlign = "middle";
                o.style.padding = "2px 4px";
                o.innerHTML = n;
                t.appendChild(o)
            }
            if (l.isOpera) {
                var r = t.cloneNode(false);
                r.style.left = "0px";
                r.style.top = "0px";
                r.style.opacity = 0;
                t.appendChild(r)
            }
        }
        if (e.isClosable()) {
            var a = this._tabRadius / 4 + 2;
            var s = this._closePool.get();
            s._closeTab = e;
            s.setAttribute("src", _twaver.getImageSrc(this._closeIcon));
            s.style.position = "absolute";
            s.style.top = a + "px";
            s.style.right = a + "px";
            t.appendChild(s)
        }
        if (e.isDisabled()) {
            t.style.color = this.getDisabledColor()
        } else {
            t.style.color = ""
        }
    }, onTabRendered: function (t, e) {
    }});
    twaver.controls.TabPaneInteraction = function (t) {
        this.tabPane = t;
        this.view = t.getTabDiv();
        var e = this;
        this.view.addEventListener("mousedown", function (t) {
            e.handleMouseDown(t)
        }, false);
        this.view.addEventListener("mousemove", function (t) {
            e.handleMouseMove(t)
        }, false)
    };
    _twaver.ext("twaver.controls.TabPaneInteraction", Object, {handleMouseDown: function (t) {
        if (t.button !== 0) {
            return
        }
        if (this.movableDiv) {
            this.handleMouseUp(t);
            return
        }
        this.resizeTab = t.target._resizeTab;
        if (!this.resizeTab) {
            this.movableDiv = this.getMovableDivAt(t)
        }
        this.changeCursor(t);
        this.lastX = this.getX(t);
        this._startClient = n.getClientPoint(t);
        this._startLogicalX = this.lastX;
        n.handle_mousedown(this, t)
    }, changeCursor: function (t) {
        var e = "";
        if (t.target._resizeTab) {
            e = "ew-resize"
        } else {
            var i = this.getTabAt(t);
            if (i && (!i.isDisabled() || i.isMovable())) {
                e = "pointer"
            }
        }
        this.view.style.cursor = e
    }, handleMouseMove: function (t) {
        if (this.lastX == null) {
            this.changeCursor(t);
            return
        }
        if (n.target !== this) {
            return
        }
        var e = this._startLogicalX + t.clientX - this._startClient.x;
        if (this.resizeTab) {
            if (this.stopX != null) {
                if (e < this.stopX) {
                    return
                } else {
                    delete this.stopX
                }
            }
            var i = this.resizeTab.getWidth() + (e - this.lastX);
            if (i < 10) {
                i = 10;
                this.stopX = e
            }
            this.resizeTab.setWidth(i);
            this.lastX = e
        } else if (this.movableDiv) {
            var s = e - this.lastX;
            if (!this.cloneDiv) {
                if (Math.abs(s) < 3) {
                    return
                }
                this.cloneDiv = this.movableDiv.cloneNode(true);
                this.cloneDiv._x = this.movableDiv._x;
                this.cloneDiv.style.background = this.tabPane.getMoveBackground();
                this.insertDiv = n.createDiv();
                this.insertDiv.style.width = "1px";
                this.insertDiv.style.height = this.cloneDiv.style.height;
                this.insertDiv.style.background = this.tabPane.getInsertBackground();
                this.movableDiv.parentNode.appendChild(this.cloneDiv);
                this.movableDiv.parentNode.appendChild(this.insertDiv)
            }
            var o = this.cloneDiv._x + s;
            this.cloneDiv.style.left = o + "px";
            this.cloneDiv._x = o;
            this.lastX = e;
            this.tabInfo = this.getTabInfoAt(t);
            if (this.tabInfo) {
                this.insertDiv.style.left = this.tabInfo.position
            }
        }
    }, handleMouseUp: function (t) {
        if (t.button !== 0) {
            return
        }
        if (this.resizeTab) {
        } else if (this.movableDiv && this.tabInfo) {
            var e = this.movableDiv._tab;
            var i = this.tabInfo.index;
            this.tabPane.getTabBox().moveTo(e, i)
        } else {
            var s = this.tabPane.getTabBox();
            var e = t.target._closeTab;
            if (e) {
                if (this.tabPane.isSelectNextOnClose() && this.tabPane.getCurrentTab() === e) {
                    var n = s.getRoots();
                    var i = n.indexOf(e);
                    s.remove(e);
                    if (n.size() > 0) {
                        if (i >= n.size()) {
                            i = n.size() - 1
                        }
                        s.getSelectionModel().setSelection(n.get(i))
                    }
                } else {
                    s.remove(e)
                }
            } else {
                var e = this.getTabAt(t);
                if (e && !e.isDisabled()) {
                    s.getSelectionModel().setSelection(e)
                }
            }
        }
        this.clear()
    }, clear: function () {
        this.view.style.cursor = "";
        if (this.cloneDiv && this.movableDiv) {
            this.movableDiv.parentNode.removeChild(this.cloneDiv)
        }
        if (this.insertDiv && this.movableDiv) {
            this.movableDiv.parentNode.removeChild(this.insertDiv)
        }
        delete this.movableDiv;
        delete this.tabInfo;
        delete this.insertDiv;
        delete this.cloneDiv;
        delete this.resizeTab;
        delete this.stopX;
        delete this.lastX;
        delete this._startLogicalX;
        delete this._startClient
    }, getTabAt: function (t) {
        t = t.target;
        var e;
        while (t && t !== this.view && !(e = t._tab)) {
            t = t.parentNode
        }
        return e
    }, getMovableDivAt: function (t) {
        t = t.target;
        var e;
        while (t && t !== this.view && !(e = t._tab)) {
            t = t.parentNode
        }
        if (e && e.isMovable()) {
            return t
        }
        return null
    }, getX: function (t) {
        var e = n.getLogicalPoint(this.view, t);
        return e ? e.x : null
    }, getTabInfoAt: function (t) {
        var e = this._startLogicalX + t.clientX - this._startClient.x;
        var i = this.tabPane.getTabBox().getRoots();
        var s = i.size();
        var n = 0;
        var o = false;
        for (var r = 0; r < s; r++) {
            var a = i.get(r);
            if (a === this.movableDiv._tab) {
                o = true
            }
            if (a.isVisible()) {
                var h = a.getWidth();
                if (h <= 0) {
                    continue
                }
                if (e >= n && e <= n + h) {
                    var l = e < n + h / 2;
                    if (o && !(a === this.movableDiv._tab && l)) {
                        r--
                    }
                    var d = l ? Math.max(0, r) : Math.min(r + 1, s);
                    var c = l ? n : n + h;
                    c = Math.max(0, c - 1);
                    return{index: d, tab: a, position: c + "px"}
                }
                n += h
            }
        }
        return this.tabInfo
    }});
    twaver.controls.TabPaneTouchInteraction = function (t) {
        this.tabPane = t;
        this.view = t.getTabDiv();
        n.addEventListener("touchstart", "handleTouchstart", this.view, this)
    };
    _twaver.ext("twaver.controls.TabPaneTouchInteraction", Object, {handleTouchstart: function (t) {
        n.preventDefault(t);
        if (this.movableDiv) {
            this.handleTouchend(t);
            return
        }
        this.resizeTab = t.target._resizeTab;
        if (!this.resizeTab) {
            this.movableDiv = this.getMovableDivAt(t)
        }
        this.lastX = this.getX(t);
        n.addEventListener("touchmove", "handleTouchmove", this.view, this);
        n.addEventListener("touchend", "handleTouchend", this.view, this)
    }, handleTouchmove: function (t) {
        if (this.lastX == null) {
            return
        }
        if (this.resizeTab) {
            var e = this.getX(t);
            if (this.stopX != null) {
                if (e < this.stopX) {
                    return
                } else {
                    delete this.stopX
                }
            }
            var i = this.resizeTab.getWidth() + (e - this.lastX);
            if (i < 0) {
                i = 0;
                this.stopX = e
            }
            this.resizeTab.setWidth(i);
            this.lastX = e
        } else if (this.movableDiv) {
            var e = this.getX(t);
            var s = e - this.lastX;
            if (!this.cloneDiv) {
                if (Math.abs(s) < 3) {
                    return
                }
                this.cloneDiv = this.movableDiv.cloneNode(true);
                this.cloneDiv._x = this.movableDiv._x;
                this.cloneDiv.style.background = this.tabPane.getMoveBackground();
                this.insertDiv = n.createDiv();
                this.insertDiv.style.width = "1px";
                this.insertDiv.style.height = this.cloneDiv.style.height;
                this.insertDiv.style.background = this.tabPane.getInsertBackground();
                this.movableDiv.parentNode.appendChild(this.cloneDiv);
                this.movableDiv.parentNode.appendChild(this.insertDiv)
            }
            var o = this.cloneDiv._x + s;
            this.cloneDiv.style.left = o + "px";
            this.cloneDiv._x = o;
            this.lastX = e;
            this.tabInfo = this.getTabInfoAt(t);
            if (this.tabInfo) {
                this.insertDiv.style.left = this.tabInfo.position
            }
        }
    }, handleTouchend: function (t) {
        if (this.resizeTab) {
        } else if (this.movableDiv && this.tabInfo) {
            var e = this.movableDiv._tab;
            var i = this.tabInfo.index;
            this.tabPane.getTabBox().moveTo(e, i)
        } else {
            var s = this.tabPane.getTabBox();
            var e = t.target._closeTab;
            if (e) {
                if (this.tabPane.isSelectNextOnClose() && this.tabPane.getCurrentTab() === e) {
                    var o = s.getRoots();
                    var i = o.indexOf(e);
                    s.remove(e);
                    if (o.size() > 0) {
                        if (i >= o.size()) {
                            i = o.size() - 1
                        }
                        s.getSelectionModel().setSelection(o.get(i))
                    }
                } else {
                    s.remove(e)
                }
            } else {
                var e = this.getTabAt(t);
                if (e && !e.isDisabled()) {
                    s.getSelectionModel().setSelection(e)
                }
            }
        }
        this.clear();
        n.removeEventListener("touchmove", this.view, this);
        n.removeEventListener("touchend", this.view, this)
    }, clear: function () {
        if (this.cloneDiv && this.movableDiv) {
            this.movableDiv.parentNode.removeChild(this.cloneDiv)
        }
        if (this.insertDiv && this.movableDiv) {
            this.movableDiv.parentNode.removeChild(this.insertDiv)
        }
        delete this.movableDiv;
        delete this.tabInfo;
        delete this.insertDiv;
        delete this.cloneDiv;
        delete this.resizeTab;
        delete this.stopX;
        delete this.lastX
    }, getTabAt: function (t) {
        t = t.target;
        var e;
        while (t && t !== this.view && !(e = t._tab)) {
            t = t.parentNode
        }
        return e
    }, getMovableDivAt: function (t) {
        t = t.target;
        var e;
        while (t && t !== this.view && !(e = t._tab)) {
            t = t.parentNode
        }
        if (e && e.isMovable()) {
            return t
        }
        return null
    }, getX: function (t) {
        var e = n.getLogicalPoint(this.view, t);
        return e ? e.x : null
    }, getTabInfoAt: function (t) {
        var e = this.getX(t);
        var i = this.tabPane.getTabBox().getRoots();
        var s = i.size();
        var n = 0;
        var o = false;
        for (var r = 0; r < s; r++) {
            var a = i.get(r);
            if (a === this.movableDiv._tab) {
                o = true
            }
            if (a.isVisible()) {
                var h = a.getWidth();
                if (h <= 0) {
                    continue
                }
                if (e >= n && e <= n + h) {
                    var l = e < n + h / 2;
                    if (o && !(a === this.movableDiv._tab && l)) {
                        r--
                    }
                    var d = l ? Math.max(0, r) : Math.min(r + 1, s);
                    var c = l ? n : n + h;
                    c = Math.max(0, c - 1);
                    return{index: d, tab: a, position: c + "px"}
                }
                n += h
            }
        }
        return this.tabInfo
    }});
    twaver.controls.TitlePane = function (t, e, i) {
        twaver.controls.TitlePane.superClass.constructor.apply(this, arguments);
        this.invalidate();
        this._titleDiv = n.createDiv();
        this._titleDiv.tabIndex = -1;
        this._titleDiv.style.verticalAlign = "middle";
        this._titleDiv.style.fontWeight = "bold";
        this._titleDiv.style.textOverflow = "ellipsis";
        this._titleDiv.style.overflow = "hidden";
        this._titleDiv.style.whiteSpace = "nowrap";
        this._titleDiv.onmousedown = n.preventDefault;
        this._span = document.createElement("span");
        this._span.style.verticalAlign = "middle";
        this._span.style.paddingLeft = "4px";
        this._span.style.paddingRight = "4px";
        this._img = document.createElement("img");
        this._img.style.verticalAlign = "middle";
        this._img.style.paddingLeft = "4px";
        this._view = n.createView("hidden", true);
        this._view.tabIndex = -1;
        this._view.appendChild(this._titleDiv);
        if (e)this.setTitle(e);
        if (t)this.setContent(t);
        if (i)this.setIcon(i)
    };
    _twaver.ext("twaver.controls.TitlePane", twaver.controls.ControlBase, {__accessor: ["icon", "title", "titleHeight", "titleHorizontalAlign", "titleBackground"], _titleHeight: c.TITLEPANE_TITLE_HEIGHT, _titleBackground: c.TITLEPANE_TITLE_BACKGROUND, _titleHorizontalAlign: c.TITLEPANE_TITLE_HORIZONTAL_ALIGN, onPropertyChanged: function (t) {
        this.invalidate()
    }, getTitleDiv: function () {
        return this._titleDiv
    }, getContent: function () {
        return this._content
    }, setContent: function (t) {
        if (this._content === t) {
            return
        }
        var e = this._content;
        if (e) {
            if (e.getView) {
                this._view.removeChild(e.getView())
            } else {
                this._view.removeChild(e)
            }
        }
        this._content = t;
        if (t) {
            if (t.getView) {
                this._view.appendChild(t.getView())
            } else {
                this._view.appendChild(t)
            }
        }
        this.firePropertyChange("content", e, t)
    }, validateImpl: function () {
        var t = this._view.offsetWidth;
        var e = this._view.offsetHeight;
        var i = this._titleDiv.style;
        i.textAlign = this._titleHorizontalAlign;
        i.lineHeight = this._titleHeight - 2 + "px";
        i.background = this._titleBackground;
        n.clear(this._titleDiv);
        if (this._icon) {
            this._img.setAttribute("src", _twaver.getImageSrc(this._icon));
            this._titleDiv.appendChild(this._img)
        }
        if (this._title) {
            this._span.innerHTML = this._title;
            this._span.setAttribute("title", this._title);
            this._titleDiv.appendChild(this._span)
        }
        var i = this._titleDiv.style;
        i.left = "0px";
        i.top = "0px";
        i.width = t + "px";
        i.height = this._titleHeight + "px";
        _twaver.setViewBounds(this._content, {x: 0, y: this._titleHeight, width: t, height: Math.max(e - this._titleHeight, 0)})
    }});
    twaver.controls.Accordion = function () {
        twaver.controls.Accordion.superClass.constructor.apply(this, arguments);
        this._titleMap = {};
        this._titleList = new d;
        this._currentTitle = null;
        this._currentView = null;
        this._view = n.createView("hidden", true);
        this.invalidate();
        var t = this;
        this._view.addEventListener("mousedown", function (e) {
            t.handleMouseDown(e)
        }, false)
    };
    _twaver.ext("twaver.controls.Accordion", twaver.controls.ControlBase, {__accessor: ["expandIcon", "collapseIcon", "titleHeight", "titleBackground", "borderBottomColor"], _expandIcon: c.ACCORDION_EXPAND_ICON, _collapseIcon: c.ACCORDION_COLLAPSE_ICON, _titleHeight: c.ACCORDION_TITLE_HEIGHT, _titleBackground: c.ACCORDION_TITLE_BACKGROUND, _borderBottomColor: c.ACCORDION_BORDER_BOTTOM_COLOR, onPropertyChanged: function (t) {
        this.invalidate()
    }, handleMouseDown: function (t) {
        if (t.button !== 0) {
            return
        }
        var e = t.target._title;
        if (!e) {
            e = t.target.parentNode._title
        }
        if (e) {
            if (this._currentTitle === e) {
                this.collapse()
            } else {
                this.expand(e)
            }
        }
    }, getTitles: function () {
        return this._titleList
    }, getCurrentTitle: function () {
        return this._currentTitle
    }, add: function (t, e) {
        if (this._titleMap[t]) {
            throw"Title ' + title + ' already exists"
        }
        var i = n.createDiv();
        i._title = t;
        i.onmousedown = n.preventDefault;
        i.style.cursor = "pointer";
        i.style.textAlign = "left";
        i.style.textOverflow = "ellipsis";
        i.style.whiteSpace = "nowrap";
        i.style.overflow = "hidden";
        i.style.borderBottomWidth = "1px";
        i.style.borderBottomStyle = "solid";
        var s = document.createElement("img");
        s.style.verticalAlign = "middle";
        s.style.paddingLeft = "4px";
        var o = document.createElement("span");
        o.style.verticalAlign = "middle";
        o.style.paddingLeft = "4px";
        o.innerHTML = t;
        o.setAttribute("title", t);
        this._view.appendChild(i);
        i.appendChild(s);
        i.appendChild(o);
        this._titleMap[t] = {content: e, titleDiv: i, span: o, img: s};
        this._titleList.add(t);
        this.invalidate()
    }, remove: function (t) {
        delete this._titleMap[t];
        this._titleList.remove(t);
        this.invalidate()
    }, clear: function () {
        this._titleMap = {};
        this._titleList.clear();
        this.invalidate()
    }, expand: function (t) {
        if (this._titleMap[t] && this._currentTitle !== t) {
            this._currentTitle = t;
            this.onExpanded(t);
            this.invalidate()
        }
    }, onExpanded: function (t) {
    }, collapse: function () {
        if (this._currentTitle) {
            this.onCollapsed(this._currentTitle);
            this._currentTitle = null;
            this.invalidate()
        }
    }, onCollapsed: function (t) {
    }, validateImpl: function () {
        var t = this._currentView;
        this._currentView = null;
        var e = this._view.offsetWidth;
        var i = this._view.offsetHeight;
        var s = this._titleList.size();
        var n = 0;
        for (var o = 0; o < s; o++) {
            var r = this._titleList.get(o);
            var a = this._titleMap[r];
            var h = a.titleDiv.style;
            h.lineHeight = this._titleHeight - 3 + "px";
            h.background = this._titleBackground;
            h.borderBottomColor = this._borderBottomColor;
            h.left = "0px";
            h.top = n + "px";
            h.width = e + "px";
            h.height = this._titleHeight - 1 + "px";
            var l = this._currentTitle === r;
            var d = l ? this._expandIcon : this._collapseIcon;
            a.img.setAttribute("src", _twaver.getImageSrc(d));
            if (l) {
                var c = Math.max(0, i - s * this._titleHeight);
                if (a.content) {
                    this._currentView = a.content.getView ? a.content.getView() : a.content;
                    _twaver.setViewBounds(a.content, {x: 0, y: n + this._titleHeight, width: e, height: c})
                }
                n += this._titleHeight + c
            } else {
                n += this._titleHeight
            }
        }
        if (this._currentView && this._currentView !== t) {
            this._view.appendChild(this._currentView)
        }
        if (t && t !== this._currentView) {
            this._view.removeChild(t)
        }
    }});
    twaver.controls.BorderPane = function (t, e, i, s, o) {
        twaver.controls.BorderPane.superClass.constructor.apply(this, arguments);
        this.invalidate();
        this._view = n.createView("hidden", true);
        this._view.tabIndex = -1;
        if (t)this.setCenter(t);
        if (e)this.setTop(e);
        if (i)this.setRight(i);
        if (s)this.setBottom(s);
        if (o)this.setLeft(o)
    };
    _twaver.ext("twaver.controls.BorderPane", twaver.controls.ControlBase, {__accessor: ["hGap", "vGap", "topHeight", "bottomHeight", "leftWidth", "rightWidth"], _hGap: c.BORDERPANE_HGAP, _vGap: c.BORDERPANE_VGAP, _topHeight: 0, _bottomHeight: 0, _leftWidth: 0, _rightWidth: 0, onPropertyChanged: function (t) {
        this.invalidate()
    }, getCenter: function () {
        return this._center
    }, setCenter: function (t) {
        this._setContent("center", t)
    }, getTop: function () {
        return this._top
    }, setTop: function (t) {
        this._setContent("top", t)
    }, getRight: function () {
        return this._right
    }, setRight: function (t) {
        this._setContent("right", t)
    }, getBottom: function () {
        return this._bottom
    }, setBottom: function (t) {
        this._setContent("bottom", t)
    }, getLeft: function () {
        return this._left
    }, setLeft: function (t) {
        this._setContent("left", t)
    }, _setContent: function (t, e) {
        var i = this["_" + t];
        if (i === e) {
            return
        }
        if (i) {
            if (i.getView) {
                this._view.removeChild(i.getView())
            } else {
                this._view.removeChild(i)
            }
        }
        this["_" + t] = e;
        if (e) {
            if (e.getView) {
                this._view.appendChild(e.getView())
            } else {
                this._view.appendChild(e)
            }
        }
        this.firePropertyChange(t, i, e)
    }, validateImpl: function () {
        var t = this._view.offsetWidth, e = this._view.offsetHeight;
        var i = 0, s = 0, n = t, o = e, r = 0, a = 0, h = 0, l = 0;
        if (this._top) {
            r = this._topHeight || (this._top.getView ? this._top.getView().offsetHeight : this._top.offsetHeight);
            s = r + this._vGap
        }
        if (this._bottom) {
            a = this._bottomHeight || (this._bottom.getView ? this._bottom.getView().offsetHeight : this._bottom.offsetHeight);
            o = e - a - this._vGap
        }
        if (this._left) {
            h = this._leftWidth || (this._left.getView ? this._left.getView().offsetWidth : this._left.offsetWidth);
            i = h + this._hGap
        }
        if (this._right) {
            l = this._rightWidth || (this._right.getView ? this._right.getView().offsetWidth : this._right.offsetWidth);
            n = t - l - this._hGap
        }
        var d = Math.max(0, n - i);
        var c = Math.max(0, o - s);
        if (this._top) {
            _twaver.setViewBounds(this._top, {x: 0, y: 0, width: t, height: r})
        }
        if (this._bottom) {
            _twaver.setViewBounds(this._bottom, {x: 0, y: o, width: t, height: a})
        }
        if (this._left) {
            _twaver.setViewBounds(this._left, {x: 0, y: s, width: h, height: c})
        }
        if (this._right) {
            _twaver.setViewBounds(this._right, {x: n, y: s, width: l, height: c})
        }
        if (this._center) {
            _twaver.setViewBounds(this._center, {x: i, y: s, width: d, height: c})
        }
    }});
    twaver.controls.PopupMenu = function (t) {
        this._view = n.createDiv();
        this._view.style.zIndex = 100001;
        this._items = [];
        this._itemsMap = {};
        this.setContextView(t);
        var e = this._view, i = this;
        e.addEventListener("mouseover", function (t) {
            i._mouseOver = true
        }, false);
        e.addEventListener("mouseout", function (t) {
            i._mouseOver = false
        }, false);
        e.oncontextmenu = function (t) {
            t.preventDefault()
        };
        n.addEventListener("mousedown", "_handleClick", e, this)
    };
    _twaver.ext("twaver.controls.PopupMenu", Object, {_width: 200, _menuItemHeight: 25, _background: "#F9F9F9", _border: "2px outset white", _disabledColor: "#BABBBC", _focusColor: "#C2CFF1", getView: function () {
        return this._view
    }, getContextView: function () {
        return this._contextView
    }, setContextView: function (t) {
        this._removeContextmenuListener();
        this._contextView = t;
        if (t) {
            var e = t.getView ? t.getView() : t;
            if (l.isTouchable) {
                e.addEventListener("touchstart", this._getTouchStartListener(), false);
                e.addEventListener("touchmove", this._getTouchMoveListener(), false);
                e.addEventListener("touchend", this._getTouchEndListener(), false)
            } else {
                n.addEventListener("contextmenu", "_handleContextmenu", e, this)
            }
        }
    }, getMenuItems: function () {
        return this._items
    }, setMenuItems: function (t) {
        this._items = [];
        this._itemsMap = {};
        if (t) {
            for (var e = 0, i = t.length; e < i; e++) {
                this.addMenuItem(t[e])
            }
        }
    }, addMenuItem: function (t) {
        if (t.separator !== true) {
            this._itemsMap[t.id || t.label] = t
        }
        this._items.push(t)
    }, addSeparator: function () {
        this.addMenuItem({separator: true})
    }, getMenuItemById: function (t) {
        return this._itemsMap[t]
    }, isVisible: function (t) {
        return t.visible !== false
    }, isEnabled: function (t) {
        return t.enabled !== false
    }, show: function (t) {
        this.hide();
        var e = this._view, i = this._view.style, s, o;
        if (l.isTouchable) {
            s = t.changedTouches[0].clientX;
            o = t.changedTouches[0].clientY
        } else {
            s = t.clientX, o = t.clientY
        }
        n.clear(e);
        this.renderMenu(e, this._items);
        if (this._height === 0) {
            return
        }
        n.addEventListener(l.isTouchable ? "touchstart" : "mousedown", "_handleBodyClicked", document.body, this);
        var r = n.windowWidth() - this._width - 10, a = height = n.windowHeight() - this._height - 10;
        s = s > r ? r : s;
        o = o > a ? a : o;
        s = s < 0 ? 0 : s;
        o = o < 0 ? 0 : o;
        i.left = s + h.scrollLeft() + "px";
        i.top = o + h.scrollTop() + "px";
        document.body.appendChild(e)
    }, hide: function () {
        if (document.body.contains(this._view)) {
            document.body.removeChild(this._view)
        }
        delete this._mouseOver;
        n.removeEventListener(l.isTouchable ? "touchstart" : "mousedown", document.body, this)
    }, dispose: function () {
        this._removeContextmenuListener();
        this.hide()
    }, onMenuShowing: function (t) {
        return true
    }, onAction: function (t) {
    }, renderMenu: function (t, e) {
        var i = t.style;
        i.background = this._background;
        i.border = this._border;
        i.width = this._width + "px";
        this._height = 0;
        delete this._separator;
        for (var s = 0, n = e.length, o; s < n; s++) {
            o = e[s];
            if (this.isVisible(o)) {
                if (o.separator === true) {
                    this._separator = true
                } else {
                    var r = document.createElement("div");
                    if (this.isEnabled(o)) {
                        this._addMouseoverListener(r)
                    }
                    r.menuItem = o;
                    this._view.appendChild(r);
                    this.renderMenuItem(r, o);
                    this.onMenuItemRendered(r, o);
                    this._separator = false;
                    this._height += this._menuItemHeight
                }
            }
        }
    }, renderMenuItem: function (t, e) {
        var i = t.style;
        i.height = this._menuItemHeight + "px";
        if (this._separator) {
            i.borderTop = "1px solid gray"
        }
        if (!this.isEnabled(e)) {
            i.color = this._disabledColor
        }
        var s = document.createElement("span");
        i = s.style;
        i.position = "absolute";
        i.width = "25px";
        i.height = this._menuItemHeight + "px";
        i.lineHeight = this._menuItemHeight + "px";
        i.textAlign = "center";
        t.appendChild(s);
        if (e.icon) {
            var n = new Image;
            n.src = e.icon;
            s.appendChild(n)
        }
        var o = document.createElement("label");
        _twaver.setText(o, e.label, true);
        i = o.style;
        i.position = "absolute";
        i.height = this._menuItemHeight + "px";
        i.lineHeight = this._menuItemHeight + "px";
        i.left = "25px";
        t.appendChild(o)
    }, onMenuItemRendered: function (t, e) {
    }, _addMouseoverListener: function (t) {
        var e = this;
        t.addEventListener("mouseover", function (i) {
            t.style.background = e._focusColor;
            t.style.color = "#FFFFFF"
        }, false);
        t.addEventListener("mouseout", function (i) {
            t.style.background = e._background;
            t.style.color = "#000000"
        }, false)
    }, _removeContextmenuListener: function () {
        var t = this._contextView;
        if (t) {
            t = t.getView ? t.getView() : t;
            if (l.isTouchable) {
                t.removeEventListener("touchstart", this._getTouchStartListener(), false);
                t.removeEventListener("touchmove", this._getTouchMoveListener(), false);
                t.removeEventListener("touchend", this._getTouchEndListener(), false)
            } else {
                n.removeEventListener("contextmenu", t, this)
            }
        }
    }, _handleContextmenu: function (t) {
        if (this.onMenuShowing(t) === true) {
            this.show(t)
        }
        t.preventDefault()
    }, _handleBodyClicked: function (t) {
        if (l.isTouchable) {
            var e = t.target;
            while (e && e !== this._view) {
                e = e.parentElement
            }
            if (e !== this._view) {
                this.hide()
            }
        } else {
            if (!this._mouseOver) {
                this.hide()
            }
        }
    }, _handleClick: function (t) {
        if (t.button !== 0) {
            return
        }
        var e = t.target;
        while (!e.menuItem && e.parentElement) {
            e = e.parentElement
        }
        var i = e ? e.menuItem : null;
        if (i && this.isEnabled(i)) {
            if (i.action) {
                i.action()
            }
            this.onAction(i);
            this.hide()
        }
    }, _getTouchStartListener: function () {
        if (!this._touchStartListener) {
            var t = this;
            this._touchStartListener = function (e) {
                t._touchMoved = false;
                t._lastTouch = new Date
            }
        }
        return this._touchStartListener
    }, _getTouchMoveListener: function () {
        if (!this._touchMoveListener) {
            var t = this;
            this._touchMoveListener = function (e) {
                t._touchMoved = true
            }
        }
        return this._touchMoveListener
    }, _getTouchEndListener: function () {
        if (!this._touchEndListener) {
            var t = this;
            this._touchEndListener = function (e) {
                if (!t._touchMoved && (new Date).getTime() - t._lastTouch.getTime() > 1e3) {
                    t._handleContextmenu(e)
                }
            }
        }
        return this._touchEndListener
    }, getWidth: function () {
        return this._width
    }, setWidth: function (t) {
        this._width = t
    }, getMenuItemHeight: function () {
        return this._menuItemHeight
    }, setMenuItemHeight: function (t) {
        this._menuItemHeight = t
    }, getBackground: function () {
        return this._background
    }, setBackground: function (t) {
        this._background = t
    }, getBorder: function () {
        return this._border
    }, setBorder: function (t) {
        this._border = t
    }, getDisabledColor: function () {
        return this._disabledColor
    }, setDisabledColor: function (t) {
        this._disabledColor = t
    }, getFocusColor: function () {
        return this._focusColor
    }, setFocusColor: function (t) {
        this._focusColor = t
    }})
})(window);
(function (e, i) {
    var t = twaver.List;
    var s = twaver.Node;
    var a = twaver.Group;
    twaver.JsonSerializer = function (e, i, t) {
        this.dataBox = e;
        this.settings = i ? i : new twaver.SerializationSettings;
        this.filterFunction = t;
        this.ref = 0;
        this.refMap = {};
        this.idMap = {};
        this.jsonObject = {}
    };
    _twaver.ext("twaver.JsonSerializer", Object, {serialize: function () {
        this.jsonObject = {version: twaver.Util.getVersion(), platform: "html5"};
        this.serializeBody();
        return JSON.stringify(this.jsonObject)
    }, serializeBody: function () {
        this.ref = 0;
        this.dataBox.getRoots().forEach(this.initRefs, this);
        if (this.settings.isDataBoxSerializable) {
            var e = {"class": this.dataBox.getClassName(), p: {}, s: {}, c: {}};
            this.jsonObject.dataBox = e;
            this.dataBox.serializeJson(this, this.dataBox.newInstance(), e);
            if (_twaver.isEmptyObject(e.p)) {
                delete e.p
            }
            if (_twaver.isEmptyObject(e.s)) {
                delete e.s
            }
            if (_twaver.isEmptyObject(e.c)) {
                delete e.c
            }
        }
        this.jsonObject.datas = [];
        this.dataBox.getRoots().forEach(this.serializeData, this)
    }, initRefs: function (e) {
        this.refMap[e.getId()] = this.ref++;
        e.getChildren().forEach(this.initRefs, this)
    }, isSerializable: function (e) {
        if (!this.dataBox.contains(e)) {
            return false
        }
        if (this.filterFunction && !this.filterFunction(e)) {
            return false
        }
        return true
    }, serializeData: function (e) {
        if (this.isSerializable(e)) {
            var i = e.newInstance();
            var t = this.refMap[e.getId()];
            var s = {"class": e.getClassName(), ref: t, p: {}, s: {}, c: {}};
            if (this.settings.getPropertyType("id")) {
                this.jsonObject.id = e.getId()
            }
            this.jsonObject.datas.push(s);
            e.serializeJson(this, i, s);
            if (_twaver.isEmptyObject(s.p)) {
                delete s.p
            }
            if (_twaver.isEmptyObject(s.s)) {
                delete s.s
            }
            if (_twaver.isEmptyObject(s.c)) {
                delete s.c
            }
        }
        e.getChildren().forEach(this.serializeData, this)
    }, serializePropertyJson: function (e, i, t, s) {
        var a = this.settings.getPropertyType(i);
        if (a) {
            var r = _twaver.getValue(e, i, a);
            var n = _twaver.getValue(t, i, a);
            if (r !== n) {
                this.serializeValue(i, r, n, a, s.p)
            }
        }
    }, serializeStyleJson: function (e, i, t, s) {
        var a = this.settings.getStyleType(i);
        if (a) {
            var r = e.getStyle(i);
            var n = t.getStyle(i);
            if (r != n) {
                this.serializeValue(i, r, n, a, s.s)
            }
        }
    }, serializeClientJson: function (e, i, t, s) {
        var a = this.settings.getClientType(i);
        if (a != null) {
            var r = e.getClient(i);
            var n = t.getClient(i);
            if (r != n) {
                this.serializeValue(i, r, n, a, s.c)
            }
        }
    }, serializeValue: function (e, i, s, a, r) {
        if (i == null) {
            r[e] = null
        } else if (i instanceof t) {
            r[e] = i._as
        } else if (a === "data") {
            var n = this.refMap[i.getId()];
            if (n != null) {
                r[e] = n
            }
        } else {
            r[e] = i
        }
    }, deserialize: function (e, i) {
        _twaver.isDeserializing = true;
        this.jsonObject = JSON.parse(e);
        this.refMap = {};
        this.idMap = {};
        var s = new t;
        var a = new t;
        var r;
        var n = this.jsonObject.datas.length;
        for (var l = 0; l < n; l++) {
            var o = this.jsonObject.datas[l];
            var h = o["class"];
            var f = this.settings.getPropertyType("id");
            if (f && o.id != null) {
                if (o.action === "remove") {
                    this.dataBox.removeById(o.id);
                    continue
                }
                r = this.dataBox.getDataById(o.id);
                if (!r) {
                    r = _twaver.newInstance(h, o.id)
                }
            } else {
                r = _twaver.newInstance(h)
            }
            if (o.ref != null) {
                this.refMap[o.ref] = r
            }
            s.add(r);
            a.add(o);
            this.idMap[r.getId()] = r
        }
        this.dataBox.forEach(function (e) {
            this.idMap[e.getId()] = e
        }, this);
        n = s.size();
        for (l = 0; l < n; l++) {
            r = s.get(l);
            r.deserializeJson(this, a.get(l))
        }
        for (l = 0; l < n; l++) {
            r = s.get(l);
            if (this.dataBox.containsById(r.getId())) {
                continue
            }
            if (i && !r.getParent()) {
                r.setParent(i)
            }
            this.dataBox.add(r)
        }
        if (this.settings.isDataBoxSerializable && this.jsonObject.dataBox) {
            this.dataBox.deserializeJson(this, this.jsonObject.dataBox)
        }
        _twaver.isDeserializing = false
    }, deserializePropertyJson: function (e, i, t) {
        var s = this.settings.getPropertyType(t);
        if (s) {
            _twaver.setValue(e, t, this.deserializeValue(i, s))
        }
    }, deserializeStyleJson: function (e, i, t) {
        var s = this.settings.getStyleType(t);
        if (s) {
            e.setStyle(t, this.deserializeValue(i, s))
        }
    }, deserializeClientJson: function (e, i, t) {
        var s = this.settings.getClientType(t);
        if (s) {
            e.setClient(t, this.deserializeValue(i, s))
        }
    }, deserializeValue: function (e, i) {
        if (i === "data") {
            var s = this.refMap[e];
            if (s) {
                return s
            } else {
                return this.idMap[e]
            }
        }
        if (e instanceof Array) {
            return new t(e)
        }
        return e
    }});
    _twaver.addMethod(twaver.Data, {serializeJson: function (e, i, t) {
        if (e.settings.isClientSerializable && this._clientMap) {
            for (var s in this._clientMap) {
                this.serializeClientJson(e, s, i, t)
            }
        }
        this.serializePropertyJson(e, "name", i, t);
        this.serializePropertyJson(e, "icon", i, t);
        this.serializePropertyJson(e, "toolTip", i, t);
        this.serializePropertyJson(e, "parent", i, t)
    }, serializePropertyJson: function (e, i, t, s) {
        e.serializePropertyJson(this, i, t, s)
    }, serializeClientJson: function (e, i, t, s) {
        e.serializeClientJson(this, i, t, s)
    }, deserializeJson: function (e, i) {
        var t;
        for (t in i.p) {
            this.deserializePropertyJson(e, i.p[t], t)
        }
        if (e.settings.isClientSerializable) {
            for (t in i.c) {
                this.deserializeClientJson(e, i.c[t], t)
            }
        }
    }, deserializePropertyJson: function (e, i, t) {
        e.deserializePropertyJson(this, i, t)
    }, deserializeClientJson: function (e, i, t) {
        e.deserializeClientJson(this, i, t)
    }});
    _twaver.addMethod(twaver.Element, {serializeJson: function (e, i, t) {
        if (e.settings.isStyleSerializable && this._styleMap) {
            for (var s in this._styleMap) {
                this.serializeStyleJson(e, s, i, t)
            }
        }
        twaver.Element.superClass.serializeJson.call(this, e, i, t);
        this.serializePropertyJson(e, "layerId", i, t);
        if (this._alarmState.getHighestNativeAlarmSeverity() && e.settings.getPropertyType("alarmState") === "alarmstate") {
            var a = {n: {}, a: {}};
            t.p.alarmState = a;
            twaver.AlarmSeverity.forEach(function (e) {
                var i = this.getNewAlarmCount(e);
                if (i > 0) {
                    a.n[e.name] = i
                }
            }, this._alarmState);
            twaver.AlarmSeverity.forEach(function (e) {
                var i = this.getAcknowledgedAlarmCount(e);
                if (i > 0) {
                    a.a[e.name] = i
                }
            }, this._alarmState);
            if (_twaver.isEmptyObject(a.n)) {
                delete a.n
            }
            if (_twaver.isEmptyObject(a.a)) {
                delete a.a
            }
            if (_twaver.isEmptyObject(a)) {
                delete t.p.alarmState
            }
        }
    }, serializeStyleJson: function (e, i, t, s) {
        e.serializeStyleJson(this, i, t, s)
    }, deserializeJson: function (e, i) {
        twaver.Element.superClass.deserializeJson.call(this, e, i);
        if (e.settings.isStyleSerializable) {
            for (var t in i.s) {
                this.deserializeStyleJson(e, i.s[t], t)
            }
        }
    }, deserializeStyleJson: function (e, i, t) {
        e.deserializeStyleJson(this, i, t)
    }, deserializePropertyJson: function (e, i, t) {
        if (t === "alarmState") {
            if (e.settings.getPropertyType("alarmState") === "alarmstate") {
                var s;
                for (s in i.n) {
                    this._alarmState.setNewAlarmCount(twaver.AlarmSeverity.getByName(s), i.n[s])
                }
                for (s in i.a) {
                    this._alarmState.setAcknowledgedAlarmCount(twaver.AlarmSeverity.getByName(s), i.a[s])
                }
            }
        } else {
            twaver.Element.superClass.deserializePropertyJson.call(this, e, i, t)
        }
    }});
    _twaver.addMethod(s, {serializeJson: function (e, i, t) {
        s.superClass.serializeJson.call(this, e, i, t);
        this.serializePropertyJson(e, "image", i, t);
        this.serializePropertyJson(e, "location", i, t);
        if (_twaver.num(this._width) && this._width >= 0) {
            this.serializePropertyJson(e, "width", i, t)
        }
        if (_twaver.num(this._height) && this._height >= 0) {
            this.serializePropertyJson(e, "height", i, t)
        }
    }});
    _twaver.addMethod(twaver.Link, {serializeJson: function (e, i, t) {
        twaver.Link.superClass.serializeJson.call(this, e, i, t);
        this.serializePropertyJson(e, "fromNode", i, t);
        this.serializePropertyJson(e, "toNode", i, t)
    }});
    _twaver.addMethod(twaver.Follower, {serializeJson: function (e, i, t) {
        twaver.Follower.superClass.serializeJson.call(this, e, i, t);
        this.serializePropertyJson(e, "host", i, t)
    }});
    _twaver.addMethod(a, {serializeJson: function (e, i, t) {
        a.superClass.serializeJson.call(this, e, i, t);
        this.serializePropertyJson(e, "expanded", i, t)
    }});
    _twaver.addMethod(twaver.ShapeNode, {serializeJson: function (e, i, t) {
        twaver.ShapeNode.superClass.serializeJson.call(this, e, i, t);
        this.serializePropertyJson(e, "points", i, t);
        this.serializePropertyJson(e, "segments", i, t)
    }});
    _twaver.addMethod(twaver.ShapeLink, {serializeJson: function (e, i, t) {
        twaver.ShapeLink.superClass.serializeJson.call(this, e, i, t);
        this.serializePropertyJson(e, "points", i, t)
    }});
    _twaver.addMethod(twaver.RotatableNode, {serializeJson: function (e, i, t) {
        twaver.RotatableNode.superClass.serializeJson.call(this, e, i, t);
        this.serializePropertyJson(e, "angle", i, t)
    }});
    _twaver.addMethod(twaver.DataBox, {serializeJson: function (e, i, t) {
        if (e.settings.isClientSerializable && this._clientMap) {
            for (var s in this._clientMap) {
                this.serializeClientJson(e, s, i, t)
            }
        }
        this.serializePropertyJson(e, "name", i, t);
        this.serializePropertyJson(e, "icon", i, t);
        this.serializePropertyJson(e, "toolTip", i, t)
    }, serializePropertyJson: function (e, i, t, s) {
        e.serializePropertyJson(this, i, t, s)
    }, serializeClientJson: function (e, i, t, s) {
        e.serializeClientJson(this, i, t, s)
    }, deserializeJson: function (e, i) {
        var t;
        for (t in i.p) {
            this.deserializePropertyJson(e, i.p[t], t)
        }
        if (e.settings.isClientSerializable) {
            for (t in i.c) {
                this.deserializeClientJson(e, i.c[t], t)
            }
        }
    }, deserializePropertyJson: function (e, i, t) {
        e.deserializePropertyJson(this, i, t)
    }, deserializeClientJson: function (e, i, t) {
        e.deserializeClientJson(this, i, t)
    }});
    _twaver.addMethod(twaver.ElementBox, {serializeJson: function (e, i, t) {
        if (e.settings.isLayerBoxSerializable) {
            t.layers = [];
            this._layerBox.forEachByDepthFirst(function (e) {
                var i = {};
                t.layers.push(i);
                if (this._layerBox.getDefaultLayer() !== e) {
                    i.id = e.getId()
                }
                if (e.getName()) {
                    i.name = e.getName()
                }
                i.visible = e.isVisible();
                i.editable = e.isEditable();
                i.movable = e.isMovable()
            }, null, this)
        }
        if (e.settings.isStyleSerializable && this._styleMap) {
            for (var s in this._styleMap) {
                this.serializeStyleJson(e, s, i, t)
            }
        }
        twaver.ElementBox.superClass.serializeJson.call(this, e, i, t)
    }, serializeStyleJson: function (e, i, t, s) {
        e.serializeStyleJson(this, i, t, s)
    }, deserializeStyleJson: function (e, i, t) {
        e.deserializeStyleJson(this, i, t)
    }, deserializeJson: function (e, i) {
        twaver.ElementBox.superClass.deserializeJson.call(this, e, i);
        if (e.settings.isLayerBoxSerializable && i.layers) {
            this._layerBox.clear();
            if (i.layers) {
                var t = i.layers.length;
                for (var s = 0; s < t; s++) {
                    var a;
                    var r = i.layers[s];
                    if (r.id != null) {
                        a = new twaver.Layer(r.id);
                        this._layerBox.add(a)
                    } else {
                        a = this._layerBox.getDefaultLayer();
                        this._layerBox.moveToBottom(a)
                    }
                    if (r.name) {
                        a.setName(r.name)
                    }
                    if (r.visible != null) {
                        a.setVisible(r.visible)
                    }
                    if (r.editable != null) {
                        a.setEditable(r.editable)
                    }
                    if (r.movable != null) {
                        a.setMovable(r.movable)
                    }
                }
            }
        }
        if (e.settings.isStyleSerializable) {
            for (var n in i.s) {
                this.deserializeStyleJson(e, i.s[n], n)
            }
        }
    }})
})(window);
(function (t, a) {
    var r = _twaver.math;
    var n = _twaver.html;
    var s = twaver.List;
    var h = twaver.Node;
    var e = twaver.Group;
    twaver.layout.SpringLayouter = function (i) {
        this._network = i;
        this._damper = 1;
        this._maxMotion = 0;
        this._motionRatio = 0;
        this._isAdjusting = false;
        this._timer = null;
        this._snodeMap = {};
        this._snodes = new s;
        this._slinks = new s;
        this._network.getElementBox().addDataBoxChangeListener(this._handleDataBoxChange, this);
        this._network.getElementBox().addDataPropertyChangeListener(this._handleDataPropertyChange, this);
        this._network.addPropertyChangeListener(this._handleNetworkPropertyChange, this)
    };
    _twaver.ext("twaver.layout.SpringLayouter", Object, {_nodeRepulsionFactor: .6, _linkRepulsionFactor: .6, _limitBounds: null, _interval: 50, _stepCount: 10, _motionLimit: .01, start: function () {
        if (this._timer) {
            return
        }
        var i = this;
        var a = function () {
            i.relax.call(i)
        };
        this._timer = t.setInterval(a, this._interval);
        this._damper = 1
    }, stop: function () {
        if (this._timer) {
            t.clearInterval(this._timer);
            this._timer = null
        }
    }, relax: function () {
        if (this._damper < .1 && this._maxMotion < this._motionLimit) {
            return
        }
        this._rebuild();
        var i = this._snodes.size();
        for (var t = 0; t < this._stepCount; t++) {
            this._slinks.forEach(this._relaxLink, this);
            for (var a = 0; a < i; a++) {
                for (var r = 0; r < i; r++) {
                    var n = this._snodes.get(a);
                    var s = this._snodes.get(r);
                    if (n != s) {
                        this._relaxNodePair(n, s)
                    }
                }
            }
            this._moveNodes()
        }
        this._isAdjusting = true;
        for (var t = 0; t < i; t++) {
            var h = this._snodes.get(t);
            if (!h.fix) {
                h.element.setLocation(h.x, h.y)
            }
        }
        this._isAdjusting = false
    }, isRunning: function () {
        return!!this._timer
    }, getNetwork: function () {
        return this._network
    }, isVisible: function (i) {
        return this._network.isVisible(i)
    }, isMovable: function (i) {
        if (!this._network.isMovable(i)) {
            return false
        }
        if (this._network.getSelectionModel().contains(i)) {
            return false
        }
        if (i instanceof e) {
            return false
        }
        return true
    }, getNodeRepulsionFactor: function () {
        return this._nodeRepulsionFactor
    }, setNodeRepulsionFactor: function (i) {
        if (i < .02) {
            i = .02
        }
        this._nodeRepulsionFactor = i;
        this._damper = 1
    }, getLinkRepulsionFactor: function () {
        return this._linkRepulsionFactor
    }, setLinkRepulsionFactor: function (i) {
        if (i < .02) {
            i = .02
        }
        this._linkRepulsionFactor = i;
        this._damper = 1
    }, getStepCount: function () {
        return this._stepCount
    }, setStepCount: function (i) {
        this._stepCount = i;
        this._damper = 1
    }, getInterval: function () {
        return this._interval
    }, setInterval: function (i) {
        if (this._interval === i) {
            return
        }
        this._interval = i;
        if (this._timer) {
            t.clearInterval(this._timer);
            var a = this;
            var r = function () {
                a.relax.call(a)
            };
            this._timer = t.setInterval(r, this._interval)
        }
    }, getLimitBounds: function () {
        return this._limitBounds
    }, setLimitBounds: function (i) {
        this._limitBounds = i;
        this._damper = 1
    }, _handleDataPropertyChange: function (i) {
        if (!this._isAdjusting) {
            this._damper = 1
        }
    }, _handleDataBoxChange: function (i) {
        if (this._network.getElementBox().size() === 0) {
            this._damper = 0
        } else {
            this._damper = 1
        }
    }, _handleNetworkPropertyChange: function (i) {
        if (i.property === "elementBox") {
            var t = i.oldValue;
            if (t != null) {
                t.removeDataBoxChangeListener(this._handleDataBoxChange, this);
                t.removeDataPropertyChangeListener(this._handleDataPropertyChange, this)
            }
            this._network.getElementBox().addDataBoxChangeListener(this._handleDataBoxChange, this);
            this._network.getElementBox().addDataPropertyChangeListener(this._handleDataPropertyChange, this)
        }
    }, _relaxLink: function (i) {
        var t = i.toNode.x - i.fromNode.x;
        var a = i.toNode.y - i.fromNode.y;
        var r = Math.sqrt(t * t + a * a);
        var n = t * .25;
        var s = a * .25;
        n /= i.length * 100;
        var h = i.length;
        var e = h * 100;
        var _ = s;
        s = s / e;
        _ /= i.length * 100;
        i.toNode.dx = i.toNode.dx - n * r;
        i.toNode.dy = i.toNode.dy - s * r;
        i.fromNode.dx = i.fromNode.dx + n * r;
        i.fromNode.dy = i.fromNode.dy + s * r
    }, _relaxNodePair: function (i, t) {
        var a = 0;
        var r = 0;
        var n = i.x - t.x;
        var s = i.y - t.y;
        var h = n * n + s * s;
        if (h === 0) {
            a = Math.random();
            r = Math.random()
        } else if (h < 36e4) {
            a = n / h;
            r = s / h
        }
        var e = i.repulsion * t.repulsion / 100;
        var _ = e * .25;
        i.dx += a * _;
        i.dy += r * _;
        t.dx -= a * _;
        t.dy -= r * _
    }, _moveNodes: function () {
        var i = this._maxMotion;
        var t = 0;
        for (var a = 0, r = this._snodes.size(); a < r; a++) {
            var n = this._snodes.get(a);
            var s = n.dx;
            var h = n.dy;
            s *= this._damper;
            h *= this._damper;
            n.dx = s / 2;
            n.dy = h / 2;
            var e = Math.sqrt(s * s + h * h);
            if (!n.fix) {
                n.x = n.x + Math.max(-30, Math.min(30, s));
                n.y = n.y + Math.max(-30, Math.min(30, h));
                if (!this._limitBounds) {
                    if (n.x < 1) {
                        this._adjustLocation(1, 0)
                    }
                    if (n.y < 1) {
                        this._adjustLocation(0, 1)
                    }
                } else {
                    if (n.x < this._limitBounds.x) {
                        n.x = this._limitBounds.x;
                        this._adjustLocation(1, 0)
                    }
                    if (n.y < this._limitBounds.y) {
                        n.y = this._limitBounds.y;
                        this._adjustLocation(0, 1)
                    }
                    var _;
                    var f = this._network.getElementUI(n.element);
                    if (f) {
                        _ = f._viewRect
                    } else {
                        _ = n.element.getRect()
                    }
                    if (_) {
                        if (n.x + _.width > this._limitBounds.x + this._limitBounds.width) {
                            n.x = this._limitBounds.x + this._limitBounds.width - _.width;
                            this._adjustLocation(-1, 0)
                        }
                        if (n.y + _.height > this._limitBounds.y + this._limitBounds.height) {
                            n.y = this._limitBounds.y + this._limitBounds.height - _.height;
                            this._adjustLocation(0, -1)
                        }
                    }
                }
            }
            t = Math.max(e, t)
        }
        this._maxMotion = t;
        if (this._maxMotion > 0)this._motionRatio = i / this._maxMotion - 1; else this._motionRatio = 0;
        this._damp()
    }, _damp: function () {
        if (this._motionRatio <= .001) {
            if ((this._maxMotion < .2 || this._maxMotion > 1 && this._damper < .9) && this._damper > .01)this._damper -= .01; else if (this._maxMotion < .4 && this._damper > .003)this._damper -= .003; else if (this._damper > 1e-4)this._damper -= 1e-4
        }
        if (this._maxMotion < this._motionLimit) {
            this._damper = 0
        }
    }, _rebuild: function () {
        this._snodeMap = {};
        this._snodes.clear();
        this._slinks.clear();
        this._network.getElementBox().forEach(function (i) {
            if (this.isVisible(i)) {
                if (i instanceof twaver.Link) {
                    this._addLink(i)
                } else if (i instanceof h) {
                    this._addNode(i)
                }
            }
        }, this)
    }, _addNode: function (i) {
        var t = this._snodeMap[i.getId()];
        if (!!t) {
            return t
        }
        t = {};
        t.element = i;
        t.repulsion = this._getRepulsion(i);
        t.x = i.getX();
        t.y = i.getY();
        t.dx = 0;
        t.dy = 0;
        t.fix = !this.isMovable(i);
        this._snodeMap[i.getId()] = t;
        this._snodes.add(t);
        return t
    }, _addLink: function (i) {
        var t = {};
        t.fromNode = this._addNode(i.getFromNode());
        t.toNode = this._addNode(i.getToNode());
        t.element = i;
        var a = this._network.getElementUI(i.getToNode());
        var r = this._network.getElementUI(i.getFromNode());
        var n, s;
        if (a && a._viewRect && r && r._viewRect) {
            n = a._viewRect.width + r._viewRect.width;
            s = a._viewRect.height + r._viewRect.height
        } else {
            n = i.getToNode().getWidth() + i.getFromNode().getWidth();
            s = i.getToNode().getHeight() + i.getFromNode().getHeight()
        }
        t.length = Math.floor(Math.sqrt(n * n + s * s) * this._linkRepulsionFactor);
        if (t.length <= 0) {
            t.length = 100
        }
        this._slinks.add(t)
    }, _getRepulsion: function (i) {
        var t = this._network.getElementUI(i);
        var a;
        if (t && t._viewRect) {
            var r = t._viewRect;
            a = Math.floor(Math.sqrt(r.width * r.width + r.height * r.height) * this._nodeRepulsionFactor)
        } else {
            a = 100
        }
        if (a <= 0) {
            a = 100
        }
        return a
    }, _adjustLocation: function (i, t) {
        for (var a = 0, r = this._snodes.size(); a < r; a++) {
            var n = this._snodes.get(a);
            var s;
            var h = this._network.getElementUI(n.element);
            if (h) {
                s = h._viewRect
            } else {
                s = n.element.getRect()
            }
            if (!s) {
                return
            }
            if (i > 0) {
                if (!this._limitBounds || n.x + s.width + i < this._limitBounds.x + this._limitBounds.width) {
                    n.x += i
                }
            } else {
                if (!this._limitBounds || n.x + i > this._limitBounds.x) {
                    n.x += i
                }
            }
            if (t > 0) {
                if (!this._limitBounds || n.y + s.height + t < this._limitBounds.y + this._limitBounds.height) {
                    n.y += t
                }
            } else {
                if (!this._limitBounds || n.y + t > this._limitBounds.y) {
                    n.y += t
                }
            }
        }
    }});
    twaver.layout.CloudLayouter = function (i) {
        twaver.layout.CloudLayouter.superClass.constructor.apply(this, arguments);
        this._network = i;
        this._centerX = 0;
        this._centerY = 0;
        this._radius = 1;
        this._rect = null;
        this._localPoint = null;
        this._lastWidth = -1e3;
        this._lastHeight = -1e3;
        this._nodes = new s;
        this._sa = 0;
        this._ca = 0;
        this._sb = 0;
        this._cb = 0;
        this._sc = 0;
        this._cc = 0;
        this._lasta = 0;
        this._lastb = 0;
        this._active = false;
        this._horizontalElliptical = 1;
        this._verticalElliptical = 1;
        this._timer = null;
        this._centering = false;
        this._centeringNode = null;
        this._freeze = false;
        if (this._network.getClassName() === "twaver.network.Network") {
            this._network.setInteractions([new twaver.network.interaction.SelectInteraction(this._network)])
        } else {
            this._network.setInteractions([new twaver.canvas.interaction.SelectInteraction(this._network)])
        }
    };
    _twaver.ext("twaver.layout.CloudLayouter", twaver.PropertyChangeDispatcher, {__accessor: ["updateNodeFunction", "mouseMoveFunction", "mouseOverFunction", "percentPadding", "ceaseRate", "ceaseLimit"], __bool: ["elliptical", "active", "updateLayoutRectOnResized", "reloadOnDataBoxChanged"], _moveSpeed: 2, _ceaseRate: .9, _ceaseLimit: .01, _percentPadding: .2, _elliptical: true, _interval: 50, _reloadOnDataBoxChanged: true, _updateLayoutRectOnResized: true, getNetwork: function () {
        return this._network
    }, isLayoutable: function (i) {
        return this._network.isVisible(i) && this._network.isMovable(i)
    }, start: function (i) {
        if (arguments.length === 0) {
            i = true
        }
        if (this._timer) {
            return
        }
        this._installListeners();
        if (i) {
            this.updateLayoutRect(true)
        }
        var a = this;
        var r = function () {
            a._update.call(a)
        };
        this._timer = t.setInterval(r, this._interval);
        this._update()
    }, stop: function () {
        if (this._timer) {
            t.clearInterval(this._timer);
            this._timer = null
        }
    }, isRunning: function () {
        return!!this._timer
    }, getInterval: function () {
        return this._interval
    }, setInterval: function (i) {
        if (this._interval === i) {
            return
        }
        var a = this._interval;
        this._interval = i;
        if (this._timer) {
            t.clearInterval(this._timer);
            var r = this;
            var n = function () {
                r._update.call(r)
            };
            this._timer = t.setInterval(n, this._interval)
        }
        this.firePropertyChange("interval", a, i)
    }, getMoveSpeed: function () {
        return this._moveSpeed
    }, setMoveSpeed: function (i) {
        var t = this._moveSpeed;
        this._moveSpeed = i;
        this.firePropertyChange("moveSpeed", t, i)
    }, getLayoutRect: function () {
        var i = this._network.getView().offsetWidth / this._network.getZoom();
        var t = this._network.getView().offsetHeight / this._network.getZoom();
        var a = i * this._percentPadding;
        var r = t * this._percentPadding;
        return{x: a, y: r, width: i - 2 * a, height: t - 2 * r}
    }, getCount: function () {
        return this._nodes.size()
    }, updateLayoutRect: function (i) {
        var t = this._radius;
        this._rect = this.getLayoutRect();
        if (this._rect.width <= 2) {
            this._rect.width = 2
        }
        if (this._rect.height <= 2) {
            this._rect.height = 2
        }
        this._radius = Math.min(this._rect.width / 2, this._rect.height / 2);
        if (this.isElliptical()) {
            this._horizontalElliptical = this._rect.width / 2 / this._radius;
            this._verticalElliptical = this._rect.height / 2 / this._radius
        } else {
            this._horizontalElliptical = 1;
            this._verticalElliptical = 1
        }
        this._centerX = this._rect.x + this._rect.width / 2;
        this._centerY = this._rect.y + this._rect.height / 2;
        if (i) {
            this.reload()
        } else {
            this._lasta = 1;
            this._lastb = 1;
            var a = this._nodes.size();
            for (var r = 0; r < a; r++) {
                var n = this._nodes.get(r);
                n.cx *= this._radius / t;
                n.cy *= this._radius / t;
                n.cz *= this._radius / t
            }
            if (this._freeze) {
                this._updateNodes(0, 0, 0)
            } else {
                this._update()
            }
        }
        this._lastWidth = this._network.getView().offsetWidth;
        this._lastHeight = this._network.getView().offsetHeight
    }, reload: function () {
        this._freeze = false;
        this._centeringNode = null;
        this._localPoint = null;
        this._centering = false;
        this._nodes = new s;
        this._box.forEach(function (i) {
            if (i && this.isLayoutable(i)) {
                var t = {};
                t.node = i;
                this._nodes.add(t)
            }
        }, this);
        this._sineCosine(0, 0, 0);
        this._active = false;
        this._lasta = 1;
        this._lastb = 1;
        var t = 0;
        var a = 0;
        var r = this._nodes.size();
        for (i = 0; i < r; i++) {
            t = Math.acos(-1 + (2 * (i + 1) - 1) / r);
            a = Math.sqrt(r * Math.PI) * t;
            var n = this._nodes.get(i);
            n.cx = this._radius * Math.cos(a) * Math.sin(t);
            n.cy = this._radius * Math.sin(a) * Math.sin(t);
            n.cz = this._radius * Math.cos(t)
        }
    }, _sineCosine: function (i, t, a) {
        var r = Math.PI / 180;
        this._sa = Math.sin(i * r);
        this._ca = Math.cos(i * r);
        this._sb = Math.sin(t * r);
        this._cb = Math.cos(t * r);
        this._sc = Math.sin(a * r);
        this._cc = Math.cos(a * r)
    }, handleSelectionChange: function (i) {
        this.centerNode(this._network.getSelectionModel().getLastData())
    }, handleDataBoxChange: function (i) {
        if (this._reloadOnDataBoxChanged || i.kind === "clear") {
            this.reload()
        }
    }, handleMouseMove: function (i) {
        if (!this._centering) {
            this._updateLogicalPoint(i)
        }
        if (!this._mouseMoveFunction) {
            this._active = true
        } else {
            this._active = this._mouseMoveFunction(i)
        }
    }, handleMouseOver: function (i) {
        if (!this._centering) {
            this._updateLogicalPoint(i)
        }
        if (!this._mouseOverFunction) {
            this._active = true
        } else {
            this._active = this._mouseOverFunction(i)
        }
    }, _updateLogicalPoint: function (i) {
        this._localPoint = this._network.getLogicalPoint(i)
    }, handleRollOut: function (i) {
        this._active = false
    }, handleResize: function (i) {
        if (i.kind === "validateEnd") {
            if (!this._updateLayoutRectOnResized) {
                return
            }
            if (Math.abs(this._network.getView().offsetWidth - this._lastWidth) <= 2 && Math.abs(this._network.getView().offsetHeight - this._lastHeight) <= 2) {
                return
            }
            this.updateLayoutRect()
        }
    }, handleNetworkPropertyChange: function (i) {
        if (i.property === "elementBox") {
            this._box.removeDataBoxChangeListener(this.handleDataBoxChange, this);
            this._box = this._network.getElementBox();
            this._box.addDataBoxChangeListener(this.handleDataBoxChange, this);
            this.reload()
        }
        if (i.property === "zoom") {
            this._localPoint = null;
            this.updateLayoutRect()
        }
    }, _adjustIndex: function () {
        this._nodes.sort(this._sortFunction);
        var i = this._nodes.size();
        for (var t = 0; t < i; t++) {
            var a = this._nodes.get(t).node;
            var r = this._box.getDatas().indexOf(a);
            this._box.getDatas().removeAt(r);
            this._box.getDatas().add(a, t);
            this._box.fireIndexChange(a, r, t);
            this.updateNode(a, t, i, this._nodes.get(t).alpha)
        }
    }, _sortFunction: function (i, t) {
        if (t.cz > i.cz) {
            return 1
        } else if (t.cz < i.cz) {
            return-1
        } else {
            return 0
        }
    }, updateNode: function (i, t, a, r) {
        if (this._updateNodeFunction) {
            this._updateNodeFunction(i, t, a, r)
        }
    }, _update: function () {
        if (this._freeze) {
            return
        }
        var i;
        var t;
        if (this._centering) {
            if (this._centeringNode) {
                var a = this.isAtCenter(this._centeringNode.node, this._centeringNode.perspective, this._centeringNode.cx, this._centeringNode.cy, this._centeringNode.cz);
                if (a) {
                    this._freeze = true;
                    this._centering = false;
                    this._centeringNode = null;
                    return
                }
            }
        }
        if (!this._freeze && (this._active || this._centering) && this._localPoint) {
            if (!this.isElliptical()) {
                i = (this._centerY - this._localPoint.y) / this._radius * this._moveSpeed;
                t = (this._localPoint.x - this._centerX) / this._radius * this._moveSpeed
            } else {
                i = (this._centerY - this._localPoint.y) / (this._rect.height / 2) * this._moveSpeed;
                t = (this._localPoint.x - this._centerX) / (this._rect.width / 2) * this._moveSpeed
            }
        } else {
            i = this._lasta * this._ceaseRate;
            t = this._lastb * this._ceaseRate
        }
        this._lasta = i;
        this._lastb = t;
        if (Math.abs(i) > this._ceaseLimit || Math.abs(t) > this._ceaseLimit) {
            var r = 0;
            this._sineCosine(i, t, r);
            for (var n = 0, s = this._nodes.size(); n < s; n++) {
                var h = this._nodes.get(n);
                var e = h.cx;
                var _ = h.cy * this._ca + h.cz * -this._sa;
                var f = h.cy * this._sa + h.cz * this._ca;
                var u = e * this._cb + f * this._sb;
                var o = _;
                var v = e * -this._sb + f * this._cb;
                var l = u * this._cc + o * -this._sc;
                var c = u * this._sc + o * this._cc;
                var d = v;
                h.cx = l;
                h.cy = c;
                h.cz = d;
                var x = this._radius * 2;
                x = x / (x + d);
                h.perspective = x;
                h.alpha = (this._radius - d) / (this._radius * 2);
                var g = this._horizontalElliptical * l * x - this._horizontalElliptical * 2 + this._centerX;
                var b = c * x * this._verticalElliptical + this._centerY;
                h.node.setCenterLocation(g, b)
            }
            this._adjustIndex()
        }
    }, centerNode: function (i) {
        if (i && this.isLayoutable(i)) {
            if (this._centeringNode && i === this._centeringNode.node && this._freeze) {
                return
            }
            for (var t = 0, a = this._nodes.size(); t < a; t++) {
                var r = this._nodes.get(t);
                if (r && i === r.node) {
                    this._centering = true;
                    this._freeze = false;
                    this._active = true;
                    this._centeringNode = r;
                    this._localPoint = this.createControlPoint(this._centeringNode.node);
                    break
                }
            }
        } else {
            this._centering = false;
            this._freeze = false;
            this._active = false;
            this._localPoint = null
        }
    }, createControlPoint: function (i) {
        var t = i.getCenterLocation();
        var a = this.getLayoutRect();
        var r = a.x + a.width / 2;
        var n = a.y + a.height / 2;
        var s = Math.atan2(t.y - n, t.x - r);
        var h = a.width + a.height;
        return{x: r + h * Math.cos(s), y: n + h * Math.sin(s)}
    }, isAtCenter: function (i, t, a, r, n) {
        if (this._moveSpeed <= 0) {
            return true
        }
        var s = 16 / this._moveSpeed;
        if (s > 20) {
            s = 20
        } else if (s < 2) {
            s = 2
        }
        return-n / Math.sqrt(a * a + r * r) > s
    }, _updateNodes: function (i, t, a) {
        this._sineCosine(i, t, a);
        for (var r = 0, n = this._nodes.size(); r < n; r++) {
            var s = this._nodes.get(r);
            var h = s.cx;
            var e = s.cy * this._ca + s.cz * -this._sa;
            var _ = s.cy * this._sa + s.cz * this._ca;
            var f = h * this._cb + _ * this._sb;
            var u = e;
            var o = h * -this._sb + _ * this._cb;
            var v = f * this._cc + u * -this._sc;
            var l = f * this._sc + u * this._cc;
            var c = o;
            s.cx = v;
            s.cy = l;
            s.cz = c;
            var d = this._radius * 2;
            d = d / (d + c);
            s.perspective = d;
            var x = this._horizontalElliptical * v * d - this._horizontalElliptical * 2 + this._centerX;
            var g = l * d * this._verticalElliptical + this._centerY;
            s.node.setCenterLocation(x, g)
        }
        this._adjustIndex()
    }, _installListeners: function () {
        this._box = this._network.getElementBox();
        this._box.addDataBoxChangeListener(this.handleDataBoxChange, this);
        this._network.getSelectionModel().addSelectionChangeListener(this.handleSelectionChange, this);
        this._network.addViewListener(this.handleResize, this);
        n.addEventListener("mouseout", "handleRollOut", this._network.getView(), this);
        n.addEventListener("mousemove", "handleMouseMove", this._network.getView(), this);
        n.addEventListener("mouseover", "handleMouseOver", this._network.getView(), this);
        this._network.addPropertyChangeListener(this.handleNetworkPropertyChange, this)
    }, _uninstallListeners: function () {
        this._box.removeDataBoxChangeListener(this.handleDataBoxChange, this);
        this._network.getSelectionModel().removeSelectionChangeListener(this.handleSelectionChange, this);
        this._network.removeViewListener(this.handleResize, this);
        n.removeEventListener("mouseout", this._network.getView(), this);
        n.removeEventListener("mousemove", this._network.getView(), this);
        n.removeEventListener("mouseover", this._network.getView(), this);
        this._network.removePropertyChangeListener(this.handleNetworkPropertyChange, this)
    }});
    twaver.layout.AutoLayouter = function (i) {
        this._box = i
    };
    _twaver.ext("twaver.layout.AutoLayouter", Object, {_expandGroup: false, _repulsion: 1, _type: null, _animate: true, _explicitXOffset: Number.NaN, _explicitYOffset: Number.NaN, _xOffset: 0, _yOffset: 0, isExpandGroup: function () {
        return this._expandGroup
    }, setExpandGroup: function (i) {
        this._expandGroup = i
    }, getRepulsion: function () {
        return this._repulsion
    }, setRepulsion: function (i) {
        this._repulsion = i
    }, getType: function () {
        return this._type
    }, isAnimate: function () {
        return this._animate
    }, setAnimate: function (i) {
        this._animate = i
    }, getElementBox: function () {
        return this._box
    }, getExplicitXOffset: function () {
        return this._explicitXOffset
    }, setExplicitXOffset: function (i) {
        this._explicitXOffset = i
    }, getExplicitYOffset: function () {
        return this._explicitYOffset
    }, setExplicitYOffset: function (i) {
        this._explicitYOffset = i
    }, getDimension: function (i) {
        if (i instanceof e && i.getChildrenSize() > 0) {
            var t = null;
            for (var a = 0, n = i.getChildrenSize(); a < n; a++) {
                var s = i.getChildAt(a);
                if (s instanceof h) {
                    if (t) {
                        t = r.unionRect(t, s.getRect())
                    } else {
                        t = s.getRect()
                    }
                }
            }
            if (t) {
                return{width: t.width, height: t.height}
            } else {
                return null
            }
        } else {
            return{width: i.getWidth(), height: i.getHeight()}
        }
    }, isVisible: function (i) {
        return true
    }, isMovable: function (i) {
        return true
    }, getGroupLayoutType: function (i) {
        return this._type
    }, getElements: function () {
        var i, t = this._box;
        var a = t.getSelectionModel().size() > 1;
        if (a) {
            i = t.getSelectionModel().getSelection()
        } else {
            i = new s;
            t.forEachByBreadthFirst(i.add, null, i)
        }
        this._xOffset = -1;
        this._yOffset = -1;
        var r = new s;
        for (var n = 0, e = i.size(); n < e; n++) {
            var _ = i.get(n);
            if (this.isVisible(_)) {
                if (_ instanceof twaver.Link) {
                    r.add(_)
                } else if (this.isMovable(_) && _ instanceof h) {
                    r.add(_);
                    if (a) {
                        if (this._xOffset < 0 || _.getX() < this._xOffset) {
                            this._xOffset = _.getX()
                        }
                        if (this._yOffset < 0 || _.getY() < this._yOffset) {
                            this._yOffset = _.getY()
                        }
                    }
                }
            }
        }
        if (!a) {
            if (!isNaN(this._explicitXOffset)) {
                this._xOffset = this._explicitXOffset
            } else {
                this._xOffset = 50 / this._repulsion
            }
            if (!isNaN(this._explicitYOffset)) {
                this._yOffset = this._explicitYOffset
            } else {
                this._yOffset = 50 / this._repulsion
            }
        }
        return r
    }, getLayoutResult: function (i) {
        var t = {};
        this.doLayoutImpl(i, null, t);
        return t
    }, doLayout: function (i, t) {
        return this.doLayoutImpl(i, t)
    }, doLayoutImpl: function (i, t, a) {
        var r = this;
        var n = t;
        t = function () {
            r._box._layoutMovingElements = false;
            if (n)n()
        };
        this._type = i;
        var h = null;
        if ("round" === i) {
            h = new yt
        } else if ("symmetry" === i) {
            h = new Rt
        } else if ("hierarchic" === i) {
            h = new Yt
        } else if (i === "topbottom" || i === "bottomtop" || i === "rightleft" || i === "leftright") {
            h = new et
        }
        if (h == null) {
            return false
        }
        r._box._layoutMovingElements = true;
        var e = {};
        var _ = this.getElements();
        var f = new Pt(this, _, true, null);
        _ = f.process();
        var u = new Nt(this, _, i, true, null);
        try {
            h.i2(u)
        } catch (o) {
            f.resetGroup();
            if (t != null) {
                t()
            }
            return false
        }
        var v, l;
        for (v in u._a) {
            l = u._a[v];
            var c = u.g4(l);
            e[v] = {x: c.x + this._xOffset, y: c.y + this._yOffset}
        }
        var d;
        if (i === "rightleft" || i === "leftright" || i === "bottomtop") {
            var x = Pt.createMatrix(i);
            var g = Number.MAX_VALUE;
            var b = Number.MAX_VALUE;
            for (v in e) {
                l = u._a[v];
                d = e[v];
                var w = x.transform(d);
                d.x = w.x;
                d.y = w.y;
                var m;
                if (i === "rightleft" || i === "leftright") {
                    m = w.x - u.g9(l) / 2 / this._repulsion;
                    if (m < g) {
                        g = m
                    }
                    m = w.y - u.gj(l) / 2 / this._repulsion;
                    if (m < b) {
                        b = m
                    }
                } else {
                    m = w.x - u.gj(l) / 2 / this._repulsion;
                    if (m < g) {
                        g = m
                    }
                    m = w.y - u.g9(l) / 2 / this._repulsion;
                    if (m < b) {
                        b = m
                    }
                }
            }
            for (v in e) {
                l = u._a[v];
                d = e[v];
                d.x = d.x - g + this._xOffset;
                d.y = d.y - b + this._yOffset
            }
        }
        if (a == null && this._animate) {
            var y = new s;
            var p = new s;
            for (v in e) {
                y.add(u._a[v].node);
                p.add(e[v])
            }
            twaver.animate.AnimateManager.endAnimate();
            twaver.animate.AnimateManager.start(new twaver.animate.AnimateCenterLocation(y, p, function () {
                f.resetGroup();
                if (t != null) {
                    _twaver.callLater(t)
                }
            }))
        } else {
            for (v in e) {
                l = u._a[v];
                d = e[v];
                if (a == null) {
                    l.node.setCenterLocation(d.x, d.y)
                } else {
                    a[l.node.getId()] = d
                }
            }
            f.resetGroup();
            if (t != null) {
                _twaver.callLater(t)
            }
        }
        return true
    }});
    var _ = function (i, t) {
        this.x = i;
        this.y = t
    };
    _twaver.ext(_, Object, {equals: function (i) {
        if (this === i)return true;
        if (!(i instanceof _)) {
            return false
        } else {
            return i.x == this.x && i.y == this.y
        }
    }});
    var f = function (i, t) {
        this.width = i;
        this.height = t
    };
    _twaver.ext(f, Object, {});
    var u = function (i, t) {
        this.x = i;
        this.y = t
    };
    _twaver.ext(u, Object, {});
    var o = function () {
        if (arguments.length === 2) {
            o.superClass.constructor.call(this, arguments[1].width, arguments[1].height);
            this.x = arguments[0].x;
            this.y = arguments[0].y
        } else {
            o.superClass.constructor.call(this, arguments[2], arguments[3]);
            this.x = arguments[0];
            this.y = arguments[1]
        }
    };
    _twaver.ext(o, f, {});
    var v = function (i, t) {
        if (v.a2(i.x, t.x)) {
            this._a = 1;
            this._b = 0;
            this._c = -i.x
        } else {
            this._b = -1;
            var a = (t.y - i.y) / (t.x - i.x);
            var r = i.y - i.x * a;
            this._a = a;
            this._c = r
        }
    };
    _twaver.ext(v, Object, {a3: function () {
        return this._a
    }, a4: function () {
        return this._b
    }, a5: function () {
        return this._c
    }});
    v.a6 = function (i, t) {
        if (v.a1(i.a3()) && v.a1(t.a3()))return null;
        if (v.a1(i.a4()) && v.a1(t.a4()))return null;
        if (v.a1(t.a4())) {
            var a = i;
            i = t;
            t = a
        }
        var r = i.a3();
        var n = i.a4();
        var s = -i.a5();
        var h;
        var e;
        if (!v.a1(i.a3())) {
            h = t.a4() - t.a3() / i.a3() * i.a4();
            e = -t.a5() - t.a3() / i.a3() * -i.a5()
        } else {
            h = t.a4();
            e = -t.a5()
        }
        var f = e / h;
        var u = (s - f * n) / r;
        return new _(u, f)
    };
    v.a1 = function (i) {
        return v.a2(i, 0)
    };
    v.a2 = function (i, t) {
        return Math.abs(i - t) < 1e-5
    };
    var l = function (i) {
        this._a = new A;
        if (i) {
            for (var t = 0; t < i.size(); t++)this._a.aa(i.get(t))
        }
    };
    _twaver.ext(l, Object, {c: function () {
        return this._a.ah()
    }, d: function () {
        return this._a.ah()
    }, a: function () {
        var i = new s;
        for (var t = this.c(); t.i1(); t.i2())i.add(t.i6(), 0);
        return new l(i)
    }, b: function () {
        return this._a.ay()
    }});
    var c = function (i, t) {
        this.x = i;
        this.y = t
    };
    _twaver.ext(c, Object, {a: function (i, t) {
        this.x = i;
        this.y = t
    }});
    var d = function (i, t) {
        this.x = i || 0;
        this.y = t || 0
    };
    _twaver.ext(d, Object, {b: function () {
        return new d(this.x, this.y)
    }, a: function (i) {
        this.z = i
    }, c: function () {
        return this.x
    }, d: function () {
        return this.y
    }, f: function (i, t) {
        this.x = i;
        this.y = t
    }});
    var x = function (i) {
        this._c = new A;
        if (i) {
            this.ac(i.a8().b());
            this.ad(i.a9().b())
        } else {
            this.ac(new d);
            this.ad(new d)
        }
    };
    _twaver.ext(x, Object, {a6: function () {
        return this.a5(this)
    }, ac: function (i) {
        i.a(this);
        this._a = i
    }, ad: function (i) {
        i.a(this);
        this._b = i
    }, a8: function () {
        return this._a
    }, a9: function () {
        return this._b
    }, a1: function (i, t) {
        return this.a4(i, t, this.aa())
    }, a2: function () {
        return this._c.ay()
    }, a7: function (i) {
        return this._c.ak(i)
    }, aa: function () {
        if (this._c.ay() === 0)return null; else return this._c.as()
    }, a3: function () {
        this._c.af()
    }, i2: function (i) {
        var t = this.a7(i);
        if (t != null)return new _(t.x, t.y); else return null
    }, i1: function () {
        return this.a2()
    }, i6: function () {
        var i = this.a8();
        return new _(i.c(), i.d())
    }, i7: function () {
        var i = this.a9();
        return new _(i.c(), i.d())
    }, i8: function (i) {
        this.a8().f(i.x, i.y)
    }, i9: function (i) {
        this.a9().f(i.x, i.y)
    }, i3: function (i, t, a) {
        var r = this.a7(i);
        if (r != null)r.a(t, a)
    }, i4: function (i, t) {
        this.a1(i, t)
    }, i5: function () {
        this.a3()
    }});
    var g = function (i) {
        g.superClass.constructor.call(this, i)
    };
    _twaver.ext(g, x, {a5: function (i) {
        return new g(i)
    }, a4: function (i, t, a) {
        var r = new c(i, t);
        this.ab(r, a);
        return r
    }, ab: function (i, t) {
        this._c.an(i, this._c.al(t))
    }});
    var b = function () {
        if (arguments.length === 2) {
            var i = arguments[0], t = arguments[1];
            this._s = false;
            this._w = 30;
            this._h = 30;
            this._x = i - this._w / 2;
            this._y = t - this._h / 2
        } else {
            var a = arguments[0];
            this._s = a._s;
            this._w = a._w;
            this._h = a._h;
            this._x = a._x;
            this._y = a._y
        }
    };
    _twaver.ext(b, Object, {m3: function () {
        return this.m2(this)
    }, m4: function () {
        return this._x + this._w / 2
    }, m5: function () {
        return this._y + this._h / 2
    }, m6: function (i, t) {
        this._x = i - this._w / 2;
        this._y = t - this._h / 2
    }, i1: function () {
        return this._x
    }, i2: function () {
        return this._y
    }, i5: function (i, t) {
        this._x = i;
        this._y = t
    }, i3: function () {
        return this._w
    }, i4: function () {
        return this._h
    }, i6: function (i, t) {
        var a = (this._w - i) / 2;
        var r = (this._h - t) / 2;
        this._x += a;
        this._y += r;
        this._w = i;
        this._h = t
    }, m1: function (i) {
        var t, a, r, n;
        if (i.width <= 0) {
            t = this._x;
            a = this._x + this._w;
            r = this._y;
            n = this._y + this._h
        } else {
            t = Math.min(this._x, i.x);
            a = Math.max(this._x + this._w, i.x + i.width);
            r = Math.min(this._y, i.y);
            n = Math.max(this._y + this._h, i.y + i.height)
        }
        i.x = t;
        i.y = r;
        i.width = a - t;
        i.height = n - r
    }});
    var w = function (i) {
        if (i) {
            w.superClass.constructor.call(this, i)
        } else {
            w.superClass.constructor.call(this, 0, 0)
        }
    };
    _twaver.ext(w, b, {m2: function (i) {
        return new w(i)
    }});
    var m = {};
    m.a2 = function (i) {
        var t = rt.a2(Jt.a(i.xa()));
        return m.a4(i, t, m.a3(i, t))
    };
    m.a3 = function (i, t) {
        for (var a = i.x9(); a.i1(); a.i2())t.i7(a.i9(), -1);
        var r = 0;
        var n = new S(i.xa());
        for (var s = i.x9(); s.i1(); s.i2()) {
            var h = s.i9();
            if (t.i2(h) === -1)m.a(h, n, t, r++)
        }
        return r
    };
    m.a6 = function (i) {
        var t = new R;
        var a = m.a2(i);
        for (var r = 0; r < a.length - 1; r++) {
            var n = i.xo(a[r].x2(), a[r + 1].x3());
            t.aa(n)
        }
        return t
    };
    m.a4 = function (i, t, a) {
        var r = [];
        for (var n = 0; n < a; n++)r[n] = new $;
        for (var s = i.x9(); s.i1(); s.i2())r[t.i2(s.i9())].ae(s.i9());
        return r
    };
    m.a = function (i, t, a, r) {
        t.c(i);
        a.i7(i, r);
        while (!t.a()) {
            i = t.b();
            for (var n = i.ag(); n != null; n = n.a8()) {
                var s = n.a3();
                if (a.i2(s) === -1) {
                    a.i7(s, r);
                    t.c(s)
                }
            }
            for (var h = i.ae(); h != null; h = h.a7()) {
                var e = h.a2();
                if (a.i2(e) === -1) {
                    a.i7(e, r);
                    t.c(e)
                }
            }
        }
    };
    m.a1 = function (i, t, a) {
        var r = new O(t, a);
        r.a8(i);
        return r._i
    };
    m.a5 = function (i, t, a) {
        var r = [];
        for (var n = 0; n < a; n++)r[n] = new R;
        for (var s = i.xf(); s.i1(); s.i2())r[t.i2(s.i8())].aa(s.i8());
        return r
    };
    m.a7 = function (i) {
        var t = new R;
        var a = rt.a3(Jt.b(i.xa()));
        var r = rt.a4(Jt.a(i.xh()));
        var n = m.a1(i, r, a);
        var s = m.a5(i, r, n);
        if (s.length > 1) {
            var h = new $;
            for (var e = 0; e < s.length; e++) {
                var _ = s[e];
                var f = null;
                if (_.ay() === 1) {
                    var u = _.c2();
                    if (u.a2().ad() === 1)f = u.a2(); else if (u.a3().ad() === 1)f = u.a3()
                } else {
                    for (var o = _.c1(); o.i1(); o.i2()) {
                        var v = o.i8();
                        if (a.i4(v.a2()))if (f == null)f = v.a2(); else if (f !== v.a2()) {
                            f = null;
                            break
                        }
                        if (!a.i4(v.a3()))continue;
                        if (f == null) {
                            f = v.a3();
                            continue
                        }
                        if (f === v.a3())continue;
                        f = null;
                        break
                    }
                    if (f != null) {
                        var l = _.c2();
                        if (l.a2() !== f)f = l.a2(); else f = l.a3()
                    }
                }
                if (f != null)h.aa(f)
            }
            var c;
            for (var d = h.x4(); !h.ar(); d = c) {
                c = h.x4();
                t.ac(i.xo(d, c))
            }
        }
        return t
    };
    var y = function () {
        this._c = 0;
        this._d = 0;
        this._e = 0;
        this._b = true;
        this._f = false
    };
    _twaver.ext(y, Object, {a6: function (i) {
        this._f = i
    }, a7: function (i) {
        this._b = i
    }, a8: function (i) {
        if (i.x0() !== 0) {
            this.a9(i, i.x9().i9())
        }
    }, a9: function (i, t) {
        this._xx = i.xk();
        this._c = i.xl();
        this._d = 0;
        this._e = 0;
        this.a0(t);
        if (this._b) {
            for (var a = i.x9(); a.i1(); a.i2()) {
                var r = a.i9();
                if (this._xx.i1(r) == null) {
                    this.a1(r);
                    this.a0(r)
                }
            }
        }
        i.xi(this._xx);
        i.xj(this._c)
    }, a0: function (i) {
        var t = ++this._d;
        this._xx.z1(i, y._B);
        this.a5(i, t);
        for (var a = this._f ? i.ap() : i.af(); a.i1(); a.i2()) {
            var r = a.i8();
            if (!this._c.i4(r)) {
                this._c.i7(r, true);
                var n = r.a1(i);
                if (this._xx.i1(n) == null) {
                    this.a3(r, n, true);
                    this.a0(n);
                    this.a2(r, n)
                } else {
                    this.a3(r, n, false)
                }
            }
        }
        this.a4(i, t, ++this._e);
        this._xx.z1(i, y._C)
    }, a5: function (i, t) {
    }, a4: function (i, t, a) {
    }, a3: function (i, t, a) {
    }, a2: function (i, t) {
    }, a1: function (i) {
    }});
    y._B = {};
    y._C = {};
    var p = function (i) {
        this._a = i
    };
    _twaver.ext(p, y, {a5: function (i, t) {
        var a = this._a._ah.i2(i);
        this._a._ad[a].ae(i)
    }});
    var k = function (i) {
        this._a = i
    };
    _twaver.ext(k, y, {a2: function (i, t) {
        var a = i.a1(t);
        var r = this._a[a.al()];
        var n = this._a[t.al()];
        if (n._a + 1 > r._a) {
            r._c = r._a;
            r._b = r._d;
            r._a = n._a + 1;
            r._d = i
        } else if (n._a + 1 > r._c) {
            r._c = n._a + 1;
            r._b = i
        }
    }});
    var j = function (i) {
        this._a = i
    };
    _twaver.ext(j, y, {a3: function (i, t, a) {
        if (a && i.a2() === t)this._a.ac(i)
    }});
    var M = function () {
        this._a = 0;
        this._c = 0
    };
    _twaver.ext(M, Object, {});
    var z = function () {
        this._a = 0
    };
    _twaver.ext(z, Object, {a1: function (i, t) {
        this._a = 0;
        for (var a = t.length - 1; a >= 0; a--)t[a] = -1;
        for (var r = i.x9(); r.i1(); r.i2()) {
            var n = r.i9();
            if (n.ak() !== 0)continue;
            this.a2(n, n.al(), t);
            break
        }
        for (var s = i.x9(); s.i1(); s.i2()) {
            var h = s.i9();
            var e = h.al();
            if (t[e] === -1)this.a2(h, e, t)
        }
    }, a2: function (i, t, a) {
        a[t] = -2;
        for (var r = i.ag(); r != null;) {
            var n = r.a3();
            var s = n.al();
            switch (a[s]) {
                case-1:
                    this.a2(n, s, a);
                case-2:
                default:
                    r = r.a8();
                    break
            }
        }
        a[t] = this._a++
    }});
    var L = {};
    L.a1 = function (i) {
        var t = new C;
        t.a8(i);
        return t._n
    };
    L.a2 = function (i) {
        var t = i.x9();
        var a = null;
        var r = 0;
        t.i4();
        for (; t.i1(); t.i2())if (t.i9().ak() === 0) {
            a = t.i9();
            r++
        }
        if (r === 1)return a;
        r = 0;
        t.i4();
        for (; t.i1(); t.i2())if (t.i9().ao() === 0) {
            a = t.i9();
            r++
        }
        if (r === 1)return a; else return L.a8(i)
    };
    L.a8 = function (i) {
        var t = Jt.a(i.x0());
        var a = rt.a2(t);
        return L.a6(i, a)
    };
    L.a6 = function (i, t) {
        var a = i.xd();
        var r = Jt.d(1);
        var n = Jt.a(i.x0(), -1);
        var s = L.a4(i, a);
        L.a7(a, t, r, n, -1);
        for (var h = s.c1(); h.i1(); h.i2())i.x3(h.i8());
        return r[0]
    };
    L.a7 = function (i, t, a, r, n) {
        var s = 0;
        for (var h = i.ag(); h != null; h = h.a8()) {
            var e = h.a3();
            var _ = L.a7(e, t, a, r, n);
            if (_ > n)n = _;
            s += r[e.al()]
        }
        var f = s * (i._g.xa() - 1 - s);
        for (var u = i.ag(); u != null; u = u.a8()) {
            var o = u.a3();
            for (var v = u.a8(); v != null; v = v.a8()) {
                var l = v.a3();
                f += r[o.al()] * r[l.al()]
            }
        }
        t.i7(i, f);
        r[i.al()] = s + 1;
        if (f > n) {
            n = f;
            a[0] = i
        }
        return n
    };
    L.a4 = function (i, t) {
        var a = new R;
        var r = new j(a);
        r.a6(false);
        r.a9(i, t);
        for (var n = a.c1(); n.i1(); n.i2())i.x3(n.i8());
        return a
    };
    L.a3 = function (i) {
        return L.a4(i, L.a2(i))
    };
    var C = function () {
        this._n = true;
        this.a6(false)
    };
    _twaver.ext(C, y, {a3: function (i, t, a) {
        if (!a)this._n = false
    }, a1: function (i) {
        this._n = false
    }});
    var O = function (i, t) {
        this._i = 0;
        this._m = t;
        this._j = i;
        this._l = false
    };
    _twaver.ext(O, y, {a8: function (i) {
        this._h = Jt.a(i.x0());
        this._k = Jt.a(i.x0());
        this._g = new S(i.xh());
        O.superClass.a8.call(this, i)
    }, a5: function (i, t) {
        this._k[i.al()] = this._h[i.al()] = t
    }, a3: function (i, t, a) {
        this._g.c(i);
        if (!a) {
            var r = i.a1(t);
            this._h[r.al()] = Math.min(this._h[r.al()], this._k[t.al()])
        }
    }, a1: function (i) {
        this._l = false
    }, a2: function (i, t) {
        var a = i.a1(t);
        if (this._h[t.al()] >= this._k[a.al()]) {
            for (; this._g.d() !== i; this._j.i5(this._g.b(), this._i));
            this._j.i5(this._g.b(), this._i);
            this._i++;
            if (this._g.a()) {
                if (this._l)this._m.i5(a, true); else this._l = true
            } else {
                this._m.i5(a, true)
            }
        }
        this._h[a.al()] = Math.min(this._h[a.al()], this._h[t.al()])
    }});
    var N = function (i, t) {
        this._h = false;
        this._i = i;
        this._g = t
    };
    _twaver.ext(N, Object, {z1: function (i, t) {
        i._c[this._i] = t
    }, i1: function (i) {
        return i._c[this._i]
    }, i5: function (i, t) {
        i._c[this._i] = t
    }, i4: function (i) {
        return i._c[this._i]
    }, i7: function (i, t) {
        i._c[this._i] = t
    }, i2: function (i) {
        var t = i._c[this._i];
        if (t == null)return 0;
        return t
    }, i6: function (i, t) {
        i._c[this._i] = t
    }, i3: function (i) {
        var t = i._c[this._i];
        if (t == null)return 0;
        return t
    }, c: function () {
        return this._h
    }, d: function () {
        this._h = true
    }});
    var E = function (i, t) {
        this._c = false;
        this._d = i;
        this._b = t
    };
    _twaver.ext(E, Object, {i8: function (i, t) {
        i._c[this._d] = t
    }, i1: function (i) {
        return i._c[this._d]
    }, i7: function (i, t) {
        i._c[this._d] = t
    }, i4: function (i) {
        var t = i._c[this._d];
        if (t == null)return false;
        return t
    }, i5: function (i, t) {
        i._c[this._d] = Jt.a(t)
    }, i2: function (i) {
        var t = i._c[this._d];
        if (t == null)return 0;
        return t
    }, i6: function (i, t) {
        i._c[this._d] = Jt.a(t)
    }, i3: function (i) {
        var t = i._c[this._d];
        if (t == null)return 0;
        return t
    }, a: function () {
        return this._c
    }, b: function () {
        this._c = true
    }});
    var q = function (i) {
        this._bb = i;
        this.i4()
    };
    _twaver.ext(q, Object, {i1: function () {
        return this._aa != null
    }, i2: function () {
        this._aa = this._aa._a
    }, i3: function () {
        this._aa = this._aa._b
    }, i4: function () {
        this._aa = this._bb._b
    }, i5: function () {
        this._aa = this._bb._c
    }, i7: function () {
        return this._bb.ay()
    }, i6: function () {
        return this._aa._c
    }});
    var B = function (i) {
        B.superClass.constructor.call(this, i)
    };
    _twaver.ext(B, q, {i8: function () {
        return this.i6()
    }});
    var A = function (i) {
        this._id = _twaver.id();
        this._a = 0;
        if (i) {
            i.i4();
            for (; i.i1(); i.i2())this.ae(i.i6())
        }
    };
    _twaver.ext(A, Object, {ac: function (i) {
        var t = this.ag(i);
        if (this._b == null) {
            this._b = this._c = t
        } else {
            this._b._b = t;
            t._a = this._b;
            this._b = t
        }
        this._a++;
        return t
    }, ae: function (i) {
        var t = this.ag(i);
        if (this._c == null) {
            this._b = this._c = t
        } else {
            this._c._a = t;
            t._b = this._c;
            this._c = t
        }
        this._a++;
        return t
    }, z1: function (i) {
        i._b = null;
        i._a = null;
        if (this._c == null) {
            this._b = this._c = i
        } else {
            this._c._a = i;
            i._b = this._c;
            this._c = i
        }
        this._a++
    }, ad: function (i) {
        i._b = null;
        i._a = null;
        if (this._b == null) {
            this._b = this._c = i
        } else {
            this._b._b = i;
            i._a = this._b;
            this._b = i
        }
        this._a++
    }, aa: function (i) {
        this.ae(i);
        return true
    }, ab: function (i) {
        for (; i.i1(); i.i2())this.ae(i.i6())
    }, ao: function (i, t) {
        if (t === this._b)return this.ac(i);
        if (t == null) {
            return this.ae(i)
        } else {
            var a = this.ag(i);
            this.aq(a, t);
            return a
        }
    }, aq: function (i, t) {
        if (t == null)this.ad(i); else if (t === this._b) {
            this.ad(i)
        } else {
            if (this._c == null) {
                i._b = null;
                i._a = null;
                this._b = this._c = i
            } else {
                var a = t._b;
                t._b = i;
                i._a = t;
                a._a = i;
                i._b = a
            }
            this._a++
        }
    }, ap: function (i, t) {
        if (t == null)this.z1(i); else if (t === this._c) {
            this.z1(i)
        } else {
            if (this._b == null) {
                i._b = null;
                i._a = null;
                this._b = this._c = i
            } else {
                var a = t._a;
                t._a = i;
                i._a = a;
                a._b = i;
                i._b = t
            }
            this._a++
        }
    }, an: function (i, t) {
        if (t === this._c)return this.ae(i);
        if (t == null) {
            return this.ac(i)
        } else {
            var a = this.ag(i);
            this.ap(a, t);
            return a
        }
    }, ay: function () {
        return this._a
    }, ar: function () {
        return this._a === 0
    }, af: function () {
        this._b = this._c = null;
        this._a = 0
    }, am: function () {
        return this._b._c
    }, at: function () {
        var i = this.am();
        this.aw(this._b);
        return i
    }, as: function () {
        return this._c._c
    }, au: function () {
        return this.aw(this._c)
    }, ak: function (i) {
        var t = 0;
        for (var a = this._b; a != null;) {
            if (i === t)return a._c;
            a = a._a;
            t++
        }
        return null
    }, aj: function (i) {
        if (i._a == null)return this._b; else return i._a
    }, ai: function (i) {
        if (i._b == null)return this._c; else return i._b
    }, aw: function (i) {
        if (i !== this._b)i._b._a = i._a; else this._b = i._a;
        if (i !== this._c)i._a._b = i._b; else this._c = i._b;
        this._a--;
        return i._c
    }, av: function (i) {
        return this.aw(i._aa)
    }, ah: function () {
        return new q(this)
    }, al: function (i) {
        var t = this._b;
        while (t != null) {
            if (t._c == null && i == null) {
                return t
            }
            if (t._c === i) {
                return t
            }
            t = t._a
        }
        return null
    }, a0: function () {
        var i = Jt.d(this._a);
        var t = 0;
        for (var a = this._b; a != null;) {
            i[t] = a._c;
            a = a._a;
            t++
        }
        return i
    }, ax: function () {
        for (var i = this._b; i != null; i = i._b) {
            var t = i._a;
            i._a = i._b;
            i._b = t
        }
        var a = this._b;
        this._b = this._c;
        this._c = a
    }, a1: function (i) {
        var t = this.a0();
        t.sort(i);
        var a = 0;
        for (var r = this._b; r != null;) {
            r._c = t[a];
            r = r._a;
            a++
        }
    }, a2: function () {
        var i = this.a0();
        i.sort(Jt.c);
        var t = 0;
        for (var a = this._b; a != null;) {
            a._c = i[t];
            a = a._a;
            t++
        }
    }, az: function (i) {
        if (this._b == null) {
            this._b = i._b;
            this._c = i._c
        } else if (i._b != null) {
            this._c._a = i._b;
            i._b._b = this._c;
            this._c = i._c
        }
        this._a += i._a;
        i._b = i._c = null;
        i._a = 0
    }, ag: function (i) {
        return new D(i)
    }});
    var R = function (i) {
        R.superClass.constructor.call(this, i)
    };
    _twaver.ext(R, A, {c1: function () {
        return new B(this)
    }, c2: function () {
        return this.am()
    }, c3: function () {
        return this.at()
    }});
    var P = function () {
        this._c = 0
    };
    _twaver.ext(P, Object, {a: function (i) {
        this._c++;
        i._b = this._b;
        i._a = null;
        if (this._b != null) {
            this._b._a = i;
            this._b = i
        } else {
            this._b = this._a = i
        }
    }, b: function (i, t) {
        if (t == null) {
            this.a(i);
            return
        }
        var a = t._b;
        if (a != null)a._a = i; else this._a = i;
        i._b = a;
        i._a = t;
        t._b = i;
        this._c++
    }, c: function (i) {
        var t = i._a;
        var a = i._b;
        this._c--;
        if (t != null)t._b = a; else this._b = a;
        if (a != null)a._a = t; else this._a = t
    }});
    var I = function (i, t) {
        this._p = i;
        this._j = t;
        this._o = i._o[t]
    };
    _twaver.ext(I, Object, {i1: function () {
        return this._o != null
    }, i2: function () {
        this._o = this._o._k[this._j]
    }, i3: function () {
        this._o = this._o._f[this._j]
    }, i4: function () {
        this._o = this._p._o[this._j]
    }, i5: function () {
        this._o = this._p._q[this._j]
    }, i7: function () {
        return this._p._n[this._j]
    }, i6: function () {
        return this._o
    }, i8: function () {
        return this._o
    }});
    var D = function (i) {
        this._c = i
    };
    _twaver.ext(D, Object, {a: function () {
        return this._a
    }, b: function () {
        return this._b
    }, c: function (i) {
        this._c = i
    }, d: function () {
        return this._c
    }});
    var V = function (i, t, a, r) {
        this._r = i;
        this._s = t;
        this._q = a;
        this._p = r
    };
    _twaver.ext(V, Object, {i1: function (i) {
        return this._p[i.a5()]
    }, i3: function (i) {
        return this._r[i.a5()]
    }, i2: function (i) {
        return this._s[i.a5()]
    }, i4: function (i) {
        return this._q[i.a5()]
    }, i8: function (i, t) {
        this._p[i.a5()] = t
    }, i6: function (i, t) {
        this._r[i.a5()] = t
    }, i5: function (i, t) {
        this._s[i.a5()] = t
    }, i7: function (i, t) {
        this._q[i.a5()] = t
    }});
    var S = function (i) {
        this._a = Jt.d(i);
        this._b = -1
    };
    _twaver.ext(S, Object, {d: function () {
        return this._a[this._b]
    }, b: function () {
        return this._a[this._b--]
    }, c: function (i) {
        this._a[++this._b] = i
    }, a: function () {
        return this._b < 0
    }});
    var F = function () {
    };
    _twaver.ext(F, Object, {a0: function (i) {
        this._c = Jt.d(i)
    }});
    var X = function (i, t, a, r, n, s, h) {
        this._g = 0;
        i.xt(this, t, a, r, n, s, h)
    };
    _twaver.ext(X, F, {a5: function () {
        if (this._h._u)this._h.b1();
        return this._g
    }, a2: function () {
        return this._d
    }, a3: function () {
        return this._e
    }, a1: function (i) {
        return this._d !== i ? this._d : this._e
    }, a4: function () {
        for (var i = 0; i <= 1; i++) {
            this._k[i] = null;
            this._f[i] = null
        }
    }, a8: function () {
        return this._k[0]
    }, a7: function () {
        return this._k[1]
    }, a6: function (i, t, a, r) {
        this.a0(r);
        this._h = i;
        this._k = Jt.d(2);
        this._f = Jt.d(2);
        this._d = t;
        this._e = a
    }});
    var U = function (i) {
        this._j = 0;
        this._h = i;
        this.i4()
    };
    _twaver.ext(U, Object, {i2: function () {
        this._k = this._k._k[this._j];
        if (this._k == null && this._j === 0) {
            this._k = this._h._o[1];
            this._j = 1
        }
    }, i3: function () {
        this._k = this._k._f[this._j];
        if (this._k == null && this._j === 1) {
            this._k = this._h._q[0];
            this._j = 0
        }
    }, i4: function () {
        this._k = this._h._o[0];
        if (this._k == null) {
            this._k = this._h._o[1];
            this._j = 1
        } else {
            this._j = 0
        }
    }, i5: function () {
        this._k = this._h._q[1];
        if (this._k == null) {
            this._k = this._h._q[0];
            this._j = 0
        } else {
            this._j = 1
        }
    }, i1: function () {
        return this._k != null
    }, i6: function () {
        return this._k
    }, i8: function () {
        return this._k
    }, i7: function () {
        return this._h.ad()
    }});
    var G = function () {
        this._a = kt._A;
        this._b = kt._A;
        this._c = new s
    };
    _twaver.ext(G, Object, {i1: function () {
        return this._c.size()
    }, i2: function (i) {
        return this._c.get(i)
    }, i3: function (i, t, a) {
        this._c.set(i, new _(t, a))
    }, i4: function (i, t) {
        this._c.add(new _(i, t))
    }, i5: function () {
        this._c.clear()
    }, i6: function () {
        return this._a
    }, i7: function () {
        return this._b
    }, i8: function (i) {
        this._a = i
    }, i9: function (i) {
        this._b = i
    }});
    var Y = function () {
        this._x = 0;
        this._y = 0;
        this._w = 0;
        this._h = 0
    };
    _twaver.ext(Y, Object, {i5: function (i, t) {
        this._x = i;
        this._y = t
    }, i6: function (i, t) {
        this._w = i;
        this._h = t
    }, i4: function () {
        return this._h
    }, i3: function () {
        return this._w
    }, i1: function () {
        return this._x
    }, i2: function () {
        return this._y
    }});
    var T = function (i, t, a, r) {
        this._m = i;
        this._n = t;
        this._l = a;
        this._k = r
    };
    _twaver.ext(T, Object, {i1: function (i) {
        return this._k[i.al()]
    }, i3: function (i) {
        return this._m[i.al()]
    }, i2: function (i) {
        return this._n[i.al()]
    }, i4: function (i) {
        return this._l[i.al()]
    }, z1: function (i, t) {
        this._k[i.al()] = t
    }, i6: function (i, t) {
        this._m[i.al()] = t
    }, i7: function (i, t) {
        this._n[i.al()] = t
    }, i5: function (i, t) {
        this._l[i.al()] = t
    }});
    var H = function (i, t) {
        this._b = i;
        this._r = t;
        this._a = [];
        for (var a = this._b - 1; a >= 0; a--)this._a.push(a);
        this._c = new s
    };
    _twaver.ext(H, Object, {a1: function (i) {
        var t;
        if (this._a.length === 0) {
            this.a2(i, this._b, this._b + this._r);
            for (var a = this._b + this._r - 1; a > this._b; a--)this._a.push(a);
            t = this._b;
            this._b += this._r
        } else {
            t = this._a.pop()
        }
        return t
    }, b: function (i) {
        var t = this.a1(i);
        var a = new N(t, this);
        this._c.add(a);
        this.a4(i, t);
        return a
    }, c: function (i) {
        var t = this.a1(i);
        var a = new E(t, this);
        this._c.add(a);
        this.a4(i, t);
        return a
    }, a2: function (i, t, a) {
        for (var r = i._a; r != null; r = r._a) {
            var n = Jt.d(a);
            Jt.f(r._c, n, t);
            r._c = n
        }
    }, a3: function (i, t, a) {
        var r = Jt.d(a);
        Jt.f(i._c, r, t);
        i._c = r
    }, a4: function (i, t) {
        for (var a = i._a; a != null; a = a._a)a._c[t] = null
    }, a5: function (i, t) {
        if (i instanceof N) {
            var a = i;
            if (a.c())throw"Error";
            a.d();
            var r = i._i;
            if (this._a.indexOf(r) < 0) {
                this.a4(t, r);
                this._a.push(r);
                this._c.remove(i)
            }
        }
    }, a6: function (i, t) {
        if (i instanceof E) {
            var a = i;
            if (a.a())throw"Error";
            a.b();
            var r = a._d;
            if (this._a.indexOf(r) < 0) {
                this.a4(t, r);
                this._a.push(r);
                this._c.remove(i)
            }
        }
    }});
    var W = function (i) {
        this._id = _twaver.id();
        this._p = 0;
        i.xs(this)
    };
    _twaver.ext(W, F, {ad: function () {
        return this._n[0] + this._n[1]
    }, ak: function () {
        return this._n[1]
    }, ao: function () {
        return this._n[0]
    }, al: function () {
        if (this._g._y)this._g.c();
        return this._p
    }, ag: function () {
        return this._o[0]
    }, ae: function () {
        return this._o[1]
    }, af: function () {
        return new U(this)
    }, am: function () {
        return new I(this, 1)
    }, ap: function () {
        return new I(this, 0)
    }, an: function () {
        return new J(this)
    }, aq: function () {
        return new Z(this, 1)
    }, aw: function () {
        return new Z(this, 0)
    }, ah: function (i) {
        for (var t = this._o[0]; t != null; t = t._k[0])if (t.a3() === i)return t;
        return null
    }, ai: function (i) {
        for (var t = this._o[1]; t != null; t = t._k[1])if (t.a2() === i)return t;
        return null
    }, aj: function (i) {
        var t = this.ah(i);
        if (t == null)t = this.ai(i);
        return t
    }, au: function (i) {
        this.at(i, 1, Jt.d(this.ak()))
    }, av: function (i) {
        this.at(i, 0, Jt.d(this.ao()))
    }, as: function (i, t) {
        this.a0(t);
        this._g = i;
        this._o = Jt.d(2);
        this._q = Jt.d(2);
        this._n = Jt.a(2)
    }, ab: function (i, t, a, r, n) {
        if (t == null) {
            this.aa(i, a, r);
            return
        }
        var s;
        if (t._d === t._e)s = r; else s = this !== t._d ? 1 : 0;
        if (n === 0) {
            var h = t._k[s];
            i._f[r] = t;
            i._k[r] = h;
            t._k[s] = i;
            if (h == null)this._q[a] = i; else if (h._d === h._e)h._f[r] = i; else h._f[this !== h._d ? 1 : 0] = i
        } else {
            var e = t._f[s];
            i._k[r] = t;
            i._f[r] = e;
            t._f[s] = i;
            if (e == null)this._o[a] = i; else if (e._d === e._e)e._k[r] = i; else e._k[this !== e._d ? 1 : 0] = i
        }
        this._n[a]++
    }, aa: function (i, t, a) {
        var r = this._q[t];
        i._k[a] = null;
        if (r == null) {
            this._o[t] = i;
            i._f[a] = null
        } else {
            i._f[a] = r;
            if (r._d === r._e) {
                r._k[a] = i
            } else {
                r._k[this !== r._d ? 1 : 0] = i
            }
        }
        this._q[t] = i;
        this._n[t]++
    }, ar: function (i, t, a) {
        var r;
        var n;
        r = i._k[a];
        n = i._f[a];
        if (r == null) {
            this._q[t] = n
        } else {
            r._f[!(r._d === this) ? 1 : 0] = n
        }
        if (n == null) {
            this._o[t] = r
        } else {
            n._k[!(n._d === this) ? 1 : 0] = r
        }
        this._n[t]--
    }, ac: function () {
        for (var i = 0; i <= 1; i++) {
            this._o[i] = null;
            this._q[i] = null;
            this._n[i] = 0
        }
    }, at: function (i, t, a) {
        if (this._n[t] < 2)return;
        var r = this._n[t];
        var n = 0;
        var s;
        for (s = this._o[t]; s != null; s = s._k[t]) {
            a[n] = s;
            n++
        }
        Jt.s(a, r, i);
        var h = this._o[t] = a[0];
        h._f[t] = null;
        for (var e = 1; e < r;) {
            s = a[e];
            s._f[t] = h;
            h._k[t] = s;
            e++;
            h = s
        }
        this._q[t] = s;
        s._k[t] = null
    }});
    var Z = function (i, t) {
        Z.superClass.constructor.call(this, i, t);
        this._h = t !== 1 ? 1 : 0
    };
    _twaver.ext(Z, I, {i6: function () {
        return this.i9()
    }, i9: function () {
        return this._h !== 0 ? this._o._e : this._o._d
    }});
    var J = function (i) {
        J.superClass.constructor.call(this, i)
    };
    _twaver.ext(J, U, {i6: function () {
        return this._k.a1(this._h)
    }, i9: function () {
        return this._k.a1(this._h)
    }});
    var K = function (i) {
        K.superClass.constructor.call(this, i)
    };
    _twaver.ext(K, q, {i9: function () {
        return this.i6()
    }});
    var Q = function (i) {
        this._o = i;
        this._c = i._a
    };
    _twaver.ext(Q, Object, {i1: function () {
        return this._c != null
    }, i2: function () {
        this._c = this._c._a
    }, i3: function () {
        this._c = this._c._b
    }, i5: function () {
        this._c = this._o._b
    }, i4: function () {
        this._c = this._o._a
    }, i7: function () {
        return this._o._c
    }, i6: function () {
        return this._c
    }, i9: function () {
        return this._c
    }, i8: function () {
        return this._c
    }});
    var $ = function (i) {
        if (i && i.length) {
            $.superClass.constructor.call(this);
            for (var t = 0; t < i.length; t++)this.ae(i[t])
        } else {
            $.superClass.constructor.call(this, i)
        }
    };
    _twaver.ext($, A, {x1: function () {
        return new K(this)
    }, x2: function () {
        return this.am()
    }, x3: function () {
        return this.as()
    }, x4: function () {
        return this.at()
    }});
    var it = function (i) {
        this._d = i;
        it.superClass.constructor.call(this)
    };
    _twaver.ext(it, $, {});
    var tt = function (i) {
        this._a = i;
        this._b = new R;
        this._c = new $
    };
    _twaver.ext(tt, Object, {a: function () {
        for (var i = this._a.x9(); i.i1(); i.i2())this.e(i.i9())
    }, b: function () {
        this.c();
        this.d()
    }, c: function () {
        while (!this._c.ar()) {
            var i = this._c.x4();
            if (!this._a.xq(i))this.g(i)
        }
    }, d: function () {
        while (!this._b.ar()) {
            var i = this._b.c3();
            if (!this._a.xp(i))this.f(i)
        }
    }, e: function (i) {
        for (var t = i.af(); t.i1(); t.i2()) {
            this._b.ac(t.i8());
            this._a.h1(t.i8())
        }
        this._c.ac(i);
        this._a.h2(i)
    }, f: function (i) {
        this._a.u1(i)
    }, g: function (i) {
        this._a.h3(i)
    }});
    tt.h = function (i, t) {
        t.i4();
        for (; t.i1(); t.i2()) {
            var a = t.i8();
            if (!i.xq(a.a2()))i.h3(a.a2());
            if (!i.xq(a.a3()))i.h3(a.a3());
            if (!i.xp(a))i.u1(a)
        }
    };
    tt.i = function (i, t) {
        t.i4();
        for (; t.i1(); t.i2()) {
            var a = t.i8();
            if (i.xp(a))i.h1(a);
            if (a.a2().ad() === 0)i.h2(a.a2());
            if (a.a3().ad() === 0)i.h2(a.a3())
        }
    };
    var at = function () {
        this._g = arguments[0];
        this._f = this._g.xk();
        this._h = this._g.xk();
        this._d = new A;
        this._e = 0;
        if (arguments.length !== 1) {
            this.a(arguments[1], arguments[2], arguments[3], arguments[4])
        }
    };
    _twaver.ext(at, Object, {a: function (i, t, a, r) {
        var n = Jt.d(a - t + 1);
        for (var s = t; s <= a; s++)n[s] = new it(s);
        for (var h = this._g.x9(); h.i1(); h.i2()) {
            var e = h.i9();
            if (r == null || r.i4(e)) {
                this._f.z1(e, n[i.i2(e) - t].ac(e));
                this._e++
            }
        }
        for (var _ = 0; _ < n.length; _++) {
            var f = n[_];
            var u = this._d.ae(f);
            for (var o = f.x1(); o.i1(); o.i2())this._h.z1(o.i9(), u)
        }
    }, c: function () {
        this._g.xi(this._h);
        this._g.xi(this._f)
    }, e: function () {
        return this._e === 0
    }, g: function () {
        for (; this._d.am().ar(); this._d.at());
        this._e--;
        var i = this._d.am().x4();
        this._h.z1(i, null);
        this._f.z1(i, null);
        return i
    }, f: function () {
        for (; this._d.as().ar(); this._d.au());
        this._e--;
        var i = this._d.as().x4();
        this._h.z1(i, null);
        this._f.z1(i, null);
        return i
    }, d: function (i) {
        var t = this._f.i1(i);
        var a = this._h.i1(i);
        var r = a.d();
        var n = null;
        var s = a.a();
        if (s != null) {
            n = s.d();
            this._h.z1(i, s)
        } else {
            n = new it(r._d + 1);
            this._h.z1(i, this._d.ae(n))
        }
        r.aw(t);
        this._f.z1(i, n.ac(i))
    }, b: function (i) {
        var t = this._f.i1(i);
        var a = this._h.i1(i);
        var r = a.d();
        var n = null;
        var s = a.b();
        if (s != null) {
            n = s.d();
            this._h.z1(i, s)
        } else {
            n = new it(r._d - 1);
            this._h.z1(i, this._d.ac(n))
        }
        r.aw(t);
        this._f.z1(i, n.ac(i))
    }});
    var rt = {};
    rt.a1 = function (i) {
        return new T(i, null, null, null)
    };
    rt.a2 = function (i) {
        return new T(null, i, null, null)
    };
    rt.a3 = function (i) {
        return new T(null, null, i, null)
    };
    rt.a4 = function (i) {
        return new V(null, i, null, null)
    };
    rt.a5 = function (i) {
        return new V(null, null, i, null)
    };
    rt.a6 = function (i) {
        return new V(null, null, null, i)
    };
    var nt = function () {
        if (arguments.length === 2) {
            this._a = new A;
            this._b = new A;
            this._c = 0;
            var i = arguments[0];
            var t = arguments[1];
            var a = new st(i._j2.gj(t) / 2, 0);
            this._a.ac(a);
            a = new st(i._j2.gj(t) / 2, 0);
            this._b.ac(a)
        } else {
            this._a = arguments[1];
            this._b = arguments[2];
            this._c = arguments[3]
        }
    };
    _twaver.ext(nt, Object, {});
    var st = function (i, t) {
        this._b = i;
        this._a = t
    };
    _twaver.ext(st, Object, {});
    var ht = function () {
        this._cx = true;
        this._cs = new bt;
        this._ct = new xt;
        this._cw = new gt
    };
    _twaver.ext(ht, Object, {i5: function (i) {
        this._cx = i
    }, k: function () {
        var i = new wt(this);
        if (this._cx) {
            this._cs.w1(i);
            i = this._cs
        }
        this._cw.w1(i);
        i = this._cw;
        this._ct.w1(i);
        i = this._ct;
        return i
    }, i2: function (i) {
        this.k().i2(i)
    }, i1: function (i) {
        return this.k().i1(i)
    }});
    var et = function () {
        et.superClass.constructor.call(this);
        this._jv = 20;
        this._jw = 40;
        this._jx = function (i, t) {
            var a = i.a3();
            var r = t.a3();
            var n = a._g;
            return Math.floor(100 * (n.g5(a) - n.g5(r)))
        }
    };
    _twaver.ext(et, ht, {i4: function (i) {
        return L.a1(i)
    }, i3: function (i) {
        if (!this.i4(i))throw"Error";
        var t = L.a3(i);
        this._j2 = i;
        this._j3 = new _t(i);
        Et.c(i);
        this._jy = i.xk();
        if (!i.xb()) {
            this.bu();
            var a = this._j3.c1();
            this.f(a);
            this.b(this._j3);
            this.c(this._j3)
        }
        var r;
        for (; !t.ar(); i.x3(r)) {
            r = t.c3();
            Et.b(i.g2(r))
        }
    }, bu: function () {
        if (this._jx != null) {
            for (var i = this._j2.x9(); i.i1(); i.i2())i.i9().av(this._jx)
        }
    }, c: function (i) {
        var t = this.a2(i);
        var a = Jt.a(t.length);
        for (var r = 0; r < t.length; r++) {
            var n = t[r];
            var s = 0;
            for (var h = n.ah(); h.i1(); h.i2()) {
                var e = h.i6();
                s = Math.max(s, this._j2.g9(e))
            }
            a[r] = s
        }
        var _ = -this._jw;
        for (var f = 0; f < t.length; f++) {
            _ += this._jw + a[f];
            var u = t[f];
            for (var o = u.ah(); o.i1(); o.i2()) {
                var v = o.i6();
                this._j2.s2(v, this._j2.g5(v), _ - a[f] / 2)
            }
        }
    }, a2: function (i) {
        var t = Jt.d(i.b());
        for (var a = 0, r = i.b(); a < r; a++)t[a] = new A;
        i.c1();
        this.a1(i.c1(), 0, t);
        return t
    }, a1: function (i, t, a) {
        a[t].ae(i);
        for (var r = i.aw(); r.i1(); r.i2())this.a1(r.i9(), t + 1, a)
    }, b: function (i) {
        var t = i.c1();
        this._j2.s2(t, 0, this._j2.g6(t));
        this.g(t)
    }, g: function (i) {
        for (var t = i.aw(); t.i1(); t.i2()) {
            var a = t.i9();
            var r = this._jy.i1(a);
            this._j2.s2(a, this._j2.g5(i) + r._c, this._j2.g6(a));
            this.g(a)
        }
    }, f: function (i) {
        if (this._j3.c2(i)) {
            this._jy.z1(i, new nt(this, i));
            return
        }
        var t = i.aw();
        var a = t.i9();
        t.i2();
        this.f(a);
        var r = this._jy.i1(a);
        var n = new nt(this, r._a, r._b, 0);
        if (!t.i1()) {
            n._a.ac(new st(this._j2.gj(i) / 2, 0));
            n._b.ac(new st(this._j2.gj(i) / 2, 0));
            this._jy.z1(i, n);
            return
        }
        while (t.i1()) {
            a = t.i9();
            t.i2();
            this.f(a);
            r = this._jy.i1(a);
            var s = n._b.ah();
            var h = r._a.ah();
            var e = 2147483647;
            var _ = 0;
            var f = 0;
            while (s.i1() && h.i1()) {
                var u = s.i6();
                s.i2();
                var o = h.i6();
                h.i2();
                f += u._a;
                _ += o._a;
                e = Math.min(e, _ - f - u._b - o._b)
            }
            r._c = this._jv - e;
            _ += r._c;
            var v = r._b.am();
            v._a = r._c;
            if (s.i1() && !h.i1()) {
                for (var l = f - this.a3(r._b); s.i1(); l = 0) {
                    var c = s.i6();
                    s.i2();
                    r._b.ae(new st(c._b, c._a + l))
                }
            } else if (!s.i1() && h.i1()) {
                var d = this.a3(n._a);
                for (d = _ - d; h.i1(); d = 0) {
                    var x = h.i6();
                    h.i2();
                    n._a.ae(new st(x._b, x._a + d))
                }
            }
            n._b = r._b
        }
        this._jy.z1(i, n);
        var g = -r._c / 2;
        for (var b = i.aw(); b.i1();) {
            var w = b.i9();
            b.i2();
            var m = this._jy.i1(w);
            m._c += g;
            var y = m._b.am();
            y._a += g;
            y = m._a.am();
            y._a += g
        }
        n._a.ac(new st(this._j2.gj(i) / 2, 0));
        n._b.ac(new st(this._j2.gj(i) / 2, 0))
    }, a3: function (i) {
        var t = 0;
        for (var a = i.ah(); a.i1(); a.i2()) {
            var r = a.i6();
            t += r._a
        }
        return t
    }});
    var _t = function (i) {
        this._b = i;
        this.a()
    };
    _twaver.ext(_t, Object, {c1: function () {
        if (this._a == null)this.a();
        return this._a
    }, b: function () {
        if (this._a == null)return-1; else return this.d(this._a)
    }, d: function (i) {
        var t = 0;
        for (var a = i.aw(); a.i1(); a.i2())t = Math.max(t, this.d(a.i9()));
        return t + 1
    }, c2: function (i) {
        return i.ao() === 0
    }, a: function () {
        for (var i = this._b.x9(); i.i1(); i.i2())if (i.i9().ak() === 0) {
            this._a = i.i9();
            return
        }
    }});
    var ft = function (i) {
        this._d = 0;
        this._e = 0;
        this._f = 0;
        this._a = 0;
        this._b = 0;
        this._g = i;
        this._c = new A
    };
    _twaver.ext(ft, Object, {a: function () {
        return this._d + this._e + this._f
    }});
    var ut = function () {
        ut.superClass.constructor.call(this);
        this._kl = 340;
        this._km = 360;
        this._kk = 40;
        this._ko = .5
    };
    _twaver.ext(ut, ht, {ic: function () {
        return this._km
    }, ia: function () {
        return this._kl
    }, i9: function () {
        return this._ko
    }, i3: function (i) {
        if (!L.a1(i))throw"Error";
        this._a = i;
        var t = this.i8();
        var a = L.a4(i, t);
        Et.c(i);
        this._kn = Jt.d(i.x0());
        for (var r = i.x9(); r.i1(); r.i2()) {
            var n = r.i9();
            if (n !== t)this.aa(n, new ft(this._kk + this.q(n.aq().i9()))); else this.aa(n, new ft(this._kk))
        }
        this.s(t);
        i.s2(t, 0, 0);
        this.t(t);
        var s;
        for (; !a.ar(); i.x3(s))s = a.c3()
    }, i4: function (i) {
        return L.a1(i)
    }, i0: function (i) {
        return this._kn[i.al()]
    }, i8: function () {
        return L.a2(this._a)
    }, i7: function (i) {
        var t = this.ib(i);
        var a;
        do {
            a = this.i6(i);
            if (a <= t)break;
            for (var r = i.aw(); r.i1(); r.i2()) {
                var n = r.i9();
                this.i0(n)._g *= 1 + this._ko
            }
        } while (true);
        var s = (t - a) / (2 * i.ao());
        a = 0;
        for (var h = i.aw(); h.i1(); h.i2()) {
            var e = this.i0(h.i9());
            e._d += s;
            e._e += s;
            a += e._d + e._e
        }
        this.id(i)
    }, id: function (i) {
        var t = Jt.d(i.ao());
        var a = 0;
        for (var r = i.ap(); r.i1();) {
            t[a] = r.i8();
            r.i2();
            a++
        }
        var n = this;
        t.sort(function (i, t) {
            var a = i.a3();
            var r = t.a3();
            var s = n.i0(a).a() - n.i0(r).a();
            if (s > 0)return 1;
            return s >= 0 ? 0 : -1
        });
        for (var s = 0; s < t.length; s++)this._a.h1(t[s]);
        for (var h = 0; h < t.length; h += 2)this._a.u1(t[h]);
        a = t.length - 1;
        if (a % 2 === 0)a--;
        for (; a > 0; a -= 2)this._a.u1(t[a])
    }, ib: function (i) {
        if (i.ak() === 0)return this._km;
        if (i.ao() === 2)return Math.min(180, this._kl); else return this._kl
    }, i6: function (i) {
        var t = 0;
        for (var a = i.ap(); a.i1(); a.i2()) {
            var r = a.i8();
            var n = r.a3();
            var s = this.i0(n);
            var h = -s._g;
            var e = s._b;
            var _ = s._c;
            var f = 0;
            var u = f + 1;
            var o = _._b;
            var v = o.d();
            var l;
            for (; u > f; u = (l.y - e) / (l.x - h)) {
                l = v;
                o = _.ai(o);
                v = o.d();
                f = (v.y - l.y) / (v.x - l.x)
            }
            s._d = -Math.atan(u) * 180 / Math.PI;
            f = 0;
            u = f - 1;
            o = _._b;
            for (v = o.d(); o.a().d().x === v.x; v = o.d())o = o.a();
            var c;
            for (; u < f; u = (c.y - e) / (c.x - h)) {
                c = v;
                o = _.aj(o);
                v = o.d();
                f = (v.y - c.y) / (v.x - c.x)
            }
            s._e = Math.atan(u) * 180 / Math.PI;
            t += s._d + s._e
        }
        return t
    }, aa: function (i, t) {
        this._kn[i.al()] = t
    }, p: function (i) {
        var t = this.i0(i);
        var a = new A;
        var r = 2 * this.q(i);
        a.aa(new _(0, 0));
        a.aa(new _(0, r));
        a.aa(new _(r, r));
        a.aa(new _(r, 0));
        t._c = a;
        t._a = r / 2;
        t._b = r / 2
    }, r: function (i) {
        if (i.ao() === 0) {
            this.p(i)
        } else {
            var t = this.i0(i);
            var a = this.q(i);
            var r = new A;
            r.aa(new _(-a, -a));
            r.aa(new _(-a, a));
            r.aa(new _(a, -a));
            r.aa(new _(a, a));
            for (var n = i.aw(); n.i1(); n.i2()) {
                var s = this.i0(n.i9());
                r.az(s._c)
            }
            var h = kt.h(r);
            var e = Number.MAX_VALUE;
            var f = Number.MAX_VALUE;
            var u = Number.MIN_VALUE;
            var o = Number.MIN_VALUE;
            for (var v = h.ah(); v.i1(); v.i2()) {
                var l = v.i6();
                if (l.x < e)e = l.x;
                if (l.x > u)u = l.x;
                if (l.y < f)f = l.y;
                if (l.y > o)o = l.y
            }
            var c = new A;
            for (var d = h.ah(); d.i1(); d.i2()) {
                var x = d.i6();
                c.aa(new _(x.x - e, x.y - f))
            }
            t._c = c;
            t._a = -e;
            t._b = -f
        }
    }, s: function (i) {
        if (i.ao() === 0) {
            this.r(i)
        } else {
            for (var t = i.aw(); t.i1(); t.i2())this.s(t.i9());
            this.i7(i);
            var a = 0;
            for (var r = i.aw(); r.i1(); r.i2()) {
                var n = r.i9();
                var s = this.i0(n);
                var h = 180 - (360 - this.ib(i)) / 2 - a - (s._e + s._f);
                a += s.a();
                h = h / 180 * Math.PI;
                var e = Math.sin(h);
                var f = Math.cos(h);
                for (var u = s._c._b; u != null; u = u.a()) {
                    var o = u.d();
                    var v = o.x + s._g;
                    var l = o.y - s._b;
                    var c = new _(v * f - e * l, v * e + f * l);
                    u.c(c)
                }
                var d = s._a + s._g;
                s._a = d * f;
                s._b = d * e
            }
            this.r(i)
        }
    }, t: function (i) {
        var t = this._a.g4(i);
        var a = 0;
        if (i.ak() > 0) {
            var r = i.aq().i9();
            var n = this._a.g4(r);
            a = Math.PI + Math.atan2(n.y - t.y, n.x - t.x)
        }
        for (var s = i.aw(); s.i1(); s.i2()) {
            var h = s.i9();
            var e = this.i0(h);
            if (a !== 0) {
                var _ = Math.cos(a);
                var f = Math.sin(a);
                var u = e._a * _ - f * e._b;
                var o = e._a * f + _ * e._b;
                e._a = u;
                e._b = o
            }
            this._a.s2(h, t.x + e._a, t.y + e._b);
            this.t(h)
        }
    }, q: function (i) {
        return 1.41 * (Math.max(this._a.gj(i), this._a.g9(i)) / 2)
    }});
    var ot = function () {
    };
    _twaver.ext(ot, Object, {i2: function (i) {
        return i.ad()
    }, i1: function (i) {
        throw"Error"
    }, i3: function (i) {
        throw"Error"
    }, i4: function (i) {
        throw"Error"
    }});
    var vt = function (i) {
        this._a = i
    };
    _twaver.ext(vt, Object, {i2: function (i) {
        var t = 0;
        for (var a = i.an(); a.i1(); a.i2())if (this._a.i1(a.i9()) != null)t++;
        return t
    }, i4: function (i) {
        return this._a.i1(i) == null
    }, i1: function (i) {
        throw"Error"
    }, i3: function (i) {
        throw"Error"
    }});
    var lt = function () {
        lt.superClass.constructor.call(this);
        this._kq = false;
        this._kp = 90
    };
    _twaver.ext(lt, ut, {a: function (i, t) {
        this._kr = t;
        this._ks = i;
        this._kq = true
    }, i7: function (i) {
        if (!this.u(i)) {
            lt.superClass.i7.call(this, i);
            return
        }
        var t = this.i9();
        var a = this.ib(i);
        var r = (360 - a) / 2 + a;
        var n = new R(i.ap());
        do {
            var s = this.i6(i);
            s = (360 - a) / 2;
            var h = null;
            var e = null;
            for (var _ = n._b; _ != null; _ = _.a()) {
                var f = _.d();
                var u = f.a3();
                var o = this.i0(u);
                var v = this._ks.i3(f);
                var l = v - (s + o._e);
                if (l >= 0 && v + o._d >= r)if (s + o.a() <= r)l = r - s - o.a(); else l = 2 * (r - (v + o._d));
                o._f = 0;
                if (l >= 0) {
                    o._f = l;
                    h = _;
                    e = o
                } else {
                    if (-l > o._d + o._e)l = (o._d + o._e) / 2; else l /= -2;
                    s -= l;
                    if (s <= r && s + o.a() > r) {
                        s += l;
                        l = s + o.a() - r;
                        s -= l
                    }
                    for (; h != null && l > e._f; e = this.i0(h.d().a3())) {
                        l -= e._f;
                        e._f = 0;
                        h = h.b();
                        if (h != null)continue;
                        e = null;
                        break
                    }
                    if (h != null)e._f -= l; else s += l
                }
                s += o.a()
            }
            if (s <= r) {
                var c = 0;
                var d = (360 - a) / 2;
                for (var x = i.ap(); x.i1(); x.i2()) {
                    var g = x.i8();
                    var b = g.a3();
                    var w = this._ks.i3(g);
                    var m = this.i0(b);
                    var y = d + m._f + m._e;
                    if (c < Math.abs(y - w))c = Math.abs(y - w);
                    d += m.a()
                }
                if (c <= this._kp)break
            }
            for (var p = i.aw(); p.i1(); p.i2()) {
                var k = p.i9();
                this.i0(k)._g *= 1 + t
            }
        } while (true)
    }, ib: function (i) {
        if (!this.u(i))return lt.superClass.ib.call(this, i);
        if (i.ak() === 0)return this.ic(); else return this.ia()
    }, u: function (i) {
        if (!this._kq || i.ao() === 0)return false; else return this._ks.i1(i.ag()) != null
    }});
    var ct = function (i) {
        this._a = i
    };
    _twaver.ext(ct, Object, {i1: function (i) {
        return this._a.i1(i)
    }, i2: function (i) {
        throw"Error"
    }, i3: function (i) {
        throw"Error"
    }, i4: function (i) {
        throw"Error"
    }});
    var dt = function () {
    };
    _twaver.ext(dt, Object, {w1: function (i) {
        this._bb = i
    }, w2: function () {
        return this._bb
    }, w4: function (i) {
        if (this._bb != null)this._bb.i2(i)
    }, w3: function (i) {
        if (this._bb != null)return this._bb.i1(i); else return true
    }});
    var xt = function () {
        this._cg = 45;
        this._ce = 400;
        this._ch = 400;
        this._cf = 0
    };
    _twaver.ext(xt, dt, {i1: function (i) {
        if (this.w2() != null) {
            var t = true;
            var a = i.xk();
            var r = m.a3(i, a);
            var n = Jt.d(r);
            var s = Jt.d(r);
            for (var h = 0; h < r; h++) {
                n[h] = new $;
                s[h] = new R
            }
            for (var e = i.xf(); e.i1(); e.i2()) {
                var _ = e.i8();
                s[a.i2(_.a2())].aa(_);
                i.h1(_)
            }
            for (var f = i.x9(); f.i1(); f.i2()) {
                var u = f.i9();
                n[a.i2(u)].aa(u);
                i.h2(f.i9())
            }
            for (var o = 0; o < r; o++) {
                for (var v = n[o].x1(); v.i1(); v.i2())i.h3(v.i9());
                for (var l = s[o].c1(); l.i1(); l.i2())i.u1(l.i8());
                t = this.w3(i);
                for (var c = s[o].c1(); c.i1(); c.i2())i.h1(c.i8());
                for (var d = n[o].x1(); d.i1(); d.i2())i.h2(d.i9());
                if (!t)break
            }
            for (var x = 0; x < r; x++) {
                for (var g = n[x].x1(); g.i1(); g.i2())i.h3(g.i9())
            }
            for (var b = 0; b < r; b++) {
                for (var w = s[b].c1(); w.i1(); w.i2())i.u1(w.i8())
            }
            i.xi(a);
            return t
        } else {
            return true
        }
    }, i2: function (i) {
        if (i.xb())return;
        var t = i.xk();
        var a = m.a3(i, t);
        var r = Jt.d(a);
        var n = Jt.d(a);
        var s = Jt.d(a);
        var h = Jt.d(a);
        for (var e = 0; e < a; e++) {
            r[e] = new $;
            n[e] = new R
        }
        for (var f = i.xf(); f.i1(); f.i2()) {
            var u = f.i8();
            n[t.i2(u.a2())].aa(u);
            i.h1(u)
        }
        for (var v = i.x9(); v.i1(); v.i2()) {
            var l = v.i9();
            r[t.i2(l)].aa(l);
            i.h2(v.i9())
        }
        for (var c = 0; c < a; c++) {
            for (var d = r[c].x1(); d.i1(); d.i2())i.h3(d.i9());
            for (var x = n[c].c1(); x.i1(); x.i2())i.u1(x.i8());
            this.w4(i);
            var g = i.g3();
            s[c] = new o(g.x, g.y, g.width, g.height);
            var b = {};
            h[c] = b;
            if (this._cf > 0) {
                var w = this._cg + Math.ceil((g.width + 1) / this._cf) * this._cf;
                var y = this._cg + Math.ceil((g.height + 1) / this._cf) * this._cf;
                b.x = g.x;
                b.y = g.y;
                b.width = w;
                b.height = y
            } else {
                b.x = g.x;
                b.y = g.y;
                b.width = g.width + this._cg;
                b.height = g.height + this._cg
            }
            for (var p = n[c].c1(); p.i1(); p.i2())i.h1(p.i8());
            for (var k = r[c].x1(); k.i1(); k.i2())i.h2(k.i9())
        }
        for (var j = 0; j < a; j++) {
            for (var M = r[j].x1(); M.i1(); M.i2())i.h3(M.i9())
        }
        for (var z = 0; z < a; z++) {
            for (var L = n[z].c1(); L.i1(); L.i2())i.u1(L.i8())
        }
        Et.a(h, null, this._ce / this._ch);
        if (this._cf <= 0) {
            for (var C = 0; C < h.length; C++)this.w5(i, r[C], n[C], new _(h[C].x, h[C].y), s[C])
        } else {
            for (var O = 0; O < h.length; O++) {
                var N = Math.floor((h[O].x - s[O].x) / this._cf) * this._cf;
                var E = Math.floor((h[O].y - s[O].y) / this._cf) * this._cf;
                var q = s[O].x + N;
                var B = s[O].y + E;
                this.w5(i, r[O], n[O], new _(q, B), s[O])
            }
        }
        i.xi(t)
    }, w5: function (i, t, a, r, n) {
        var h = -n.x + r.x;
        var e = -n.y + r.y;
        for (var f = t.x1(); f.i1(); f.i2()) {
            var u = i.ga(f.i9());
            i.s4(f.i9(), new _(u.x + h, u.y + e))
        }
        for (var o = a.c1(); o.i1(); o.i2()) {
            var v = o.i8();
            var c = new s;
            for (var d = i.gp(v).c(); d.i1(); d.i2()) {
                var x = d.i6();
                c.add(new _(x.x + h, x.y + e))
            }
            i.s5(v, new l(c))
        }
    }});
    var gt = function () {
    };
    _twaver.ext(gt, dt, {i1: function (i) {
        return this.w3(i)
    }, i2: function (i) {
        this.w7(i);
        if (this.w2() != null)this.w4(i);
        this.w6(i)
    }, w7: function (i) {
        this.e(i);
        this.k(i);
        this.i(i)
    }, e: function (i) {
        for (var t = i.x9(); t.i1(); t.i2()) {
            var a = i.g4(t.i9());
            i.s1(t.i9(), a)
        }
    }, w6: function (i) {
        this.l(i);
        this.j(i);
        this.f(i)
    }, l: function (i) {
        for (var t = i.x9(); t.i1(); t.i2()) {
            var a = i.g4(t.i9());
            i.s1(t.i9(), a)
        }
    }, j: function (i) {
        for (var t = i.xf(); t.i1(); t.i2()) {
            var a = i.g7(t.i8());
            var r = a.i6();
            a.i8(r);
            r = a.i7();
            a.i9(r);
            for (var n = 0; n < a.i1(); n++) {
                var s = a.i2(n);
                a.i3(n, s.x, s.y)
            }
        }
    }, k: function (i) {
        for (var t = i.xf(); t.i1(); t.i2()) {
            var a = i.g7(t.i8());
            var r = a.i6();
            a.i8(r);
            r = a.i7();
            a.i9(r);
            for (var n = 0; n < a.i1(); n++) {
                var s = a.i2(n);
                a.i3(n, s.x, s.y)
            }
        }
    }, f: function (i) {
        if (this._ca != null) {
            i.x1("A", this._ca);
            this._ca = null;
            this._b6 = null
        }
        if (this._b8 != null) {
            i.x1("B", this._b8);
            this._b8 = null;
            this._b9 = null
        }
    }, i: function (i) {
        this._ca = i.xc("A");
        if (this._ca != null) {
            this._b6 = new ct(this._ca);
            i.x1("A", this._b6)
        }
        this._b8 = i.xc("B");
        if (this._b8 != null) {
            this._b9 = new ct(this._b8);
            i.x1("B", this._b9)
        }
    }});
    var bt = function () {
        this._a = new R;
        this._c = 10
    };
    _twaver.ext(bt, dt, {i2: function (i) {
        this._b = i.xl();
        this.w9(i);
        this.w4(i);
        this.c(i);
        this.w8(i, this._b);
        i.xj(this._b)
    }, i1: function (i) {
        if (this.w2() == null) {
            return true
        } else {
            this._b = i.xl();
            this.w9(i);
            var t = this.w3(i);
            this.c(i);
            i.xj(this._b);
            return t
        }
    }, w8: function (i, t) {
        for (var a = i.xf(); a.i1(); a.i2()) {
            var r = a.i8();
            if (t.i1(r) != null) {
                var n = t.i1(r);
                Et.g(i, r, n, this._c)
            }
        }
    }, w9: function (i) {
        var t = i.xk();
        for (var a = i.x9(); a.i1(); a.i2()) {
            var r = a.i9();
            for (var n = r.af(); n.i1(); n.i2()) {
                var s = n.i8();
                var h = s.a1(r);
                var e = t.i1(h);
                if (e !== s)if (e == null) {
                    t.z1(h, s)
                } else {
                    if (this._b.i1(e) == null)this._b.i8(e, new R);
                    var _ = this._b.i1(e);
                    _.aa(s);
                    this._a.ac(s);
                    i.h1(s)
                }
            }
            for (var f = r.af(); f.i1(); f.i2()) {
                var u = f.i8();
                var o = u.a1(r);
                t.z1(o, null)
            }
        }
        i.xi(t)
    }, c: function (i) {
        for (; !this._a.ar(); i.u1(this._a.c3()));
    }});
    var wt = function (i) {
        this._a = i
    };
    _twaver.ext(wt, Object, {i2: function (i) {
        this._a.i3(i)
    }, i1: function (i) {
        return this._a.i4(i)
    }});
    var mt = function () {
        mt.superClass.constructor.call(this);
        this._jo = 30;
        this._jp = new jt;
        this._jt = 5
    };
    _twaver.ext(mt, ht, {i4: function (i) {
        return true
    }, i3: function (i) {
        this._ju = i;
        Et.c(i);
        var t = this._jp.i1(i);
        var a = 0;
        for (var r = i.x9(); r.i1(); r.i2())a = Math.max(a, this.e(r.i9()));
        if (a < this._jt)a = this._jt;
        this.a(t, a)
    }, a: function (i, t) {
        var a = i.i7();
        var r = 2 * Math.PI / a;
        var n = 0;
        var s = Jt.a(a);
        i.i4();
        for (var h = 0; h < a;) {
            s[h] = this.e(i.i9()) + this._jo;
            n += s[h];
            h++;
            i.i2()
        }
        var e = n / a;
        var _ = n / (Math.PI * 2);
        if (_ < t)_ = t;
        i.i4();
        var f = 0;
        for (var u = 0; u < a;) {
            var o = r / e * s[u];
            f += o / 2;
            var v = Math.cos(f) * _;
            var l = Math.sin(f) * _;
            f += o / 2;
            this._ju.s2(i.i9(), v, l);
            u++;
            i.i2()
        }
        return _
    }, e: function (i) {
        var t = this._ju.gj(i);
        var a = this._ju.g9(i);
        return t <= a ? a : t
    }});
    var yt = function () {
        yt.superClass.constructor.call(this);
        this._jm = new mt;
        this._jk = new lt
    };
    _twaver.ext(yt, ht, {i4: function (i) {
        return true
    }, i3: function (i) {
        if (i.x0() < 2)return;
        this._jn = i;
        Et.c(this._jn);
        Et.e(this._jn);
        var t = new Ot(this._jn);
        t.a1();
        t.h();
        var a = new tt(this._jn);
        a.a();
        for (var r = t.x9(); r.i1(); r.i2()) {
            var n = r.i9();
            var s = t.c2(n);
            if (s.ay() > 1) {
                var h = t.d1(n);
                tt.h(this._jn, h.c1());
                this._jm.i3(this._jn);
                var e = this._jn.g3();
                t.s7(n, e.width, e.height)
            } else if (s.ay() === 1) {
                var _ = s.x2();
                t.s8(n, this._jn.gm(_));
                this._jn.s2(_, 0, 0)
            } else {
                t.s7(n, 1, 1)
            }
            tt.i(this._jn, this._jn.xf())
        }
        a.b();
        var f = this.a7(t);
        L.a4(t, f);
        var u = t.xk();
        var o = t.xl();
        this.a2(t, o, u);
        this.a1(t, o);
        this.a3(t, f, o);
        this._jk.a(o, u);
        this._jk.i3(t);
        this.a5(t, f, u);
        for (var v = t.x9(); v.i1(); v.i2()) {
            var l = v.i9();
            var c = t.g4(l);
            for (var d = t.c2(l).x1(); d.i1(); d.i2()) {
                var x = d.i9();
                this._jn.s2(x, c.x + this._jn.g5(x), c.y + this._jn.g6(x))
            }
        }
    }, a7: function (i) {
        var t = -1;
        var a = null;
        for (var r = i.x9(); r.i1(); r.i2()) {
            var n = r.i9();
            if (i.c2(n).ay() > t) {
                a = n;
                t = i.c2(n).ay()
            }
        }
        return a
    }, a1: function (i, t) {
        var a = function (i, a) {
            var r = t.i3(i) - t.i3(a);
            if (r > 0)return 1;
            return r >= 0 ? 0 : -1
        };
        for (var r = i.x9(); r.i1(); r.i2())r.i9().av(a)
    }, a2: function (i, t, a) {
        var r = Jt.a(this._jn.x0());
        for (var n = i.x9(); n.i1(); n.i2()) {
            var s = n.i9();
            var h = i.c2(s);
            for (var e = h.x1(); e.i1(); e.i2()) {
                var _ = e.i9();
                r[_.al()] = s.al()
            }
        }
        var f = L.a2(i);
        this.a4(i, f, r, t, a)
    }, a3: function (i, t, a) {
        if (i.c2(t).ay() > 1) {
            var r = 0;
            var n = 0;
            var s = 0;
            for (var h = t.ap(); h.i1(); h.i2()) {
                var e = h.i8();
                var _ = a.i3(e);
                if (_ - r > n) {
                    n = _ - r;
                    s = (r + _) / 2
                }
                r = _
            }
            if (360 - r > n)s = (360 + r) / 2;
            this.a6(i, t, s);
            for (var f = t.ap(); f.i1(); f.i2()) {
                var u = f.i8();
                var o = a.i3(u);
                for (o -= s; o < 0; o += 360);
                a.i6(u, o)
            }
            t.av(function (i, t) {
                var r = a.i3(i) - a.i3(t);
                if (r > 0)return 1;
                return r >= 0 ? 0 : -1
            })
        }
    }, a4: function (i, t, a, r, n) {
        var s = t.al();
        var h = n.i3(t);
        for (var e = t.ap(); e.i1(); e.i2()) {
            var _ = e.i8();
            var f = i.b(_);
            var u = 0;
            var o = 0;
            var v = 0;
            var l = 0;
            for (var c = f.c1(); c.i1(); c.i2()) {
                var d = c.i8();
                var x = null;
                var g = null;
                if (a[d.a2().al()] === s) {
                    x = d.a2();
                    g = d.a3()
                } else {
                    x = d.a3();
                    g = d.a2()
                }
                v -= this._jn.g5(x);
                l += this._jn.g6(x);
                u -= this._jn.g5(g);
                o += this._jn.g6(g)
            }
            if (v !== 0 || l !== 0) {
                var b;
                for (b = Math.atan2(l, v) * 180 / Math.PI - h; b < 0; b += 360);
                r.i6(_, b)
            }
            if (u !== 0 && o !== 0) {
                var w = Math.atan2(o, u) * 180 / Math.PI;
                if (w < 0)w += 360;
                n.i6(_.a3(), w)
            }
            this.a4(i, _.a3(), a, r, n)
        }
    }, a5: function (i, t, a) {
        var r = i.g4(t);
        for (var n = t.ap(); n.i1(); n.i2()) {
            var s = n.i8();
            var h = s.a3();
            var e = i.g4(h);
            var _ = e.x - r.x;
            var f = e.y - r.y;
            var u = Math.atan2(f, _) * 180 / Math.PI;
            if (a.i1(h) != null) {
                var o = a.i3(h);
                u += o
            }
            this.a6(i, h, u);
            this.a5(i, h, a)
        }
    }, a6: function (i, t, a) {
        a = a / 180 * Math.PI;
        var r = i.c2(t);
        if (r.ay() <= 1)return;
        for (var n = r.x1(); n.i1(); n.i2()) {
            var s = n.i9();
            var h = this._jn.g5(s);
            var e = this._jn.g6(s);
            var _ = Math.cos(a);
            var f = Math.sin(a);
            var u = h * _ - f * e;
            var o = h * f + _ * e;
            this._jn.s2(s, u, o)
        }
    }});
    var pt = function () {
        this._a = (new Date).getTime()
    };
    _twaver.ext(pt, Object, {b: function () {
        return(new Date).getTime() - this._a
    }});
    var kt = {};
    kt._A = new _(0, 0);
    kt.b = function (i, t, a) {
        return kt.c(i.x, i.y, t.x, t.y, a.x, a.y)
    };
    kt.c = function (i, t, a, r, n, s) {
        a -= i;
        r -= t;
        n -= i;
        s -= t;
        var h = n * r - s * a;
        return h >= 0 ? h <= 0 ? 0 : -1 : 1
    };
    kt.d = function (i, t, a) {
        return kt.b(i, t, a) > 0
    };
    kt.f = function (i, t, a) {
        return kt.b(i, t, a) < 0
    };
    kt.g = function (i, t, a) {
        return kt.b(i, t, a) === 0
    };
    kt.h = function (i) {
        return kt.i(i)
    };
    kt.i = function (i) {
        var t = new A(i.ah());
        var a = new A;
        t.a2();
        if (t.ar())return a;
        var r = t.at();
        a.ae(r);
        for (; !t.ar() && r.equals(t.am()); t.at());
        if (t.ar())return a;
        r = t.at();
        var n = a.ae(r);
        for (var s = t.ah(); s.i1(); s.i2()) {
            var h = s.i6();
            if (!h.equals(r)) {
                r = h;
                if (a.ay() === 2 && kt.g(a.am(), a.as(), h)) {
                    n.c(h)
                } else {
                    var e;
                    for (e = n; !kt.f(a.ai(e).d(), e.d(), h); e = a.ai(e));
                    var _;
                    for (_ = n; !kt.d(a.aj(_).d(), _.d(), h); _ = a.aj(_));
                    for (; _ !== a.aj(e); a.aw(a.aj(e)));
                    n = a.an(h, e)
                }
            }
        }
        return a
    };
    kt.j = function () {
        return kt.k(Number.MAX_VALUE)
    };
    kt.k = function (i) {
        return Math.floor(Math.random() * i)
    };
    kt.l = function (i, t) {
        return Math.random() * (t - i) + i
    };
    var jt = function () {
    };
    _twaver.ext(jt, Object, {i1: function (i) {
        this._b = i;
        var t = new R;
        t = m.a6(i);
        t.az(m.a7(i));
        var a = this.a1();
        for (; !t.ar(); i.x5(t.c3()));
        return a.x1()
    }, a1: function () {
        if (this._b.x0() < 3)return new $(this._b.x9());
        var i = this._b.xk();
        var t = this._b.xk();
        var a = this._b.xl();
        var r = new at(this._b, new ot, 0, this.a3(this._b));
        var n = this._b.x0();
        var s = new R;
        var h = new R;
        var e = new tt(this._b);
        for (; n > 3; n--) {
            var _ = r.g();
            for (var f = _.an(); f.i1(); f.i2()) {
                i.z1(f.i9(), n);
                t.i5(f.i9(), false)
            }
            for (var u = _.an(); u.i1(); u.i2()) {
                var o = u.i9();
                for (var v = o.ap(); v.i1(); v.i2()) {
                    var l = v.i8();
                    if (i.i2(l.a3()) === n) {
                        h.aa(l);
                        t.i5(l.a2(), true);
                        t.i5(l.a3(), true)
                    }
                }
            }
            if (h.ay() < _.ad() - 1) {
                var c = null;
                for (var d = _.an(); d.i1(); d.i2()) {
                    var x = d.i9();
                    if (i.i2(x) === n && !t.i4(x))if (c == null) {
                        c = x
                    } else {
                        var g = this._b.xo(c, x);
                        a.i7(g, true);
                        h.aa(g);
                        c = null
                    }
                }
                if (c != null) {
                    for (var b = _.an(); b.i1(); b.i2()) {
                        var w = b.i9();
                        if (w === c || w.aj(c) != null)continue;
                        var m = this._b.xo(c, w);
                        a.i7(m, true);
                        h.aa(m);
                        break
                    }
                }
                if (h.ay() < _.ad() - 1) {
                    var y = 2147483647;
                    var p = null;
                    for (var k = _.an(); k.i1(); k.i2()) {
                        var j = k.i9();
                        if (j.ad() < y) {
                            p = j;
                            y = j.ad()
                        }
                    }
                    for (var M = _.an(); M.i1(); M.i2()) {
                        var z = M.i9();
                        if (p.aj(z) != null || p === z)continue;
                        var L = this._b.xo(p, z);
                        a.i7(L, true);
                        h.aa(L);
                        if (h.ay() >= _.ad() - 1)break
                    }
                }
            }
            for (var C = _.an(); C.i1(); C.i2())r.b(C.i9());
            for (var O = h.c1(); O.i1(); O.i2()) {
                var N = O.i8();
                if (a.i4(N)) {
                    r.d(N.a2());
                    r.d(N.a3())
                }
            }
            s.az(h);
            e.e(_)
        }
        e.b();
        r.c();
        for (var E = s.c1(); E.i1(); E.i2()) {
            var q = E.i8();
            if (q._h != null)if (a.i4(q))this._b.x5(q); else this._b.h1(q)
        }
        var B = this.a4(this._b);
        var A = new $;
        var P = B.ak(0);
        var I = B.ak(1);
        var D = null;
        if (P.a2() === I.a2() || P.a2() === I.a3())D = P.a3(); else D = P.a2();
        A.aa(D);
        for (var V = B.c1(); V.i1(); V.i2()) {
            var S = V.i8();
            D = S.a1(D);
            A.aa(D)
        }
        for (var F = s.c1(); F.i1(); F.i2()) {
            var X = F.i8();
            if (!a.i4(X) && X._h == null)this._b.u1(X)
        }
        this._b.xi(t);
        this._b.xj(a);
        this._b.xi(i);
        this.a2(A);
        return A
    }, a2: function (i) {
        if (i.ay() < this._b.x0()) {
            var t = this._b.xk();
            for (var a = i._b; a != null; a = a.a()) {
                var r = a.d();
                t.z1(r, a)
            }
            var n;
            for (n = new at(this._b, new vt(t), 0, i.ay(), new vt(t)); !n.e();) {
                var s = n.f();
                for (var h = s.an(); h.i1(); h.i2()) {
                    var e = h.i9();
                    if (t.i1(e) == null)continue;
                    var _ = t.i1(e);
                    var f = i.ai(_).d();
                    var u = null;
                    if (s.aj(f) != null)u = i.ao(s, _); else u = i.an(s, _);
                    t.z1(s, u);
                    break
                }
                for (var o = s.an(); o.i1(); o.i2()) {
                    var v = o.i9();
                    if (t.i1(v) == null)n.d(v)
                }
            }
            this._b.xi(t);
            n.c()
        }
    }, a3: function (i) {
        var t = 0;
        for (var a = i.x9(); a.i1(); a.i2())t = Math.max(t, a.i9().ad());
        return t
    }, a4: function (i) {
        var t = [];
        for (var a = 0, r = i.x0(); a < r; a++)t[a] = new M;
        var n = new k(t);
        n.a6(false);
        n.a8(i);
        var s = -1;
        var h = null;
        for (var e = i.x9(); e.i1(); e.i2()) {
            var _ = e.i9();
            var f = t[_.al()];
            if (f._a + f._c > s) {
                s = f._a + f._c;
                h = _
            }
        }
        var u = new R;
        var o = h;
        for (var v = t[o.al()]._d; v != null; v = t[o.al()]._d) {
            u.ac(v);
            o = v.a1(o)
        }
        o = h;
        for (var l = t[o.al()]._b; l != null; l = t[o.al()]._d) {
            u.ae(l);
            o = l.a1(o)
        }
        return u
    }});
    var Mt = function () {
        this._v = new P;
        this._x = new P;
        this._z = new H(3, 5);
        this._w = new H(3, 5);
        this._y = false;
        this._u = false;
        this._t = {}
    };
    _twaver.ext(Mt, Object, {xm: function () {
        var i = new W(this);
        return i
    }, xo: function (i, t) {
        return this.xn(i, null, t, null, 0, 0)
    }, xn: function (i, t, a, r, n, s) {
        return new X(this, i, t, a, r, n, s)
    }, x4: function (i) {
        this.b3(i)
    }, b3: function (i) {
        var t;
        while ((t = i._o[0]) != null)this.x5(t);
        while ((t = i._o[1]) != null)this.x5(t);
        this._v.c(i);
        i._g = null;
        this._y = true
    }, x5: function (i) {
        this.a11(i)
    }, a11: function (i) {
        if (i._h !== this)throw"Error";
        var t = i.a2();
        var a = i.a3();
        this.a12(i, t, a);
        this._x.c(i);
        i._h = null;
        this._u = true
    }, x7: function (i) {
        i._p = this._v._c;
        i._g = this;
        i.ac();
        if (i._c.length < this._z._b)this._z.a3(i, i._c.length, this._z._b);
        this._v.a(i);
        this._y = true
    }, x8: function (i) {
        if (i._h != null)throw"Error";
        if (i._c.length < this._w._b)this._w.a3(i, i._c.length, this._w._b);
        if (i._a == null || i._a._h !== this)this._x.a(i); else this._x.b(i, i._a);
        i._h = this;
        i.a4();
        this.b2(i, i.a2(), null, i.a3(), null, 0, 0);
        this._u = true
    }, xr: function (i, t, a) {
        var r = i.a2();
        var n = i.a3();
        if (i._h == null) {
            i._d = t;
            i._e = a
        } else {
            if (r !== t) {
                r.ar(i, 0, 0);
                i._d = t;
                t.ab(i, null, 0, 0, 0)
            }
            if (n !== a) {
                n.ar(i, 1, 1);
                i._e = a;
                a.ab(i, null, 1, 1, 0)
            }
        }
    }, x3: function (i) {
        this.xr(i, i.a3(), i.a2())
    }, h1: function (i) {
        this.a11(i)
    }, u1: function (i) {
        this.x8(i)
    }, h2: function (i) {
        this.x4(i)
    }, h3: function (i) {
        this.x7(i)
    }, xa: function () {
        return this._v._c
    }, x0: function () {
        return this._v._c
    }, xh: function () {
        return this._x._c
    }, xg: function () {
        return this._x._c
    }, xb: function () {
        return this._v._c === 0
    }, xq: function (i) {
        return i._g === this
    }, xp: function (i) {
        return i._h === this
    }, xd: function () {
        return this._v._a
    }, x9: function () {
        return new Q(this._v)
    }, xf: function () {
        return new Q(this._x)
    }, x2: function (i, t) {
        var a = Jt.d(this.xh());
        if (i != null && t != null) {
            for (var r = this.x9(); r.i1(); r.i2()) {
                r.i9().at(i, 1, a);
                r.i9().at(t, 0, a)
            }
        } else if (t == null && i != null) {
            for (var n = this.x9(); n.i1(); n.i2())n.i9().at(i, 1, a)
        } else if (t != null && i == null) {
            for (var s = this.x9(); s.i1(); s.i2())s.i9().at(t, 0, a)
        }
    }, xk: function () {
        return this._z.b(this._v)
    }, xl: function () {
        return this._w.c(this._x)
    }, xi: function (i) {
        this._z.a5(i, this._v)
    }, xj: function (i) {
        this._w.a6(i, this._x)
    }, xc: function (i) {
        return this._t[i]
    }, x1: function (i, t) {
        this._t[i] = t
    }, x6: function (i) {
        delete this._t[i]
    }, b2: function (i, t, a, r, n, s, h) {
        t.ab(i, a, 0, 0, s);
        r.ab(i, n, 1, 1, h)
    }, a12: function (i, t, a) {
        t.ar(i, 0, 0);
        a.ar(i, 1, 1)
    }, c: function () {
        var i = 0;
        for (var t = this.x9(); t.i1(); t.i2())t.i9()._p = i++;
        this._y = false
    }, b1: function () {
        var i = 0;
        for (var t = this.xf(); t.i1(); t.i2())t.i8()._g = i++;
        this._u = false
    }, xs: function (i) {
        i.as(this, this._z._b);
        i._p = this._v._c;
        this._v.a(i)
    }, xt: function (i, t, a, r, n, s, h) {
        i.a6(this, t, r, this._w._b);
        i._g = this._x._c;
        this._x.a(i);
        this.b2(i, i.a2(), a, i.a3(), n, s, h)
    }});
    var zt = function () {
        zt.superClass.constructor.call(this)
    };
    _twaver.ext(zt, Mt, {gb: function (i) {
        return this.g1(i)
    }, g7: function (i) {
        return this.g2(i)
    }, g5: function (i) {
        var t = this.g1(i);
        return t.i1() + t.i3() / 2
    }, g6: function (i) {
        var t = this.g1(i);
        return t.i2() + t.i4() / 2
    }, g4: function (i) {
        return new _(this.g5(i), this.g6(i))
    }, gi: function (i) {
        return this.g1(i).i1()
    }, gh: function (i) {
        return this.g1(i).i2()
    }, ga: function (i) {
        var t = this.g1(i);
        return new _(t.i1(), t.i2())
    }, gj: function (i) {
        return this.g1(i).i3()
    }, g9: function (i) {
        return this.g1(i).i4()
    }, gm: function (i) {
        return new f(this.gj(i), this.g9(i))
    }, s1: function (i, t) {
        this.s2(i, t.x, t.y)
    }, s2: function (i, t, a) {
        var r = this.g1(i);
        r.i5(t - r.i3() / 2, a - r.i4() / 2)
    }, s7: function (i, t, a) {
        this.g1(i).i6(t, a)
    }, s8: function (i, t) {
        this.s7(i, t.width, t.height)
    }, s3: function (i, t, a) {
        this.g1(i).i5(t, a)
    }, s4: function (i, t) {
        this.s3(i, t.x, t.y)
    }, gp: function (i) {
        var t = this.g2(i);
        var a = new s;
        for (var r = 0; r < t.i1(); r++)a.add(t.i2(r));
        return new l(a)
    }, gf: function (i) {
        var t = this.g2(i);
        var a = new A;
        for (var r = 0; r < t.i1(); r++)a.aa(t.i2(r));
        return a
    }, gc: function (i) {
        var t = new s;
        t.add(this.gs(i));
        for (var a = this.gp(i).d(); a.i1(); a.i2())t.add(a.i6());
        t.add(this.gl(i));
        return new l(t)
    }, gd: function (i) {
        var t = new A;
        t.aa(this.gs(i));
        for (var a = this.gp(i).d(); a.i1(); a.i2())t.aa(a.i6());
        t.aa(this.gl(i));
        return t
    }, m1: function (i, t) {
        var a = this.g2(i);
        a.i5();
        var r = t.ah();
        var n = r.i6();
        this.gx(i, n);
        var s = t.as();
        r.i2();
        for (; r.i6() !== s; r.i2()) {
            var h = r.i6();
            a.i4(h.x, h.y)
        }
        this.gy(i, s)
    }, s5: function (i, t) {
        var a = this.g2(i);
        a.i5();
        for (var r = t.d(); r.i1(); r.i2()) {
            var n = r.i6();
            a.i4(n.x, n.y)
        }
    }, s6: function (i, t) {
        var a = this.g2(i);
        a.i5();
        for (var r = t.ah(); r.i1(); r.i2()) {
            var n = r.i6();
            a.i4(n.x, n.y)
        }
    }, m2: function (i, t, a) {
        this.gx(i, t);
        this.gy(i, a)
    }, gn: function (i) {
        return this.g2(i).i6()
    }, gk: function (i) {
        return this.g2(i).i7()
    }, gt: function (i, t) {
        this.g2(i).i8(t)
    }, gz: function (i, t) {
        this.g2(i).i9(t)
    }, gs: function (i) {
        var t = this.g2(i).i6();
        if (t == null) {
            return this.g4(i.a2())
        } else {
            var a = new _(this.g5(i.a2()) + t.x, this.g6(i.a2()) + t.y);
            return a
        }
    }, gl: function (i) {
        var t = this.g2(i).i7();
        if (t == null) {
            return this.g4(i.a3())
        } else {
            var a = new _(this.g5(i.a3()) + t.x, this.g6(i.a3()) + t.y);
            return a
        }
    }, gx: function (i, t) {
        var a = new _(t.x - this.g5(i.a2()), t.y - this.g6(i.a2()));
        this.g2(i).i8(a)
    }, gy: function (i, t) {
        var a = new _(t.x - this.g5(i.a3()), t.y - this.g6(i.a3()));
        this.g2(i).i9(a)
    }, g8: function () {
        var i = new R;
        for (var t = this.xf(); t.i1(); t.i2())i.aa(t.i8());
        return i
    }, g3: function () {
        var i;
        var t = i = Number.MAX_VALUE;
        var a;
        var r = a = Number.MIN_VALUE;
        for (var n = this.x9(); n.i1(); n.i2()) {
            var s = this.ga(n.i9());
            var h = this.gm(n.i9());
            t = Math.min(s.x, t);
            i = Math.min(s.y, i);
            r = Math.max(s.x + h.width, r);
            a = Math.max(s.y + h.height, a)
        }
        for (var e = this.xf(); e.i1(); e.i2()) {
            for (var _ = this.gp(e.i8()).c(); _.i1(); _.i2()) {
                var f = _.i6();
                t = Math.min(f.x, t);
                i = Math.min(f.y, i);
                r = Math.max(f.x, r);
                a = Math.max(f.y, a)
            }
        }
        return{x: Math.floor(t), y: Math.floor(i), width: Math.floor(r - t), height: Math.floor(a - i)}
    }});
    var Lt = function () {
        Lt.superClass.constructor.call(this);
        this.a(new w, new g)
    };
    _twaver.ext(Lt, zt, {a: function (i, t) {
        this._a3 = i;
        this._a4 = t
    }, xo: function (i, t) {
        return this.l2(i, t, this._a4.a6())
    }, l2: function (i, t, a) {
        return this.l1(i, null, t, null, 0, 0, a)
    }, xn: function (i, t, a, r, n, s) {
        return this.l1(i, t, a, r, n, s, this._a4.a6())
    }, l1: function (i, t, a, r, n, s, h) {
        var e = new X(this, i, t, a, r, n, s);
        e._l = h;
        return e
    }, xm: function () {
        var i = new W(this);
        i._r = this._a3.m3();
        return i
    }, g3: function () {
        var i = {x: 0, y: 0, width: -1, height: -1};
        for (var t = this.x9(); t.i1(); t.i2())t.i9()._r.m1(i);
        return i
    }, g1: function (i) {
        return i._r
    }, g2: function (i) {
        return i._l
    }, g5: function (i) {
        return i._r.m4()
    }, g6: function (i) {
        return i._r.m5()
    }, gi: function (i) {
        return i._r.i1()
    }, gh: function (i) {
        return i._r.i2()
    }, gj: function (i) {
        return i._r.i3()
    }, g9: function (i) {
        return i._r.i4()
    }, s2: function (i, t, a) {
        i._r.m6(t, a)
    }, s7: function (i, t, a) {
        i._r.i6(t, a)
    }, s3: function (i, t, a) {
        i._r.i5(t, a)
    }});
    var Ct = function () {
        Ct.superClass.constructor.call(this);
        this._ap = this.xk();
        this._as = this.xl()
    };
    _twaver.ext(Ct, zt, {g1: function (i) {
        var t = this._ap.i1(i);
        if (t == null) {
            t = new Y;
            this._ap.z1(i, t)
        }
        return t
    }, g2: function (i) {
        var t = this._as.i1(i);
        if (t == null) {
            t = new G;
            this._as.i8(i, t)
        }
        return t
    }});
    var Ot = function (i) {
        Ot.superClass.constructor.call(this);
        this._ay = i;
        this._a0 = this.xk();
        this._au = this.xl()
    };
    _twaver.ext(Ot, Ct, {c2: function (i) {
        var t = this._a0.i1(i);
        return t
    }, a2: function (i, t) {
        this._a0.z1(i, t)
    }, h: function () {
        if (this._az == null)this._az = this.xk();
        var i = Jt.a(this._ay.x0() + 1);
        var t = 1;
        for (var a = this.x9(); a.i1();) {
            var r = this.c2(a.i9());
            for (var n = r.x1(); n.i1(); n.i2()) {
                var s = n.i9();
                i[s.al()] = t
            }
            var h = new R;
            for (var e = r.x1(); e.i1(); e.i2()) {
                var _ = e.i9();
                var f = i[_.al()];
                for (var u = _.ap(); u.i1(); u.i2()) {
                    var o = u.i8();
                    var v = o.a3();
                    var l = i[v.al()];
                    if (l === f)h.ac(o)
                }
            }
            this._az.z1(a.i9(), h);
            a.i2();
            t++
        }
    }, d1: function (i) {
        return this._az.i1(i)
    }, b: function (i) {
        return this._au.i1(i)
    }, a3: function (i, t) {
        this._au.i8(i, t)
    }, a1: function () {
        var i = this._ay.xk();
        var t = rt.a4(Jt.a(this._ay.xh()));
        var a = m.a1(this._ay, t, i);
        var r = m.a5(this._ay, t, a);
        this.d2(i, r);
        this._ay.xi(i)
    }, c1: function (i) {
        var t = null;
        var a = -1;
        for (var r = 0, n = i.length; r < n; r++) {
            var s = i[r];
            if (s.ay() > a) {
                t = s;
                a = s.ay()
            }
        }
        return t
    }, d2: function (i, t) {
        var a = this._ay.xl();
        var r = this._ay.xk();
        var n = t.length;
        for (var h = 0; h < n; h++) {
            var e = t[h];
            for (var _ = e.c1(); _.i1(); _.i2())a.i8(_.i8(), e)
        }
        var f = this.c1(t);
        this.a4(f, i, a, new s, r);
        var u = {};
        n = t.length;
        for (var o = 0; o < n; o++) {
            var v = t[o];
            if (v.ay() > 1) {
                var l = this.xm();
                u[v._id] = l
            }
        }
        for (var c = this._ay.x9(); c.i1(); c.i2()) {
            var d = c.i9();
            if (i.i4(d) && r.i1(d) == null) {
                var x = this.xm();
                u[d._id] = x;
                var g = new $;
                g.aa(d);
                this.a2(x, g)
            }
        }
        var b = Jt.d(2);
        n = t.length;
        for (var w = 0; w < n; w++) {
            var m = t[w];
            if (m.ay() === 1) {
                var y = m.c2();
                b[0] = y.a2();
                b[1] = y.a3();
                for (var p = 0; p < 2; p++) {
                    var k = b[p];
                    if (k.ad() === 1) {
                        var j = this.xm();
                        u[k._id] = j;
                        var M = new $;
                        M.aa(k);
                        this.a2(j, M)
                    }
                }
            }
        }
        for (var z = this._ay.x9(); z.i1(); z.i2()) {
            var L = z.i9();
            if (r.i1(L) != null) {
                var C = r.i1(L);
                var O = u[C._id];
                for (var N = L.af(); N.i1(); N.i2()) {
                    var E = N.i8();
                    if (a.i1(E) !== C) {
                        var q = u[a.i1(E)._id];
                        if (q == null) {
                            var B = E.a1(L);
                            var A = r.i1(B);
                            if (A != null)q = u[A._id]; else q = u[B._id]
                        }
                        var P = O.aj(q);
                        var I = null;
                        if (P == null) {
                            P = this.xo(O, q);
                            I = new R
                        } else {
                            I = this.b(P)
                        }
                        I.aa(E);
                        this.a3(P, I)
                    }
                }
            } else if (i.i4(L)) {
                var D = u[L._id];
                for (var V = L.af(); V.i1(); V.i2()) {
                    var S = V.i8();
                    var F = S.a1(L);
                    var X = u[F._id];
                    if (X != null) {
                        var U = D.aj(X);
                        if (U == null) {
                            var G = this.xo(D, X);
                            var Y = new R;
                            Y.aa(S);
                            this.a3(G, Y)
                        }
                    }
                }
            }
        }
        if (this._ay.x0() === 2 && this._ay.xg() === 1) {
            var T = this._ay.xf().i8();
            var H = u[T.a2()._id];
            var W = u[T.a3()._id];
            if (W != null && H != null && W.aj(H) == null) {
                var Z = this.xo(H, W);
                var J = new R;
                J.aa(T);
                this.a3(Z, J)
            }
        }
        var K = Jt.a(this._ay.x0());
        var Q = 1;
        n = t.length;
        for (var it = 0; it < n; it++) {
            var tt = t[it];
            var at = u[tt._id];
            if (at != null) {
                var rt = this.c2(at);
                if (rt == null) {
                    rt = new $;
                    this.a2(at, rt)
                }
                for (var nt = tt.c1(); nt.i1(); nt.i2()) {
                    var st = nt.i8();
                    var ht = st.a2();
                    if (K[ht.al()] !== Q && (!i.i4(ht) || r.i1(ht) === tt)) {
                        K[ht.al()] = Q;
                        rt.aa(ht)
                    }
                    ht = st.a3();
                    if (K[ht.al()] !== Q && (!i.i4(ht) || r.i1(ht) === tt)) {
                        K[ht.al()] = Q;
                        rt.aa(ht)
                    }
                }
            }
        }
        this._ay.xj(a);
        this._ay.xi(r)
    }, a4: function (i, t, a, r, n) {
        if (r.contains(i))return;
        r.add(i);
        var s = [];
        for (var h = i.c1(); h.i1(); h.i2()) {
            var e = h.i8();
            s[0] = e.a2();
            s[1] = e.a3();
            for (var _ = 0; _ < 2; _++) {
                var f = s[_];
                if (t.i4(f) && n.i1(f) == null) {
                    if (i.ay() > 1)n.z1(f, i);
                    for (var u = f.af(); u.i1(); u.i2()) {
                        var o = a.i1(u.i8());
                        this.a4(o, t, a, r, n)
                    }
                }
            }
        }
    }});
    var Nt = function (i, t, a, r, n) {
        this._a = {};
        Nt.superClass.constructor.call(this);
        var h = new s, _, f;
        for (_ = 0, f = t.size(); _ < f; _++) {
            var u = t.get(_);
            if (u instanceof twaver.Link) {
                h.add(u)
            } else {
                var o = r && n == null && u instanceof e;
                if (o) {
                    u.setExpanded(true)
                }
                var v = i.getDimension(u);
                if (o) {
                    u.setExpanded(false)
                }
                if (v == null) {
                    continue
                }
                var l = this.xm();
                var c = i._repulsion;
                if (a === "rightleft" || a === "leftright") {
                    this.s7(l, v.height * c, v.width * c)
                } else {
                    this.s7(l, v.width * c, v.height * c)
                }
                l.node = u;
                this._a[u.getId()] = l
            }
        }
        for (_ = 0, f = h.size(); _ < f; _++) {
            var d = h.get(_);
            var x = d.getFromAgent();
            var g = d.getToAgent();
            var b = this._a[x.getId()];
            var w = this._a[g.getId()];
            if (b == null || w == null || b === w) {
                continue
            }
            this.xo(b, w)
        }
    };
    _twaver.ext(Nt, Lt, {});
    var Et = {};
    Et._D = new l;
    Et._E = new _(0, 0);
    Et.b = function (i) {
        if (i.i1() > 0) {
            var t = new s;
            for (var a = i.i1() - 1; a >= 0; a--)t.add(i.i2(a));
            i.i5();
            for (var r = 0, n = t.size(); r < n; r++) {
                var h = t.get(r);
                i.i4(h.x, h.y)
            }
        }
        var e = i.i6();
        i.i8(i.i7());
        i.i9(e)
    };
    Et.c = function (i) {
        Et.d(i, true)
    };
    Et.d = function (i, t) {
        if (t) {
            for (var a = i.xf(); a.i1(); a.i2()) {
                var r = a.i8();
                i.gt(r, Et._E);
                i.gz(r, Et._E);
                i.s5(r, Et._D)
            }
        } else {
            for (var n = i.xf(); n.i1(); n.i2())i.s5(n.i8(), Et._D)
        }
    };
    Et.e = function (i) {
        var t = new _(0, 0);
        for (var a = i.xf(); a.i1(); a.i2()) {
            var r = a.i8();
            i.gt(r, t);
            i.gz(r, t)
        }
    };
    Et.f = function (i, t, a, r) {
        var n = i.gc(t).b();
        var h = Jt.d(n);
        var e = 0;
        for (var f = i.gc(t).c(); f.i1(); f.i2()) {
            var o = f.i6();
            if (e <= 0 || !o.equals(h[e - 1])) {
                h[e] = new _(o.x, o.y);
                e++
            }
        }
        n = e;
        if (n < 2)return;
        var c = new s;
        var d = new u(h[1].x - h[0].x, h[1].y - h[0].y);
        var x = Et.i(d);
        x.x *= r;
        x.y *= r;
        var g = Et.h(h[0], x);
        var b = Et.h(h[1], x);
        var w = new v(g, b);
        for (var m = 1; m < n - 1; m++) {
            var y = w;
            var p = Et.i(new u(h[m + 1].x - h[m].x, h[m + 1].y - h[m].y));
            p.x *= r;
            p.y *= r;
            var k = Et.h(h[m], p);
            var j = Et.h(h[m + 1], p);
            w = new v(k, j);
            var M = v.a6(y, w);
            if (M != null)c.add(new _(M.x, M.y))
        }
        var z = new u(h[n - 1].x - h[n - 2].x, h[n - 1].y - h[n - 2].y);
        z = Et.i(z);
        z.x *= r;
        z.y *= r;
        var L = Et.h(h[n - 1], z);
        var C = new l(c);
        if (t.a2() === a.a2()) {
            i.s5(a, C);
            i.m2(a, g, L)
        } else {
            i.s5(a, C.a());
            i.m2(a, L, g)
        }
    };
    Et.g = function (i, t, a, r) {
        var n = r;
        for (var s = a.c1(); s.i1(); s.i2()) {
            var h = s.i8();
            Et.f(i, t, h, n);
            if (n < 0)n -= r;
            n = -n
        }
    };
    Et.a = function (i, t, a) {
        return Et.j(i, t, a, 1)
    };
    Et.l = function (i, t, a) {
        if (i == null || i.length < 1) {
            if (t != null) {
                t.x = 0;
                t.y = 0;
                t.width = 0;
                t.height = 0
            }
            return{width: 0, height: 0}
        }
        var r = 0;
        var n = 0;
        for (var s = 0; s < i.length; s++) {
            var h = i[s];
            r = Math.max(r, h.width);
            n = Math.max(n, h.height)
        }
        var e = r * n * i.length;
        var _ = Math.sqrt(e / a);
        var f = e / _;
        var u = Math.floor(f / r);
        var o = Math.ceil(f / r);
        var v = Math.ceil(i.length / u);
        var l = Math.ceil(i.length / o);
        var c;
        var d;
        if (u * v < o * l) {
            c = u;
            d = v
        } else {
            c = o;
            d = l
        }
        var x = 0;
        var g = 0;
        var b = 0;
        var w = 0;
        var m;
        if (r > n) {
            for (var y = 0; y < i.length; y++) {
                m = i[y];
                m.x = g * r;
                m.y = x * n;
                b = Math.max(b, m.x + m.width);
                w = Math.max(w, m.y + m.height);
                if (++g >= c) {
                    x++;
                    g = 0
                }
            }
        } else {
            for (var p = 0; p < i.length; p++) {
                m = i[p];
                m.x = g * r;
                m.y = x * n;
                b = Math.max(b, m.x + m.width);
                w = Math.max(w, m.y + m.height);
                if (++x >= d) {
                    g++;
                    x = 0
                }
            }
        }
        if (t != null) {
            t.x = 0;
            t.y = 0;
            t.width = b;
            t.height = w
        }
        return{width: d, height: c}
    };
    Et.j = function (i, t, a, r) {
        if (i == null || i.length < 1) {
            if (t != null) {
                t.x = 0;
                t.y = 0;
                t.width = 0;
                t.height = 0
            }
            return 0
        }
        var n;
        var s = n = i[0].width;
        var h;
        var e = h = i[0].height;
        var _ = i.length;
        for (var f = 1; f < _; f++) {
            var u = i[f].width;
            s = Math.min(s, u);
            n = Math.max(n, u);
            var o = i[f].height;
            e = Math.min(e, o);
            h = Math.max(h, o)
        }
        if (e / h > .95 && s / n > .95)return Et.l(i, t, a).width;
        var v = new A;
        var l = 0;
        for (var c = 0; c < _; c++) {
            var d = i[c];
            v.aa(i[c]);
            l = Math.floor(l + d.width * d.height)
        }
        v.a1(function (i, t) {
            var a = Math.floor(t.height) - Math.floor(i.height);
            if (a === 0)return Math.floor(t.width) - Math.floor(i.width); else return a
        });
        var x = 0;
        var g = 0;
        var b = Math.floor(a * Math.sqrt(l / a));
        var w = b;
        var m = 0;
        var y = new A;
        do {
            var p = new A;
            y.aa(p);
            var k;
            var j;
            var M = k = j = 0;
            for (var z = v.ah(); z.i1(); z.i2()) {
                var L = z.i6();
                if (M + L.width > w && p.ay() > 0) {
                    j = Math.max(j, M);
                    p = new A;
                    p.aa(L);
                    y.aa(p);
                    M = Math.floor(L.width)
                } else {
                    p.aa(L);
                    M = Math.floor(M + L.width)
                }
                if (p.ay() === 1)k = Math.floor(k + p.am().height)
            }
            j = Math.max(j, M);
            if (a * k > j && m !== j) {
                y.af();
                w = Math.floor(w * 1.1);
                m = j
            }
        } while (y.ar());
        var C = 0;
        for (var O = y.ah(); O.i1(); O.i2()) {
            var N = 0;
            var E = O.i6();
            for (var q = E.ah(); q.i1(); q.i2()) {
                var B = q.i6();
                B.x = N;
                B.y = C;
                N += B.width
            }
            x = Math.max(x, N);
            C += Et.k(E);
            g = Math.max(g, C)
        }
        if (t != null) {
            t.x = 0;
            t.y = 0;
            t.width = x;
            t.height = g
        }
        return y.ay()
    };
    Et.k = function (i) {
        var t = 0;
        for (var a = i.ah(); a.i1(); a.i2())t = Math.max(a.i6().height, t);
        return t
    };
    Et.h = function (i, t) {
        return new _(i.x + t.x, i.y + t.y)
    };
    Et.i = function (i) {
        var t = Math.sqrt(i.x * i.x + i.y * i.y);
        return new u(-i.y / t, i.x / t)
    };
    var qt = function (i) {
        this._a = i;
        this._b = false
    };
    _twaver.ext(qt, Object, {a: function () {
        return this._b
    }, b: function () {
        return this._a
    }, c: function () {
        return this._a === 1
    }, d: function () {
        return this._a === 2
    }, e: function () {
        return this._a === 4
    }, f: function () {
        return this._a === 8
    }, g: function () {
        return this._a === 0
    }});
    qt.h = function (i, t) {
        var a = i.xc("A");
        if (a == null)return null; else return a.i1(t)
    };
    qt.i = function (i, t) {
        var a = i.xc("B");
        if (a == null)return null; else return a.i1(t)
    };
    qt.j = function (i) {
        switch (i) {
            case 1:
                return qt.k;
            case 2:
                return qt.l
        }
        return null
    };
    qt.k = new qt(1);
    qt.l = new qt(2);
    var Bt = function (i, t, a, r, n) {
        this._o = 0;
        this._l = 0;
        this._i = 0;
        this._d = 0;
        this._f = 0;
        this._b = i;
        this._a = 1e-4;
        this._r = t;
        this._p = 1;
        this._e = (n.gj(i) + n.g9(i)) / 4;
        var s = .45 * a * Math.sqrt(r);
        this._k = kt.l(-s, s);
        this._h = kt.l(-s, s);
        this._g = kt.l(-s, s)
    };
    _twaver.ext(Bt, Object, {});
    var At = function () {
        this._a = 0;
        this._c = 0;
        this._b = 0
    };
    _twaver.ext(At, Object, {});
    var Rt = function () {
        Rt.superClass.constructor.call(this);
        this._dj = 0;
        this._dh = 0;
        this._dq = 0;
        this._dp = 0;
        this._dt = 0;
        this._de = 0;
        this._d3 = 0;
        this._dr = 0;
        this._ed = 0;
        this._dw = .65;
        this._ea = 1;
        this._dl = 80;
        this._dx = 3;
        this._d8 = true;
        this._eb = 3e5;
        this._ee = 2;
        this._di = 2;
        this._df = 1e3
    };
    _twaver.ext(Rt, ht, {i4: function (i) {
        return true
    }, i3: function (i) {
        if (i == null)return;
        this._d5 = i;
        if (!this.s(i))return;
        var t = new At;
        var a = 0;
        var r = Math.floor(this._dx * this._dz.length * this._dz.length + 20 * this._dz.length);
        r = Math.max(r, 1e4);
        var n = this._ea * this._ea * this._dz.length;
        var s = this._df;
        try {
            for (; this._dj > n && a < r; a++) {
                var h = this.b(a & 2147483647);
                if (s-- === 0) {
                    if (this._dy.b() > this._eb)a = r;
                    s = this._df
                }
                this.h(h, t);
                this.d(h, t);
                this.i(h, t);
                if (this._d8) {
                    this.g(h, t);
                    this.j(h, t)
                } else {
                    this.f(h, t);
                    this.c(h, t)
                }
                var e = Math.sqrt(t._a * t._a + t._c * t._c + t._b * t._b);
                this.ac(h, t, e);
                this.aa(h, t, e)
            }
        } catch (_) {
        } finally {
            this.r()
        }
    }, s: function (i) {
        if (i == null || i.xa() < 1)return false;
        this._d5 = i;
        this._dp = 1;
        this._dy = new pt;
        this._dt = i.x0();
        this._d2 = Jt.d(this._dt);
        this._df = 1 + 1e5 / this._dt;
        this._ed = 1 / (2 * this._di);
        this._de = this._ed * this._ee / (this._dl * .05);
        this._d3 = Math.pow(this._dl, -1) * this._ed;
        this._dr = Math.pow(this._dl, 3) * this._ed;
        this._dj = 0;
        this._du = new At;
        this._dq = Math.max(20 * this._dl, 10);
        var t = Math.max(.1, Math.min(this._dw * this._dl, this._dq));
        var a = this._dt;
        Et.c(i);
        this._dz = Jt.d(a);
        for (var r = i.x9(); r.i1(); r.i2()) {
            var n = r.i9();
            var s = new Bt(n, t, this._dl, this._dt, i);
            this._dz[--a] = s;
            this._dj += s._r;
            this._dh += s._r * s._r;
            this._du._a += s._k;
            this._du._c += s._h;
            this._du._b += s._g;
            this._d2[n.al()] = s
        }
        this._d8 = false;
        return this._dz.length > 0
    }, b: function (i) {
        var t = this._dz.length;
        var a = t - i % t - 1;
        var r = kt.k(a + 1);
        var n = this._dz[r];
        this._dz[r] = this._dz[a];
        this._dz[a] = n;
        return n
    }, f: function (i, t) {
        var a;
        var r;
        var n = a = r = 0;
        for (var s = i._b.ae(); s != null; s = s.a7()) {
            var h = this._d2[s.a2().al()];
            var e = h._k - i._k;
            var _ = h._h - i._h;
            var f = h._g - i._g;
            var u = e * e + _ * _ + f * f;
            var o;
            var v = Math.sqrt(u);
            var l = v - (h._e + i._e);
            if (l <= 0)continue;
            o = l * l * this._d3 / v;
            n += e * o;
            a += _ * o;
            r += f * o
        }
        for (var c = i._b.ag(); c != null; c = c.a8()) {
            var d = this._d2[c.a3().al()];
            var x = d._k - i._k;
            var g = d._h - i._h;
            var b = d._g - i._g;
            var w = x * x + g * g + b * b;
            var m;
            var y = Math.sqrt(w);
            var p = y - (d._e + i._e);
            if (p <= 0)continue;
            m = p * p * this._d3 / y;
            n += x * m;
            a += g * m;
            r += b * m
        }
        t._a += n;
        t._c += a;
        t._b += r
    }, g: function (i, t) {
        var a;
        var r;
        var n = a = r = 0;
        this._dp++;
        i._f = this._dp;
        for (var s = i._b.ae(); s != null; s = s.a7()) {
            var h = this._d2[s.a2().al()];
            h._f = this._dp;
            var e = h._k - i._k;
            var _ = h._h - i._h;
            var f = h._g - i._g;
            var u = e * e + _ * _ + f * f;
            var o = Math.sqrt(u);
            if (o !== 0) {
                var v = Math.max(1e-6, o - (i._e + h._e));
                var l = -this._ef[s.a5()] / (v * v);
                l += v * v * this._d1[s.a5()];
                l /= o;
                n += e * l;
                a += _ * l;
                r += f * l
            }
        }
        for (var c = i._b.ag(); c != null; c = c.a8()) {
            var d = this._d2[c.a3().al()];
            d._f = this._dp;
            var x = d._k - i._k;
            var g = d._h - i._h;
            var b = d._g - i._g;
            var w = x * x + g * g + b * b;
            var m = Math.sqrt(w);
            if (m !== 0) {
                var y = Math.max(1e-6, m - (i._e + d._e));
                var p = -this._ef[c.a5()] / (y * y);
                p += y * y * this._d1[c.a5()];
                p /= m;
                n += x * p;
                a += g * p;
                r += b * p
            }
        }
        t._a += n;
        t._c += a;
        t._b += r
    }, j: function (i, t) {
        var a;
        var r;
        var n = a = r = 0;
        for (var s = this._dt - 1; s >= 0; s--) {
            var h = this._d2[s];
            if (h._f !== i._f) {
                var e = i._k - h._k;
                var _ = i._h - h._h;
                var f = i._g - h._g;
                var u = e * e + _ * _ + f * f;
                if (u !== 0) {
                    var o = Math.sqrt(u);
                    var v = Math.max(1e-6, o - (i._e + h._e));
                    var l = this._dr / (v * v * o);
                    n += e * l;
                    a += _ * l;
                    r += f * l
                }
            }
        }
        t._a += n;
        t._c += a;
        t._b += r
    }, c: function (i, t) {
        var a;
        var r;
        var n = a = r = 0;
        for (var s = this._dt - 1; s >= 0; s--) {
            var h = this._d2[s];
            var e = i._k - h._k;
            var _ = i._h - h._h;
            var f = i._g - h._g;
            var u = e * e + _ * _ + f * f;
            if (u !== 0) {
                var o = Math.sqrt(u);
                var v;
                var l = o - (i._e + h._e);
                if (l <= 0)v = this._dr / (1e-8 * o); else v = this._dr / (l * l * o);
                n += e * v;
                a += _ * v;
                r += f * v
            }
        }
        t._a += n;
        t._c += a;
        t._b += r
    }, i: function (i, t) {
        var a = this._du._b / this._dt - i._g;
        t._b += a * this._dl * this._dt / this._dh
    }, d: function (i, t) {
        if (this._de !== 0) {
            var a = this._du._a / this._dt - i._k;
            var r = this._du._c / this._dt - i._h;
            var n = this._du._b / this._dt - i._g;
            t._a += a * this._de;
            t._c += r * this._de;
            t._b += n * this._de
        }
    }, h: function (i, t) {
        var a = .05 * (i._r + 2);
        if (a > 0) {
            t._a = kt.l(-a, a);
            t._c = kt.l(-a, a);
            t._b = kt.l(-a, a)
        }
    }, ac: function (i, t, a) {
        if (a !== 0 && i._a !== 0) {
            var r = t._a * i._o + t._c * i._l + t._b * i._i;
            var n = r / (a * i._a);
            this._dh -= i._r * i._r;
            this._dj -= i._r;
            if (i._p * n > 0)i._r += n * .45; else i._r += n * .15;
            if (i._r > this._dq)i._r = this._dq; else if (i._r < .1)i._r = .1;
            this._dj += i._r;
            this._dh += i._r * i._r;
            i._p = n
        }
    }, aa: function (i, t, a) {
        if (a > 0) {
            var r = i._r / a;
            var n = t._a * r;
            var s = t._c * r;
            var h = t._b * r;
            i._k += n;
            i._h += s;
            i._g += h;
            this._du._a += n;
            this._du._c += s;
            this._du._b += h;
            i._a = a;
            i._o = t._a;
            i._l = t._c;
            i._i = t._b
        }
    }, r: function () {
        for (var i = this._d2.length - 1; i >= 0; i--) {
            var t = this._d2[i];
            this._d5.s2(t._b, t._k, t._h)
        }
    }});
    var Pt = function (i, t, a, r) {
        this._e = i;
        this._f = t;
        this._a = a;
        this._b = r;
        this._c = {}
    };
    _twaver.ext(Pt, Object, {resetGroup: function () {
        if (!this._a || this._b != null) {
            return
        }
        for (var i in this._c) {
            var t = this._c[i];
            if (this._e.isExpandGroup()) {
                t.group.setExpanded(true)
            } else {
                t.group.setExpanded(t.b)
            }
        }
    }, process: function () {
        var i = new s;
        for (var t = 0, a = this._f.size(); t < a; t++) {
            var r = this._f.get(t);
            if (r instanceof twaver.Link) {
                if (!r.isLooped()) {
                    i.add(r)
                }
            } else {
                if (this._b == null) {
                    if (r.getParent()instanceof e) {
                        continue
                    }
                }
                if (this._b == null || this._b != null && this._b !== r) {
                    i.add(r)
                }
                if (this._b == null) {
                    if (r instanceof e) {
                        this.layoutGroup(r)
                    }
                }
            }
        }
        return i
    }, layoutGroup: function (i) {
        if (!this._a || this._c[i.getId()] != null || this._b != null) {
            return
        }
        this._c[i.getId()] = {group: i, b: i.isExpanded()};
        var t = this._e.getGroupLayoutType(i);
        if (!t) {
            return
        }
        i.setExpanded(true);
        var a = new s;
        var r = i.getChildren();
        var n;
        for (var _ = 0, f = r.size(); _ < f; _++) {
            n = r.get(_);
            if (n instanceof e) {
                this.layoutGroup(n);
                n.setExpanded(false)
            }
            if (!(n instanceof twaver.Link) && !a.contains(n)) {
                a.add(n)
            }
            if (n instanceof h) {
                var u = n.getLinks();
                if (u != null) {
                    for (var o = 0, v = u.size(); o < v; o++) {
                        var l = u.get(o);
                        if (!a.contains(l)) {
                            a.add(l)
                        }
                    }
                }
            }
        }
        var c = new Nt(this._e, a, t, this._a, this._b);
        try {
            var d = null;
            if ("round" === t) {
                d = new yt
            } else if ("symmetry" === t) {
                d = new Rt
            } else if ("hierarchic" === t) {
                d = new Yt
            } else if (t === "topbottom" || t === "bottomtop" || t === "rightleft" || t === "leftright") {
                d = new et
            }
            if (d != null) {
                d.i2(c);
                var x = Pt.createMatrix(t);
                var g = {};
                var b = {};
                for (var w in c._a) {
                    var m = c._a[w];
                    var y = m.node;
                    var p = c.g4(m);
                    g[w] = y.getCenterLocation();
                    if (x != null) {
                        var k = x.transform(p);
                        y.setCenterLocation(k.x, k.y)
                    } else {
                        y.setCenterLocation(p.x, p.y)
                    }
                    b[w] = y.getCenterLocation()
                }
            }
        } catch (j) {
        }
        r = i.getChildren();
        for (_ = 0, f = r.size(); _ < f; _++) {
            n = r.get(_);
            if (n instanceof e) {
                n.setExpanded(true)
            }
        }
    }});
    Pt.createMatrix = function (i) {
        if (i === "rightleft") {
            return r.createMatrix(Math.PI / 2, 0, 0)
        }
        if (i === "leftright") {
            return r.createMatrix(-Math.PI / 2, 0, 0)
        }
        if (i === "bottomtop") {
            return r.createMatrix(Math.PI, 0, 0)
        }
        return null
    };
    var It = function () {
    };
    _twaver.ext(It, Object, {i1: function (i, t, a) {
        var r = this.a1(i, t);
        this.a2(i, t, a);
        return r
    }, a1: function (i, t) {
        var a = It.i4(i);
        a.ax();
        var r = 0;
        for (var n = a.x1(); n.i1(); n.i2())t.i7(n.i9(), -1);
        for (var s = a.x1(); s.i1(); s.i2()) {
            var h = s.i9();
            var e = -1;
            for (var _ = h.aq(); _.i1(); _.i2())e = Math.max(e, t.i2(_.i9()));
            t.i7(h, e + 1);
            r = Math.max(r, e + 1)
        }
        return r + 1
    }, a2: function (i, t, a) {
        a.az(It.i3(i, t))
    }});
    It.i3 = function (i, t) {
        var a = new R;
        for (var r = i.xf(); r.i1(); r.i2()) {
            var n = r.i8();
            if (t.i2(n.a2()) > t.i2(n.a3())) {
                i.x3(n);
                a.ac(n)
            }
        }
        return a
    };
    It.i4 = function (i) {
        var t = Jt.a(i.xa());
        (new z).a1(i, t);
        return It.i2(i, t)
    };
    It.i2 = function (i, t) {
        var a = Jt.d(i.x0());
        for (var r = i.x9(); r.i1(); r.i2()) {
            var n = r.i9();
            var s = n.al();
            a[t[s]] = n
        }
        return new $(a)
    };
    var Dt = function () {
        Dt.superClass.constructor.call(this);
        this.c0()
    };
    _twaver.ext(Dt, R, {c0: function () {
        this._bc = 1;
        this._bd = 0
    }});
    var Vt = function () {
        this._m1 = 20;
        this._m2 = 60;
        this._m3 = 5;
        this._m4 = 0
    };
    _twaver.ext(Vt, Object, {i4: function (i) {
        this._m3 = i
    }, i5: function (i) {
        this._m4 = i
    }, i3: function (i) {
        this._m1 = i
    }, i6: function (i) {
        this._m2 = i
    }, i2: function (i) {
        this._m5 = i
    }, t1: function () {
        return this._m2
    }, a1: function (i, t) {
        var a = Jt.d(t.length);
        for (var r = 0; r < t.length; r++)a[r] = t[r].x1();
        this.a2(i, a)
    }, a2: function (i, t) {
        var a = Jt.a(t.length);
        var r = 0;
        for (var n = 0; n < t.length; n++) {
            var s = 0;
            var h = t[n];
            h.i4();
            for (; h.i1(); h.i2())s = Math.max(s, i.g9(h.i9()));
            a[n] = s;
            h.i4();
            for (; h.i1(); h.i2()) {
                var e = (a[n] - i.g9(h.i9())) / 2;
                i.s4(h.i9(), new _(i.gi(h.i9()), r + e))
            }
            var f = this.t1();
            r += a[n] + f;
            h.i4()
        }
    }, i1: function (i, t, a) {
        this._m6 = i;
        this.t2(t, a)
    }});
    var St = function (i, t) {
        St.superClass.constructor.call(this)
    };
    _twaver.ext(St, Vt, {t2: function (i, t) {
        var a = this._m6;
        this._a = a.xc("D");
        this._h = a.xc("C");
        this.a1(a, i);
        this.tg(a, i);
        this.tf(i, rt.a5(this._e), this._m5, this._l);
        this.tb(a, this._f[0]);
        this.ta(i);
        this.th(a, this._f[0], i);
        this.b(i);
        this.tb(a, this._f[1]);
        this.ta(i);
        this.th(a, this._f[1], i);
        this.b(i);
        this.a11(this._f[1]);
        this.a12(i);
        this.tb(a, this._f[2]);
        this.ta(i);
        this.th(a, this._f[2], i);
        this.b(i);
        this.tb(a, this._f[3]);
        this.ta(i);
        this.th(a, this._f[3], i);
        this.b(i);
        this.a11(this._f[3]);
        this.a12(i);
        this.tc(a);
        this.tj()
    }, a11: function (i) {
        for (var t = 0; t < i.length; t++)i[t] = -i[t]
    }, b: function (i) {
        for (var t = 0; t < i.length; t++) {
            var a = i[t];
            a.ax()
        }
        for (var r = 0; r < i.length; r++) {
            var n = 0;
            var s = null;
            for (var h = i[r].x1(); h.i1(); h.i2()) {
                var e = h.i9();
                var f = e.al();
                this._l[f] = n++;
                this._b[f] = s;
                this._k[f] = null;
                if (s != null)this._k[s.al()] = e;
                s = e
            }
        }
        var u = this._a;
        this._a = this._h;
        this._h = u;
        for (var o = this._m6.xf(); o.i1(); o.i2()) {
            var v = o.i8();
            var l = this._m6.gn(v);
            this._m6.gt(v, new _(-l.x, l.y));
            var c = this._m6.gk(v);
            this._m6.gz(v, new _(-c.x, c.y))
        }
        var d = this._l;
        var x = function (i, t) {
            if (i == null && t != null) {
                return 1
            }
            if (i != null && t == null) {
                return-1
            }
            if (i == null && t == null) {
                return 0
            }
            return d[i.a2().al()] - d[t.a2().al()]
        };
        var g = function (i, t) {
            if (i == null && t != null) {
                return 1
            }
            if (i != null && t == null) {
                return-1
            }
            if (i == null && t == null) {
                return 0
            }
            return d[i.a3().al()];
            -d[t.a3().al()]
        };
        this._m6.x2(x, g)
    }, a12: function (i) {
        for (var t = this._m6.xf(); t.i1(); t.i2()) {
            var a = t.i8();
            this._m6.x3(a);
            var r = this._m6.gn(a);
            var n = this._m6.gk(a);
            this._m6.gz(a, r);
            this._m6.gt(a, n)
        }
        var s = new A;
        for (var h = 0; h < i.length; h++)s.ae(i[h]);
        for (var e = 0; e < i.length; e++)i[e] = s.au();
        var _ = this._l;
        var f = function (i, t) {
            if (i == null && t != null) {
                return 1
            }
            if (i != null && t == null) {
                return-1
            }
            if (i == null && t == null) {
                return 0
            }
            return _[i.a2().al()] - _[t.a2().al()]
        };
        var u = function (i, t) {
            if (i == null && t != null) {
                return 1
            }
            if (i != null && t == null) {
                return-1
            }
            if (i == null && t == null) {
                return 0
            }
            return _[i.a3().al()];
            -_[t.a3().al()]
        };
        this._m6.x2(f, u)
    }, tg: function (i, t) {
        var a = i.x0();
        var r = i.xg();
        this._l = Jt.a(a);
        this._b = Jt.d(a);
        this._k = Jt.d(a);
        this._m = Jt.d(a);
        this._i = Jt.d(a);
        this._o = Jt.d(a);
        this._f = Jt.e(4, a);
        this._c = Jt.a(a);
        this._g = Jt.a(a);
        this._j = Jt.a(a);
        this._d = Jt.b(a);
        this._e = Jt.b(r);
        for (var n = 0; n < t.length; n++) {
            var s = 0;
            var h = null;
            for (var e = t[n].x1(); e.i1(); e.i2()) {
                var _ = e.i9();
                var f = _.al();
                this._l[f] = s++;
                this._b[f] = h;
                this._k[f] = null;
                if (h != null)this._k[h.al()] = _;
                h = _
            }
        }
        var u = this._l;
        var o = function (i, t) {
            if (i == null && t != null) {
                return 1
            }
            if (i != null && t == null) {
                return-1
            }
            if (i == null && t == null) {
                return 0
            }
            return u[i.a2().al()] - u[t.a2().al()]
        };
        var v = function (i, t) {
            if (i == null && t != null) {
                return 1
            }
            if (i != null && t == null) {
                return-1
            }
            if (i == null && t == null) {
                return 0
            }
            return u[i.a3().al()];
            -u[t.a3().al()]
        };
        i.x2(o, v)
    }, tb: function (i, t) {
        for (var a = i.x9(); a.i1(); a.i2()) {
            var r = a.i9();
            var n = r.al();
            this._m[n] = r;
            this._i[n] = r;
            t[n] = Number.MAX_VALUE;
            this._o[n] = r;
            this._c[n] = Number.MAX_VALUE;
            this._d[n] = false;
            this._j[n] = this._g[n] = 0
        }
    }, ta: function (i) {
        for (var t = 1; t < i.length; t++) {
            var a = -1;
            for (var r = i[t]._b; r != null; r = r.a()) {
                var n = r.d();
                var s = n.al();
                var h = n.ak();
                if (h !== 0) {
                    var e = Math.floor((h + 1) / 2);
                    var _ = Math.ceil((h + 1) / 2);
                    var f = 1;
                    var u;
                    for (u = n.ae(); f < e; u = u.a7())f++;
                    for (var o = false; f <= _ && !o; f++) {
                        var v = this._m6.g2(u);
                        var l = u.a2();
                        var c = l.al();
                        if (this._i[s] === n && !this._e[u.a5()] && a < this._l[c]) {
                            a = this._l[c];
                            this._i[c] = n;
                            this._m[s] = this._m[c];
                            this._i[s] = this._m[s];
                            o = true;
                            this._j[c] = v.i6().x;
                            this._g[s] = v.i7().x
                        }
                        u = u.a7()
                    }
                }
            }
        }
    }, th: function (i, t, a) {
        for (var r = i.x9(); r.i1(); r.i2()) {
            var n = r.i9();
            var s = n.al();
            if (this._m[s] === n)this.td(i, n, t)
        }
        for (var h = 0; h < a.length; h++) {
            var e = a[h].x1();
            if (e.i1()) {
                var _ = a[h].x1().i9();
                var f = _.al();
                if (this._o[this._m[f].al()] === _)this.tk(i, _, t)
            }
        }
        for (var u = i.x9(); u.i1(); u.i2()) {
            var o = u.i9();
            var v = o.al();
            var l = this._c[this._o[this._m[v].al()].al()];
            if (l < Number.MAX_VALUE)t[v] += l
        }
    }, td: function (i, t, a) {
        var r = t.al();
        if (a[r] === Number.MAX_VALUE) {
            a[r] = 0;
            var n = t;
            var s = 0;
            do {
                var h = n.al();
                if (h !== r)s -= this._g[h];
                if (this._l[h] > 0) {
                    var e = this._b[h];
                    var _ = this._m[this._b[h].al()];
                    var f = _.al();
                    this.td(i, _, a);
                    if (this._o[r] === t)this._o[r] = this._o[f];
                    if (this._o[r] === this._o[f])a[r] = Math.max(a[r], a[e.al()] + this.ti(i, e, n) - s)
                }
                s += this._j[h];
                n = this._i[h]
            } while (n !== t);
            s = 0;
            n = t;
            do {
                var u = n.al();
                if (u !== r)s -= this._g[u];
                a[u] = a[r] + s;
                s += this._j[u];
                n = this._i[u]
            } while (n !== t)
        }
    }, tk: function (i, t, a) {
        var r = t.al();
        if (this._d[r])return;
        this._d[r] = true;
        var n = t;
        do {
            var s = n.al();
            var h = this._k[s];
            if (h != null) {
                var e = h.al();
                var _ = this._o[this._m[e].al()];
                if (_ !== this._o[r]) {
                    var f = a[e] - a[r] - this.ti(i, n, h);
                    if (this._c[_.al()] !== Number.MAX_VALUE)f += this._c[_.al()];
                    this._c[this._o[r].al()] = Math.min(this._c[this._o[r].al()], f)
                } else {
                    this.tk(i, this._m[e], a)
                }
            }
            n = this._i[s]
        } while (n !== t)
    }, tc: function (i) {
        var t = Jt.a(4);
        var a = Jt.a(4);
        for (var r = i.x9(); r.i1(); r.i2()) {
            var n = r.i9();
            var s = n.al();
            a[0] += this._f[0][s];
            a[1] += this._f[1][s];
            a[2] += this._f[2][s];
            a[3] += this._f[3][s]
        }
        a[0] /= i.xa();
        a[1] /= i.xa();
        a[2] /= i.xa();
        a[3] /= i.xa();
        for (var h = i.x9(); h.i1(); h.i2()) {
            var e = h.i9();
            var f = e.al();
            var u = i.g4(e);
            t[0] = this._f[0][f] - a[0];
            t[1] = this._f[1][f] - a[1];
            t[2] = this._f[2][f] - a[2];
            t[3] = this._f[3][f] - a[3];
            t.sort(Jt.n);
            var o = (t[1] + t[2]) / 2;
            i.s1(e, new _(o, u.y))
        }
    }, ti: function (i, t, a) {
        var r = i.gj(t);
        var n = i.gj(a);
        var s;
        if (r > 1 && n > 1)s = this._m1 + (r + n) / 2; else s = this._m3 + (r + n) / 2;
        if (this._l[t.al()] < this._l[a.al()]) {
            if (this._a != null)s += this._a.i3(a);
            if (this._h != null)s += this._h.i3(t)
        } else {
            if (this._a != null)s += this._a.i3(t);
            if (this._h != null)s += this._h.i3(a)
        }
        return s
    }, tj: function () {
        this._l = null;
        this._b = null;
        this._k = null;
        this._e = null;
        this._m = null;
        this._i = null;
        this._f = null;
        this._c = null;
        this._o = null;
        this._d = null;
        this._j = null;
        this._g = null
    }, tf: function (i, t, a, r) {
        var n = i.length;
        for (var s = 2; s < n - 1; s++) {
            var h = -1;
            var e = 0;
            var _ = 0;
            var f = i[s].x1();
            for (var u = i[s].x1(); u.i1(); u.i2()) {
                var o = u.i9();
                var v = null;
                var l = false;
                if (o.ak() === 1) {
                    v = o.ae().a2();
                    if (a.i1(v) != null && a.i1(o) != null)l = true
                }
                if (_ === i[s].ay() - 1 || l) {
                    var c = l ? r[v.al()] : i[s - 1].ay();
                    for (; e <= _; e++) {
                        var d = f.i9();
                        for (var x = d.am(); x.i1(); x.i2()) {
                            var g = x.i8();
                            var b = r[g.a2().al()];
                            if (b < h || b > c)t.i7(x.i8(), true)
                        }
                        f.i2()
                    }
                    h = c
                }
                _++
            }
        }
    }});
    var Ft = function (i, t) {
        this._b = 20;
        this._a = t;
        this._d = i;
        this._f = {}
    };
    _twaver.ext(Ft, Object, {a3: function (i) {
        this._b = i
    }, a4: function (i, t, a, r, n) {
        if (this.a2(i)) {
            var s = this.b2(i);
            s._o = t;
            s._m = n;
            s._n = r;
            s._f = a
        }
    }, b2: function (i) {
        var t = this._f[i._id];
        if (t == null) {
            t = new Xt;
            this._f[i._id] = t
        }
        return t
    }, a2: function (i) {
        return this._f[i._id] != null
    }, c: function () {
        var i = rt.a1(Jt.a(this._d.xa()));
        var t = rt.a1(Jt.a(this._d.xa()));
        for (var a = this._d.x9(); a.i1(); a.i2()) {
            var r = a.i9();
            if (this.a2(r)) {
                var n = this.b2(r);
                i.i6(r, this._b * (n.c() - 1));
                t.i6(r, this._b * (n.b() - 1))
            }
        }
        this._d.x1("D", i);
        this._d.x1("C", t)
    }, g: function () {
        this._d.x6("D");
        this._d.x6("C")
    }, f: function () {
        for (var i = this._d.x9(); i.i1(); i.i2()) {
            var t = i.i9();
            if (this.a2(t)) {
                var a = this._d.gi(t);
                var r = this._d.gh(t);
                var n = this._d.gj(t);
                var s = this._d.g9(t);
                var h = this.b2(t);
                var e = h._q.ay() + h._b.ay() + h._f;
                var f = h._d.ay() + h._g.ay() + h._o;
                var u = h._i.ay() + h._l.ay() + h._n;
                var o = h._h.ay() + h._k.ay() + h._m;
                var v = this._a.a7(n, e);
                var l = this._a.a7(n, f);
                var c = this._a.a7(s, o);
                var d = this._a.a7(s, u);
                h.a2(this._a.a8(n, e, v), this._a.a8(n, f, l), this._a.a8(s, o, c), this._a.a8(s, u, d));
                for (var x = h._j.c1(); x.i1(); x.i2()) {
                    var g = x.i8();
                    var b = this.a1(g);
                    var w = this.b1(g);
                    var m = new A;
                    if (b.b() === w.b()) {
                        if (b.c()) {
                            m.aa(new _(a + h._g._bd * l + h._c, r));
                            m.aa(new _(a + h._g._bd * l + h._c, r - this._b));
                            h._g._bd++;
                            m.aa(new _(a + h._g._bd * l + h._c, r - this._b));
                            m.aa(new _(a + h._g._bd * l + h._c, r));
                            h._g._bd++;
                            h._g._bc = Math.max(h._g._bc, 2)
                        } else if (b.d()) {
                            m.aa(new _(a + h._b._bd * v + h._p, r + s));
                            m.aa(new _(a + h._b._bd * v + h._p, r + s + this._b));
                            h._b._bd++;
                            m.aa(new _(a + h._b._bd * v + h._p, r + s + this._b));
                            m.aa(new _(a + h._b._bd * v + h._p, r + s));
                            h._b._bd++;
                            h._b._bc = Math.max(h._b._bc, 2)
                        } else if (b.f()) {
                            m.aa(new _(a, r + h._i._bd * d + h._a));
                            m.aa(new _(a - this._b, r + h._i._bd * d + h._a));
                            h._i._bd++;
                            m.aa(new _(a - this._b, r + h._i._bd * d + h._a));
                            m.aa(new _(a, r + h._i._bd * d + h._a));
                            h._i._bd++;
                            h._i._bc = Math.max(h._i._bc, 2)
                        } else if (b.e()) {
                            m.aa(new _(a + n, r + h._h._bd * c + h._e));
                            m.aa(new _(a + n + this._b, r + h._h._bd * c + h._e));
                            h._h._bd++;
                            m.aa(new _(a + n + this._b, r + h._h._bd * c + h._e));
                            m.aa(new _(a + n, r + h._h._bd * c + h._e));
                            h._h._bd++;
                            h._h._bc = Math.max(h._h._bc, 2)
                        }
                        this._d.m1(g, m)
                    } else if (b.c() || w.c()) {
                        if (b.e() || w.e()) {
                            m.aa(new _(a + n - h._d._bd * l - h._c, r));
                            m.aa(new _(a + n - h._d._bd * l - h._c, r - this._b * h._d._bc));
                            m.aa(new _(a + n + this._b * h._h._bc, r - this._b * h._d._bc));
                            m.aa(new _(a + n + this._b * h._h._bc, r + h._h._bd * c + h._e));
                            m.aa(new _(a + n, r + h._h._bd * c + h._e));
                            h._d._bd++;
                            h._d._bc++;
                            h._h._bd++;
                            h._h._bc++;
                            if (w.c())m.ax();
                            this._d.m1(g, m)
                        } else if (b.f() || w.f()) {
                            m.aa(new _(a + h._g._bd * l + h._c, r));
                            m.aa(new _(a + h._g._bd * l + h._c, r - this._b * h._g._bc));
                            m.aa(new _(a - this._b * h._i._bc, r - this._b * h._g._bc));
                            m.aa(new _(a - this._b * h._i._bc, r + h._i._bd * d + h._a));
                            m.aa(new _(a, r + h._i._bd * d + h._a));
                            h._g._bd++;
                            h._g._bc++;
                            h._i._bd++;
                            h._i._bc++;
                            if (w.c())m.ax();
                            this._d.m1(g, m)
                        } else if (b.d() || w.d()) {
                            m.aa(new _(a + n - h._d._bd * l - h._c, r));
                            m.aa(new _(a + n - h._d._bd * l - h._c, r - this._b * h._d._bc));
                            m.aa(new _(a + n + this._b * h.b(), r - this._b * h._d._bc));
                            m.aa(new _(a + n + this._b * h.b(), r + s + this._b * h._q._bc));
                            m.aa(new _(a + n - h._q._bd * v - h._p, r + s + this._b * h._q._bc));
                            m.aa(new _(a + n - h._q._bd * v - h._p, r + s));
                            h._d._bd++;
                            h._d._bc++;
                            h._k._bc++;
                            h._h._bc++;
                            h._q._bc++;
                            h._q._bd++;
                            if (w.c())m.ax();
                            this._d.m1(g, m)
                        }
                    } else if (b.d() || w.d()) {
                        if (b.e() || w.e()) {
                            m.aa(new _(a + n - h._q._bd * v - h._p, r + s));
                            m.aa(new _(a + n - h._q._bd * v - h._p, r + s + this._b * h._q._bc));
                            m.aa(new _(a + n + this._b * h._k._bc, r + s + this._b * h._q._bc));
                            m.aa(new _(a + n + this._b * h._k._bc, r + s - h._k._bd * c - h._e));
                            m.aa(new _(a + n, r + s - h._k._bd * c - h._e));
                            h._q._bd++;
                            h._q._bc++;
                            h._k._bd++;
                            h._k._bc++;
                            if (w.d())m.ax();
                            this._d.m1(g, m)
                        } else if (b.f() || w.f()) {
                            m.aa(new _(a + h._b._bd * v + h._p, r + s));
                            m.aa(new _(a + h._b._bd * v + h._p, r + s + this._b * h._b._bc));
                            m.aa(new _(a - this._b * h._l._bc, r + s + this._b * h._b._bc));
                            m.aa(new _(a - this._b * h._l._bc, r + s - h._l._bd * d - h._a));
                            m.aa(new _(a, r + s - h._l._bd * d - h._a));
                            h._b._bd++;
                            h._b._bc++;
                            h._l._bd++;
                            h._l._bc++;
                            if (w.d())m.ax();
                            this._d.m1(g, m)
                        }
                    } else {
                        m.aa(new _(a, r + s - h._l._bd * d - h._a));
                        m.aa(new _(a - this._b * h._l._bc, r + s - h._l._bd * d - h._a));
                        m.aa(new _(a - this._b * h._l._bc, r + s + this._b * h.a1()));
                        m.aa(new _(a + n + this._b * h._k._bc, r + s + this._b * h.a1()));
                        m.aa(new _(a + n + this._b * h._k._bc, r + s - h._k._bd * c - h._e));
                        m.aa(new _(a + n, r + s - h._k._bd * c - h._e));
                        h._l._bd++;
                        h._l._bc++;
                        h._b._bc++;
                        h._q._bc++;
                        h._k._bc++;
                        h._k._bd++;
                        if (w.f())m.ax();
                        this._d.m1(g, m)
                    }
                }
            }
        }
    }, a5: function (i, t) {
        for (var a = 0; a < i.length; a++) {
            var r = i[a];
            var n = t[a];
            for (var s = r.x1(); s.i1(); s.i2()) {
                var h = s.i9();
                if (this.a2(h)) {
                    var e = this.b2(h);
                    n._g = Math.max(n._g, this._b * (e.d() - 1));
                    n._j = Math.max(n._j, this._b * (e.a1() - 1))
                }
            }
        }
    }, a1: function (i) {
        var t = this._d.xc("A");
        var a = null;
        if (t != null)a = t.i1(i);
        if (a == null || a.g()) {
            var r = this._d.xc("B");
            if (r == null)return qt.j(1);
            var n = r.i1(i);
            if (n == null || n.g())return qt.j(1);
            if (n.c())return qt.j(8);
            if (n.f())return qt.j(1);
            if (n.d())return qt.j(4);
            if (n.e())return qt.j(2)
        }
        return a
    }, b1: function (i) {
        var t = this._d.xc("B");
        var a = null;
        if (t != null)a = t.i1(i);
        if (a == null || a.g()) {
            var r = this._d.xc("A");
            if (r == null)return qt.j(8);
            var n = r.i1(i);
            if (n == null || n.g())return qt.j(8);
            if (n.c())return qt.j(8);
            if (n.f())return qt.j(1);
            if (n.d())return qt.j(4);
            if (n.e())return qt.j(2)
        }
        return a
    }});
    var Xt = function () {
        this._o = 0;
        this._f = 0;
        this._n = 0;
        this._m = 0;
        this._c = 0;
        this._p = 0;
        this._e = 0;
        this._a = 0;
        this._j = new R;
        this._g = new Dt;
        this._d = new Dt;
        this._b = new Dt;
        this._q = new Dt;
        this._h = new Dt;
        this._k = new Dt;
        this._i = new Dt;
        this._l = new Dt
    };
    _twaver.ext(Xt, Object, {a1: function () {
        return Math.max(this._q._bc, this._b._bc)
    }, d: function () {
        return Math.max(this._d._bc, this._g._bc)
    }, b: function () {
        return Math.max(this._k._bc, this._h._bc)
    }, c: function () {
        return Math.max(this._l._bc, this._i._bc)
    }, a2: function (i, t, a, r) {
        this._c = t;
        this._a = r;
        this._p = i;
        this._e = a;
        this._g.c0();
        this._d.c0();
        this._b.c0();
        this._q.c0();
        this._k.c0();
        this._h.c0();
        this._l.c0();
        this._i.c0()
    }});
    var Ut = function (i, t, a, r) {
        this._k = 20;
        this._r = .5;
        this._d = i;
        this._c = t;
        this._j = a;
        this._m = r;
        this._i = i.xc("A") != null || i.xc("B") != null;
        this._t = new Tt(i, t, a, r);
        this._b = new Ft(i, this)
    };
    _twaver.ext(Ut, Object, {a6: function (i) {
        this._k = i;
        this._t.a1(i);
        this._b.a3(i)
    }, g1: function () {
        return this._k
    }, a9: function (i) {
        this.c1();
        return i
    }, a5: function (i) {
        this.a1();
        return i
    }, b3: function (i) {
        this.c1();
        i = this.c4(i);
        this._b.c();
        return i
    }, g2: function (i) {
        this._b.g();
        return i
    }, e2: function (i) {
        i = this.f(i);
        this._b.f()
    }, e1: function () {
        this._t.d();
        if (this._n != null)this._d.xi(this._n);
        this.a1();
        this._d = null
    }, a1: function () {
        if (!this._i)return;
        if (this._q != null) {
            this._d.x1("A", this._q);
            this._q = null
        }
        if (this._p != null) {
            this._d.x1("B", this._p);
            this._p = null
        }
        if (this._h != null) {
            this._d.xj(this._h);
            this._h = null
        }
        if (this._l != null) {
            this._d.xj(this._l);
            this._l = null
        }
    }, c1: function () {
        if (!this._i)return;
        if (this._h == null)this._h = this._d.xl();
        if (this._l == null)this._l = this._d.xl();
        for (var i = this._d.xf(); i.i1(); i.i2()) {
            var t = i.i8();
            var a = this._j.i1(t.a2()) != null;
            var r = this._j.i1(t.a3()) != null;
            if (a && !r) {
                var n = this._j.i1(t.a2());
                if (this._m.i4(n))this._l.i8(t, qt.h(this._d, n)); else this._l.i8(t, qt.i(this._d, n))
            } else if (!a && r) {
                var s = this._j.i1(t.a3());
                if (this._m.i4(s))this._h.i8(t, qt.i(this._d, s)); else this._h.i8(t, qt.h(this._d, s))
            } else if (!a && !r)if (this._m.i4(t)) {
                this._h.i8(t, qt.i(this._d, t));
                this._l.i8(t, qt.h(this._d, t))
            } else {
                this._h.i8(t, qt.h(this._d, t));
                this._l.i8(t, qt.i(this._d, t))
            }
        }
        this._q = this._d.xc("A");
        this._p = this._d.xc("B");
        this._d.x1("A", this._h);
        this._d.x1("B", this._l)
    }, c4: function (i) {
        this._n = this._d.xk();
        this._a = this._d.xl();
        this._g = this._d.xl();
        var t = new R;
        var a = new R;
        var r = new R;
        var n = new R;
        var s = new R;
        var h = new R;
        var e = new R;
        var f = new R;
        var u = new R;
        var o = this._d.xk();
        for (var v = 0; v < i.length; v++) {
            var l = 0;
            for (var c = i[v].x1(); c.i1();) {
                o.i6(c.i9(), l);
                c.i2();
                l++
            }
        }
        var d = function (i, t) {
            var a = o.i3(i.a3()) - o.i3(t.a3());
            return a <= 0 ? a >= 0 ? 0 : -1 : 1
        };
        var x = function (i, t) {
            var a = o.i3(i.a2()) - o.i3(t.a2());
            return a <= 0 ? a >= 0 ? 0 : -1 : 1
        };
        for (var g = 0; g < i.length; g++) {
            var b = i[g];
            for (var w = b._b; w != null; w = w.a()) {
                var m = w.d();
                m.av(d);
                m.au(x);
                var y = 0;
                t.af();
                a.af();
                r.af();
                n.af();
                s.af();
                h.af();
                e.af();
                f.af();
                u.af();
                for (var p = m.ap(); p.i1();) {
                    var k = p.i8();
                    var j = this.b1(k);
                    if (j == null || j.d() || j.g())r.aa(k); else if (j.e())t.aa(k); else if (j.f()) {
                        a.aa(k);
                        u.aa(k)
                    } else if (j.c()) {
                        f.aa(k);
                        u.aa(k)
                    }
                    p.i2();
                    y++
                }
                y = 0;
                for (var M = m.am(); M.i1();) {
                    var z = M.i8();
                    var L = this.a2(z);
                    if (L == null || L.c() || L.g())n.aa(z); else if (L.e())t.aa(z); else if (L.f()) {
                        a.aa(z);
                        u.aa(z)
                    } else if (L.d()) {
                        h.aa(z);
                        u.aa(z)
                    }
                    M.i2();
                    y++
                }
                var C = o.i3(m);
                if (!u.ar()) {
                    var O = .1 / u.ay();
                    for (var N = C - .4; !u.ar(); N += O) {
                        var E = u.c3();
                        if (E.a2() === m) {
                            var q = this._d.xm();
                            this._n.z1(q, E.a2());
                            this._d.s7(q, 1, 1);
                            this._c.z1(q, this._c.i1(m));
                            o.i6(q, N);
                            this._a.i8(E, this._d.gn(E));
                            this._d.gt(E, kt._A);
                            this._d.xr(E, q, E.a3());
                            b.ao(q, w)
                        } else {
                            var B = this._d.xm();
                            this._n.z1(B, E.a3());
                            this._d.s7(B, 1, 1);
                            this._c.z1(B, this._c.i1(m));
                            o.i6(B, N);
                            this._g.i8(E, this._d.gk(E));
                            this._d.gz(E, kt._A);
                            this._d.xr(E, E.a2(), B);
                            b.ao(B, w)
                        }
                    }
                }
                if (!t.ar()) {
                    var A = .1 / t.ay();
                    for (var P = C + .1; !t.ar(); P += A) {
                        var I = t.c3();
                        if (I.a2() === m) {
                            var D = this._d.xm();
                            this._n.z1(D, I.a2());
                            this._d.s7(D, 1, 1);
                            this._c.z1(D, this._c.i1(m));
                            o.i6(D, P);
                            this._a.i8(I, this._d.gn(I));
                            this._d.gt(I, kt._A);
                            this._d.xr(I, D, I.a3());
                            w = b.an(D, w)
                        } else {
                            var V = this._d.xm();
                            this._n.z1(V, I.a3());
                            this._d.s7(V, 1, 1);
                            this._c.z1(V, this._c.i1(m));
                            o.i6(V, P);
                            this._g.i8(I, this._d.gk(I));
                            this._d.gz(I, kt._A);
                            this._d.xr(I, I.a2(), V);
                            w = b.an(V, w)
                        }
                    }
                }
                var S = Ut._z;
                if (this._b.a2(m))S = this._b.b2(m);
                var F = S._b.ay() + h.ay() + m.ao() + s.ay() + S._q.ay();
                if (F > 0) {
                    var X = this._d.g9(m) / 2;
                    var U = this._d.gj(m);
                    var G = this.a7(U, F);
                    var Y = -.5 * U + this.a8(this._d.gj(m), F, G) + G * (S._b.ay() + h.ay());
                    for (var T = m.ap(); T.i1(); T.i2()) {
                        var H = T.i8();
                        if (!this.c2(H) && this._j.i1(H.a2()) == null) {
                            this._d.g2(H).i8(new _(Y, X));
                            Y += G
                        }
                    }
                }
                var W = this._t.a3(m);
                var Z = 0;
                var J = 0;
                var K = 0;
                var Q = 0;
                if (W != null) {
                    Z = W._e.ay();
                    J = W._c.ay();
                    K = W._b.ay();
                    Q = W._d.ay()
                }
                F = S._g.ay() + Z + f.ay() + m.ak() + e.ay() + J + S._d.ay();
                if (F > 0) {
                    var $ = this._d.gj(m);
                    var it = this.a7($, F);
                    var tt = this.a8($, F, it);
                    var at = -.5 * $ + tt + it * (S._g.ay() + Z + f.ay());
                    var rt = -this._d.g9(m) / 2;
                    for (var nt = m.am(); nt.i1(); nt.i2()) {
                        var st = nt.i8();
                        if (!this.d1(st) && this._j.i1(st.a3()) == null) {
                            this._d.g2(st).i9(new _(at, rt));
                            at += it
                        }
                    }
                    if (W != null) {
                        var ht = -.5 * $ + tt + it * (S._g.ay() + f.ay() + W._e.ay() - 1);
                        for (var et = W._e.c1(); et.i1(); et.i2()) {
                            var _t = et.i8();
                            this._d.u1(_t);
                            if (_t.a2() === m && !this.c2(_t)) {
                                this._d.g2(et.i8()).i8(new _(ht, rt));
                                ht -= it
                            } else if (!this.d1(_t)) {
                                this._d.g2(et.i8()).i9(new _(ht, rt));
                                ht -= it
                            }
                            this._d.h1(_t)
                        }
                        ht = .5 * $ - tt - it * (S._d.ay() + e.ay());
                        for (var ft = W._c.c1(); ft.i1(); ft.i2()) {
                            var ut = ft.i8();
                            this._d.u1(ut);
                            if (ut.a2() === m && !this.c2(ut)) {
                                this._d.g2(ft.i8()).i8(new _(ht, rt));
                                ht -= it
                            } else if (!this.d1(ut)) {
                                this._d.g2(ft.i8()).i9(new _(ht, rt));
                                ht -= it
                            }
                            this._d.h1(ut)
                        }
                    }
                }
                if (this._b.a2(m))this._b.a4(m, Z + f.ay() + m.ak() + e.ay() + J, h.ay() + m.ao() + s.ay(), K + a.ay(), Q + t.ay())
            }
        }
        this._d.xi(o);
        return i
    }, a7: function (i, t) {
        if (t <= 1)return 0; else return i / (t - 1 + 2 * this._r)
    }, a8: function (i, t, a) {
        if (t <= 1)return i * .5; else return(i - a * (t - 1)) * .5
    }, f: function (i) {
        var t = this.g1();
        this._f = this._d.xk();
        for (var a = 0; a < i.length; a++) {
            var r = i[a];
            for (var n = r._b; n != null;) {
                var s = n.d();
                var h = this._n.i1(s);
                if (h != null || this._t.b2(s)) {
                    n = n.a()
                } else {
                    var e = new $;
                    var f = new $;
                    var u = new $;
                    var o = new $;
                    var v = new $;
                    var l = new $;
                    var c = new R;
                    var d = new R;
                    var x = new Zt(e, f, u, o, v, l, c, d);
                    this._f.z1(s, x);
                    c.ab(s.am());
                    d.ab(s.ap());
                    for (var g = n.b(); g != null && this._n.i1(g.d()) === s; g = g.b()) {
                        var b = g.d();
                        var w = this.c3(b);
                        if (w.f())f.ac(b); else if (w.c())o.ac(b); else if (w.d())l.ac(b)
                    }
                    var m;
                    for (m = n.a(); m != null && this._n.i1(m.d()) === s; m = m.a()) {
                        var y = m.d();
                        var p = this.c3(y);
                        if (p.e())e.aa(y); else if (p.c())u.aa(y); else if (p.d())v.aa(y)
                    }
                    n = m
                }
            }
        }
        var k = this.d2(i);
        var j = 0;
        for (var M = 0; M < i.length; M++) {
            var z = k[M];
            if (M > 0)j += k[M - 1]._j + k[M - 1]._h + k[M - 1]._b;
            j += z._g + z._f + z._a + z._d;
            for (var L = i[M].x1(); L.i1(); L.i2()) {
                var C = L.i9();
                this._d.s3(C, this._d.gi(C), this._d.gh(C) + j)
            }
            z._c += j;
            z._i += j
        }
        for (var O = 0; O < i.length; O++) {
            var N = i[O];
            for (var E = N.x1(); E.i1(); E.i2()) {
                var q = E.i9();
                if (this._n.i1(q) != null)N.av(E)
            }
        }
        var B = this;
        var A = function (i, t) {
            if (B.a3(i))if (B.a3(t))return B._d.gi(i) >= B._d.gi(t) ? -1 : 1; else return 1;
            if (B.a3(t))return-1; else return B._d.gi(i) >= B._d.gi(t) ? 1 : -1
        };
        var P = function (i, t) {
            if (B.a3(i))if (B.a3(t))return B._d.gi(i) >= B._d.gi(t) ? 1 : -1; else return 1;
            if (B.a3(t))return-1; else return B._d.gi(i) >= B._d.gi(t) ? -1 : 1
        };
        for (var I = 0; I < i.length; I++) {
            var D = k[I];
            for (var V = i[I].x1(); V.i1(); V.i2()) {
                var S = V.i9();
                if (!this._t.b2(S)) {
                    var F = this._f.i1(S);
                    var X = F._d;
                    var U = F._a;
                    var G = F._b;
                    var Y = F._h;
                    var T = F._f;
                    var H = F._c;
                    var W = F._g;
                    var Z = F._e;
                    var J = 0;
                    var K = 0;
                    var Q = 0;
                    var it = 0;
                    var tt = S.ao();
                    var at = S.ak();
                    var rt = this._d.gi(S);
                    var nt = this._d.gh(S);
                    var st = this._d.gj(S);
                    var ht = this._d.g9(S);
                    var et = this._t.a3(S);
                    var _t = Ut._z;
                    if (this._b.a2(S))_t = this._b.b2(S);
                    if (et != null) {
                        J = et._d.ay();
                        K = et._b.ay();
                        Q = et._e.ay();
                        it = et._c.ay();
                        if (J > 0) {
                            var ft = _t._h.ay() + X.ay() + J + _t._k.ay();
                            var ut = this.a7(ht, ft);
                            var ot = this.a8(ht, ft, ut);
                            var vt = nt + ot + ut * (_t._h.ay() + this.a4(X));
                            for (var lt = et._d.c1(); lt.i1(); lt.i2()) {
                                var ct = lt.i8();
                                this._d.u1(ct);
                                if (ct.a2() === S) {
                                    if (!this.c2(ct))this._d.gx(ct, new _(rt + st, vt))
                                } else {
                                    if (this.d1(ct)) {
                                    }
                                    this._d.gy(ct, new _(rt + st, vt))
                                }
                                vt += ut;
                                this._d.h1(ct)
                            }
                        }
                        if (K > 0) {
                            var dt = _t._i.ay() + U.ay() + K + _t._l.ay();
                            var xt = this.a7(ht, dt);
                            var gt = this.a8(ht, dt, xt);
                            var bt = nt + gt + xt * (_t._i.ay() + this.a4(U));
                            for (var wt = et._b.c1(); wt.i1(); wt.i2()) {
                                var mt = wt.i8();
                                this._d.u1(mt);
                                if (mt.a2() === S) {
                                    if (!this.c2(mt))this._d.gx(mt, new _(rt, bt))
                                } else if (!this.d1(mt))this._d.gy(mt, new _(rt, bt));
                                bt += xt;
                                this._d.h1(mt)
                            }
                        }
                    }
                    if (X.ay() > 0) {
                        X.a1(A);
                        var yt = _t._h.ay() + X.ay() + J + _t._k.ay();
                        var pt = this.a7(ht, yt);
                        var kt = this.a8(ht, yt, pt);
                        var jt = nt + kt + pt * _t._h.ay();
                        var Mt = true;
                        while (!X.ar()) {
                            var zt = X.x4();
                            if (this.a3(zt)) {
                                if (Mt) {
                                    Mt = false;
                                    jt += pt * J
                                }
                                var Lt = zt.ag();
                                var Ct = this._d.gd(Lt);
                                var Ot = Ct.at();
                                Ct.ac(new _(Ot.x, D.b()));
                                if (this.c2(Lt)) {
                                    var Nt = this._a.i1(Lt);
                                    Ct.ac(new _(Ot.x, Nt.y + this._d.g6(S)));
                                    Ct.ac(new _(Nt.x + this._d.g5(S), Nt.y + this._d.g6(S)))
                                } else {
                                    Ct.ac(new _(Ot.x, jt));
                                    Ct.ac(new _(rt + st, jt))
                                }
                                this._d.xr(Lt, S, Lt.a3());
                                this._d.m1(Lt, Ct)
                            } else {
                                var Et = zt.ae();
                                var qt = this._d.gd(Et);
                                var Bt = qt.au();
                                qt.ae(new _(Bt.x, D.a()));
                                if (this.d1(Et)) {
                                    var At = this._g.i1(Et);
                                    qt.ae(new _(Bt.x, At.y + this._d.g6(S)));
                                    qt.ae(new _(At.x + this._d.g5(S), At.y + this._d.g6(S)))
                                } else {
                                    qt.ae(new _(Bt.x, jt));
                                    qt.ae(new _(rt + st, jt))
                                }
                                this._d.xr(Et, Et.a2(), S);
                                this._d.m1(Et, qt)
                            }
                            this._d.x4(zt);
                            jt += pt
                        }
                    }
                    if (U.ay() > 0) {
                        U.a1(P);
                        var Rt = _t._i.ay() + U.ay() + K + _t._l.ay();
                        var Pt = this.a7(ht, Rt);
                        var It = this.a8(ht, Rt, Pt);
                        var Dt = nt + It + Pt * _t._i.ay();
                        var Vt = true;
                        while (!U.ar()) {
                            var St = U.x4();
                            if (this.a3(St)) {
                                if (Vt) {
                                    Vt = false;
                                    Dt += Pt * K
                                }
                                var Ft = St.ag();
                                var Xt = this._d.gd(Ft);
                                var Gt = Xt.at();
                                Xt.ac(new _(Gt.x, D.b()));
                                if (this.c2(Ft)) {
                                    var Yt = this._a.i1(Ft);
                                    Xt.ac(new _(Gt.x, Yt.y + this._d.g6(S)));
                                    Xt.ac(new _(Yt.x + this._d.g5(S), Yt.y + this._d.g6(S)))
                                } else {
                                    Xt.ac(new _(Gt.x, Dt));
                                    Xt.ac(new _(rt, Dt))
                                }
                                this._d.xr(Ft, S, Ft.a3());
                                this._d.m1(Ft, Xt)
                            } else {
                                var Tt = St.ae();
                                var Ht = this._d.gd(Tt);
                                var Wt = Ht.au();
                                Ht.ae(new _(Wt.x, D.a()));
                                if (this.d1(Tt)) {
                                    var Jt = this._g.i1(Tt);
                                    Ht.ae(new _(Wt.x, Jt.y + this._d.g6(S)));
                                    Ht.ae(new _(Jt.x + this._d.g5(S), Jt.y + this._d.g6(S)))
                                } else {
                                    Ht.ae(new _(Wt.x, Dt));
                                    Ht.ae(new _(rt, Dt))
                                }
                                this._d.xr(Tt, Tt.a2(), S);
                                this._d.m1(Tt, Ht)
                            }
                            this._d.x4(St);
                            Dt += Pt
                        }
                    }
                    var Kt = _t._g.ay() + _t._d.ay() + at + Y.ay() + G.ay() + Q + it;
                    st = this._d.gj(S);
                    var Qt = this.a7(st, Kt);
                    var $t = this.a8(st, Kt, Qt);
                    Kt = _t._b.ay() + _t._q.ay() + tt + H.ay() + T.ay();
                    var ia = this.a7(st, Kt);
                    var ta = this.a8(st, Kt, ia);
                    if (Y.ay() > 0) {
                        var aa = Qt;
                        var ra = t;
                        var na = this._d.gi(S) + $t + aa * (_t._g.ay() + Y.ay() - 1);
                        var sa = this._d.gh(S);
                        var ha = D._c - D._g - Y.ay() * ra;
                        var ea;
                        for (; !Y.ar(); this._d.x4(ea)) {
                            ea = Y.x4();
                            var _a = ea.ag();
                            var fa = this._d.gd(_a);
                            var ua = fa.at();
                            fa.ac(new _(ua.x, D.b()));
                            fa.ac(new _(ua.x, ha));
                            if (this.c2(_a)) {
                                var oa = this._a.i1(_a);
                                fa.ac(new _(oa.x + this._d.g5(S), ha));
                                fa.ac(new _(oa.x + this._d.g5(S), oa.y + this._d.g6(S)))
                            } else {
                                fa.ac(new _(na, ha));
                                fa.ac(new _(na, sa));
                                na -= aa
                            }
                            ha += ra;
                            this._d.xr(_a, S, _a.a3());
                            this._d.m1(_a, fa)
                        }
                    }
                    if (G.ay() > 0) {
                        var va = Qt;
                        var la = t;
                        var ca = this._d.gi(S) + this._d.gj(S) - $t - va * _t._d.ay();
                        var da = this._d.gh(S);
                        var xa = D._c - D._g - la;
                        var ga;
                        for (; !G.ar(); this._d.x4(ga)) {
                            ga = G.x4();
                            var ba = ga.ag();
                            var wa = this._d.gd(ba);
                            var ma = wa.at();
                            wa.ac(new _(ma.x, D.b()));
                            wa.ac(new _(ma.x, xa));
                            if (this.c2(ba)) {
                                var ya = this._a.i1(ba);
                                wa.ac(new _(ya.x + this._d.g5(S), xa));
                                wa.ac(new _(ya.x + this._d.g5(S), ya.y + this._d.g6(S)))
                            } else {
                                wa.ac(new _(ca, xa));
                                wa.ac(new _(ca, da));
                                ca -= va
                            }
                            xa -= la;
                            this._d.xr(ba, S, ba.a3());
                            this._d.m1(ba, wa)
                        }
                    }
                    if (H.ay() > 0) {
                        var pa = ia;
                        var ka = t;
                        var ja = this._d.gi(S) + ta + pa * (_t._b.ay() + H.ay() - 1);
                        var Ma = this._d.gh(S) + this._d.g9(S);
                        var za = Ma + H.ay() * ka;
                        var La;
                        for (; !H.ar(); this._d.x4(La)) {
                            La = H.x4();
                            var Ca = La.ae();
                            var Oa = this._d.gd(Ca);
                            var Na = Oa.au();
                            Oa.ae(new _(Na.x, D.a()));
                            Oa.ae(new _(Na.x, za));
                            if (this.d1(Ca)) {
                                var Ea = this._g.i1(Ca);
                                Oa.ae(new _(Ea.x + this._d.g5(S), za));
                                Oa.ae(new _(Ea.x + this._d.g5(S), Ea.y + this._d.g6(S)))
                            } else {
                                Oa.ae(new _(ja, za));
                                Oa.ae(new _(ja, Ma));
                                ja -= pa
                            }
                            za -= ka;
                            this._d.xr(Ca, Ca.a2(), S);
                            this._d.m1(Ca, Oa)
                        }
                    }
                    if (T.ay() > 0) {
                        var qa = ia;
                        var Ba = t;
                        var Aa = this._d.gi(S) + this._d.gj(S) - ta - ia * _t._q.ay();
                        var Ra = this._d.gh(S) + this._d.g9(S);
                        var Pa = Ra + Ba;
                        var Ia;
                        for (; !T.ar(); this._d.x4(Ia)) {
                            Ia = T.x4();
                            var Da = Ia.ae();
                            var Va = this._d.gd(Da);
                            var Sa = Va.au();
                            Va.ae(new _(Sa.x, D.a()));
                            Va.ae(new _(Sa.x, Pa));
                            if (this.d1(Da)) {
                                var Fa = this._g.i1(Da);
                                Va.ae(new _(Fa.x + this._d.g5(S), Pa));
                                Va.ae(new _(Fa.x + this._d.g5(S), Fa.y + this._d.g6(S)))
                            } else {
                                Va.ae(new _(Aa, Pa));
                                Va.ae(new _(Aa, Ra));
                                Aa -= qa
                            }
                            Pa += Ba;
                            this._d.xr(Da, Da.a2(), S);
                            this._d.m1(Da, Va)
                        }
                    }
                    while (!Z.ar()) {
                        var Xa = Z.c3();
                        var Ua = this._d.gl(Xa);
                        if (D.a() + 12 < Ua.y)this._d.g7(Xa).i4(Ua.x, D.a())
                    }
                    while (!W.ar()) {
                        var Ga = W.c3();
                        var Ya = this._d.gs(Ga);
                        if (D.b() - 12 > Ya.y) {
                            var Ta = this._d.gf(Ga);
                            Ta.ac(new _(Ya.x, D.b()));
                            this._d.s6(Ga, Ta)
                        }
                    }
                }
            }
        }
        for (var Ha = 0; Ha < i.length; Ha++) {
            var Wa = i[Ha];
            for (var Za = Wa._b; Za != null; Za = Za.a()) {
                var Ja = Za.d();
                var Ka = this._t.a3(Ja);
                if (Ka != null && Ka._a != null) {
                    this._d.x4(Ka._a);
                    Wa.aw(Za.b())
                }
            }
        }
        this._d.xi(this._f);
        this._d.xj(this._a);
        this._d.xj(this._g);
        return i
    }, c3: function (i) {
        if (this.a3(i))return this.b1(i.ag()); else return this.a2(i.ae())
    }, b1: function (i) {
        if (this._h == null)return Ut.s; else return this._h.i1(i)
    }, a2: function (i) {
        if (this._l == null)return Ut.u; else return this._l.i1(i)
    }, c2: function (i) {
        if (i == null) {
            return false
        } else {
            var t = this.b1(i);
            return t != null && t.a()
        }
    }, d1: function (i) {
        if (i == null) {
            return false
        } else {
            var t = this.a2(i);
            return t != null && t.a()
        }
    }, a3: function (i) {
        return i.ao() === 1
    }, b2: function (i) {
        return i.ak() === 1
    }, a4: function (i) {
        var t = 0;
        for (var a = i._b; a != null; a = a.a())if (this.b2(a.d()))t++;
        return t
    }, d2: function (i) {
        var t = this._k;
        var a = Jt.d(i.length + 1);
        for (var r = 0; r < i.length; r++) {
            var n = i[r];
            var s = new Ht;
            a[r] = s;
            s._c = Number.MAX_VALUE;
            s._i = Number.MIN_VALUE;
            for (var h = n.x1(); h.i1(); h.i2()) {
                var e = h.i9();
                var _ = this._d.gb(e);
                s._c = Math.min(s._c, _.i2());
                s._i = Math.max(s._i, _.i2() + _.i4())
            }
        }
        this._b.a5(i, a);
        for (var f = 0; f < i.length; f++) {
            var u = a[f];
            for (var o = i[f].x1(); o.i1(); o.i2()) {
                var v = o.i9();
                var l = this._f.i1(v);
                if (l != null) {
                    u._h = Math.max(u._h, Math.max(l._f.ay() * t, l._c.ay() * t));
                    u._f = Math.max(u._f, Math.max(l._b.ay() * t, l._h.ay() * t))
                }
            }
        }
        return a
    }});
    Ut.s = qt.j(2);
    Ut.u = qt.j(1);
    Ut._z = new Xt;
    var Gt = function () {
        this._af = 0;
        this._b = 0
    };
    _twaver.ext(Gt, Object, {ib: function (i) {
        this._af = i
    }, ia: function (i, t, a) {
        this.a6(i, t, a);
        this.b2(false);
        var r = this.g();
        if (this.o() && r > 0) {
            var n = this.r();
            for (var s = 0; s < 20 && r > 0 && this.o(); s++) {
                this.b2(true);
                var h = this.g();
                if (h < r) {
                    this.a7(n);
                    r = h
                }
            }
            this.b3(n);
            this.b1()
        }
        return this.c()
    }, a6: function (i, t, a) {
        this._b = (new Date).getTime();
        this._ac = i;
        this._ah = t;
        var r = this;
        this._p = function (i, t) {
            var a = r._n[i.al()] - r._n[t.al()];
            if (a > 0)return 1;
            return a >= 0 ? 0 : -1
        };
        this._ad = Jt.d(a);
        for (var n = 0; n < this._ad.length; n++)this._ad[n] = new $;
        this._ab = Jt.a(this._ac.x0());
        this._f = Jt.d(this._ac.x0());
        this._n = Jt.a(this._ac.x0() + 1);
        var s = this._ab;
        this._o = function (i, t) {
            if (i == null && t != null) {
                return 1
            }
            if (i != null && t == null) {
                return-1
            }
            if (i == null && t == null) {
                return 0
            }
            var a = i;
            var r = t;
            var n = a._h;
            var h = a.a2();
            var e = r.a2();
            var _ = s[h.al()] - s[e.al()];
            if (_ === 0) {
                var f = Gt.b(qt.h(n, a), n.gn(a));
                var u = Gt.b(qt.h(n, r), n.gn(r));
                var o = f - u;
                if (o === 0) {
                    var v = s[a.a3().al()] - s[r.a3().al()];
                    if (v === 0) {
                        var l = Gt.a(qt.i(n, a), n.gk(a));
                        var c = Gt.a(qt.i(n, r), n.gk(r));
                        return l - c
                    } else {
                        return v
                    }
                } else {
                    return o
                }
            } else {
                return _
            }
        };
        this._l = function (i, t) {
            if (i == null && t != null) {
                return 1
            }
            if (i != null && t == null) {
                return-1
            }
            if (i == null && t == null) {
                return 0
            }
            var a = i;
            var r = t;
            var n = a._h;
            var h = a.a3();
            var e = r.a3();
            var _ = s[h.al()] - s[e.al()];
            if (_ === 0) {
                var f = Gt.a(qt.i(n, a), n.gk(a));
                var u = Gt.a(qt.i(n, r), n.gk(r));
                var o = f - u;
                if (o === 0) {
                    var v = s[a.a2().al()] - s[r.a2().al()];
                    if (v === 0) {
                        var l = Gt.b(qt.h(n, a), n.gn(a));
                        var c = Gt.b(qt.h(n, r), n.gn(r));
                        return l - c
                    } else {
                        return v
                    }
                } else {
                    return o
                }
            } else {
                return _
            }
        };
        this._z = function (i, t) {
            if (i == null && t != null) {
                return 1
            }
            if (i != null && t == null) {
                return-1
            }
            if (i == null && t == null) {
                return 0
            }
            var a = i;
            var r = t;
            var n = a._h;
            var s = Gt.b(qt.h(n, a), n.gn(a));
            var h = Gt.b(qt.h(n, r), n.gn(r));
            return s - h
        };
        this._e = function (i, t) {
            if (i == null && t != null) {
                return 1
            }
            if (i != null && t == null) {
                return-1
            }
            if (i == null && t == null) {
                return 0
            }
            var a = i;
            var r = t;
            var n = a._h;
            var s = Gt.a(qt.i(n, a), n.gk(a));
            var h = Gt.a(qt.i(n, r), n.gk(r));
            return s - h
        };
        this._ac.x2(this._e, this._z)
    }, c: function () {
        this._ah = null;
        this._aa = null;
        this._f = null;
        this._n = null;
        this._p = null;
        this._o = null;
        this._l = null;
        this._ac = null;
        var i = this._ad;
        this._ad = null;
        return i
    }, o: function () {
        var i = (new Date).getTime() - this._b;
        return i <= this._af
    }, m: function () {
        var i = this;
        var t = function (t, a) {
            return Math.ceil(i._n[t.a3().al()]) - Math.ceil(i._n[a.a3().al()])
        };
        for (var a = this._ac.x9(); a.i1(); a.i2()) {
            for (var r = a.i9().aw(); r.i1(); r.i2())this._n[r.i9().al()] = kt.j();
            a.i9().av(t)
        }
    }, b2: function (i) {
        for (var t = 0; t < this._ad.length; t++)this._ad[t].af();
        if (i) {
            this.m();
            for (var a = 0, r = this._ab.length; a < r; a++) {
                this._ab[a] = 0
            }
            this._ac.x2(null, this._z)
        }
        var n = this._ac.xm();
        this._ah.i7(n, 0);
        for (var s = this._ac.x9(); s.i1(); s.i2())if (s.i9().ak() === 0 && s.i9() !== n)this._ac.xo(n, s.i9());
        var h = new p(this);
        h.a6(true);
        h.a9(this._ac, n);
        this._ad[0].at();
        this._ac.x4(n);
        this.d()
    }, a1: function () {
        this._ac.x2(this._o, this._l);
        var i = 0;
        for (var t = 1; t < this._ad.length; t++) {
            var a = this.a2(this._ad[t - 1], this._ad[t]);
            i += a
        }
        var r = 0;
        i += r;
        return i
    }, a2: function (i, t) {
        var a = i.ah();
        var r = t.ah();
        var n = new A;
        var s = new A;
        this._aa = Jt.d(this._ac.x0());
        var h = 0;
        for (; a.i1() && r.i1(); r.i2()) {
            h += this.a8(a.i6(), n, s, true);
            h += this.a8(r.i6(), s, n, false);
            a.i2()
        }
        for (; a.i1(); a.i2())h += this.a8(a.i6(), n, s, true);
        for (; r.i1(); r.i2())h += this.a8(r.i6(), s, n, false);
        return h
    }, a8: function (i, t, a, r) {
        var n = 0;
        var s = 0;
        var h = 0;
        if (this._aa[i.al()] != null) {
            var e = this._aa[i.al()].a();
            for (var _ = t._b; _ !== e; _ = _.a()) {
                var f = _._c;
                if (f === i) {
                    n++;
                    h += s;
                    t.aw(_)
                } else {
                    s++
                }
            }
        }
        var u = n * a.ay() + h;
        if (r) {
            for (var o = i.ag(); o != null; o = o.a8()) {
                var v = o.a3();
                if (this._ab[v.al()] >= this._ab[i.al()])this._aa[v.al()] = a.ae(v)
            }
        } else {
            for (var l = i.ae(); l != null; l = l.a7()) {
                var c = l.a2();
                if (this._ab[c.al()] > this._ab[i.al()])this._aa[c.al()] = a.ae(c)
            }
        }
        return u
    }, g: function () {
        var i = this.r();
        var t = this.a1();
        var a = true;
        for (var r = 0; r < 3 && this.o() && t > 0;) {
            var n = this.k();
            if (n < t) {
                this.a7(i);
                t = n
            } else {
                r++
            }
            a = !a
        }
        this.b3(i);
        this.b1();
        if (t > 0) {
            var s = 1;
            for (var h = 0; s === 1 && t > 0; h++) {
                this.e();
                this.i();
                var e = this.a1();
                if (e < t) {
                    s = 1;
                    this.a7(i)
                } else {
                    s = -1
                }
                t = e
            }
            this.b3(i);
            this.b1()
        }
        return t
    }, e: function () {
        var i = this.l();
        var t = this.r();
        var a = Jt.d(this._ac.x0());
        for (var r = this._ad.length - 1; r >= 0; r--) {
            for (var n = this._ad[r].ah(); n.i1(); n.i2()) {
                var s = n.i6();
                if (s.ak() === 1 && s.ao() === 1) {
                    var h = i.i1(s.ag());
                    if (h != null && a[h.al()] == null) {
                        var e = this.a4(s, h);
                        var _ = h.al();
                        var f = a[_] = Jt.d(e + 1);
                        for (var u = f.length - 1; u >= 0; u--)f[u] = new A
                    }
                }
            }
        }
        for (var o = 0; o < this._ad.length; o++) {
            for (var v = this._ad[o].ah(); v.i1(); v.i2()) {
                var l = v.i6();
                if (l.ak() === 1 && l.ao() === 1) {
                    var c = i.i1(l.ag());
                    if (c != null) {
                        var d = c.al();
                        var x = this.a4(l, c) - 1;
                        a[d][x].ae(l.ae())
                    }
                } else {
                    for (var g = l.ae(); g != null; g = g.a7()) {
                        var b = i.i1(g);
                        if (b != null) {
                            var w = b.al();
                            var m = this.a4(l, b) - 1;
                            a[w][m].ae(g)
                        }
                    }
                }
            }
        }
        for (var y = this._ac.x9(); y.i1(); y.i2()) {
            var p = y.i9();
            if (a[p.al()] != null) {
                for (var k = p.ag(); k != null; k = k.a8()) {
                    var j = i.i1(k);
                    if (j != null) {
                        for (var M = a[j.al()]; M[0].ay() > 0;) {
                            var z = 0;
                            var L;
                            do {
                                L = M[z].am();
                                var C = L.a3();
                                if (C.ak() !== 1 || C.ao() !== 1)break;
                                z++
                            } while (true);
                            var O = M[z].at().a3();
                            z--;
                            O = L.a2();
                            L = M[z].at();
                            var N = L.a3();
                            while (z >= 0) {
                                if (t[O.al()] !== t[N.al()])this._ab[O.al()] = t[N.al()];
                                O = O.ae().a2();
                                if (--z >= 0) {
                                    var E = M[z].at();
                                    N = E.a3()
                                }
                            }
                        }
                    }
                }
            }
        }
        this.b1();
        this._ac.xj(i)
    }, i: function () {
        var i = this.f();
        var t = this.r();
        var a = Jt.d(this._ac.x0());
        for (var r = 0; r < this._ad.length; r++) {
            for (var n = this._ad[r].ah(); n.i1(); n.i2()) {
                var s = n.i6();
                if (s.ak() === 1 && s.ao() === 1) {
                    var h = i.i1(s.ae());
                    if (h != null && a[h.al()] == null) {
                        var e = this.a4(h, s);
                        var _ = h.al();
                        var f = a[_] = Jt.d(e + 1);
                        for (var u = f.length - 1; u >= 0; u--)f[u] = new A
                    }
                }
            }
        }
        for (var o = this._ad.length - 1; o >= 0; o--) {
            for (var v = this._ad[o].ah(); v.i1(); v.i2()) {
                var l = v.i6();
                if (l.ak() === 1 && l.ao() === 1) {
                    var c = i.i1(l.ae());
                    if (c != null) {
                        var d = c.al();
                        var x = this.a4(c, l) - 1;
                        a[d][x].ae(l.ag())
                    }
                } else {
                    for (var g = l.ag(); g != null; g = g.a8()) {
                        var b = i.i1(g);
                        if (b != null) {
                            var w = b.al();
                            var m = this.a4(b, l) - 1;
                            a[w][m].ae(g)
                        }
                    }
                }
            }
        }
        for (var y = this._ac.x9(); y.i1(); y.i2()) {
            var p = y.i9();
            if (a[p.al()] != null) {
                for (var k = p.ae(); k != null; k = k.a7()) {
                    var j = i.i1(k);
                    if (j != null) {
                        for (var M = a[j.al()]; M[0].ay() > 0;) {
                            var z = 0;
                            var L;
                            do {
                                L = M[z].am();
                                var C = L.a2();
                                if (C.ak() !== 1 || C.ao() !== 1)break;
                                z++
                            } while (true);
                            var O = M[z].at().a2();
                            z--;
                            O = L.a3();
                            L = M[z].at();
                            var N = L.a2();
                            while (z >= 0) {
                                if (t[O.al()] !== t[N.al()])this._ab[O.al()] = t[N.al()];
                                O = O.ag().a3();
                                if (--z >= 0) {
                                    var E = M[z].at();
                                    N = E.a2()
                                }
                            }
                        }
                    }
                }
            }
        }
        this.b1();
        this._ac.xj(i)
    }, a4: function (i, t) {
        return this._ah.i2(i) - this._ah.i2(t)
    }, l: function () {
        var i = rt.a6(Jt.d(this._ac.xg()));
        for (var t = this._ac.x9(); t.i1(); t.i2()) {
            var a = t.i9();
            if (a.ao() > 1) {
                var r = 0;
                for (var n = a.ag(); n != null; n = n.a8()) {
                    var s = n.a3();
                    if (s.ak() === 1 && s.ao() === 1)r++
                }
                if (r > 1) {
                    for (var h = a.ag(); h != null; h = h.a8()) {
                        var e = h;
                        var _ = e.a3();
                        if (_.ak() === 1 && _.ao() === 1) {
                            for (; _.ak() === 1 && _.ao() === 1; _ = e.a3()) {
                                i.i8(e, a);
                                e = _.ag()
                            }
                            i.i8(e, a)
                        }
                    }
                }
            }
        }
        return i
    }, f: function () {
        var i = rt.a6(Jt.d(this._ac.xg()));
        for (var t = this._ac.x9(); t.i1(); t.i2()) {
            var a = t.i9();
            if (a.ak() > 1) {
                var r = 0;
                for (var n = a.ae(); n != null; n = n.a7()) {
                    var s = n.a2();
                    if (s.ak() === 1 && s.ao() === 1)r++
                }
                if (r > 1) {
                    for (var h = a.ae(); h != null; h = h.a7()) {
                        var e = h;
                        var _ = e.a2();
                        if (_.ak() === 1 && _.ao() === 1) {
                            for (; _.ak() === 1 && _.ao() === 1; _ = e.a2()) {
                                i.i8(e, a);
                                e = _.ae()
                            }
                            i.i8(e, a)
                        }
                    }
                }
            }
        }
        return i
    }, k: function () {
        for (var i = 1; i < this._ad.length; i++) {
            var t = this._ad[i];
            for (var a = t.ah(); a.i1(); a.i2()) {
                var r = a.i6();
                this._n[r.al()] = this.a5(r, t.ay(), r.am(), this._ad[i - 1].ay());
                this._n[r.al()] += this._ab[r.al()] / (this._ad[i - 1].ay() * 3)
            }
            this.a3(t, this._p)
        }
        return this.a1()
    }, a5: function (i, t, a, r) {
        var n = 0;
        if (a.i7() === 0) {
            n = r * this._ab[i.al()] / t
        } else {
            for (; a.i1(); a.i2()) {
                var s = a.i8();
                if (s.a2() === i) {
                    n += this._ab[s.a3().al()]
                } else {
                    n += this._ab[s.a2().al()]
                }
            }
            n /= a.i7()
        }
        return n
    }, a7: function (i) {
        Jt.f(this._ab, i, i.length)
    }, b3: function (i) {
        Jt.f(i, this._ab, i.length)
    }, r: function () {
        var i = Jt.a(this._ab.length);
        this.a7(i);
        return i
    }, d: function () {
        for (var i = 0; i < this._ad.length; i++) {
            var t = 0;
            for (var a = this._ad[i].ah(); a.i1();) {
                this._ab[a.i6().al()] = t;
                a.i2();
                t++
            }
        }
    }, b1: function () {
        for (var i = 0; i < this._ad.length; i++) {
            var t = this._ad[i];
            for (var a = t._b; a != null; a = a.a()) {
                var r = a.d();
                this._f[this._ab[r.al()]] = r
            }
            var n = 0;
            for (var s = t._b; s != null;) {
                s.c(this._f[n]);
                s = s.a();
                n++
            }
        }
    }, a3: function (i, t) {
        var a = i.ah();
        for (var r = 0; r < i.ay(); a.i2()) {
            this._f[r] = a.i6();
            r++
        }
        Jt.s(this._f, i.ay(), t);
        var n = 0;
        for (var s = i._b; s != null;) {
            s.c(this._f[n]);
            this._ab[this._f[n].al()] = n;
            s = s.a();
            n++
        }
    }});
    Gt.b = function (i, t) {
        if (i == null)return 0;
        var a = i.a() ? Math.floor(t.x) : 0;
        var r = i.a() ? Math.floor(t.y) : 0;
        if (i.e())return 1e4 - r;
        if (i.f())return-1e4 + r;
        if (i.c())return-2e4 - a; else return a
    };
    Gt.a = function (i, t) {
        if (i == null)return 0;
        var a = i.a() ? Math.floor(t.x) : 0;
        var r = i.a() ? Math.floor(t.y) : 0;
        if (i.e())return 1e4 + r;
        if (i.f())return-1e4 - r;
        if (i.d())return-2e4 - a; else return a
    };
    var Yt = function () {
        Yt.superClass.constructor.call(this);
        this._i6 = 0;
        this._i3 = 2147483647;
        this._i0 = 60;
        this._iz = 20;
        this._i2 = 20;
        this._i4 = 20;
        this.i5(false);
        this._i7 = new It;
        this._i1 = new Gt;
        this._i8 = new St
    };
    _twaver.ext(Yt, ht, {j2: function () {
        return this._i2
    }, i4: function (i) {
        return true
    }, i3: function (i) {
        this._i6 = (new Date).getTime();
        Et.d(i, false);
        var t = i.xk();
        var a = i.xk();
        var r = i.xl();
        var n = new R;
        var s = new Ut(i, t, a, r);
        s.a6(this.j2());
        this._i8.i3(this._iz);
        this._i8.i6(this._i0);
        this._i8.i4(this._i2);
        this._i8.i5(this._i4);
        this._i8.i2(a);
        var h = this._i7.i1(i, t, n);
        for (var e = n.c1(); e.i1(); e.i2()) {
            var _ = e.i8();
            r.i7(_, true);
            var f = i.gn(_);
            i.gt(_, i.gk(_));
            i.gz(_, f)
        }
        this.a2(i, t, a);
        h = s.a9(h);
        var u = this.j1(i, t, h);
        u = s.a5(u);
        u = s.b3(u);
        this._i8.i1(i, u, t);
        u = s.g2(u);
        s.e2(u);
        this.b(i, a);
        this.w(i);
        this.a1(i, n);
        s.e1();
        i.xj(r);
        i.xi(a);
        i.xi(t)
    }, j1: function (i, t, a) {
        if (this._i1 instanceof Gt) {
            var r = this._i1;
            var n = (new Date).getTime() - this._i6;
            r.ib(this._i3 - n)
        }
        var s = this._i1.ia(i, t, a);
        return s
    }, a1: function (i, t) {
        for (var a = t.c1(); a.i1(); a.i2()) {
            var r = a.i8();
            var n = i.gs(r);
            var s = i.gl(r);
            i.x3(r);
            var h = i.gp(r);
            i.s5(r, h.a());
            i.gy(r, n);
            i.gx(r, s)
        }
    }, b: function (i, t) {
        for (var a = i.x9(); a.i1(); a.i2()) {
            var r = a.i9();
            var n = t.i1(r);
            if (n != null && !i.xp(n)) {
                for (var s = r.am().i8().a2(); t.i1(s) != null; s = r.am().i8().a2())r = s;
                i.u1(n);
                var h = r.ae();
                var e = new A;
                for (; t.i1(h.a3()) != null; h = h.a3().ag()) {
                    var _ = i.gs(h);
                    e.aa(_);
                    e.az(i.gf(h));
                    var f = i.gl(h);
                    if (!f.equals(_))e.aa(f)
                }
                var u = i.gs(h);
                e.aa(u);
                e.az(i.gf(h));
                var o = i.gl(h);
                if (!o.equals(u))e.aa(o);
                i.m1(n, e)
            }
        }
        for (var v = i.x9(); v.i1(); v.i2())if (t.i1(v.i9()) != null)i.x4(v.i9())
    }, w: function (i) {
        for (var t = i.xf(); t.i1(); t.i2()) {
            var a = t.i8();
            var r = i.g2(a);
            if (r.i1() > 0) {
                var n = new s;
                var h = i.gc(a);
                var e = h.c();
                var _ = e.i6();
                e.i2();
                var f = _.x;
                var u = _.y;
                if (e.i1()) {
                    var o = e.i6();
                    var v = o.x;
                    var c = o.y;
                    e.i2();
                    for (; e.i1(); e.i2()) {
                        var d = e.i6();
                        var x = d.x;
                        var g = d.y;
                        var b = (f - x) * (c - g) / (u - g) + x;
                        if (Math.abs(b - v) >= 1) {
                            n.add(o);
                            f = v;
                            u = c
                        }
                        o = d;
                        v = x;
                        c = g
                    }
                }
                if (n.size() < r.i1())i.s5(a, new l(n))
            }
        }
    }, a2: function (i, t, a) {
        var r = i.g8().c1();
        r.i5();
        for (; r.i1(); r.i3()) {
            var n = r.i8().a2();
            var s = r.i8().a3();
            var h = t.i2(s) - t.i2(n);
            if (h > 1) {
                var e = null;
                var _ = null;
                var f = n;
                for (; h > 1; h--) {
                    e = i.xm();
                    i.s7(e, 1, 1);
                    i.s4(e, kt._A);
                    _ = i.xo(f, e);
                    if (f === n)i.gt(_, i.gn(r.i8()));
                    t.i7(e, t.i2(f) + 1);
                    a.z1(e, r.i8());
                    f = e
                }
                _ = i.xo(e, s);
                i.gz(_, i.gk(r.i8()));
                i.h1(r.i8())
            }
        }
    }});
    var Tt = function (i, t, a, r) {
        this._i = 20;
        this._j = i;
        this._g = t;
        this._a = a;
        this._h = r
    };
    _twaver.ext(Tt, Object, {a1: function (i) {
        this._i = i
    }, b2: function (i) {
        return this._e == null ? false : this._e.i4(i)
    }, a3: function (i) {
        return this._f == null ? null : this._f.i1(i)
    }, d: function () {
        this._j.xi(this._f);
        this._j.xi(this._e)
    }});
    var Ht = function () {
        this._c = 0;
        this._i = 0;
        this._g = 0;
        this._j = 0;
        this._f = 0;
        this._h = 0;
        this._d = 0;
        this._e = 0;
        this._a = 0;
        this._b = 0
    };
    _twaver.ext(Ht, Object, {a: function () {
        return this._c - this._g - this._f - this._a
    }, b: function () {
        return this._i + this._j + this._h + this._b
    }});
    var Wt = function () {
        this._d = new R;
        this._b = new R;
        this._c = new R;
        this._e = new R
    };
    _twaver.ext(Wt, Object, {});
    var Zt = function (i, t, a, r, n, s, h, e) {
        this._d = i;
        this._a = t;
        this._b = a;
        this._h = r;
        this._f = n;
        this._c = s;
        this._e = h;
        this._g = e
    };
    _twaver.ext(Zt, Object, {});
    var Jt = {};
    Jt.a = function (i, t) {
        var a = [];
        for (var r = 0; r < i; r++)a[r] = t || 0;
        return a
    };
    Jt.b = function (i) {
        var t = [];
        for (var a = 0; a < i; a++)t[a] = false;
        return t
    };
    Jt.c = function (i, t) {
        if (i instanceof _) {
            if (i.x < t.x)return-1;
            if (i.x > t.x)return 1;
            if (i.y < t.y)return-1;
            return i.y <= t.y ? 0 : 1
        } else if (i instanceof f) {
            if (t.width > i.width)return-1;
            if (t.width < i.width)return 1;
            if (t.height > i.height)return-1;
            return t.height >= i.height ? 0 : 1
        } else if (i instanceof o) {
            if (i.x < t.x)return-1;
            if (i.x > t.x)return 1;
            if (i.y < t.y)return-1;
            if (i.y > t.y)return 1;
            if (t.width > i.width)return-1;
            if (t.width < i.width)return 1;
            if (t.height > i.height)return-1;
            return t.height >= i.height ? 0 : 1
        } else {
            throw"Unkown Type: " + i
        }
    };
    Jt.d = function (i) {
        var t = [];
        for (var a = 0; a < i; a++)t[a] = null;
        return t
    };
    Jt.e = function (i, t) {
        var a = [];
        for (var r = 0; r < i; r++)a[r] = Jt.a(t);
        return a
    };
    Jt.f = function (i, t, a) {
        for (var r = 0; r < a; r++)t[r] = i[r]
    };
    Jt.s = function (i, t, a) {
        var r = [];
        Jt.f(i, r, t);
        r.sort(a);
        Jt.f(r, i, t)
    };
    Jt.n = function (i, t) {
        return i - t
    }
})(window);
(function (t, e) {
    var i = _twaver.arrow;
    var n = _twaver.box;
    var s = _twaver.bus;
    var r = _twaver.Dashline;
    var o = _twaver.element;
    var a = _twaver.g;
    var h = _twaver.group;
    var l = _twaver.html;
    var c = _twaver.link;
    var d = _twaver.math;
    var u = _twaver.Matrix;
    var v = _twaver.interaction;
    var w = _twaver.popup;
    var f = _twaver.position;
    var _ = _twaver.render;
    var g = _twaver.touch;
    var m = _twaver.ua;
    var k = twaver.Defaults;
    var p = twaver.List;
    var y = twaver.Node;
    var E = twaver.Group;
    twaver.network.Network = function (t) {
        twaver.network.Network.superClass.constructor.apply(this, arguments);
        this._elementUIMap = {};
        this._layerMap = {};
        this._layerList = new p;
        this._view = l.createView("auto");
        this._rootDiv = l.createDiv();
        this._topDiv = l.createDiv();
        this._attachmentDiv = l.createDiv();
        this._layersDiv = l.createDiv();
        this._bottomDiv = l.createDiv();
        this._rootDiv.appendChild(this._bottomDiv);
        this._rootDiv.appendChild(this._layersDiv);
        this._rootDiv.appendChild(this._attachmentDiv);
        this._rootDiv.appendChild(this._topDiv);
        this._view.appendChild(this._rootDiv);
        this.setElementBox(t ? t : new twaver.ElementBox);
        if (m.isMSToucheable) {
            this.setMSTouchInteractions()
        } else if (m.isTouchable) {
            this.setTouchInteractions()
        } else {
            this.setDefaultInteractions(false)
        }
        var e = this;
        this._flowLink = function () {
            if (e.isMovingElement() || e.isSelectingElement() || e.isEditingElement() || e._box._layoutMovingElements) {
                return
            }
            if (!this._flowLinkQuickFinder) {
                this._flowLinkQuickFinder = new twaver.QuickFinder(e._box, "link.flow", "style")
            }
            var t = this._flowLinkQuickFinder.find(true);
            t.forEach(function (t) {
                t._styleMap["link.flow.offset"] = e.getLinkFlowOffset(t);
                var i = e.getElementUI(t);
                i.drawBody()
            })
        };
        this.setToolTipEnabled(k.NETWORK_TOOLTIP_ENABLED)
    };
    _twaver.ext("twaver.network.Network", twaver.controls.View, {__accessor: ["selectMode", "makeVisibleOnSelected", "movableFunction", "editPointSize", "editPointFillColor", "editPointOutlineWidth", "editPointOutlineColor", "editLineColor", "editLineWidth", "resizePointFillColor", "resizePointOutlineWidth", "resizePointOutlineColor", "resizeLineColor", "resizeLineWidth", "selectOutlineColor", "selectOutlineWidth", "selectFillColor", "lazyMoveOutlineColor", "lazyMoveOutlineWidth", "lazyMoveFillColor", "rectSelectFilter", "selectionTolerance"], __bool: ["doubleClickToUpSubNetwork", "doubleClickToSubNetwork", "doubleClickToEmptySubNetwork", "doubleClickToLinkBundle", "doubleClickToGroupExpand", "subNetworkAnimate", "lazyMoveAnimate", "resizeAnimate", "noAgentLinkVisible", "keyboardRemoveEnabled", "keyboardSelectEnabled", "sendToTopOnSelected", "lazyMoveFill", "editingElement", "movingElement", "selectingElement", "rectSelectEnabled", "limitElementInPositiveLocation"], _viewRect: {x: 0, y: 0, width: 0, height: 0}, _currentSubNetwork: null, _selectMode: k.NETWORK_SELECT_MODE, _noAgentLinkVisible: k.NETWORK_NO_AGENT_LINK_VISIBLE, _makeVisibleOnSelected: k.NETWORK_MAKE_VISIBLE_ON_SELECTED, _keyboardRemoveEnabled: k.NETWORK_KEYBOARD_REMOVE_ENABLED, _keyboardSelectEnabled: k.NETWORK_KEYBOARD_SELECT_ENABLED, _rectSelectEnabled: k.NETWORK_RECT_SELECT_ENABLED, _rectSelectFilter: null, _subNetworkAnimate: k.NETWORK_SUBNETWORK_ANIMATE, _transparentSelectable: k.NETWORK_TRANSPARENT_SELECTABLE, _removeElementUIOnInvisible: k.NETWORK_REMOVE_ELEMENTUI_ON_INVISIBLE, _elementUIFunction: k.ELEMENTUI_FUNCTION, _doubleClickToUpSubNetwork: k.NETWORK_DOUBLECLICK_TO_UPSUBNETWORK, _doubleClickToSubNetwork: k.NETWORK_DOUBLECLICK_TO_SUBNETWORK, _doubleClickToEmptySubNetwork: k.NETWORK_DOUBLECLICK_TO_EMPTYSUBNETWORK, _doubleClickToLinkBundle: k.NETWORK_DOUBLECLICK_TO_LINKBUNDLE, _doubleClickToGroupExpand: k.NETWORK_DOUBLECLICK_TO_GROUPEXPAND, _sendToTopOnSelected: k.NETWORK_SENDTOTOP_ON_SELECTED, _selectOutlineColor: k.NETWORK_SELECT_OUTLINE_COLOR, _selectOutlineWidth: k.NETWORK_SELECT_OUTLINE_WIDTH, _selectFillColor: k.NETWORK_SELECT_FILL_COLOR, _lazyMoveOutlineColor: k.NETWORK_LAZYMOVE_OUTLINE_COLOR, _lazyMoveOutlineWidth: k.NETWORK_LAZYMOVE_OUTLINE_WIDTH, _lazyMoveFillColor: k.NETWORK_LAZYMOVE_FILL_COLOR, _lazyMoveFill: k.NETWORK_LAZYMOVE_FILL, _lazyMoveAnimate: k.NETWORK_LAZYMOVE_ANIMATE, _editPointSize: k.NETWORK_EDIT_POINT_SIZE, _editPointFillColor: k.NETWORK_EDIT_POINT_FILL_COLOR, _editPointOutlineColor: k.NETWORK_EDIT_POINT_OUTLINE_COLOR, _editPointOutlineWidth: k.NETWORK_EDIT_POINT_OUTLINE_WIDTH, _editLineColor: k.NETWORK_EDIT_LINE_COLOR, _editLineWidth: k.NETWORK_EDIT_LINE_WIDTH, _resizePointFillColor: k.NETWORK_RESIZE_POINT_FILL_COLOR, _resizePointOutlineColor: k.NETWORK_RESIZE_POINT_OUTLINE_COLOR, _resizePointOutlineWidth: k.NETWORK_RESIZE_POINT_OUTLINE_WIDTH, _resizeLineColor: k.NETWORK_RESIZE_LINE_COLOR, _resizeLineWidth: k.NETWORK_RESIZE_LINE_WIDTH, _resizeAnimate: k.NETWORK_RESIZE_ANIMATE, _limitElementInPositiveLocation: k.NETWORK_LIMIT_ELEMENT_INPOSITIVE_LOCATION, _linkFlowInterval: k.NETWORK_LINK_FLOW_INTERVAL, _selectionTolerance: k.NETWORK_SELECTION_TOLERANCE, _invalidate: false, _invalidateElementVisibility: false, _invalidateElementIndex: false, _isEditingElement: false, _isMovingElement: false, _isSelectingElement: false, _hasEditInteraction: false, getLabel: function (t) {
        return t.getStyle("network.label") || t.getName()
    }, isToolTipEnabled: function () {
        return this._toolTipEnabled ? true : false
    }, setToolTipEnabled: function (t) {
        this._toolTipEnabled = t;
        if (t) {
            if (!this._toolTipListener) {
                var e = this;
                this._toolTipListener = function (t) {
                    var i = e.getElementAt(t);
                    if (i) {
                        var n = e.getToolTip(i);
                        w.showToolTip({x: t.pageX, y: t.pageY}, n);
                        var s = w.getToolTipDiv();
                        if (s.children.length > 0) {
                            var r = e._view.getBoundingClientRect();
                            var o = s.getBoundingClientRect();
                            if (o.width + o.left > r.width + r.left) {
                                s.style.left = r.width + r.left - o.width + (document.documentElement.scrollLeft || document.body.scrollLeft) + "px"
                            }
                            if (o.height + o.top > r.height + r.top) {
                                s.style.top = r.height + r.top - o.height + (document.documentElement.scrollTop || document.body.scrollTop) + "px"
                            }
                        }
                        return
                    }
                    w.hideToolTip()
                };
                this._view.addEventListener("mousemove", this._toolTipListener, true);
                this.firePropertyChange("toolTipEnabled", false, true)
            }
        } else {
            if (this._toolTipListener) {
                w.hideToolTip();
                this._view.removeEventListener("mousemove", this._toolTipListener, true);
                delete this._toolTipListener;
                this.firePropertyChange("toolTipEnabled", true, false)
            }
        }
    }, isLinkFlowEnabled: function () {
        return this._linkFlowEnabled ? true : false
    }, setLinkFlowEnabled: function (t) {
        if (t) {
            if (!this._linkFlowEnabled) {
                this._linkFlowEnabled = true;
                this.firePropertyChange("linkFlowEnabled", false, true)
            }
            clearInterval(this._linkFlowTimerId);
            this._linkFlowTimerId = setInterval(this._flowLink, this._linkFlowInterval)
        } else {
            if (this._linkFlowEnabled) {
                this._linkFlowEnabled = false;
                this.firePropertyChange("linkFlowEnabled", true, false)
            }
            clearInterval(this._linkFlowTimerId);
            delete this._linkFlowTimerId
        }
    }, getLinkFlowInterval: function () {
        return this._linkFlowInterval
    }, setLinkFlowInterval: function (t) {
        var e = this._linkFlowInterval;
        this._linkFlowInterval = t;
        this.firePropertyChange("linkFlowInterval", e, t);
        clearInterval(this._linkFlowTimerId);
        if (this.isLinkFlowEnabled()) {
            this._linkFlowTimerId = setInterval(this._flowLink, this._linkFlowInterval)
        }
    }, getTopDiv: function () {
        return this._topDiv
    }, getAttachmentDiv: function () {
        return this._attachmentDiv
    }, getLayersDiv: function () {
        return this._layersDiv
    }, getBottomDiv: function () {
        return this._bottomDiv
    }, validateImpl: function () {
        var t = 0;
        var e = null;
        var i = null;
        var n = null;
        var s = this._invalidateElementVisibility;
        if (this._invalidateElementVisibility) {
            this._invalidateElementVisibility = false;
            if (this._removeElementUIOnInvisible) {
                this._invalidateElementIndex = true
            }
            this.forEachElementUI(function (s) {
                s.validate();
                var r = s.getElement();
                s.setVisible(this.isVisible(r));
                if (this._removeElementUIOnInvisible) {
                    e = this.getLayerDivByElement(r);
                    if (s.isVisible()) {
                        if (s.getView().parentNode !== e) {
                            e.appendChild(s.getView());
                            i = s.getAttachments();
                            for (t = 0; t < i.size(); t++) {
                                n = i.get(t);
                                if (n.isShowInAttachmentDiv()) {
                                    this._attachmentDiv.appendChild(n.getView())
                                }
                            }
                        }
                    } else {
                        if (s.getView().parentNode === e) {
                            e.removeChild(s.getView());
                            i = s.getAttachments();
                            for (t = 0; t < i.size(); t++) {
                                n = i.get(t);
                                if (n.isShowInAttachmentDiv()) {
                                    this._attachmentDiv.removeChild(n.getView())
                                }
                            }
                        }
                    }
                } else {
                    if (!s.getView().parentNode) {
                        e = this.getLayerDivByElement(r);
                        e.appendChild(s.getView());
                        i = s.getAttachments();
                        for (t = 0; t < i.size(); t++) {
                            n = i.get(t);
                            if (n.isShowInAttachmentDiv()) {
                                this._attachmentDiv.appendChild(n.getView())
                            }
                        }
                    }
                }
            }, null, this)
        }
        if (this._invalidateElementIndex) {
            this._invalidateElementIndex = false;
            var r;
            var o = this;
            this._box.getLayerBox().forEachByDepthFirst(function (t) {
                var e = o._layerMap[t.getId()];
                var i;
                o._box.forEachByLayer(function (t) {
                    var n = o._elementUIMap[t.getId()];
                    if (n && n.getView().parentNode === e) {
                        i = l.insertAfter(n.getView(), i);
                        var s = n.getAttachments();
                        for (var a = 0; a < s.size(); a++) {
                            var h = s.get(a);
                            if (h.getView().parentNode === o._attachmentDiv) {
                                r = l.insertAfter(h.getView(), r)
                            }
                        }
                    }
                }, t)
            })
        }
        if (s && !this._invalidateElementVisibility) {
            var a;
            for (var h in this._elementUIMap) {
                var c = this._elementUIMap[h];
                if (c.isVisible()) {
                    a = d.unionRect(a, c.getViewRect())
                }
            }
            if (a) {
                a = {x: 0, y: 0, width: a.x + a.width, height: a.y + a.height}
            } else {
                a = {x: 0, y: 0, width: 0, height: 0}
            }
            if (a.x !== this._viewRect.x || a.y !== this._viewRect.y || a.width !== this._viewRect.width || a.height !== this._viewRect.height) {
                var u = this._viewRect;
                this._viewRect = a;
                this._rootDiv.style.left = "0px";
                this._rootDiv.style.top = "0px";
                this._rootDiv.style.width = a.width + "px";
                this._rootDiv.style.height = a.height + "px";
                this.firePropertyChange("viewRect", u, a)
            }
        }
    }, setInteractions: function (t) {
        var e = this._interactions;
        if (e) {
            e.forEach(function (t) {
                t.tearDown()
            })
        }
        this._interactions = t;
        if (t) {
            t.forEach(function (t) {
                t.setUp()
            })
        }
        this.invalidateSelectedElementUIs(true);
        this.firePropertyChange("interactions", e, t)
    }, getInteractions: function () {
        return this._interactions
    }, upSubNetwork: function (t, e) {
        if (this._currentSubNetwork) {
            this.setCurrentSubNetwork(o.getSubNetwork(this._currentSubNetwork), t, e)
        }
    }, sendToTop: function (t) {
        if (!this.isVisible(t)) {
            return
        }
        var e = t;
        while (this.isVisible(e.getParent())) {
            e = e.getParent();
            if (!e) {
                break
            }
        }
        if (e !== t) {
            this._box.adjustElementIndex(e)
        }
        this._box.adjustElementIndex(t)
    }, invalidateElementIndex: function () {
        if (!this._invalidateElementIndex) {
            this._invalidateElementIndex = true;
            this.invalidate()
        }
    }, invalidateElementVisibility: function () {
        if (!this._invalidateElementVisibility) {
            this._invalidateElementVisibility = true;
            this.invalidate()
        }
    }, updateLayers: function () {
        l.clear(this._layersDiv);
        l.clear(this._attachmentDiv);
        this._layerMap = {};
        this._layerList.clear();
        var t = this;
        this._box.getLayerBox().forEachByDepthFirst(function (e) {
            var i = l.createDiv();
            l.setVisible(i, e.isVisible());
            t._layerMap[e.getId()] = i;
            t._layersDiv.appendChild(i);
            t._layerList.add(e)
        });
        this._box.forEach(this.createElementUI, this)
    }, getCurrentSubNetwork: function () {
        return this._currentSubNetwork
    }, setCurrentSubNetwork: function (t, e, i) {
        var n = twaver.animate.AnimateManager;
        n.endAnimate();
        if (e) {
            if (this._currentSubNetwork === t) {
                return
            }
            if (t && !this._box.contains(t)) {
                throw t + " is not contained in this network's elementBox"
            }
            n.start(new twaver.animate.AnimateSubNetwork(this, t, i))
        } else {
            this._setCurrentSubNetwork(t);
            if (i) {
                i()
            }
        }
    }, _setCurrentSubNetwork: function (t) {
        if (this._currentSubNetwork === t) {
            return
        }
        if (t && !this._box.contains(t)) {
            throw t + " is not contained in this network's elementBox"
        }
        var e = this._currentSubNetwork;
        this._currentSubNetwork = t;
        this.firePropertyChange("currentSubNetwork", e, t);
        this.invalidateElementVisibility()
    }, isVisible: function (t) {
        if (!this._box.contains(t)) {
            return false
        }
        if (this._visibleFunction && !this._visibleFunction(t)) {
            return false
        }
        if (!this._box.getLayerBox().getLayerByElement(t).isVisible()) {
            return false
        }
        if (o.getSubNetwork(t) !== this._currentSubNetwork) {
            return false
        }
        if (t instanceof twaver.Link) {
            if (!this.isNoAgentLinkVisible()) {
                if (!t.getFromAgent() || !t.getToAgent()) {
                    return false
                }
                if (!this.isVisible(t.getFromAgent()) || !this.isVisible(t.getToAgent())) {
                    return false
                }
            }
            if (t.getBundleIndex() > 0 && t.getBundleCount() > 1 && !t.getStyle("link.bundle.expanded")) {
                return false
            }
        } else {
            var e = t.getParent();
            while (e && !e.ISubNetwork) {
                if (e instanceof E) {
                    if (!e.isExpanded() || !this.isVisible(e)) {
                        return false
                    }
                }
                e = e.getParent()
            }
        }
        if (t.IDummy) {
            return false
        }
        return true
    }, isMovable: function (t) {
        if (!this._box.contains(t)) {
            return false
        }
        if (t instanceof twaver.Link) {
            return false
        }
        if (this._movableFunction && !this._movableFunction(t)) {
            return false
        }
        return this._box.getLayerBox().getLayerByElement(t).isMovable()
    }, isEditable: function (t) {
        if (!this._box.contains(t)) {
            return false
        }
        if (this._editableFunction && !this._editableFunction(t)) {
            return false
        }
        return this._box.getLayerBox().getLayerByElement(t).isEditable()
    }, getVisibleFunction: function () {
        return this._visibleFunction
    }, setVisibleFunction: function (t) {
        var e = this._visibleFunction;
        this._visibleFunction = t;
        this.firePropertyChange("visibleFunction", e, t);
        this.invalidateElementVisibility()
    }, getEditableFunction: function () {
        return this._editableFunction
    }, setEditableFunction: function (t) {
        var e = this._editableFunction;
        this._editableFunction = t;
        this.firePropertyChange("editableFunction", e, t);
        this.invalidateSelectedElementUIs(true)
    }, onShareSelectionModelChanged: function () {
        this.invalidateElementUIs()
    }, getElementBox: function () {
        return this._box
    }, setElementBox: function (t) {
        if (!t) {
            throw"ElementBox can not be null"
        }
        if (this._box === t) {
            return
        }
        var e = this._box;
        if (e) {
            e.removeDataBoxChangeListener(this.handleElementBoxChange, this);
            e.removeDataPropertyChangeListener(this.handleElementPropertyChange, this);
            e.removePropertyChangeListener(this.handleElementBoxPropertyChange, this);
            e.removeIndexChangeListener(this.handleIndexChange, this);
            e.getLayerBox().removeDataBoxChangeListener(this.handleLayerBoxChange, this);
            e.getLayerBox().removeDataPropertyChangeListener(this.handleLayerPropertyChange, this);
            e.getLayerBox().removeHierarchyChangeListener(this.handleLayerHierarchyChange, this);
            if (!this._selectionModel) {
                e.getSelectionModel().removeSelectionChangeListener(this.handleSelectionChange, this)
            }
        }
        this._box = t;
        this._box.addDataBoxChangeListener(this.handleElementBoxChange, this);
        this._box.addDataPropertyChangeListener(this.handleElementPropertyChange, this);
        this._box.addPropertyChangeListener(this.handleElementBoxPropertyChange, this);
        this._box.addIndexChangeListener(this.handleIndexChange, this);
        this._box.getLayerBox().addDataBoxChangeListener(this.handleLayerBoxChange, this);
        this._box.getLayerBox().addDataPropertyChangeListener(this.handleLayerPropertyChange, this);
        this._box.getLayerBox().addHierarchyChangeListener(this.handleLayerHierarchyChange, this);
        if (this._selectionModel) {
            this._selectionModel._setDataBox(t)
        } else {
            this._box.getSelectionModel().addSelectionChangeListener(this.handleSelectionChange, this)
        }
        this._elementUIMap = {};
        this.updateLayers();
        this.invalidateElementVisibility();
        this.firePropertyChange("elementBox", e, this._box)
    }, invalidateElementUI: function (t, e) {
        var i = this.getElementUI(t);
        if (i) {
            i.invalidate(e)
        }
    }, invalidateElementUIs: function (t) {
        for (var e in this._elementUIMap) {
            var i = this._elementUIMap[e];
            i.invalidate(t)
        }
    }, invalidateSelectedElementUIs: function (t) {
        this.getSelectionModel().getSelection().forEach(function (e) {
            this.invalidateElementUI(e, t)
        }, this)
    }, getElementUI: function (t) {
        if (!t) {
            return null
        }
        return this._elementUIMap[t.getId()]
    }, getLayerDivByElement: function (t) {
        var e = this._box.getLayerBox().getLayerByElement(t);
        if (!e) {
            return null
        }
        return this._layerMap[e.getId()]
    }, createElementUI: function (t) {
        var e = this._elementUIMap[t.getId()];
        if (!e) {
            e = this._elementUIFunction(this, t);
            if (e) {
                this._elementUIMap[t.getId()] = e
            }
        }
        if (e) {
            var i = this.getLayerDivByElement(t);
            if (e.getView().parentNode !== i) {
                i.appendChild(e.getView());
                e.getAttachments().forEach(function (t) {
                    if (t.isShowInAttachmentDiv() && t.getView().parentNode !== this._attachmentDiv) {
                        this._attachmentDiv.appendChild(t.getView())
                    }
                }, this)
            }
            this.invalidateElementIndex()
        }
    }, invalidateBundleLink: function (t) {
        if (t instanceof twaver.Link && t.getBundleLinks()) {
            t.getBundleLinks().forEachSiblingLink(function (e) {
                if (e !== t) {
                    var i = this.getElementUI(e);
                    if (i) {
                        i.invalidate(false)
                    }
                }
            }, this)
        }
    }, handleLayerBoxChange: function (t) {
        this.updateLayers();
        this.invalidateElementVisibility()
    }, handleLayerPropertyChange: function (t) {
        var e = t.source;
        if (t.property === "visible") {
            var i = this._layerMap[e.getId()];
            l.setVisible(i, e.isVisible())
        } else if (t.property === "editable") {
            this.invalidateSelectedElementUIs(true)
        }
        this.invalidateElementVisibility()
    }, handleLayerHierarchyChange: function (t) {
        var e = 0;
        var i;
        this._layerList.clear();
        this._box.getLayerBox().forEachByDepthFirst(function (t) {
            var e = this._layerMap[t.getId()];
            i = l.insertAfter(e, i);
            this._layerList.add(t)
        }, null, this);
        this.invalidateElementVisibility()
    }, handleSelectionChange: function (t) {
        t.datas.forEach(function (e) {
            var i = this.getElementUI(e);
            if (i) {
                i.handleSelectionChange(t)
            }
        }, this);
        this.invalidateElementVisibility();
        var e = this.getSelectionModel().getLastData();
        if (e) {
            if (t.kind === "append" || t.kind === "set") {
                if (this.isMakeVisibleOnSelected()) {
                    this.makeVisible(e)
                }
                if (this.isSendToTopOnSelected()) {
                    this.sendToTop(e)
                }
            }
        }
    }, makeVisible: function (t) {
        var e = this.getElementUI(t);
        if (!e) {
            return
        }
        var i = o.getSubNetwork(t);
        if (i !== this._currentSubNetwork) {
            var n = this;
            this.setCurrentSubNetwork(i, this.isSubNetworkAnimate(), function () {
                _twaver.callLater(n.makeVisible, n, [t])
            });
            return
        }
        var s = t;
        while ((s = s.getParent()) && s !== i) {
            if (s instanceof E) {
                s.setExpanded(true)
            }
        }
        var r = e.getUnionBodyBounds();
        if (!r) {
            return
        }
        var a = {x: this._view.scrollLeft / this._zoom, y: this._view.scrollTop / this._zoom, width: this._view.clientWidth / this._zoom, height: this._view.clientHeight / this._zoom};
        if (!d.intersects(a, r)) {
            if (this.isVisible(t)) {
                _twaver.callLater(this.centerByLogicalPoint, this, [r.x + r.width / 2, r.y + r.height / 2])
            }
        }
    }, handleElementBoxChange: function (t) {
        var e = t.data;
        if (t.kind === "add") {
            this.createElementUI(e);
            this.invalidateBundleLink(e)
        } else if (t.kind === "remove") {
            var i = this.getElementUI(e);
            if (i) {
                var n = this._box.getLayerBox().getLayerByElement(e);
                var s = this._layerMap[n.getId()];
                if (i.getView().parentNode === s) {
                    s.removeChild(i.getView())
                }
                i.dispose();
                delete this._elementUIMap[e.getId()]
            }
            if (e === this._currentSubNetwork && this._currentSubNetwork != null) {
                this._setCurrentSubNetwork(null)
            }
        } else if (t.kind === "clear") {
            this.forEachElementUI(function (t) {
                t.dispose()
            });
            this._elementUIMap = {};
            this.updateLayers();
            if (this._currentSubNetwork != null) {
                this._setCurrentSubNetwork(null)
            }
        }
        this.invalidateElementVisibility()
    }, handleElementPropertyChange: function (t) {
        var e = t.source;
        var i = this.getElementUI(e);
        if (i) {
            i.handlePropertyChange(t);
            if (t.property === "layerId") {
                var n = this._box.getLayerBox().getLayerByElement(e);
                var s = this._layerMap[n.getId()];
                if (i.getView().parentNode !== s) {
                    s.appendChild(i.getView());
                    this.invalidateElementIndex()
                }
            }
        }
        this.invalidateBundleLink(e);
        this.invalidateElementVisibility()
    }, handleElementBoxPropertyChange: function (t) {
        this.invalidateElementVisibility()
    }, handleIndexChange: function (t) {
        this.invalidateElementIndex()
    }, getElementUIFunction: function () {
        return this._elementUIFunction
    }, setElementUIFunction: function (t) {
        if (!t) {
            throw"ElementUIFunction can not be null"
        }
        if (this._elementUIFunction === t) {
            return
        }
        var e = this._elementUIFunction;
        this._elementUIFunction = t;
        this.firePropertyChange("elementUIFunction", e, t);
        if (!this._box.isEmpty()) {
            this.updateLayers()
        }
    }, getIconsNames: function (t) {
        return t.getStyle("icons.names")
    }, getIconsColors: function (t) {
        return t.getStyle("icons.colors")
    }, getLinkHandlerLabel: function (t) {
        if (t.isBundleAgent()) {
            return"+(" + t.getBundleCount() + ")"
        }
        return null
    }, getSelectColor: function (t) {
        return t.getStyle("select.color")
    }, getShadowColor: function (t) {
        var e = t.getStyle("shadow.color");
        if (!e && this.isSelected(t) && t.getStyle("select.style") === "shadow") {
            return t.getStyle("select.color")
        }
        return e
    }, getAlarmLabel: function (t) {
        var e = t.getAlarmState().getHighestNewAlarmSeverity();
        if (e) {
            var i = t.getAlarmState().getNewAlarmCount(e) + e.nickName;
            if (t.getAlarmState().hasLessSevereNewAlarms()) {
                i += "+"
            }
            return i
        }
        return null
    }, isRemoveElementUIOnInvisible: function () {
        return this._removeElementUIOnInvisible
    }, setRemoveElementUIOnInvisible: function (t) {
        var e = this._removeElementUIOnInvisible;
        this._removeElementUIOnInvisible = t;
        this.firePropertyChange("removeElementUIOnInvisible", e, t);
        this.invalidateElementVisibility()
    }, setDefaultInteractions: function (t) {
        this.setInteractions([new twaver.network.interaction.SelectInteraction(this), new twaver.network.interaction.MoveInteraction(this, t), new twaver.network.interaction.DefaultInteraction(this)])
    }, setPanInteractions: function () {
        this.setInteractions([new twaver.network.interaction.PanInteraction(this), new twaver.network.interaction.DefaultInteraction(this)])
    }, setEditInteractions: function (t) {
        this.setInteractions([new twaver.network.interaction.SelectInteraction(this), new twaver.network.interaction.EditInteraction(this, t), new twaver.network.interaction.MoveInteraction(this, t), new twaver.network.interaction.DefaultInteraction(this)])
    }, setCreateElementInteractions: function (t) {
        this.setInteractions([new twaver.network.interaction.CreateElementInteraction(this, t), new twaver.network.interaction.DefaultInteraction(this)])
    }, setCreateLinkInteractions: function (t) {
        this.setInteractions([new twaver.network.interaction.CreateLinkInteraction(this, t), new twaver.network.interaction.DefaultInteraction(this)])
    }, setCreateShapeLinkInteractions: function (t) {
        this.setInteractions([new twaver.network.interaction.CreateShapeLinkInteraction(this, t), new twaver.network.interaction.DefaultInteraction(this)])
    }, setCreateShapeNodeInteractions: function (t) {
        this.setInteractions([new twaver.network.interaction.CreateShapeNodeInteraction(this, t), new twaver.network.interaction.DefaultInteraction(this)])
    }, setTouchInteractions: function () {
        this.setInteractions([new twaver.network.interaction.TouchInteraction(this)])
    }, setMSTouchInteractions: function () {
        this.setInteractions([new twaver.network.interaction.MSTouchInteraction(this)])
    }, hasEditInteraction: function () {
        return this._hasEditInteraction
    }, setHasEditInteraction: function (t) {
        var e = this._hasEditInteraction;
        this._hasEditInteraction = t;
        this.firePropertyChange("hasEditInteraction", e, t)
    }, moveSelectedElements: function (t, e, i, n) {
        if (t === 0 && e === 0) {
            return
        }
        var s = this.getMovableSelectedElementsRect();
        if (s == null) {
            return
        }
        if (this._limitElementInPositiveLocation) {
            if (s.x + t < 0) {
                t = -s.x
            }
            if (s.y + e < 0) {
                e = -s.y
            }
        }
        twaver.Util.moveElements(this.getMovableSelectedElements(), t, e, i, n, this)
    }, getMovableSelectedElements: function () {
        return this.getSelectionModel().toSelection(function (t) {
            return this.isMovable(t)
        }, this)
    }, hasMovableSelectedElements: function () {
        var t = this.getSelectionModel().getSelection();
        for (var e = 0; e < t.size(); e++) {
            var i = t.get(e);
            if (this.isMovable(i)) {
                return true
            }
        }
        return false
    }, getMovableSelectedElementsRect: function () {
        var t = this.getMovableSelectedElements();
        if (t.size() === 0) {
            return null
        }
        var e = null;
        for (var i = 0, n = t.size(); i < n; i++) {
            var s = t.get(i);
            if (s instanceof y) {
                var r = this.getElementUI(s);
                if (r) {
                    e = d.unionRect(e, r.getViewRect())
                }
            }
        }
        return e
    }, getLayerByElement: function (t) {
        return this._box.getLayerBox().getLayerByElement(t)
    }, getPosition: function (t, e, i, n, s) {
        var r;
        var o = e instanceof twaver.network.ElementUI ? e : this.getElementUI(e);
        if (o) {
            if (t === "from" || t === "to") {
                if (o.getFromPosition) {
                    r = t === "from" ? o.getFromPosition(n, s) : o.getToPosition(n, s);
                    if (r) {
                        return{x: r.x - i.width / 2, y: r.y - i.height / 2}
                    }
                }
            } else if (t === "hotspot") {
                r = o.getHotSpot()
            } else {
                r = f.get(t, o.getBodyRect(), i)
            }
        }
        if (!r && e.getRect) {
            r = f.get(t, e.getRect(), i)
        }
        if (r) {
            return{x: r.x + n, y: r.y + s}
        }
        throw"position '" + t + "' object '" + e + "'"
    }, getViewRect: function () {
        if (this._viewRect) {
            return _twaver.clone(this._viewRect)
        }
        return{x: 0, y: 0, width: 0, height: 0}
    }, forEachElementUI: function (t, e, i) {
        if (e) {
            this._box.forEachReverse(function (n) {
                if (this.getLayerByElement(n) === e) {
                    var s = this.getElementUI(n);
                    if (s) {
                        if (i) {
                            t.call(i, s)
                        } else {
                            t(s)
                        }
                    }
                }
            }, this)
        } else {
            this._layerList.forEachReverse(function (e) {
                this.forEachElementUI(t, e, i)
            }, this)
        }
    }, findFirstElement: function (t, e) {
        var i = this._layerList.size() - 1;
        var n = this._box.size() - 1;
        for (var s = i; s >= 0; s--) {
            var r = this._layerList.get(s);
            for (var o = n; o >= 0; o--) {
                var a = this._box.getDataAt(o);
                if (this.getLayerByElement(a) === r) {
                    if (e) {
                        if (t.call(e, a) === true) {
                            return a
                        }
                    } else {
                        if (t(a) === true) {
                            return a
                        }
                    }
                }
            }
        }
        return null
    }, getElementAt: function (t, e) {
        if (arguments.length === 1) {
            e = true
        }
        if (!this.isValidEvent(t)) {
            return null
        }
        t = this._getPoint(t);
        if (!t) {
            console.log("null")
        }
        var i = t.x, n = t.y;
        var s = this._selectionTolerance;
        if (s && s > 0) {
            var r = {x: i, y: n, width: 0, height: 0};
            d.grow(r, s, s)
        }
        return this.findFirstElement(function (t) {
            if (e && !this.isSelectable(t)) {
                return false
            }
            var s = this.getElementUI(t);
            if (s) {
                if (r) {
                    return!!s.intersectsTest(r)
                } else {
                    return!!s.hitTest(i, n)
                }
            }
            return false
        }, this)
    }, _getPoint: function (t) {
        if (!t) {
            return null
        }
        if (t.target) {
            return this.getLogicalPoint(t)
        } else {
            return t
        }
    }, getElementsAtRect: function (t, e, i) {
        var n = new p;
        this.forEachElementUI(function (s) {
            if (s.isVisible() && (!i || i(s._element))) {
                if (e) {
                    if (s.intersectsTest(t)) {
                        n.add(s._element)
                    }
                } else {
                    if (d.contains(t, s.getViewRect())) {
                        n.add(s._element)
                    }
                }
            }
        }, null, this);
        return n
    }, hitTest: function (t) {
        var e = this.getElementAt(t);
        if (!e) {
            return null
        }
        var i = this.getElementUI(e);
        if (!i) {
            return null
        }
        t = this._getPoint(t);
        return i.hitTest(t.x, t.y)
    }, addElementByInteraction: function (t) {
        if (!t.getParent()) {
            t.setParent(this._currentSubNetwork)
        }
        this._box.add(t);
        this.getSelectionModel().setSelection(t);
        this.fireInteractionEvent({kind: "createElement", element: t})
    }, getLinkFlowStepping: function (t) {
        var e = parseInt(t.getStyle("link.flow.stepping"));
        if (!e) {
            e = k.NETWORK_LINK_FLOW_STEPPING
        }
        return e
    }, getLinkFlowOffset: function (t) {
        var e = t.getStyle("link.flow.offset");
        if (isNaN(e)) {
            e = 0
        }
        return e + this.getLinkFlowStepping(t)
    }, toCanvas: function (t, e, i) {
        if (!i) {
            i = l.createCanvas()
        }
        i.setAttribute("width", t);
        i.setAttribute("height", e);
        if (i._viewRect) {
            i._viewRect.width = t;
            i._viewRect.height = e
        } else {
            i._viewRect = {x: 0, y: 0, width: t, height: e}
        }
        var n = i.getContext("2d");
        n.clearRect(0, 0, t, e);
        if (this._view.clientWidth === 0 || this._view.clientHeight === 0) {
            return i
        }
        var s = t / this._view.scrollWidth * this._zoom;
        var r = e / this._view.scrollHeight * this._zoom;
        n.scale(s, r);
        l.forEach(this._view, function (t) {
            if ((t.tagName === "CANVAS" || t.tagName === "IMG") && !t._isIgnored) {
                var e = t._viewRect;
                if (e) {
                    try {
                        n.drawImage(t, e.x, e.y, e.width, e.height)
                    } catch (t) {
                    }
                }
            }
        });
        return i
    }, toCanvasByRegion: function (t, e, i) {
        if (!i) {
            i = l.createCanvas()
        }
        var n = t.width * e;
        var s = t.height * e;
        i.setAttribute("width", n);
        i.setAttribute("height", s);
        if (i._viewRect) {
            i._viewRect.width = n;
            i._viewRect.height = s
        } else {
            i._viewRect = {x: 0, y: 0, width: n, height: s}
        }
        var r = i.getContext("2d");
        r.clearRect(0, 0, n, s);
        if (this._view.clientWidth === 0 || this._view.clientHeight === 0) {
            return i
        }
        r.scale(e, e);
        r.arc(t.width / 2, t.height / 2, Math.min(t.width, t.height) / 2, 0, Math.PI * 2, true);
        r.clip();
        r.beginPath();
        l.forEach(this._view, function (e) {
            if ((e.tagName === "CANVAS" || e.tagName === "IMG") && !e._isIgnored) {
                var i = e._viewRect;
                if (i && d.intersects(i, t)) {
                    try {
                        r.drawImage(e, i.x - t.x, i.y - t.y, i.width, i.height)
                    } catch (e) {
                    }
                }
            }
        });
        return i
    }, getGroupChildrenRects: function (t) {
        var e = new p;
        t.getChildren().forEach(function (t) {
            if (t instanceof y) {
                var i = this.getElementUI(t);
                if (i) {
                    var n = i.getViewRect();
                    if (n) {
                        e.add(n)
                    }
                }
            }
        }, this);
        return e
    }});
    twaver.network.Overview = function (t) {
        twaver.network.Overview.superClass.constructor.apply(this, arguments);
        this._view = l.createView();
        this._rootDiv = l.createDiv();
        this._imageCanvas = l.createCanvas();
        this._imageDiv = l.createDiv();
        this._maskCanvas = l.createCanvas();
        this._selectDiv = l.createDiv();
        this._isNetworkDirty = false;
        this._isMaskDirty = false;
        l.setVisible(this._selectDiv, false);
        this._view.appendChild(this._rootDiv);
        this._rootDiv.appendChild(this._imageDiv);
        this._rootDiv.appendChild(this._maskCanvas);
        this._rootDiv.appendChild(this._selectDiv);
        this._imageDiv.appendChild(this._imageCanvas);
        this.setNetwork(t);
        var e;
        if (m.isMSToucheable) {
            e = twaver.network.OverviewMSTouchInteraction
        } else if (m.isTouchable) {
            e = twaver.network.OverviewTouchInteraction
        } else {
            e = twaver.network.OverviewInteraction
        }
        if (e) {
            new e(this)
        }
    };
    _twaver.ext("twaver.network.Overview", twaver.controls.ControlBase, {__accessor: ["fillColor", "outlineColor", "outlineWidth", "selectColor", "selectWidth", "padding", "maxPackingWidth", "maxPackingHeight"], __bool: ["animate"], _fillColor: k.OVERVIEW_FILL_COLOR, _outlineColor: k.OVERVIEW_OUTLINE_COLOR, _outlineWidth: k.OVERVIEW_OUTLINE_WIDTH, _selectColor: k.OVERVIEW_SELECT_COLOR, _selectWidth: k.OVERVIEW_SELECT_WIDTH, _padding: k.OVERVIEW_PADDING, _animate: k.OVERVIEW_ANIMATE, _maxPackingWidth: k.OVERVIEW_MAX_PACKING_WIDTH, _maxPackingHeight: k.OVERVIEW_MAX_PACKING_HEIGHT, getNetwork: function () {
        return this._network
    }, onPropertyChanged: function (t) {
        this._invalidateMask()
    }, setNetwork: function (t) {
        if (t === this._network) {
            return
        }
        if (this._network) {
            this._network.removePropertyChangeListener(this._handleNetworkPropertyChange, this);
            this._network.removeViewListener(this._handleNetworkViewChange, this);
            l.removeEventListener("scroll", "_handleScrollChange", this._network.getView(), this)
        }
        this._network = t;
        if (this._network) {
            this._network.addPropertyChangeListener(this._handleNetworkPropertyChange, this);
            this._network.addViewListener(this._handleNetworkViewChange, this);
            l.addEventListener("scroll", "_handleScrollChange", this._network.getView(), this)
        }
        this.invalidate()
    }, _handleNetworkPropertyChange: function (t) {
        if (t.property === "zoom" || t.property === "currentSubNetwork" || t.property === "elementBox" || t.property === "dataBox") {
            this.invalidate()
        }
    }, _handleNetworkViewChange: function (t) {
        if (t.kind === "validateEnd") {
            this.invalidate()
        }
    }, _handleScrollChange: function () {
        this._invalidateMask()
    }, invalidate: function (t) {
        if (!this._isNetworkDirty || !this._isMaskDirty) {
            if (!this._isNetworkDirty) {
                this._isNetworkDirty = true
            }
            if (!this._isMaskDirty) {
                this._isMaskDirty = true
            }
            _twaver.callLater(this.validate, this, null, t)
        }
    }, _invalidateMask: function () {
        if (!this._isMaskDirty) {
            this._isMaskDirty = true;
            _twaver.callLater(this.validate, this, [], 100)
        }
    }, validate: function () {
        if ((this._isMaskDirty || this._isNetworkDirty) && this._network && (this._maxPackingWidth > 0 && this._maxPackingHeight > 0 || this._view.clientWidth > 0 && this._view.clientHeight > 0) && this._network._view.clientWidth !== 0 && this._network._view.clientHeight !== 0) {
            var t = this._maxPackingWidth > 0 && this._maxPackingHeight > 0;
            var e;
            if (t) {
                e = {x: 0, y: 0, width: this._maxPackingWidth, height: this._maxPackingHeight}
            } else {
                e = {x: 0, y: 0, width: this._view.clientWidth, height: this._view.clientHeight}
            }
            d.grow(e, -this._padding, -this._padding);
            var i = Math.min(e.width / this._network._view.scrollWidth, e.height / this._network._view.scrollHeight);
            if (t) {
                l.setDiv(this._view, {x: 0, y: 0, width: this._imageDiv._viewRect.width, height: this._imageDiv._viewRect.height}, null, 0, null);
                e.width = this._imageDiv._viewRect.width;
                e.height = this._imageDiv._viewRect.height
            }
            var n = this._network._view.scrollWidth * i;
            var s = this._network._view.scrollHeight * i;
            var r = e.x + (e.width - n) / 2;
            var o = e.y + (e.height - s) / 2;
            if (this._isNetworkDirty) {
                var h = {x: r, y: o, width: n, height: s};
                this._network.toCanvas(h.width, h.height, this._imageCanvas);
                l.setDiv(this._imageDiv, h, null, 0, null);
                if (this._network.getElementBox) {
                    this._imageDiv.style.backgroundColor = (this._network.getCurrentSubNetwork() || this._network.getElementBox()).getStyle("background.color") || ""
                }
                this._isNetworkDirty = false
            }
            if (this._isMaskDirty) {
                var c = {x: this._network._view.scrollLeft * i, y: this._network._view.scrollTop * i, width: n * this._network._view.clientWidth / this._network._view.scrollWidth, height: s * this._network._view.clientHeight / this._network._view.scrollHeight};
                var u = l.setCanvas(this._maskCanvas, r, o, n, s);
                u.lineWidth = 0;
                u.fillStyle = this._fillColor;
                a.drawVector(u, "rectangle", null, r, o, n, s);
                u.closePath();
                u.fill();
                u.stroke();
                u.clearRect(r + c.x, o + c.y, c.width, c.height);
                u.lineWidth = this._outlineWidth;
                u.strokeStyle = this._outlineColor;
                a.drawVector(u, "rectangle", null, r + c.x + this._outlineWidth, o + c.y + this._outlineWidth, c.width - this._outlineWidth * 2, c.height - this._outlineWidth * 2);
                u.closePath();
                u.stroke();
                this._isMaskDirty = false
            }
        } else {
            this._isNetworkDirty = false;
            this._isMaskDirty = false
        }
    }, getLogicalPoint: function (t) {
        return l.getLogicalPoint(this._view, t, 1, this._rootDiv)
    }, centerNetwork: function (t, e) {
        var i = this._imageDiv._viewRect;
        if (d.containsPoint(i, t)) {
            this._network.centerByLogicalPoint((t.x - i.x) / i.width * this._network._view.scrollWidth / this._network.getZoom(), (t.y - i.y) / i.height * this._network._view.scrollHeight / this._network.getZoom(), e);
            this._invalidateMask()
        }
    }});
    twaver.network.OverviewTouchInteraction = function (t) {
        this.overview = t;
        this.network = t.getNetwork();
        this.view = t._view;
        l.addEventListener("touchstart", "handleTouchstart", this.view, this)
    };
    _twaver.ext("twaver.network.OverviewTouchInteraction", Object, {handleTouchstart: function (t) {
        l.preventDefault(t);
        this.clear();
        this.endPoint = this.overview.getLogicalPoint(t);
        if (g.isMultiTouch(t)) {
            this.distance = g.getDistance(t);
            this.zoom = this.network.getZoom()
        }
        l.addEventListener("touchmove", "handleTouchmove", this.view, this);
        l.addEventListener("touchend", "handleTouchend", this.view, this)
    }, handleTouchmove: function (t) {
        l.preventDefault(t);
        if (!this.moved) {
            this.moved = true
        }
        this.endPoint = this.overview.getLogicalPoint(t);
        if (g.isSingleTouch(t)) {
            this.overview.centerNetwork(this.endPoint, false)
        } else {
            if (this.distance) {
                var e = g.getDistance(t) / this.distance;
                this.network.setZoom(this.zoom * e, false)
            }
        }
    }, handleTouchend: function (t) {
        if (!this.moved) {
            this.endPoint = this.overview.getLogicalPoint(t);
            var e = this.lastPoint && this.lastTouchStartTime && (new Date).getTime() - this.lastTouchStartTime.getTime() <= 300 && Math.abs(this.endPoint.x - this.lastPoint.x) <= 10 && Math.abs(this.endPoint.y - this.lastPoint.y) <= 10;
            if (e) {
                this.lastPoint = null;
                this.lastTouchStartTime = null
            } else {
                this.lastPoint = this.endPoint;
                this.lastTouchStartTime = new Date
            }
            if (e) {
                _twaver.callLater(this.network.zoomReset, this.network, [this.overview._animate])
            } else {
                this.overview.centerNetwork(this.endPoint, this.overview._animate)
            }
        }
        this.clear()
    }, clear: function () {
        if (this.endPoint) {
            this.endPoint = null;
            l.removeEventListener("touchmove", this.view, this);
            l.removeEventListener("touchend", this.view, this)
        }
        this.moved = false
    }});
    twaver.network.OverviewInteraction = function (t) {
        this.overview = t;
        this.network = t.getNetwork();
        this.view = t._view;
        l.addEventListener("mousedown", "handleMousedown", this.view, this)
    };
    _twaver.ext("twaver.network.OverviewInteraction", Object, {handleMousedown: function (t) {
        this.clear();
        this.endPoint = this.overview.getLogicalPoint(t);
        if (_twaver.isCtrlDown(t)) {
            this.startPoint = this.endPoint;
            l.setVisible(this.overview._selectDiv, true)
        }
        l.addEventListener("mousemove", "handleMousemove", this.view, this);
        l.addEventListener("mouseup", "handleMouseup", this.view, this)
    }, handleMouseup: function (t) {
        this.endPoint = this.overview.getLogicalPoint(t);
        if ("detail"in t && t.detail === 2) {
            _twaver.callLater(this.network.zoomReset, this.network, [this.overview._animate])
        } else {
            if (l.isVisible(this.overview._selectDiv) && this.startPoint) {
                var e = this.overview._imageDiv._viewRect;
                var i = this.overview._selectDiv._viewRect.x;
                var n = this.overview._selectDiv._viewRect.y;
                var s = e.width / this.overview._selectDiv._viewRect.width;
                var r = e.height / this.overview._selectDiv._viewRect.height;
                var o = Math.min(s, r);
                var a = this.network._view.scrollWidth / this.network.getZoom() * ((i - e.x + this.overview._selectDiv._viewRect.width / 2) / e.width);
                var h = this.network._view.scrollHeight / this.network.getZoom() * ((n - e.y + this.overview._selectDiv._viewRect.height / 2) / e.height);
                this.network.setZoom(o * Math.min(this.network._view.clientWidth / this.network._view.scrollWidth, this.network._view.clientHeight / this.network._view.scrollHeight) * this.network.getZoom(), false);
                _twaver.callLater(this.network.centerByLogicalPoint, this.network, [a, h, this.overview._animate]);
                l.setVisible(this.overview._selectDiv, false);
                l.setDiv(this.overview._selectDiv, {x: 0, y: 0, width: 0, height: 0}, null, 0, null);
                this.startPoint = null
            } else {
                this.overview.centerNetwork(this.endPoint, this.overview._animate)
            }
        }
        this.clear()
    }, handleMousemove: function (t) {
        var e = this.overview.getLogicalPoint(t);
        this.endPoint = e;
        if (l.isVisible(this.overview._selectDiv) && this.startPoint) {
            var i = e.x > this.startPoint.x ? this.startPoint.x : e.x;
            var n = e.x > this.startPoint.x ? this.startPoint.y : e.y;
            if (e.x > this.startPoint.x && e.y < this.startPoint.y) {
                n = e.y
            }
            if (e.x < this.startPoint.x && e.y > this.startPoint.y) {
                n = this.startPoint.y
            }
            var s = this.overview._imageDiv._viewRect;
            if (i < s.x) {
                i = s.x
            }
            if (i > s.x + s.width) {
                i = s.x + s.width
            }
            if (n < s.y) {
                n = s.y
            }
            if (n > s.y + s.height) {
                n = s.y + s.height
            }
            var r = Math.abs(e.x - this.startPoint.x);
            var o = Math.abs(e.y - this.startPoint.y);
            if (i + r > s.x + s.width) {
                r = s.x + s.width - i
            }
            if (n + o > s.y + s.height) {
                o = s.y + s.height - n
            }
            l.setDiv(this.overview._selectDiv, {x: i, y: n, width: r, height: o}, null, this.overview._selectWidth, this.overview._selectColor)
        } else {
            this.overview.centerNetwork(e, false)
        }
    }, clear: function () {
        if (this.endPoint) {
            this.endPoint = null;
            l.removeEventListener("mousemove", this.view, this);
            l.removeEventListener("mouseup", this.view, this)
        }
    }});
    twaver.network.OverviewMSTouchInteraction = function (t) {
        this.overview = t;
        this.network = t.getNetwork();
        this.view = t._view;
        this._pointerMap = {};
        this._pointerIdArray = [];
        var e = this;
        this.view.addEventListener("MSPointerDown", function (t) {
            e.handleTouchstart(t)
        }, false);
        this.view.addEventListener("MSPointerMove", function (t) {
            e.handleTouchmove(t)
        }, false);
        this.view.addEventListener("MSPointerUp", function (t) {
            e.handleTouchend(t)
        }, false);
        this.view.addEventListener("MSPointerCancel", function (t) {
            e.handleTouchend(t)
        }, false)
    };
    _twaver.ext("twaver.network.OverviewMSTouchInteraction", Object, {handleTouchstart: function (t) {
        l.preventDefault(t);
        if (t.isPrimary && this._pointerIdArray.length > 0) {
            this._pointerMap = {};
            this._pointerIdArray = []
        }
        if (!this._pointerMap[t.pointerId] && this.overview.getLogicalPoint(t)) {
            this._pointerIdArray.push(t.pointerId);
            this._pointerMap[t.pointerId] = t
        }
        if (this._pointerIdArray.length == 1) {
            this._startTouchPoint = this.overview.getLogicalPoint(t);
            this._startTouchTime = new Date
        } else if (this._pointerIdArray.length == 2) {
            this._distance = this._getDistance();
            this._zoom = this.network.getZoom()
        }
    }, handleTouchmove: function (t) {
        if (this._pointerIdArray.length == 0 || !this._pointerMap[t.pointerId] || d.getDistance({x: this._pointerMap[t.pointerId].pageX, y: this._pointerMap[t.pointerId].pageY}, {x: t.pageX, y: t.pageY}) <= 10) {
            return
        }
        this._pointerMap[t.pointerId] = t;
        if (this._pointerIdArray.length == 2) {
            var e = this._getDistance() / this._distance;
            this.network.setZoom(this._zoom * e, false)
        } else if (this._pointerIdArray.length == 1) {
            if (this._startTouchPoint) {
                var i = this.overview.getLogicalPoint(t);
                if (i == null) {
                    return
                }
                this._startTouchPoint = i;
                this.overview.centerNetwork(this._startTouchPoint, false)
            }
        }
    }, handleTouchend: function (t) {
        var e = this.overview.getLogicalPoint(t);
        if (this._pointerIdArray.length == 1 && e) {
            var i = this._endTouchPoint && this._endTouchTime && (new Date).getTime() - this._endTouchTime.getTime() <= 500 && d.getDistance(this._endTouchPoint, e) <= 10;
            if (i) {
                this._endTouchPoint = null;
                this._endTouchTime = null
            } else {
                this._endTouchPoint = e;
                this._endTouchTime = new Date
            }
            if (i) {
                _twaver.callLater(this.network.zoomReset, this.network, [this.overview._animate])
            } else {
                this.overview.centerNetwork(this._endTouchPoint, this.overview._animate)
            }
        }
        this._pointerMap = {};
        this._pointerIdArray = []
    }, _getDistance: function () {
        return d.getDistance({x: this._pointerMap[this._pointerIdArray[0]].pageX, y: this._pointerMap[this._pointerIdArray[0]].pageY}, {x: this._pointerMap[this._pointerIdArray[1]].pageX, y: this._pointerMap[this._pointerIdArray[1]].pageY})
    }});
    twaver.network.ElementUI = function (t, e) {
        this._view = l.createDiv();
        this._bodyView = l.createDiv();
        this._view.appendChild(this._bodyView);
        this._network = t;
        this._element = e;
        this._attachments = new p;
        this._bodyBounds = new p;
        this.invalidate(true)
    };
    _twaver.ext("twaver.network.ElementUI", Object, {_invalidateFlag: false, _invalidateAttachmentsFlag: false, getElement: function () {
        return this._element
    }, getNetwork: function () {
        return this._network
    }, getAttachments: function () {
        return this._attachments
    }, getStyle: function (t) {
        return this._element.getStyle(t)
    }, getFont: function (t) {
        var e = this._element.getStyle(t);
        return e ? e : k.FONT
    }, getDyeColor: function (t) {
        if (this._innerColor) {
            return this._innerColor
        }
        return this.getStyle(t)
    }, getInnerColor: function () {
        return this._innerColor
    }, getOuterColor: function () {
        return this._outerColor
    }, getShadowColor: function () {
        return this._shadowColor
    }, getLabelAttachment: function () {
        return this._labelAttachment
    }, getAlarmAttachment: function () {
        return this._alarmAttachment
    }, getIconsAttachment: function () {
        return this._iconsAttachment
    }, getEditAttachment: function () {
        return this._editAttachment
    }, getHotSpot: function () {
        if (this._hotSpot) {
            return _twaver.clone(this._hotSpot)
        }
        return{x: 0, y: 0}
    }, setHotSpot: function (t) {
        this._hotSpot = t
    }, getUnionBodyBounds: function () {
        return _twaver.clone(this._unionBodyBounds)
    }, getBodyRect: function () {
        if (!this._bodyRect) {
            this._bodyRect = this.createBodyRect()
        }
        return _twaver.clone(this._bodyRect)
    }, invalidate: function (t) {
        if (t === e) {
            t = true
        }
        if (t) {
            this._invalidateAttachmentsFlag = true
        }
        if (this._invalidateFlag) {
            return
        }
        this._bodyRect = null;
        this._invalidateFlag = true;
        this._network.invalidateElementVisibility()
    }, updateMeasure: function () {
    }, validate: function () {
        if (!this._invalidateFlag) {
            return
        }
        if (this._invalidateAttachmentsFlag) {
            this._invalidateAttachmentsFlag = false;
            this.checkAttachments()
        }
        this._invalidateFlag = false;
        this._bodyBounds.clear();
        l.clear(this._bodyView);
        this._innerColor = this._network.getInnerColor(this._element);
        this._outerColor = this._network.getOuterColor(this._element);
        this._shadowColor = this._network.getShadowColor(this._element);
        this._shadowXOffset = this._element.getStyle("shadow.xoffset");
        this._shadowYOffset = this._element.getStyle("shadow.yoffset");
        this._shadowBlur = this._element.getStyle("shadow.blur");
        this.updateMeasure();
        var t = this._element.getStyle("whole.alpha");
        this._view.style.opacity = t;
        this._attachments.forEach(function (e) {
            e.updateMeasure();
            var i = e.getAlpha();
            if (e.isShowInAttachmentDiv()) {
                e._view.style.opacity = i * t
            } else {
                e._view.style.opacity = i
            }
        });
        var e;
        this._bodyBounds.forEach(function (t) {
            e = d.unionRect(e, t)
        });
        this._unionBodyBounds = _twaver.clone(e);
        this._attachments.forEach(function (t) {
            e = d.unionRect(e, t.getViewRect())
        });
        this._viewRect = e
    }, cleanUp: function (t) {
        var e = t.length;
        for (var i = 0; i < e; i++) {
            var n = t[i];
            var s = this[n];
            if (s && !s.parentNode) {
                this[n] = null
            }
        }
    }, setVisible: function (t) {
        if (this.isVisible() === t) {
            return
        }
        l.setVisible(this._view, t);
        this._attachments.forEach(function (e) {
            if (e.isShowInAttachmentDiv()) {
                l.setVisible(e._view, t)
            }
        });
        this.invalidate(true)
    }, isVisible: function () {
        return l.isVisible(this._view)
    }, checkAttachments: function () {
        this.checkLabelAttachment();
        this.checkAlarmAttachment();
        this.checkIconsAttachment();
        this.checkEditAttachment()
    }, checkLabelAttachment: function () {
        var t = this._network.getLabel(this._element);
        if (t != null && t !== "") {
            if (!this._labelAttachment) {
                this._labelAttachment = new twaver.network.LabelAttachment(this);
                this.addAttachment(this._labelAttachment)
            }
        } else {
            if (this._labelAttachment) {
                this.removeAttachment(this._labelAttachment);
                this._labelAttachment = null
            }
        }
    }, checkAlarmAttachment: function () {
        var t = this._network.getAlarmLabel(this._element);
        if (t != null && t !== "") {
            if (!this._alarmAttachment) {
                this._alarmAttachment = new twaver.network.AlarmAttachment(this, k.SHOW_ALARM_IN_ATTACHMENT_DIV);
                this.addAttachment(this._alarmAttachment)
            }
        } else {
            if (this._alarmAttachment) {
                this.removeAttachment(this._alarmAttachment);
                this._alarmAttachment = null
            }
        }
    }, checkIconsAttachment: function () {
        var t = this._network.getIconsNames(this._element);
        if (t && t.length > 0) {
            if (!this._iconsAttachment) {
                this._iconsAttachment = new twaver.network.IconsAttachment(this);
                this.addAttachment(this._iconsAttachment)
            }
        } else {
            if (this._iconsAttachment) {
                this.removeAttachment(this._iconsAttachment);
                this._iconsAttachment = null
            }
        }
    }, checkEditAttachment: function () {
        if (this.isEditable() && this._network.hasEditInteraction() && this._network.isSelected(this._element) && this._network.isEditable(this._element)) {
            if (!this._editAttachment) {
                this._editAttachment = new twaver.network.EditAttachment(this);
                this.addAttachment(this._editAttachment)
            }
        } else {
            if (this._editAttachment) {
                this.removeAttachment(this._editAttachment);
                this._editAttachment = null
            }
        }
    }, isEditable: function () {
        return true
    }, handlePropertyChange: function (t) {
        this.invalidate(true)
    }, handleSelectionChange: function (t) {
        this.invalidate(true)
    }, dispose: function () {
        this._attachments.forEach(function (t) {
            if (t.getView().parentNode) {
                t.getView().parentNode.removeChild(t.getView())
            }
            t.dispose()
        });
        this._attachments.clear()
    }, addAttachment: function (t) {
        this._attachments.add(t);
        if (t.isShowInAttachmentDiv()) {
            this._network.getAttachmentDiv().appendChild(t.getView())
        } else {
            this._view.appendChild(t.getView())
        }
        this.invalidate(false)
    }, removeAttachment: function (t) {
        this._attachments.remove(t);
        if (t.getView().parentNode) {
            t.getView().parentNode.removeChild(t.getView())
        }
        t.dispose();
        this.invalidate(false)
    }, addBodyBounds: function (t) {
        if (t) {
            this._bodyBounds.add(t)
        }
    }, addComponent: function (t) {
        this._bodyView.appendChild(t)
    }, getBodyView: function () {
        return this._bodyView
    }, getView: function () {
        return this._view
    }, getViewRect: function () {
        return _twaver.clone(this._viewRect)
    }, setShadow: function (t, e, i) {
        var n = t.isShadowable() && this._shadowColor && !this._editAttachment;
        if (n) {
            if (this._shadowXOffset > 0) {
                i.width += this._shadowXOffset
            } else {
                i.x += this._shadowXOffset;
                i.width += -this._shadowXOffset
            }
            if (this._shadowYOffset > 0) {
                i.height += this._shadowYOffset
            } else {
                i.y += this._shadowYOffset;
                i.height += -this._shadowYOffset
            }
            d.grow(i, this._shadowBlur, this._shadowBlur)
        }
        var s = l.setCanvas(e, i);
        if (n) {
            s.shadowOffsetX = this._shadowXOffset;
            s.shadowOffsetY = this._shadowYOffset;
            s.shadowBlur = this._shadowBlur;
            s.shadowColor = this._shadowColor
        }
        return s
    }, isShadowable: function () {
        if (this._shadowColor && this._network.isSelected(this._element) && this._element.getStyle("select.style") === "shadow") {
            return true
        }
        return false
    }, hit: function (t, e) {
        return false
    }, hitCanvas: function (t, e, i) {
        var n = i.length;
        for (var s = 0; s < n; s++) {
            var r = i[s];
            var o = this[r];
            if (a.hit(o, t, e, this._network.getSelectionTolerance())) {
                return true
            }
        }
        return false
    }, hitComponent: function (t, e, i) {
        var n = i.length;
        for (var s = 0; s < n; s++) {
            var r = i[s];
            var o = this[r];
            if (o && d.containsPoint(o._viewRect, t, e)) {
                return true
            }
        }
        return false
    }, hitTest: function (t, e) {
        if (!this.isVisible() || !d.containsPoint(this._viewRect, t, e)) {
            return null
        }
        var i, n = this._attachments.size(), s;
        for (i = n - 1; i >= 0; i--) {
            s = this._attachments.get(i);
            if (s.isShowInAttachmentDiv() && s.hit(t, e)) {
                return s
            }
        }
        for (i = n - 1; i >= 0; i--) {
            s = this._attachments.get(i);
            if (!s.isShowInAttachmentDiv() && s.hit(t, e)) {
                return s
            }
        }
        if (d.containsPoint(this._unionBodyBounds, t, e) && this.hit(t, e)) {
            return this
        }
        return null
    }, intersects: function (t) {
        return false
    }, intersectsComponent: function (t, e) {
        var i = e.length;
        for (var n = 0; n < i; n++) {
            var s = e[n];
            var r = this[s];
            if (r && d.intersects(r._viewRect, t)) {
                return true
            }
        }
        return false
    }, intersectsCanvas: function (t, e) {
        var i = e.length;
        for (var n = 0; n < i; n++) {
            var s = e[n];
            var r = this[s];
            if (a.intersects(r, t)) {
                return true
            }
        }
        return false
    }, intersectsTest: function (t) {
        if (!this.isVisible() || !d.intersects(this._viewRect, t)) {
            return null
        }
        var e = this._attachments.size(), i, n;
        for (i = e - 1; i >= 0; i--) {
            n = this._attachments.get(i);
            if (n.isShowInAttachmentDiv() && n.intersects(t)) {
                return n
            }
        }
        for (i = e - 1; i >= 0; i--) {
            n = this._attachments.get(i);
            if (!n.isShowInAttachmentDiv() && n.intersects(t)) {
                return n
            }
        }
        if (d.intersects(this._unionBodyBounds, t) && this.intersects(t)) {
            return this
        }
        return null
    }});
    twaver.network.Attachment = function (t, e) {
        this._view = l.createDiv();
        this._ui = t;
        this._element = this._ui.getElement();
        this._network = t.getNetwork();
        this._isShowInAttachmentDiv = e === true;
        if (this._isShowInAttachmentDiv) {
            l.setVisible(this._view, t.isVisible())
        }
    };
    _twaver.ext("twaver.network.Attachment", Object, {getElement: function () {
        return this._element
    }, getElementUI: function () {
        return this._ui
    }, getNetwork: function () {
        return this._network
    }, getStyle: function (t) {
        return this._ui.getStyle(t)
    }, getFont: function (t) {
        return this._ui.getFont(t)
    }, isShowInAttachmentDiv: function () {
        return this._isShowInAttachmentDiv
    }, getView: function () {
        return this._view
    }, getViewRect: function () {
        return _twaver.clone(this._viewRect)
    }, getAlpha: function () {
        return 1
    }, updateMeasure: function () {
    }, dispose: function () {
    }, hit: function (t, e) {
        return d.containsPoint(this._viewRect, t, e)
    }, intersects: function (t) {
        return d.intersects(this._viewRect, t)
    }});
    twaver.network.BasicAttachment = function (t, e) {
        twaver.network.BasicAttachment.superClass.constructor.call(this, t, e);
        this._roundRect = {x: 0, y: 0, width: 0, height: 0};
        this._contentRect = {x: 0, y: 0, width: 0, height: 0};
        this._attachmentCanvas = l.createCanvas();
        this._view.insertBefore(this._attachmentCanvas, this._view.firstChild)
    };
    _twaver.ext("twaver.network.BasicAttachment", twaver.network.Attachment, {calculateMeasure: function () {
        var t = this.getContentWidth();
        var e = this.getContentHeight();
        var i = this.getCornerRadius();
        var n = this.getPointerLength();
        var s = this.getPointerWidth();
        var r = this.getPosition();
        var o = this.getXOffset();
        var a = this.getYOffset();
        var h = this._roundRect;
        h.width = t + i * 2;
        h.height = e;
        var l;
        if (n > 0) {
            var c = this.getDirection();
            l = this._network.getPosition(r, this._ui, null, o, a);
            var u;
            if (c === "aboveleft") {
                h.y = l.y - n - h.height;
                h.x = l.x - (h.width - i);
                u = Math.max(l.x - s, h.x + i / 2);
                this._pointers = [l, {x: l.x, y: l.y - n}, {x: u, y: l.y - n}]
            } else if (c === "aboveright") {
                h.y = l.y - n - h.height;
                h.x = l.x - i;
                u = Math.min(l.x + s, h.x + h.width - i / 2);
                this._pointers = [l, {x: l.x, y: l.y - n}, {x: u, y: l.y - n}]
            } else if (c === "belowleft") {
                h.y = l.y + n;
                h.x = l.x - (h.width - i);
                u = Math.max(l.x - s, h.x + i / 2);
                this._pointers = [l, {x: l.x, y: l.y + n}, {x: u, y: l.y + n}]
            } else if (c === "belowright") {
                h.y = l.y + n;
                h.x = l.x - i;
                u = Math.min(l.x + s, h.x + h.width - i / 2);
                this._pointers = [l, {x: l.x, y: l.y + n}, {x: u, y: l.y + n}]
            } else if (c === "leftabove") {
                h.y = l.y + i - h.height;
                h.x = l.x - n - h.width;
                u = Math.max(l.y - s, h.y + i / 2);
                this._pointers = [l, {x: l.x - n, y: l.y}, {x: l.x - n, y: u}]
            } else if (c === "leftbelow") {
                h.y = l.y - i;
                h.x = l.x - n - h.width;
                u = Math.min(l.y + s, h.y + h.height - i / 2);
                this._pointers = [l, {x: l.x - n, y: l.y}, {x: l.x - n, y: u}]
            } else if (c === "rightabove") {
                h.y = l.y + i - h.height;
                h.x = l.x + n;
                u = Math.max(l.y - s, h.y + i / 2);
                this._pointers = [l, {x: l.x + n, y: l.y}, {x: l.x + n, y: u}]
            } else if (c === "rightbelow") {
                h.y = l.y - i;
                h.x = l.x + n;
                u = Math.min(l.y + s, h.y + h.height - i / 2);
                this._pointers = [l, {x: l.x + n, y: l.y}, {x: l.x + n, y: u}]
            } else if (c === "above") {
                h.y = l.y - n - h.height;
                h.x = l.x - h.width / 2;
                u = Math.min(t / 2, s / 2);
                this._pointers = [l, {x: l.x - u, y: l.y - n}, {x: l.x + u, y: l.y - n}]
            } else if (c === "below") {
                h.y = l.y + n;
                h.x = l.x - h.width / 2;
                u = Math.min(t / 2, s / 2);
                this._pointers = [l, {x: l.x - u, y: l.y + n}, {x: l.x + u, y: l.y + n}]
            } else if (c === "left") {
                h.y = l.y - h.height / 2;
                h.x = l.x - n - h.width;
                u = Math.min(e / 2, s / 2);
                this._pointers = [l, {x: l.x - n, y: l.y + u}, {x: l.x - n, y: l.y - u}]
            } else if (c === "right") {
                h.y = l.y - h.height / 2;
                h.x = l.x + n;
                u = Math.min(e / 2, s / 2);
                this._pointers = [l, {x: l.x + n, y: l.y + u}, {x: l.x + n, y: l.y - u}]
            } else {
                throw"Can not resolve '" + c + "' attachment direction"
            }
        } else {
            l = this._network.getPosition(r, this._ui, {width: h.width, height: h.height}, o, a);
            h.x = l.x;
            h.y = l.y;
            this._pointers = null
        }
        this._contentRect.x = h.x + (h.width - t) / 2;
        this._contentRect.y = h.y + (h.height - e) / 2;
        this._contentRect.width = t;
        this._contentRect.height = e;
        var v = this.getPadding();
        if (v != 0) {
            d.grow(h, v, v)
        }
        v = this.getPaddingLeft();
        if (v != 0) {
            h.x -= v;
            h.width += v
        }
        v = this.getPaddingRight();
        if (v != 0) {
            h.width += v
        }
        v = this.getPaddingTop();
        if (v != 0) {
            h.y -= v;
            h.height += v
        }
        v = this.getPaddingBottom();
        if (v != 0) {
            h.height += v
        }
        if (h.width < 0) {
            h.width = h.width;
            h.x -= h.width
        }
        if (h.height < 0) {
            h.height = -h.height;
            h.y -= h.height
        }
    }, updateMeasure: function () {
        twaver.network.BasicAttachment.superClass.updateMeasure.call(this);
        this.calculateMeasure();
        var t = this.isFill();
        var e = this.getOutlineWidth();
        this._viewRect = d.getRect(this._pointers);
        this._viewRect = d.unionRect(this._viewRect, this._roundRect);
        if (e > 0) {
            d.grow(this._viewRect, e / 2, e / 2)
        }
        var i = this._ui.setShadow(this, this._attachmentCanvas, this._viewRect);
        if (e > 0 || t) {
            i.beginPath();
            a.drawRoundRect(i, this._roundRect.x, this._roundRect.y, this._roundRect.width, this._roundRect.height, this.getCornerRadius());
            if (this._pointers) {
                i.moveTo(this._pointers[0].x, this._pointers[0].y);
                i.lineTo(this._pointers[1].x, this._pointers[1].y);
                i.lineTo(this._pointers[2].x, this._pointers[2].y)
            }
            i.closePath();
            if (e > 0) {
                i.lineWidth = e;
                i.strokeStyle = this.getOutlineColor();
                i.lineCap = this.getCap();
                i.lineJoin = this.getJoin();
                i.stroke()
            }
            if (t) {
                var n = this.getFillColor();
                var s = this.getGradient();
                if (s) {
                    a.fill(i, n, s, this.getGradientColor(), this._viewRect)
                } else {
                    i.fillStyle = n
                }
                i.fill()
            }
        }
        return i
    }, getRoundRect: function () {
        return _twaver.clone(this._roundRect)
    }, getContentRect: function () {
        return _twaver.clone(this._contentRect)
    }, getContent: function () {
        return this._content
    }, setContent: function (t) {
        if (this._content === t) {
            return
        }
        if (this._content) {
            this._view.removeChild(this._content)
        }
        this._content = t;
        if (t) {
            this._view.appendChild(t)
        }
    }, getContentWidth: function () {
        return k.ATTACHMENT_CONTENT_WIDTH
    }, getContentHeight: function () {
        return k.ATTACHMENT_CONTENT_HEIGHT
    }, getCornerRadius: function () {
        return k.ATTACHMENT_CORNER_RADIUS
    }, getPointerLength: function () {
        return k.ATTACHMENT_POINTER_LENGTH
    }, getPointerWidth: function () {
        return k.ATTACHMENT_POINTER_WIDTH
    }, getPosition: function () {
        return k.ATTACHMENT_POSITION
    }, getXOffset: function () {
        return k.ATTACHMENT_XOFFSET
    }, getYOffset: function () {
        return k.ATTACHMENT_YOFFSET
    }, getPadding: function () {
        return k.ATTACHMENT_PADDING
    }, getPaddingLeft: function () {
        return k.ATTACHMENT_PADDING_LEFT
    }, getPaddingRight: function () {
        return k.ATTACHMENT_PADDING_RIGHT
    }, getPaddingTop: function () {
        return k.ATTACHMENT_PADDING_TOP
    }, getPaddingBottom: function () {
        return k.ATTACHMENT_PADDING_BOTTOM
    }, getDirection: function () {
        return k.ATTACHMENT_DIRECTION
    }, isFill: function () {
        return k.ATTACHMENT_FILL
    }, getFillColor: function () {
        return k.ATTACHMENT_FILL_COLOR
    }, getGradient: function () {
        return k.ATTACHMENT_GRADIENT
    }, getGradientColor: function () {
        return k.ATTACHMENT_GRADIENT_COLOR
    }, getOutlineWidth: function () {
        return k.ATTACHMENT_OUTLINE_WIDTH
    }, getOutlineColor: function () {
        return k.ATTACHMENT_OUTLINE_COLOR
    }, getCap: function () {
        return k.ATTACHMENT_CAP
    }, getJoin: function () {
        return k.ATTACHMENT_JOIN
    }, isShadowable: function () {
        return k.ATTACHMENT_SHADOWABLE
    }, hit: function (t, e) {
        if (!d.containsPoint(this._viewRect, t, e)) {
            return false
        }
        if (d.containsPoint(this._contentRect, t, e)) {
            return true
        }
        return a.hit(this._attachmentCanvas, t, e)
    }, intersects: function (t) {
        if (!d.intersects(this._viewRect, t)) {
            return false
        }
        if (d.intersects(this._contentRect, t)) {
            return true
        }
        return a.intersects(this._attachmentCanvas, t)
    }});
    twaver.network.LabelAttachment = function (t, e) {
        twaver.network.LabelAttachment.superClass.constructor.call(this, t, e)
    };
    _twaver.ext("twaver.network.LabelAttachment", twaver.network.BasicAttachment, {updateMeasure: function () {
        var t = this.getFont("label.font");
        var e = this.getLabel();
        this._textSize = a.getTextSize(t, e);
        var i = twaver.network.LabelAttachment.superClass.updateMeasure.call(this);
        a.drawText(i, e, this._contentRect, t, this.getStyle("label.color"))
    }, getLabel: function () {
        return this._network.getLabel(this._element)
    }, getContentWidth: function () {
        return this._textSize ? this._textSize.width : 0
    }, getContentHeight: function () {
        return this._textSize ? this._textSize.height : 0
    }, getCornerRadius: function () {
        return this.getStyle("label.corner.radius")
    }, getPointerLength: function () {
        return this.getStyle("label.pointer.length")
    }, getPointerWidth: function () {
        return this.getStyle("label.pointer.width")
    }, getPosition: function () {
        return this.getStyle("label.position")
    }, getXOffset: function () {
        return this.getStyle("label.xoffset")
    }, getYOffset: function () {
        return this.getStyle("label.yoffset")
    }, getPadding: function () {
        return this.getStyle("label.padding")
    }, getPaddingLeft: function () {
        return this.getStyle("label.padding.left")
    }, getPaddingRight: function () {
        return this.getStyle("label.padding.right")
    }, getPaddingTop: function () {
        return this.getStyle("label.padding.top")
    }, getPaddingBottom: function () {
        return this.getStyle("label.padding.bottom")
    }, getDirection: function () {
        return this.getStyle("label.direction")
    }, isFill: function () {
        return this.getStyle("label.fill")
    }, getFillColor: function () {
        return this.getStyle("label.fill.color")
    }, getGradient: function () {
        return this.getStyle("label.gradient")
    }, getGradientColor: function () {
        return this.getStyle("label.gradient.color")
    }, getOutlineWidth: function () {
        return this.getStyle("label.outline.width")
    }, getOutlineColor: function () {
        return this.getStyle("label.outline.color")
    }, getCap: function () {
        return this.getStyle("label.cap")
    }, getJoin: function () {
        return this.getStyle("label.join")
    }, getAlpha: function () {
        return this.getStyle("label.alpha")
    }, isShadowable: function () {
        return this.getStyle("label.shadowable")
    }});
    twaver.network.AlarmAttachment = function (t, e) {
        twaver.network.AlarmAttachment.superClass.constructor.call(this, t, e)
    };
    _twaver.ext("twaver.network.AlarmAttachment", twaver.network.BasicAttachment, {updateMeasure: function () {
        var t = this.getFont("alarm.font");
        var e = this._network.getAlarmLabel(this._element);
        this._textSize = a.getTextSize(t, e);
        this._fillColor = this._network.getAlarmFillColor(this._element);
        var i = twaver.network.AlarmAttachment.superClass.updateMeasure.call(this);
        a.drawText(i, e, this._contentRect, t, this.getStyle("alarm.color"))
    }, getContentWidth: function () {
        return this._textSize ? this._textSize.width : 0
    }, getContentHeight: function () {
        return this._textSize ? this._textSize.height : 0
    }, getCornerRadius: function () {
        return this.getStyle("alarm.corner.radius")
    }, getPointerLength: function () {
        return this.getStyle("alarm.pointer.length")
    }, getPointerWidth: function () {
        return this.getStyle("alarm.pointer.width")
    }, getPosition: function () {
        return this.getStyle("alarm.position")
    }, getXOffset: function () {
        return this.getStyle("alarm.xoffset")
    }, getYOffset: function () {
        return this.getStyle("alarm.yoffset")
    }, getPadding: function () {
        return this.getStyle("alarm.padding")
    }, getPaddingLeft: function () {
        return this.getStyle("alarm.padding.left")
    }, getPaddingRight: function () {
        return this.getStyle("alarm.padding.right")
    }, getPaddingTop: function () {
        return this.getStyle("alarm.padding.top")
    }, getPaddingBottom: function () {
        return this.getStyle("alarm.padding.bottom")
    }, getDirection: function () {
        return this.getStyle("alarm.direction")
    }, isFill: function () {
        return this._fillColor != null
    }, getFillColor: function () {
        return this._fillColor
    }, getGradient: function () {
        return this.getStyle("alarm.gradient")
    }, getGradientColor: function () {
        return this.getStyle("alarm.gradient.color")
    }, getOutlineWidth: function () {
        return this.getStyle("alarm.outline.width")
    }, getOutlineColor: function () {
        return this.getStyle("alarm.outline.color")
    }, getCap: function () {
        return this.getStyle("alarm.cap")
    }, getJoin: function () {
        return this.getStyle("alarm.join")
    }, getAlpha: function () {
        return this.getStyle("alarm.alpha")
    }, isShadowable: function () {
        return this.getStyle("alarm.shadowable")
    }});
    twaver.network.LinkHandlerAttachment = function (t, e) {
        twaver.network.LinkHandlerAttachment.superClass.constructor.call(this, t, e)
    };
    _twaver.ext("twaver.network.LinkHandlerAttachment", twaver.network.BasicAttachment, {updateMeasure: function () {
        var t = this.getFont("link.handler.font");
        var e = this._network.getLinkHandlerLabel(this._element);
        this._textSize = a.getTextSize(t, e);
        var i = twaver.network.LabelAttachment.superClass.updateMeasure.call(this);
        a.drawText(i, e, this._contentRect, t, this.getStyle("link.handler.color"))
    }, getContentWidth: function () {
        return this._textSize ? this._textSize.width : 0
    }, getContentHeight: function () {
        return this._textSize ? this._textSize.height : 0
    }, getCornerRadius: function () {
        return this.getStyle("link.handler.corner.radius")
    }, getPointerLength: function () {
        return this.getStyle("link.handler.pointer.length")
    }, getPointerWidth: function () {
        return this.getStyle("link.handler.pointer.width")
    }, getPosition: function () {
        return this.getStyle("link.handler.position")
    }, getXOffset: function () {
        return this.getStyle("link.handler.xoffset")
    }, getYOffset: function () {
        return this.getStyle("link.handler.yoffset")
    }, getPadding: function () {
        return this.getStyle("link.handler.padding")
    }, getPaddingLeft: function () {
        return this.getStyle("link.handler.padding.left")
    }, getPaddingRight: function () {
        return this.getStyle("link.handler.padding.right")
    }, getPaddingTop: function () {
        return this.getStyle("link.handler.padding.top")
    }, getPaddingBottom: function () {
        return this.getStyle("link.handler.padding.bottom")
    }, getDirection: function () {
        return this.getStyle("link.handler.direction")
    }, isFill: function () {
        return this.getStyle("link.handler.fill")
    }, getFillColor: function () {
        return this.getStyle("link.handler.fill.color")
    }, getGradient: function () {
        return this.getStyle("link.handler.gradient")
    }, getGradientColor: function () {
        return this.getStyle("link.handler.gradient.color")
    }, getOutlineWidth: function () {
        return this.getStyle("link.handler.outline.width")
    }, getOutlineColor: function () {
        return this.getStyle("link.handler.outline.color")
    }, getCap: function () {
        return this.getStyle("link.handler.cap")
    }, getJoin: function () {
        return this.getStyle("link.handler.join")
    }, getAlpha: function () {
        return this.getStyle("link.handler.alpha")
    }, isShadowable: function () {
        return this.getStyle("link.handler.shadowable")
    }});
    twaver.network.EditAttachment = function (t, e) {
        twaver.network.EditAttachment.superClass.constructor.call(this, t, e);
        this._attachmentDiv = l.createDiv();
        this._view.appendChild(this._attachmentDiv)
    };
    _twaver.ext("twaver.network.EditAttachment", twaver.network.Attachment, {updateMeasure: function () {
        twaver.network.EditAttachment.superClass.updateMeasure.call(this);
        if (this._element instanceof y) {
            this._addResizingPoint(this._element)
        }
        if (this._element instanceof twaver.ShapeNode) {
            this._addShapeNodePoint(this._element)
        }
        if (this._ui instanceof twaver.network.ShapeLinkUI) {
            this._addShapeLinkPoints(this._ui)
        }
        if (this._ui instanceof twaver.network.LinkUI) {
            this._addLinkControlPoint(this._ui)
        }
    }, _addResizingPoint: function (t) {
        var e = t.getRect();
        if (!e) {
            return
        }
        if (!this._resizeDivs) {
            this._resizeDivs = new Array;
            for (var i = 0; i < 8; i++) {
                var n = l.createDiv();
                this._attachmentDiv.appendChild(n);
                this._resizeDivs[i] = n
            }
        }
        var s = new p([
            {x: e.x, y: e.y},
            {x: e.x + e.width / 2, y: e.y},
            {x: e.x + e.width, y: e.y},
            {x: e.x, y: e.y + e.height / 2},
            {x: e.x + e.width, y: e.y + e.height / 2},
            {x: e.x, y: e.y + e.height},
            {x: e.x + e.width / 2, y: e.y + e.height},
            {x: e.x + e.width, y: e.y + e.height}
        ]);
        var r = this._network.getResizePointOutlineWidth();
        var o = this._network.getResizePointOutlineColor();
        var a = this._network.getResizePointFillColor();
        this._addPoints(e, s, r, o, a, true)
    }, _addPoints: function (t, e, i, n, s, r) {
        var o = this._network.getEditPointSize();
        var a = o + i;
        d.grow(t, a, a);
        this._viewRect = t;
        var h = o * 2;
        var c = new p;
        var u, v, w, f;
        for (u = 0, v = e.size(); u < v; u++) {
            w = e.get(u);
            f = {x: w.x - o, y: w.y - o, width: h, height: h};
            c.add(f)
        }
        var _;
        if (r) {
            _ = this._resizeDivs
        } else {
            if (!this._controlDivs) {
                this._controlDivs = new Array
            }
            if (this._controlDivs.length < v) {
                for (u = this._controlDivs.length; u < v; u++) {
                    var g = l.createDiv();
                    this._attachmentDiv.appendChild(g);
                    this._controlDivs[u] = g
                }
            } else if (this._controlDivs.length > v) {
                for (u = v; u < this._controlDivs.length; u++) {
                    this._attachmentDiv.removeChild(this._controlDivs[u])
                }
                this._controlDivs.splice(v)
            }
            _ = this._controlDivs
        }
        for (u = 0, v = c.size(); u < v; u++) {
            f = c.get(u);
            l.setDiv(_[u], f, s, i, n);
            l.setBorderRaidus(_[u], (r ? "0" : h) + "px")
        }
    }, _addShapeLinkPoints: function (t) {
        this._addEditPoints(t._element.getPoints())
    }, _addShapeNodePoint: function (t) {
        this._addEditPoints(t.getPoints())
    }, _addLinkControlPoint: function (t) {
        if (c.isOrthogonalLink(t._element)) {
            var e = t.getControlPoint();
            if (e) {
                var i = new p;
                i.add(e);
                this._addEditPoints(i)
            }
        }
    }, _addEditPoints: function (t) {
        var e = d.getRect(t);
        if (!e) {
            return
        }
        var i = this._network.getEditPointOutlineWidth();
        var n = this._network.getEditPointOutlineColor();
        var s = this._network.getEditPointFillColor();
        this._addPoints(e, t, i, n, s, false)
    }, hit: function (t, e) {
        if (!d.containsPoint(this._viewRect, t, e)) {
            return false
        }
        var i;
        if (this._resizeDivs) {
            for (i = this._resizeDivs.length - 1; i >= 0; i--) {
                if (d.containsPoint(this._resizeDivs[i]._viewRect, t, e)) {
                    return true
                }
            }
        }
        if (this._controlDivs) {
            for (i = this._controlDivs.length - 1; i >= 0; i--) {
                if (d.containsPoint(this._controlDivs[i]._viewRect, t, e)) {
                    return true
                }
            }
        }
        return false
    }, intersects: function (t) {
        if (!d.intersects(this._viewRect, t)) {
            return false
        }
        var e;
        if (this._resizeDivs) {
            for (e = this._resizeDivs.length - 1; e >= 0; e--) {
                if (d.intersects(this._resizeDivs[e]._viewRect, t)) {
                    return true
                }
            }
        }
        if (this._controlDivs) {
            for (e = this._controlDivs.length - 1; e >= 0; e--) {
                if (d.intersects(this._controlDivs[e]._viewRect, t)) {
                    return true
                }
            }
        }
        if (!d.intersects(this._viewRect, t)) {
            return false
        }
        return false
    }});
    twaver.network.IconsAttachment = function (t, e) {
        twaver.network.IconsAttachment.superClass.constructor.call(this, t, e);
        this._iconsCanvas = null
    };
    _twaver.ext("twaver.network.IconsAttachment", twaver.network.Attachment, {isShadowable: function () {
        return k.ATTACHMENT_SHADOWABLE
    }, updateMeasure: function () {
        twaver.network.IconsAttachment.superClass.updateMeasure.call(this);
        var t = this._network.getIconsNames(this._element);
        if (!t || t.length == 0) {
            return
        }
        var e = this._network.getIconsColors(this._element);
        var i = this._element.getStyle("icons.orientation");
        var n = this._element.getStyle("icons.position");
        var s = this._element.getStyle("icons.xoffset");
        var r = this._element.getStyle("icons.yoffset");
        var o = this._element.getStyle("icons.xgap");
        var a = this._element.getStyle("icons.ygap");
        var h = this._getIconsSize(t, i, o, a);
        if (!h) {
            return
        }
        var c = this._network.getPosition(n, this._ui, h, s, r);
        this._viewRect = {x: c.x, y: c.y, width: h.width, height: h.height};
        if (i === "top") {
            c.y += h.height
        } else if (i === "left") {
            c.x += h.width
        }
        if (!this._iconsCanvas) {
            this._iconsCanvas = l.createCanvas();
            this._view.appendChild(this._iconsCanvas)
        }
        var d = this._ui.setShadow(this, this._iconsCanvas, _twaver.clone(this._viewRect));
        var u = c.x;
        var v = c.y;
        var w = 0;
        for (var f in t) {
            var _ = null;
            var g = null;
            if (e && e.length > w) {
                g = e[w++]
            }
            var m = _twaver.getImageAsset(t[f]);
            if (m == null) {
                continue
            }
            if (i === "right") {
                _ = {x: u, y: v, width: m.getWidth(), height: m.getHeight()};
                u += _.width + o
            } else if (i === "left") {
                _ = {x: u - m.getWidth(), y: v, width: m.getWidth(), height: m.getHeight()};
                u -= _.width + o
            } else if (i === "top") {
                _ = {x: u, y: v - m.getHeight(), width: m.getWidth(), height: m.getHeight()};
                v -= _.height + a
            } else if (i === "bottom") {
                _ = {x: u, y: v, width: m.getWidth(), height: m.getHeight()};
                v += _.height + a
            } else {
                throw"Can not resolve '" + i + "' orientation"
            }
            d.drawImage(m.getImage(g), _.x, _.y, _.width, _.height)
        }
    }, _getIconsSize: function (t, e, i, n) {
        var s = 0;
        var r = 0;
        var o = null;
        var a = null;
        var h = null;
        for (var l in t) {
            a = _twaver.getImageAsset(t[l]);
            if (!a) {
                continue
            }
            if (e === "right") {
                o = {x: s, y: r, width: a.getWidth(), height: a.getHeight()};
                s += o.width + i
            } else if (e === "left") {
                o = {x: s - a.getWidth(), y: r, width: a.getWidth(), height: a.getHeight()};
                s -= o.width + i
            } else if (e === "top") {
                o = {x: s, y: r - a.getHeight(), width: a.getWidth(), height: a.getHeight()};
                r -= o.height + n
            } else if (e === "bottom") {
                o = {x: s, y: r, width: a.getWidth(), height: a.getHeight()};
                r += o.height + n
            } else {
                throw"Can not resolve '" + e + "' orientation"
            }
            if (h == null) {
                h = _twaver.clone(o)
            } else {
                h = d.unionRect(h, o)
            }
        }
        if (h) {
            return{width: Math.abs(h.width), height: Math.abs(h.height)}
        }
        return null
    }});
    twaver.network.NodeUI = function (t, e) {
        twaver.network.NodeUI.superClass.constructor.call(this, t, e)
    };
    _twaver.ext("twaver.network.NodeUI", twaver.network.ElementUI, {createBodyRect: function () {
        return this._element.getRect()
    }, invalidate: function (t) {
        twaver.network.NodeUI.superClass.invalidate.call(this, t);
        var e = this._element.getAgentLinks();
        if (e) {
            e.forEach(function (t) {
                this._network.invalidateElementUI(t, false)
            }, this)
        }
    }, updateMeasure: function () {
        twaver.network.NodeUI.superClass.updateMeasure.call(this);
        var t = this.getStyle("vector.shape");
        var e = this.getBodyRect();
        this._hotSpot = d.getHotSpot(e.x, e.y, e.width, e.height, t);
        this.drawBody();
        if (this._outerColor) {
            this.drawOuterBorder()
        }
        if (!this._editAttachment && this.getStyle("select.style") === "border" && this._network.isSelected(this._element)) {
            this.drawSelectBorder()
        }
        this.cleanUp(["_selectCanvas", "_nodeCanvas", "_nodeImage", "_nodeComponent", "_vectorCanvas", "_outerCanvas"]);
        var i = this._element.getParent();
        if (i instanceof E) {
            this._network.invalidateElementUI(i, false)
        }
    }, drawBody: function () {
        var t = this.getStyle("body.type");
        if (t === "default") {
            this.drawDefaultBody()
        } else if (t === "vector") {
            this.drawVectorBody()
        } else if (t === "default.vector") {
            this.drawVectorBody();
            this.drawDefaultBody()
        } else if (t === "vector.default") {
            this.drawDefaultBody();
            this.drawVectorBody()
        }
    }, drawOuterBorder: function () {
        var t = this._element;
        var e = t.getStyle("outer.width");
        if (e > 0) {
            var i = this.getBodyRect();
            d.addPadding(i, t, "outer.padding", 1);
            if (!this._outerCanvas) {
                this._outerCanvas = l.createCanvas()
            }
            var n = _twaver.clone(i);
            d.grow(n, e / 2, e / 2);
            var s = l.setCanvas(this._outerCanvas, n);
            s.lineWidth = e;
            s.lineCap = t.getStyle("outer.cap");
            s.lineJoin = t.getStyle("outer.join");
            s.strokeStyle = this._outerColor;
            a.drawVector(s, t.getStyle("outer.shape"), null, i);
            s.stroke();
            this.addComponent(this._outerCanvas);
            this.addBodyBounds(n)
        }
    }, drawSelectBorder: function () {
        var t = this._element;
        var e = t.getStyle("select.width");
        if (e > 0) {
            var i = this.getBodyRect();
            d.addPadding(i, t, "select.padding", 1);
            if (!this._selectCanvas) {
                this._selectCanvas = l.createCanvas()
            }
            var n = _twaver.clone(i);
            d.grow(n, e / 2, e / 2);
            var s = l.setCanvas(this._selectCanvas, n);
            s.lineWidth = e;
            s.lineCap = t.getStyle("select.cap");
            s.lineJoin = t.getStyle("select.join");
            s.strokeStyle = t.getStyle("select.color");
            a.drawVector(s, t.getStyle("select.shape"), null, i);
            s.stroke();
            this.addComponent(this._selectCanvas);
            this.addBodyBounds(n)
        }
    }, drawDefaultBody: function () {
        var t = this._element;
        var e = _twaver.getImageAsset(t.getImage());
        var i = this.getBodyRect();
        if (!e) {
            this.addBodyBounds(i);
            this._currentImageAsset = null;
            return
        }
        d.addPadding(i, this._element, "image.padding", 1);
        if (e.getImage()) {
            if (!this._nodeCanvas) {
                this._nodeCanvas = l.createCanvas()
            }
            var n = _twaver.clone(i);
            var s = this.setShadow(this, this._nodeCanvas, n);
            s.drawImage(e.getImage(this._innerColor), i.x, i.y, i.width, i.height);
            i = n;
            this.addComponent(this._nodeCanvas)
        } else if (e.getSrc()) {
            if (!this._nodeImage) {
                this._nodeImage = l.createImg()
            }
            l.setImg(this._nodeImage, e.getSrc(), i);
            this.addComponent(this._nodeImage)
        } else if (e.getFunction()) {
            if (this._currentImageAsset !== e) {
                this._nodeComponent = e.getFunction()(this, i)
            } else {
                this._nodeComponent = e.getFunction()(this, i, this._nodeComponent)
            }
            this.addComponent(this._nodeComponent);
            this._nodeComponent._viewRect = _twaver.clone(i)
        } else {
            throw"ImageAsset '" + t.getImage() + " ' is empty"
        }
        this.addBodyBounds(i);
        this._currentImageAsset = e
    }, hit: function (t, e) {
        if (this.hitCanvas(t, e, ["_nodeCanvas", "_outerCanvas", "_vectorCanvas"])) {
            return true
        }
        return this.hitComponent(t, e, ["_nodeImage", "_nodeComponent"])
    }, intersects: function (t) {
        if (this.intersectsCanvas(t, ["_nodeCanvas", "_outerCanvas", "_vectorCanvas"])) {
            return true
        }
        return this.intersectsComponent(t, ["_nodeImage", "_nodeComponent"])
    }, drawVectorBody: function () {
        if (!this._vectorCanvas) {
            this._vectorCanvas = l.createCanvas()
        }
        var t = a.drawPath(this, this._vectorCanvas, "vector", true, this._element.getStyle("vector.outline.pattern"));
        var e = this.getStyle("vector.deep");
        var i = this.getStyle("vector.fill.color");
        if (e !== 0 && i) {
            if (this.getStyle("vector.shape") === "rectangle") {
                a.draw3DRect(this._vectorCanvas.getContext("2d"), i, e, this._bodyRect)
            }
        }
        this.addBodyBounds(t);
        this.addComponent(this._vectorCanvas)
    }});
    twaver.network.LinkUI = function (t, e) {
        twaver.network.LinkUI.superClass.constructor.call(this, t, e);
        this._linkCanvas = l.createCanvas()
    };
    _twaver.ext("twaver.network.LinkUI", twaver.network.ElementUI, {isEditable: function () {
        if (c.isOrthogonalLink(this._element) && this.getControlPoint()) {
            return true
        }
        return false
    }, createBodyRect: function () {
        var t = this.getHotSpot();
        if (t) {
            return{x: t.x - 1, y: t.y - 1, width: 2, height: 2}
        }
        return null
    }, hit: function (t, e) {
        return this.hitCanvas(t, e, ["_linkCanvas"])
    }, intersects: function (t) {
        return this.intersectsCanvas(t, ["_linkCanvas"])
    }, checkAttachments: function () {
        twaver.network.LinkUI.superClass.checkAttachments.call(this);
        this.checkLinkHandlerAttachment()
    }, checkLinkHandlerAttachment: function () {
        var t = this._network.getLinkHandlerLabel(this._element);
        if (t != null && t !== "") {
            if (!this._linkHandlerAttachment) {
                this._linkHandlerAttachment = new twaver.network.LinkHandlerAttachment(this);
                this.addAttachment(this._linkHandlerAttachment)
            }
        } else {
            if (this._linkHandlerAttachment) {
                this.removeAttachment(this._linkHandlerAttachment);
                this._linkHandlerAttachment = null
            }
        }
    }, getLinkHandlerAttachment: function () {
        return this._linkHandlerAttachment
    }, getLinkPoints: function () {
        if (!this._linkPoints) {
            this._linkPoints = this.createLinkPoints();
            this._lineLength = d.calculateLineLength(this._linkPoints)
        }
        return this._linkPoints
    }, invalidate: function (t) {
        this._linkPoints = null;
        this._fromPoint = null;
        this._toPoint = null;
        twaver.network.LinkUI.superClass.invalidate.call(this, t)
    }, getFromPosition: function (t, e) {
        var i = this.getFromPoint();
        if (i) {
            return{x: i.x + t, y: i.y + e}
        }
        return null
    }, getToPosition: function (t, e) {
        var i = this.getToPoint();
        if (i) {
            return{x: i.x + t, y: i.y + e}
        }
        return null
    }, getFromPoint: function () {
        if (!this._fromPoint) {
            this._fromPoint = c.createFromPoint(this)
        }
        return this._fromPoint
    }, getToPoint: function () {
        if (!this._toPoint) {
            this._toPoint = c.createToPoint(this)
        }
        return this._toPoint
    }, updateMeasure: function () {
        twaver.network.LinkUI.superClass.updateMeasure.call(this);
        this.drawBody()
    }, createLinkPoints: function () {
        var t = this.getFromPoint();
        var e = this.getToPoint();
        var i = this.getStyle("link.type");
        if (c.isOrthogonalOrFlexionalLink(this._element)) {
            return c.orthogonalAndFlexional(this, i)
        }
        var n = new p;
        if (this._element.isLooped()) {
            var s = this._network.getElementUI(this._element.getFromAgent());
            if (s == null) {
                return null
            }
            this._hotSpot = c.fillLoopedPoints(this, s.getBodyRect(), n)
        } else if (i === "arc" || i === "triangle" || i === "parallel") {
            this._hotSpot = c.fillBundlePoints(this, i, t, e, n)
        } else {
            throw"Can not resolve link type '" + i + "'"
        }
        return n
    }, drawLinePoints: function (t, e, i, n, s) {
        t.lineWidth = i;
        t.strokeStyle = n;
        if (this._element.getStyle("link.flow") === true && s && s.length > 1) {
            var o = new r(t, s[0], s[1]);
            var h = this._element.getStyle("link.flow.offset");
            if (this._element.getStyle("link.flow.converse")) {
                if (h < s[0]) {
                    o.overflow = s[0] - h
                } else if (h >= s[0] && h <= s[0] + s[1]) {
                    o.overflow = s[1] - (h - s[0]);
                    if (o.overflow) {
                        o.isLine = false
                    }
                } else {
                    h -= s[0] + s[1];
                    o.overflow = s[0] - h
                }
            } else {
                if (h <= s[1]) {
                    o.overflow = h;
                    if (h)o.isLine = false
                } else if (h > s[1] && h <= s[0] + s[1]) {
                    o.overflow = h - s[1]
                } else {
                    h -= s[0] + s[1];
                    if (h) {
                        o.isLine = false
                    }
                    o.overflow = h
                }
            }
            this._element._styleMap["link.flow.offset"] = h;
            t.beginPath();
            a._drawLine(e, t);
            t.stroke();
            t.shadowColor = "transparent";
            t.beginPath();
            var l = this._element.getStyle("link.flow.color");
            l = l ? l : k.NETWORK_LINK_FLOW_COLOR;
            t.strokeStyle = l;
            a._drawLine(e, o);
            t.stroke();
            t.shadowColor = this._shadowColor
        } else {
            t.beginPath();
            a.drawLinePoints(t, e, s);
            t.stroke()
        }
    }, drawBody: function () {
        var t = this.getLinkPoints();
        if (!t || t.size() < 2) {
            return
        }
        var e = this._element;
        var n = d.getLineRect(t);
        var s = e.getStyle("link.width");
        var r = s;
        if (this._outerColor) {
            var o = e.getStyle("outer.width");
            r += o * 2
        }
        var a = !this._editAttachment && e.getStyle("select.style") === "border" && this._network.isSelected(this._element);
        if (a) {
            var h = e.getStyle("select.width");
            r += h * 2
        }
        d.grow(n, r / 2, r / 2);
        if (e.getStyle("arrow.from")) {
            n = d.unionRect(n, i.getArrowRect(t, true, e.getStyle("arrow.from.shape"), e.getStyle("arrow.from.width"), e.getStyle("arrow.from.height"), e.getStyle("arrow.from.xoffset"), e.getStyle("arrow.from.yoffset")))
        }
        if (e.getStyle("arrow.to")) {
            n = d.unionRect(n, i.getArrowRect(t, false, e.getStyle("arrow.to.shape"), e.getStyle("arrow.to.width"), e.getStyle("arrow.to.height"), e.getStyle("arrow.to.xoffset"), e.getStyle("arrow.to.yoffset")))
        }
        var l = this.setShadow(this, this._linkCanvas, n);
        l.lineCap = e.getStyle("link.cap");
        l.lineJoin = e.getStyle("link.join");
        var c = e.getStyle("link.pattern");
        if (a) {
            this.drawLinePoints(l, t, r, e.getStyle("select.color"), c)
        }
        if (this._outerColor) {
            this.drawLinePoints(l, t, s + o * 2, this._outerColor, c)
        }
        this.drawLinePoints(l, t, s, this._innerColor || e.getStyle("link.color"), c);
        this.addBodyBounds(n);
        this.addComponent(this._linkCanvas);
        i.drawLinkArrow(this, l, t)
    }, getControlPoint: function () {
        return c.getControlPoint(this._element, this)
    }, setControlPoint: function (t) {
        if (!t) {
            return
        }
        var e = this.getStyle("link.type");
        if (!c.hasControlPoint(e)) {
            return
        }
        var i = c.getLinkSourceBounds(this);
        var n = c.getLinkTargetBounds(this);
        c.setParamsByControlPoint(t, i, n, e, this._element)
    }, getLineLength: function () {
        return this._lineLength
    }});
    twaver.network.GroupUI = function (t, e) {
        twaver.network.GroupUI.superClass.constructor.call(this, t, e)
    };
    _twaver.ext("twaver.network.GroupUI", twaver.network.NodeUI, {isEditable: function () {
        return!this._element.isExpanded()
    }, drawBody: function () {
        var t = this.getBodyRect();
        if (this._shapeRect) {
            this.drawExpandedGroup()
        } else {
            twaver.network.GroupUI.superClass.drawBody.call(this)
        }
    }, drawExpandedGroup: function () {
        if (!this._nodeCanvas) {
            this._nodeCanvas = l.createCanvas()
        }
        var t = a.drawPath(this, this._nodeCanvas, "group", false, this._element.getStyle("vector.outline.pattern"));
        var e = this.getStyle("group.deep");
        var i = this.getStyle("group.fill.color");
        if (e !== 0 && i) {
            if (this.getStyle("group.shape") === "rectangle") {
                a.draw3DRect(this._nodeCanvas.getContext("2d"), i, e, this._bodyRect)
            }
        }
        this.addBodyBounds(t);
        this.addComponent(this._nodeCanvas)
    }, getChildrenRects: function () {
        return this._network.getGroupChildrenRects(this._element)
    }, createBodyRect: function () {
        this._shapeRect = null;
        var t = this._element;
        if (t.isExpanded()) {
            var e = this.getChildrenRects();
            if (!e.isEmpty()) {
                var i = t.getStyle("group.shape");
                var n = h[i];
                if (!n) {
                    throw"Can not resolve group shape '" + i + "'"
                }
                this._shapeRect = n(e)
            }
        }
        if (this._shapeRect) {
            d.addPadding(this._shapeRect, t, "group.padding", 1);
            return this._shapeRect
        } else {
            return twaver.network.GroupUI.superClass.createBodyRect.call(this)
        }
    }});
    twaver.network.GridUI = function (t, e) {
        twaver.network.GridUI.superClass.constructor.call(this, t, e)
    };
    _twaver.ext("twaver.network.GridUI", twaver.network.NodeUI, {drawDefaultBody: function () {
        if (this._element.getImage()) {
            twaver.network.GridUI.superClass.drawDefaultBody.call(this)
        } else {
            this.drawGridBody()
        }
    }, drawGridBody: function () {
        var t = this.getStyle("grid.fill");
        var e = this.getStyle("grid.deep");
        var i = this.getStyle("grid.cell.deep");
        if (!t && e === 0 && i === 0) {
            return
        }
        var n = this.getBodyRect();
        var s = this.getDyeColor("grid.fill.color");
        if (!this._nodeCanvas) {
            this._nodeCanvas = l.createCanvas()
        }
        var r = _twaver.clone(n);
        var o = this.setShadow(this, this._nodeCanvas, r);
        if (t) {
            o.fillStyle = s;
            o.rect(n.x, n.y, n.width, n.height);
            o.fill();
            this.addComponent(this._nodeCanvas)
        }
        if (e != 0) {
            a.draw3DRect(o, s, e, n.x, n.y, n.width, n.height)
        }
        if (i != 0) {
            var h = this.getStyle("grid.row.count");
            var c = this.getStyle("grid.column.count");
            for (var d = 0; d < h; d++) {
                for (var u = 0; u < c; u++) {
                    var v = this._element.getCellRect(d, u);
                    if (v != null) {
                        a.draw3DRect(o, s, i, v.x, v.y, v.width, v.height)
                    }
                }
            }
        }
        this.addBodyBounds(r)
    }});
    twaver.network.ShapeNodeUI = function (t, e) {
        twaver.network.ShapeNodeUI.superClass.constructor.call(this, t, e)
    };
    _twaver.ext("twaver.network.ShapeNodeUI", twaver.network.NodeUI, {drawDefaultBody: function () {
        if (this._element._points.size() < 2) {
            return
        }
        if (!this._nodeCanvas) {
            this._nodeCanvas = l.createCanvas()
        }
        var t = a.drawPath(this, this._nodeCanvas, "vector", true, this._element.getStyle("vector.outline.pattern"), this._element._points, this._element._segments, this._element.getStyle("shapenode.closed"));
        this.addBodyBounds(t);
        this.addComponent(this._nodeCanvas);
        i.drawLinkArrow(this, this._nodeCanvas.getContext("2d"), d.getPointObject(this._element._points, this._element._segments))
    }});
    twaver.network.ShapeLinkUI = function (t, e) {
        twaver.network.ShapeLinkUI.superClass.constructor.call(this, t, e)
    };
    _twaver.ext("twaver.network.ShapeLinkUI", twaver.network.LinkUI, {isEditable: function () {
        return true
    }, createLinkPoints: function () {
        var t = this.getFromPoint();
        var e = this.getToPoint();
        var i = new p;
        var n = this.getStyle("shapelink.type");
        i.add(t);
        if (this._element._points != null) {
            i.addAll(this._element._points)
        }
        i.add(e);
        var s = i.size();
        var r = Math.ceil(s / 2);
        if (s % 2 === 0) {
            var o = i.get(r);
            var a = i.get(r - 1);
            this._hotSpot = {x: (o.x + a.x) / 2, y: (o.y + a.y) / 2}
        } else {
            this._hotSpot = _twaver.clone(i.get(r))
        }
        var h, l, c;
        if (n === "lineto") {
        } else if (n === "quadto") {
            h = new p(i.get(0));
            for (l = 1, s = i.size(); l < s; l++) {
                if (l < s - 1) {
                    h.add(new p([i.get(l++), i.get(l)]))
                } else {
                    h.add(i.get(l))
                }
            }
            i = h
        } else if (n === "cubicto") {
            h = new p(i.get(0));
            for (l = 1, s = i.size(); l < s; l++) {
                if (l < s - 2) {
                    h.add(new p([i.get(l++), i.get(l++), i.get(l)]))
                } else if (l < s - 1) {
                    h.add(new p([i.get(l++), i.get(l)]))
                } else {
                    h.add(i.get(l))
                }
            }
            i = h
        } else if (n === "orthogonalto") {
            c = i.get(0);
            h = new p(c);
            for (l = 1, s = i.size(); l < s; l++) {
                if (l < s - 1) {
                    var d = _twaver.clone(i.get(l));
                    var u = d.x;
                    var v = d.y;
                    var w = u - c.x;
                    var f = v - c.y;
                    if (Math.abs(w) > Math.abs(f)) {
                        d.x = u;
                        d.y = c.y
                    } else {
                        d.x = c.x;
                        d.y = v
                    }
                    c = d;
                    h.add(c)
                } else {
                    h.add(i.get(l))
                }
            }
            i = h
        } else {
            throw"Can not resolve shapelink type '" + n + "'"
        }
        return i
    }});
    twaver.network.RotatableNodeUI = function (t, e) {
        twaver.network.RotatableNodeUI.superClass.constructor.call(this, t, e)
    };
    _twaver.ext("twaver.network.RotatableNodeUI", twaver.network.NodeUI, {isEditable: function () {
        return false
    }, drawDefaultBody: function () {
        var t = this._element;
        var e = _twaver.getImageAsset(t.getImage());
        var i = this.getBodyRect();
        if (!e) {
            this.addBodyBounds(i);
            this._currentImageAsset = null;
            return
        }
        d.addPadding(i, this._element, "image.padding", 1);
        if (e.getImage()) {
            if (!this._nodeCanvas) {
                this._nodeCanvas = l.createCanvas()
            }
            var n = _twaver.clone(i);
            var s = this.setShadow(this, this._nodeCanvas, n);
            var r = this._element._getOrignalWidth(), o = this._element._getOrignalHeight(), a = this._element._getRotateRect();
            s.save();
            s.translate(i.x - a.x + r / 2, i.y - a.y + o / 2);
            s.rotate(this._element._angle * Math.PI / 180);
            s.drawImage(e.getImage(this._innerColor), -r / 2, -o / 2, r, o);
            s.restore();
            this.addComponent(this._nodeCanvas)
        } else if (e.getSrc()) {
        } else if (e.getFunction()) {
        } else {
            throw"ImageAsset '" + t.getImage() + " ' is empty"
        }
        this.addBodyBounds(i);
        this._currentImageAsset = e
    }});
    twaver.network.interaction.BaseInteraction = function (t) {
        this.network = t
    };
    _twaver.ext("twaver.network.interaction.BaseInteraction", Object, {setUp: function () {
    }, tearDown: function () {
    }, addListener: function () {
        for (var t = 0; t < arguments.length; t++) {
            var e = arguments[t];
            l.addEventListener(e, "handle_" + e, this.network.getView(), this)
        }
    }, removeListener: function () {
        for (var t = 0; t < arguments.length; t++) {
            l.removeEventListener(arguments[t], this.network.getView(), this)
        }
    }, _handle_mousedown: function (t) {
        if (t.button !== 0) {
            return
        }
        this._startLogical = this.network.getLogicalPoint(t);
        this._startClient = l.getClientPoint(t);
        if (this._startLogical) {
            l.handle_mousedown(this, t)
        }
    }, _handle_mousemove: function (t) {
        this._endLogical = {x: this._startLogical.x + (t.clientX - this._startClient.x) / this.network.getZoom(), y: this._startLogical.y + (t.clientY - this._startClient.y) / this.network.getZoom()}
    }, _handle_mouseup: function (t) {
        delete this._startClient;
        delete this._startLogical;
        delete this._endLogical
    }});
    twaver.network.interaction.DefaultInteraction = function (t) {
        twaver.network.interaction.DefaultInteraction.superClass.constructor.call(this, t)
    };
    _twaver.ext("twaver.network.interaction.DefaultInteraction", twaver.network.interaction.BaseInteraction, {setUp: function () {
        this.addListener("mousedown", "keydown")
    }, tearDown: function () {
        this.removeListener("mousedown", "keydown")
    }, handle_mousedown: function (t) {
        if (!this.network.isValidEvent(t)) {
            return
        }
        if (this.network.isFocusOnClick()) {
            twaver.Util.setFocus(this.network.getView())
        }
        var e = this.network.getElementAt(t);
        if (t.detail === 2) {
            this.handleDoubleClicked(t, e)
        } else {
            this.handleClicked(t, e)
        }
    }, handleClicked: function (t, e) {
        v.handleClicked(this.network, t, e)
    }, handleDoubleClicked: function (t, e) {
        v.handleDoubleClicked(this.network, t, e)
    }, handle_keydown: function (t) {
        v.handleKeyDown(this.network, t)
    }});
    twaver.network.interaction.SelectInteraction = function (t) {
        twaver.network.interaction.SelectInteraction.superClass.constructor.call(this, t)
    };
    _twaver.ext("twaver.network.interaction.SelectInteraction", twaver.network.interaction.BaseInteraction, {setUp: function () {
        this.addListener("mousedown")
    }, tearDown: function () {
        this.removeListener("mousedown");
        this.end()
    }, handle_mousedown: function (t) {
        this._button = t.button;
        if (!this.network.isValidEvent(t) || this.network.isMovingElement() || this.network.isEditingElement()) {
            return
        }
        if (t.shiftKey) {
            return
        }
        var e = this.network.getElementAt(t);
        var i = this.network.getSelectionModel();
        if (e) {
            if (_twaver.isCtrlDown(t)) {
                if (i.contains(e)) {
                    i.removeSelection(e)
                } else {
                    i.appendSelection(e)
                }
            } else {
                if (!i.contains(e)) {
                    i.setSelection(e)
                }
            }
        } else {
            if (!_twaver.isCtrlDown(t)) {
                i.clearSelection()
            }
            this.end(t);
            if (this.network.getLogicalPoint(t) && this.network.isRectSelectEnabled()) {
                this._handle_mousedown(t)
            }
        }
    }, handle_mouseup: function (t) {
        this.end(t)
    }, handle_mousemove: function (t) {
        if (this._button !== 0 || this.network.isMovingElement() || this.network.isEditingElement()) {
            this.end(t);
            return
        }
        this._handle_mousemove(t);
        if (this.mark) {
            this.network.fireInteractionEvent({kind: "selectBetween", event: t})
        } else {
            this.mark = l.createDiv();
            this.network.getTopDiv().appendChild(this.mark);
            this.network.setSelectingElement(true);
            this.network.fireInteractionEvent({kind: "selectStart", event: t})
        }
        var e = d.getRect([this._startLogical, this._endLogical]);
        l.setDiv(this.mark, e, this.getIntersectMode() ? this.network.getSelectFillColor() : null, this.network.getSelectOutlineWidth(), this.network.getSelectOutlineColor())
    }, end: function (t) {
        if (this._startLogical) {
            if (this.mark) {
                if (this._endLogical && this._startLogical.x !== this._endLogical.x && this._startLogical.y !== this._endLogical.y) {
                    var e = this.network.getElementsAtRect(this.mark._viewRect, this.getIntersectMode(), this.network.getRectSelectFilter());
                    if (e && e.size() > 0) {
                        var i = this.network.getSelectionModel();
                        var n = i.toSelection();
                        e.forEach(function (t) {
                            if (i.contains(t)) {
                                n.remove(t)
                            } else {
                                n.add(t)
                            }
                        }, this);
                        i.setSelection(n)
                    }
                    this.network.fireInteractionEvent({kind: "selectEnd", event: t})
                }
                var s = this;
                setTimeout(function () {
                    if (s.mark) {
                        s.network.getTopDiv().removeChild(s.mark);
                        s.mark = null
                    }
                }, 0);
                this.network.setSelectingElement(false)
            }
            this._handle_mouseup(t)
        }
    }, getIntersectMode: function () {
        if (this.network.getSelectMode() === "intersect") {
            return true
        }
        if (this.network.getSelectMode() === "contain") {
            return false
        }
        return this._startLogical.x > this._endLogical.x && this._startLogical.y > this._endLogical.y
    }});
    twaver.network.interaction.MoveInteraction = function (t, e) {
        this.lazyMode = e;
        this.xoffset = 0;
        this.yoffset = 0;
        twaver.network.interaction.MoveInteraction.superClass.constructor.call(this, t)
    };
    _twaver.ext("twaver.network.interaction.MoveInteraction", twaver.network.interaction.BaseInteraction, {setUp: function () {
        this.addListener("mousedown")
    }, tearDown: function () {
        this.removeListener("mousedown");
        this.end()
    }, handle_mousedown: function (t) {
        if (t.button !== 0) {
            return
        }
        if (this.network.isSelectingElement() || this.network.isEditingElement()) {
            return
        }
        var e = this.network.getElementAt(t);
        if (!this.network.isMovable(e)) {
            return
        }
        this.end(t);
        this._handle_mousedown(t)
    }, handle_mouseup: function (t) {
        this.end(t)
    }, handle_mousemove: function (t) {
        if (this.network.isSelectingElement() || this.network.isEditingElement() || !this.network.hasMovableSelectedElements()) {
            this.end(t);
            return
        }
        this._handle_mousemove(t);
        this.xoffset = this._endLogical.x - this._startLogical.x;
        this.yoffset = this._endLogical.y - this._startLogical.y;
        if (this.lazyMode) {
            if (this.mark) {
                this.network.fireInteractionEvent({kind: "lazyMoveBetween", event: t})
            } else {
                this.mark = l.createDiv();
                var e;
                this.network.getMovableSelectedElements().forEach(function (t) {
                    var i = this.getElementUI(t);
                    if (i) {
                        e = d.unionRect(e, i.getViewRect())
                    }
                }, this.network);
                this.network.getTopDiv().appendChild(this.mark);
                this.network.setMovingElement(true);
                l.setDiv(this.mark, e, this.network.isLazyMoveFill() ? this.network.getLazyMoveFillColor() : null, this.network.getLazyMoveOutlineWidth(), this.network.getLazyMoveOutlineColor());
                this.network.fireInteractionEvent({kind: "lazyMoveStart", event: t})
            }
            this.mark.style.left = this.xoffset + this.mark._viewRect.x + "px";
            this.mark.style.top = this.yoffset + this.mark._viewRect.y + "px"
        } else {
            this.network.moveSelectedElements(this.xoffset, this.yoffset);
            this._startLogical = this._endLogical;
            this._startClient = l.getClientPoint(t);
            if (this.network.isMovingElement()) {
                this.network.fireInteractionEvent({kind: "liveMoveBetween", event: t})
            } else {
                this.network.setMovingElement(true);
                this.network.fireInteractionEvent({kind: "liveMoveStart", event: t})
            }
        }
    }, end: function (t) {
        if (this._startLogical) {
            if (this.lazyMode) {
                if (this.mark) {
                    var e = this;
                    var i = function () {
                        e.network.fireInteractionEvent({kind: "lazyMoveEnd", event: t});
                        if (e.mark) {
                            e.network.getTopDiv().removeChild(e.mark);
                            e.mark = null;
                            e.network.setMovingElement(false)
                        }
                    };
                    this.network.moveSelectedElements(this.xoffset, this.yoffset, this.network.isLazyMoveAnimate(), i)
                }
            } else {
                if (this.network.isMovingElement()) {
                    this.network.setMovingElement(false);
                    this.network.fireInteractionEvent({kind: "liveMoveEnd", event: t})
                }
            }
            this._handle_mouseup(t)
        }
    }});
    twaver.network.interaction.PanInteraction = function (t) {
        twaver.network.interaction.PanInteraction.superClass.constructor.call(this, t)
    };
    _twaver.ext("twaver.network.interaction.PanInteraction", twaver.network.interaction.BaseInteraction, {setUp: function () {
        this.addListener("mousedown");
        this._oldCursor = this.network.getView().style.cursor
    }, tearDown: function () {
        this.removeListener("mousedown")
    }, handle_mousedown: function (t) {
        this._startLogical = this.network.getLogicalPoint(t);
        if (this._startLogical) {
            this._handle_mousedown(t);
            this.network.getView().style.cursor = "pointer"
        }
    }, handle_mouseup: function (t) {
        this._clear()
    }, handle_mousemove: function (t) {
        if (!this._startLogical) {
            return
        }
        this._handle_mousemove(t);
        var e = this._startLogical.x - this._endLogical.x;
        var i = this._startLogical.y - this._endLogical.y;
        var n = this.network.panByOffset(e, i);
        this._startLogical = this._endLogical;
        this._startClient = l.getClientPoint(t)
    }, _clear: function (t) {
        if (this._startLogical) {
            this._handle_mouseup(t);
            this.network.getView().style.cursor = this._oldCursor
        }
    }});
    twaver.network.interaction.EditInteraction = function (t, e) {
        this.lazyMode = e;
        this.pointIndex = -1;
        twaver.network.interaction.EditInteraction.superClass.constructor.call(this, t)
    };
    _twaver.ext("twaver.network.interaction.EditInteraction", twaver.network.interaction.BaseInteraction, {setUp: function () {
        this.addListener("mousedown", "mousemove");
        this.oldCursor = this.network.getView().style.cursor;
        this.network.setHasEditInteraction(true)
    }, tearDown: function () {
        this.removeListener("mousedown", "mousemove");
        this.network.getView().style.cursor = this.oldCursor;
        this.network.setHasEditInteraction(false);
        this.clear()
    }, clear: function () {
        this.network.setEditingElement(false);
        this.isStart = false;
        this.node = null;
        this.shapeNode = null;
        this.shapeLink = null;
        this.linkUI = null;
        this.resizingRect = null;
        this.resizeDirection = null;
        this.pointIndex = -1;
        this._removeCursor();
        this.oldCursor = null;
        if (this.mark) {
            this.network.getTopDiv().removeChild(this.mark);
            this.mark = null
        }
    }, _removeCursor: function () {
        if (this.cursorID) {
            this.network.getView().style.cursor = this.oldCursor || "default";
            this.cursorID = null
        }
        this.resizeDirection = null;
        this.isCrossCursor = false
    }, _setCrossCursor: function () {
        if (!this.isCrossCursor) {
            this._removeCursor();
            this._setCursor("crosshair");
            this.isCrossCursor = true
        }
    }, _setCursor: function (t) {
        this.cursorID = t;
        if (this.network.getView().style.cursor !== this.cursorID) {
            this.network.getView().style.cursor = this.cursorID
        }
    }, handle_mousedown: function (t) {
        if (!this.network.isEditingElement()) {
            return
        }
        if (!this.isStart) {
            if (this.node && this.resizeDirection) {
                this.isStart = true;
                this._handle_mousedown(t);
                this.network.fireInteractionEvent({kind: this.lazyMode ? "lazyResizeStart" : "liveResizeStart", event: t, element: this.node, resizeDirection: this.resizeDirection})
            } else if (this.shapeNode && this.pointIndex >= 0) {
                this.isStart = true;
                this._handle_mousedown(t);
                this.network.fireInteractionEvent({kind: "liveMovePointStart", event: t, element: this.shapeNode, pointIndex: this.pointIndex})
            } else if (this.shapeLink && this.pointIndex >= 0) {
                this.isStart = true;
                this._handle_mousedown(t);
                this.network.fireInteractionEvent({kind: "liveMovePointStart", event: t, element: this.shapeLink, pointIndex: this.pointIndex})
            } else if (this.linkUI) {
                this.isStart = true;
                this._handle_mousedown(t);
                this.network.fireInteractionEvent({kind: "liveMovePointStart", event: t, element: this.linkUI._element})
            }
        }
    }, handle_mouseup: function (t) {
        if (this.isStart) {
            var e = _twaver.clone(this._endLogical);
            if (this.resizingRect) {
                if (this.lazyMode) {
                    if (this.network.ResizeAnimate) {
                        var i = this;
                        var n = new twaver.animaate.AnimateBounds(this.node, this.resizingRect, function () {
                            i.network.fireInteractionEvent({kind: "lazyResizeEnd", event: t, element: i.node, resizeDirection: i.resizeDirection})
                        });
                        twaver.animate.AnimateManager.start(n)
                    } else {
                        this.node.setLocation(this.resizingRect.x, this.resizingRect.y);
                        this.node.setSize(this.resizingRect.width, this.resizingRect.height);
                        this.network.fireInteractionEvent({kind: "lazyResizeEnd", event: t, element: this.node, resizeDirection: this.resizeDirection})
                    }
                } else {
                    this.node.setLocation(this.resizingRect.x, this.resizingRect.y);
                    this.node.setSize(this.resizingRect.width, this.resizingRect.height);
                    this.network.fireInteractionEvent({kind: "liveResizeEnd", event: t, element: this.node, resizeDirection: this.resizeDirection})
                }
            } else if (this.shapeNode && this.pointIndex >= 0 && e) {
                this.shapeNode.setPoint(this.pointIndex, e);
                this.network.fireInteractionEvent({kind: "liveMovePointEnd", event: t, element: this.shapeNode, pointIndex: this.pointIndex})
            } else if (this.shapeLink && this.pointIndex >= 0 && e) {
                this.shapeLink.setPoint(this.pointIndex, e);
                this.network.fireInteractionEvent({kind: "liveMovePointEnd", event: t, element: this.shapeLink, pointIndex: this.pointIndex})
            } else if (this.linkUI && e) {
                this.linkUI.setControlPoint(e);
                this.network.fireInteractionEvent({kind: "liveMovePointEnd", event: t, element: this.linkUI._element})
            }
        }
        this._handle_mouseup(t);
        this.clear()
    }, handle_mousemove: function (t) {
        if (this.isStart) {
            if (this.shapeNode && this.pointIndex >= 0) {
                this._handleMovingShapeNodePoint(t);
                return
            }
            if (this.shapeLink && this.pointIndex >= 0) {
                this._handleMovingShapeLinkPoint(t);
                return
            }
            if (this.node && this.resizeDirection) {
                this._handleResizing(t);
                return
            }
            if (this.linkUI) {
                this._handleMovingLinkControlPoint(t);
                return
            }
            return
        }
        if (!this.network.isValidEvent(t)) {
            return
        }
        if (this.network.isSelectingElement() || this.network.isMovingElement() || this.network.getSelectionModel().size() === 0) {
            this.clear();
            return
        }
        var e = this.network.getElementAt(t);
        var i = this.network.getElementUI(e);
        if (!i || !i.getEditAttachment()) {
            this.clear();
            return
        }
        var n = this.network.getLogicalPoint(t);
        if (e instanceof y) {
            this.node = e;
            if (this._isEditingShapeNode(n) || this._isResizingNode(n)) {
                this.network.setEditingElement(true);
                return
            }
        } else if (e instanceof twaver.ShapeLink) {
            this.shapeLink = e;
            if (this._isEditingShapeLink(n)) {
                this.network.setEditingElement(true);
                return
            }
        } else if (i instanceof twaver.network.LinkUI) {
            if (c.isOrthogonalLink(i._element)) {
                this.linkUI = i;
                var s = this.linkUI.getControlPoint();
                if (s && this._contains(n, s)) {
                    this._setCrossCursor();
                    this.network.setEditingElement(true)
                }
                return
            }
        }
        this.clear()
    }, _handleMovingShapeNodePoint: function (t) {
        this._handle_mousemove(t);
        this.shapeNode.setPoint(this.pointIndex, _twaver.clone(this._endLogical));
        this.network.fireInteractionEvent({kind: "liveMovePointBetween", e: t, element: this.shapeNode, pointIndex: this.pointIndex})
    }, _handleMovingShapeLinkPoint: function (t) {
        this._handle_mousemove(t);
        this.shapeLink.setPoint(this.pointIndex, _twaver.clone(this._endLogical));
        this.network.fireInteractionEvent({kind: "liveMovePointBetween", e: t, element: this.shapeLink, pointIndex: this.pointIndex})
    }, _handleMovingLinkControlPoint: function (t) {
        this._handle_mousemove(t);
        this.linkUI.setControlPoint(_twaver.clone(this._endLogical));
        this.network.fireInteractionEvent({kind: "liveMovePointBetween", e: t, element: this.linkUI._element})
    }, _handleResizing: function (t) {
        this._handle_mousemove(t);
        var e = _twaver.clone(this._endLogical);
        var i = this.node.getRect();
        if (this.resizeDirection === "northwest") {
            this.resizingRect = this._getRect(e.x, e.y, i.x + i.width, i.y + i.height)
        }
        if (this.resizeDirection === "north") {
            this.resizingRect = this._getRect(i.x, e.y, i.x + i.width, i.y + i.height)
        }
        if (this.resizeDirection === "northeast") {
            this.resizingRect = this._getRect(i.x, e.y, e.x, i.y + i.height)
        }
        if (this.resizeDirection === "west") {
            this.resizingRect = this._getRect(e.x, i.y, i.x + i.width, i.y + i.height)
        }
        if (this.resizeDirection === "east") {
            this.resizingRect = this._getRect(i.x, i.y, e.x, i.y + i.height)
        }
        if (this.resizeDirection === "southwest") {
            this.resizingRect = this._getRect(e.x, i.y, i.x + i.width, e.y)
        }
        if (this.resizeDirection === "south") {
            this.resizingRect = this._getRect(i.x, i.y, i.x + i.width, e.y)
        }
        if (this.resizeDirection === "southeast") {
            this.resizingRect = this._getRect(i.x, i.y, e.x, e.y)
        }
        if (this.lazyMode) {
            if (!this.mark) {
                this.mark = l.createDiv();
                this.network.getTopDiv().appendChild(this.mark)
            }
            l.setDiv(this.mark, this.resizingRect, null, this.network.getResizeLineWidth(), this.network.getResizeLineColor());
            this.network.fireInteractionEvent({kind: "lazyResizeBetween", event: t, element: this.node, resizeDirection: this.resizeDirection})
        } else {
            this.node.setLocation(this.resizingRect.x, this.resizingRect.y);
            this.node.setSize(this.resizingRect.width, this.resizingRect.height);
            this.network.fireInteractionEvent({kind: "liveResizeBetween", event: t, element: this.node, resizeDirection: this.resizeDirection})
        }
    }, _isEditingShapeNode: function (t) {
        if (this.node instanceof twaver.ShapeNode) {
            this.shapeNode = this.node;
            var e = this.shapeNode.getPoints();
            for (var i = 0, n = e.size(); i < n; i++) {
                var s = e.get(i);
                if (this._contains(t, s)) {
                    this._setCrossCursor();
                    this.pointIndex = i;
                    return true
                }
            }
        }
        this.pointIndex = -1;
        return false
    }, _isEditingShapeLink: function (t) {
        var e = this.shapeLink.getPoints();
        for (var i = 0, n = e.size(); i < n; i++) {
            var s = e.get(i);
            if (this._contains(t, s)) {
                this._setCrossCursor();
                this.pointIndex = i;
                return true
            }
        }
        this.pointIndex = -1;
        return false
    }, _isResizingNode: function (t) {
        var e = this.network.getEditPointSize();
        var i = this.node.getRect();
        if (this._isResizing(t, i.x, i.y, "northwest", "nwse-resize")) {
            return true
        }
        if (this._isResizing(t, i.x + i.width / 2, i.y, "north", "ns-resize")) {
            return true
        }
        if (this._isResizing(t, i.x + i.width, i.y, "northeast", "nesw-resize")) {
            return true
        }
        if (this._isResizing(t, i.x, i.y + i.height / 2, "west", "ew-resize")) {
            return true
        }
        if (this._isResizing(t, i.x + i.width, i.y + i.height / 2, "east", "ew-resize")) {
            return true
        }
        if (this._isResizing(t, i.x, i.y + i.height, "southwest", "nesw-resize")) {
            return true
        }
        if (this._isResizing(t, i.x + i.width / 2, i.y + i.height, "south", "ns-resize")) {
            return true
        }
        if (this._isResizing(t, i.x + i.width, i.y + i.height, "southeast", "nwse-resize")) {
            return true
        }
        return false
    }, _isResizing: function (t, e, i, n, s) {
        if (this._contains(t, {x: e, y: i})) {
            if (this.resizeDirection !== n) {
                this._removeCursor();
                this._setCursor(s);
                this.resizeDirection = n
            }
            return true
        }
        return false
    }, _getRect: function (t, e, i, n) {
        var s = t < i ? t : i;
        var r = e < n ? e : n;
        var o = Math.abs(t - i);
        var a = Math.abs(e - n);
        return{x: s, y: r, width: o, height: a}
    }, _contains: function (t, e) {
        var i = this.network.getEditPointSize();
        var n = {x: e.x - i, y: e.y - i, width: i * 2, height: i * 2};
        return d.containsPoint(n, t)
    }});
    twaver.network.interaction.CreateElementInteraction = function (t, e) {
        if (!e) {
            e = y
        }
        if (twaver.Util.isTypeOf(e, y)) {
            this.elementFunction = function (t) {
                var i = new e;
                if (i instanceof y) {
                    i.setCenterLocation(t)
                }
                return i
            }
        } else {
            this.elementFunction = e
        }
        twaver.network.interaction.CreateElementInteraction.superClass.constructor.call(this, t)
    };
    _twaver.ext("twaver.network.interaction.CreateElementInteraction", twaver.network.interaction.BaseInteraction, {setUp: function () {
        this.addListener("mousedown")
    }, tearDown: function () {
        this.removeListener("mousedown")
    }, handle_mousedown: function (t) {
        var e = this.network.getLogicalPoint(t);
        if (e) {
            var i = this.elementFunction(e);
            if (i) {
                this.network.addElementByInteraction(i)
            }
        }
    }});
    twaver.network.interaction.CreateLinkInteraction = function (t, e) {
        if (!e) {
            e = twaver.Link
        }
        if (twaver.Util.isTypeOf(e, twaver.Link)) {
            this.linkFunction = function (t, i) {
                var n = new e;
                if (n instanceof twaver.Link) {
                    n.setFromNode(t);
                    n.setToNode(i)
                }
                return n
            }
        } else {
            this.linkFunction = e
        }
        twaver.network.interaction.CreateLinkInteraction.superClass.constructor.call(this, t)
    };
    _twaver.ext("twaver.network.interaction.CreateLinkInteraction", twaver.network.interaction.BaseInteraction, {setUp: function () {
        this.addListener("mousedown", "mousemove")
    }, tearDown: function () {
        this.removeListener("mousedown", "mousemove");
        this.clear()
    }, clear: function () {
        var t = this;
        setTimeout(function () {
            if (t._fromRectangle) {
                t.network.getTopDiv().removeChild(t._fromRectangle);
                t._fromRectangle = null
            }
            if (t._currentRectangle) {
                t.network.getTopDiv().removeChild(t._currentRectangle);
                t._currentRectangle = null
            }
            if (t._line) {
                t.network.getTopDiv().removeChild(t._line);
                t._line = null
            }
        });
        this.currentPoint = null;
        this.currentNode = null;
        this.fromNode = null;
        this.toNode = null
    }, createLink: function () {
        return this.linkFunction(this.fromNode, this.toNode)
    }, handle_mousedown: function (t) {
        if (!this.network.isValidEvent(t)) {
            return
        }
        if (this.fromNode) {
            this.toNode = this.currentNode;
            if (this.toNode) {
                var e = this.createLink();
                if (e) {
                    this.network.addElementByInteraction(e)
                }
            }
            this.clear()
        } else {
            this.fromNode = this.currentNode;
            this.currentNode = null;
            this.currentPoint = null;
            this.updateMark()
        }
    }, handle_mousemove: function (t) {
        var e = this.network.getLogicalPoint(t);
        if (!e) {
            return
        }
        if (this.network.isMovingElement() || this.network.isEditingElement()) {
            this.clear();
            return
        }
        var i = null;
        if (this.fromNode) {
            this.currentNode = this.getToNode(t);
            this.currentPoint = e;
            this.updateMark()
        } else {
            i = this.getFromNode(t);
            if (this.currentNode !== i) {
                this.currentNode = i;
                this.updateMark()
            }
        }
    }, getFromNode: function (t) {
        var e = this.network.getElementAt(t);
        if (e instanceof y) {
            return e
        }
        return null
    }, getToNode: function (t) {
        var e = this.network.getElementAt(t);
        if (e instanceof y) {
            return e
        }
        return null
    }, updateMark: function () {
        var t;
        if (this.fromNode && !this._fromRectangle && this._currentRectangle) {
            this._fromRectangle = this._currentRectangle;
            this._currentRectangle = null
        }
        if (!this.fromNode && this._fromRectangle) {
            this.network.getTopDiv().removeChild(this._fromRectangle);
            this._fromRectangle = null
        }
        if (this.currentNode && !this._currentRectangle) {
            t = this.network.getElementUI(this.currentNode);
            this._currentRectangle = l.createDiv();
            this.network.getTopDiv().appendChild(this._currentRectangle);
            l.setDiv(this._currentRectangle, t._viewRect, null, this.network.getEditLineWidth(), this.network.getEditLineColor())
        }
        if (!this.currentNode && this._currentRectangle) {
            this.network.getTopDiv().removeChild(this._currentRectangle);
            this._currentRectangle = null
        }
        this.updateLine()
    }, updateLine: function () {
        if (this.currentPoint) {
            var t = this.fromNode.getCenterLocation();
            var e = t.x, i = t.y;
            var n = this.currentPoint.x, s = this.currentPoint.y;
            if (!this._line) {
                this._line = l.createCanvas();
                this.network.getTopDiv().appendChild(this._line)
            }
            var r = l.setCanvas(this._line, Math.min(e, n), Math.min(i, s), Math.abs(e - n), Math.abs(i - s));
            r.lineWidth = this.network.getEditLineWidth();
            r.strokeStyle = this.network.getEditLineColor();
            r.beginPath();
            r.moveTo(e, i);
            r.lineTo(n, s);
            r.stroke()
        } else {
            if (this._line) {
                this.network.getTopDiv().removeChild(this._line);
                this._line = null
            }
        }
    }});
    twaver.network.interaction.CreateShapeNodeInteraction = function (t, e) {
        if (!e) {
            e = twaver.ShapeNode
        }
        if (twaver.Util.isTypeOf(e, twaver.ShapeNode)) {
            this.shapeNodeFunction = function (t) {
                var i = new e;
                if (i instanceof twaver.ShapeNode) {
                    if (t) {
                        i.setPoints(t)
                    }
                }
                return i
            }
        } else {
            this.shapeNodeFunction = e
        }
        twaver.network.interaction.CreateShapeNodeInteraction.superClass.constructor.call(this, t)
    };
    _twaver.ext("twaver.network.interaction.CreateShapeNodeInteraction", twaver.network.interaction.BaseInteraction, {setUp: function () {
        this.addListener("mousedown", "mousemove")
    }, tearDown: function () {
        this.removeListener("mousedown", "mousemove");
        this.clear()
    }, clear: function () {
        this.network.setEditingElement(false);
        this.points = null;
        this.currentPoint = null;
        if (this.mark) {
            this.network.getTopDiv().removeChild(this.mark);
            this.mark = null
        }
    }, handle_mousedown: function (t) {
        var e = this.network.getLogicalPoint(t);
        if (!e) {
            return
        }
        if (t.detail === 2) {
            if (this.points) {
                var i = this.shapeNodeFunction(this.points);
                this.network.addElementByInteraction(i);
                this.clear();
                var n = this;
                setTimeout(function () {
                    n.network.setEditingElement(false)
                }, 0)
            }
        } else {
            if (!this.network.isEditingElement()) {
                this.network.setEditingElement(true)
            }
            if (!this.points) {
                this.points = new p
            }
            if (this.points.size() > 0) {
                var s = this.points.get(this.points.size() - 1);
                if (s.x === e.x && s.y === e.y) {
                    return
                }
            }
            this.points.add(e);
            this.updateMark()
        }
    }, handle_mousemove: function (t) {
        if (this.points) {
            this.currentPoint = this.network.getLogicalPoint(t);
            this.updateMark()
        }
    }, updateMark: function (t) {
        if (this.points && this.points.size() > 0) {
            if (this.currentPoint) {
                if (!this.mark) {
                    this.mark = l.createCanvas();
                    this.network.getTopDiv().appendChild(this.mark)
                }
                var e = new p(this.points);
                e.add(this.currentPoint);
                var i = d.getRect(e);
                var n = l.setCanvas(this.mark, i);
                n.lineWidth = this.network.getEditLineWidth();
                n.strokeStyle = this.network.getEditLineColor();
                n.beginPath();
                a.drawLinePoints(n, e);
                n.stroke()
            }
        }
    }});
    twaver.network.interaction.CreateShapeLinkInteraction = function (t, e) {
        twaver.network.interaction.CreateShapeLinkInteraction.superClass.constructor.call(this, t);
        if (!e) {
            e = twaver.ShapeLink
        }
        if (twaver.Util.isTypeOf(e, twaver.ShapeLink)) {
            this.linkFunction = function (t, i, n) {
                var s = new e;
                if (s instanceof twaver.ShapeLink) {
                    s.setFromNode(t);
                    s.setToNode(i);
                    if (n) {
                        s.setPoints(n)
                    }
                }
                return s
            }
        } else {
            this.linkFunction = e
        }
    };
    _twaver.ext("twaver.network.interaction.CreateShapeLinkInteraction", twaver.network.interaction.CreateLinkInteraction, {clear: function () {
        this.network.setEditingElement(false);
        this.points = null;
        if (this.polyline) {
            this.network.getTopDiv().removeChild(this.polyline);
            this.polyline = null
        }
        twaver.network.interaction.CreateShapeLinkInteraction.superClass.clear.call(this)
    }, createLink: function () {
        return this.linkFunction(this.fromNode, this.toNode, this.points)
    }, handle_mousedown: function (t) {
        var e = this.network.getLogicalPoint(t);
        if (!e) {
            return
        }
        if (this.fromNode) {
            this.toNode = this.currentNode;
            if (this.toNode) {
                var i = this.createLink();
                if (i) {
                    this.network.addElementByInteraction(i)
                }
                this.clear()
            } else {
                if (!this.points) {
                    this.points = new p
                }
                if (this.points.size() > 0) {
                    var n = this.points.get(this.points.size() - 1);
                    if (n.x === e.x && n.y === e.y) {
                        return
                    }
                }
                this.points.add(e);
                this.updateMark()
            }
        } else {
            this.fromNode = this.currentNode;
            if (this.fromNode) {
                if (!this.polyline) {
                    this.polyline = l.createCanvas();
                    this.network.getTopDiv().appendChild(this.polyline)
                }
            }
            this.points = null;
            this.currentNode = null;
            this.currentPoint = null;
            this.updateMark()
        }
    }, updateLine: function () {
        if (this.currentPoint) {
            if (this.polyline) {
                var t = new p(this.points);
                t.add(this.fromNode.getCenterLocation(), 0);
                t.add(this.currentPoint);
                var e = d.getRect(t);
                var i = l.setCanvas(this.polyline, e);
                i.lineWidth = this.network.getEditLineWidth();
                i.strokeStyle = this.network.getEditLineColor();
                i.beginPath();
                a.drawLinePoints(i, t);
                i.stroke()
            }
        }
    }});
    twaver.network.interaction.CreateOrthogonalLinkInteraction = function (t, e, i, n, s, r) {
        twaver.network.interaction.CreateOrthogonalLinkInteraction.superClass.constructor.call(this, t, e);
        this.linkType = i || "orthogonal";
        this.isByControlPoint = n;
        this.splitPercent = s;
        this.isSplitByPercent = r;
        this.link = new twaver.Link;
        this.link.setStyle("link.type", this.linkType);
        this.link.setStyle("link.split.by.percent", this.isSplitByPercent);
        if (c.isFlexionalTypeLink(this.linkType) || c.isExtendTypeLink(this.linkType)) {
            if (this.splitPercent < 0) {
                this.splitPercent = twaver.Styles.getStyle("link.extend")
            }
            this.link.setStyle("link.extend", this.splitPercent)
        } else if (c.isSplitTypeLink(this.linkType)) {
            if (this.splitPercent < 0) {
                this.splitPercent = twaver.Styles.getStyle(this.isSplitByPercent ? "link.split.percent" : "link.split.value")
            }
            if (this.isSplitByPercent) {
                this.link.setStyle("link.split.percent", this.splitPercent)
            } else {
                this.link.setStyle("link.split.value", this.splitPercent)
            }
        }
    };
    _twaver.ext("twaver.network.interaction.CreateOrthogonalLinkInteraction", twaver.network.interaction.CreateLinkInteraction, {clear: function () {
        if (this.path) {
            this.network.getTopDiv().removeChild(this.path);
            this.path = null
        }
        twaver.network.interaction.CreateOrthogonalLinkInteraction.superClass.clear.call(this)
    }, createLink: function () {
        var t = twaver.network.interaction.CreateOrthogonalLinkInteraction.superClass.createLink.call(this);
        t.setStyle("link.type", this.linkType);
        t.setStyle("link.split.by.percent", this.isSplitByPercent);
        if (this.isByControlPoint) {
            var e = c.getControlPoint(t);
            if (e) {
                t.SetStyle("link.control.point", e);
                return t
            }
        } else {
            if (c.isFlexionalTypeLink(this.linkType) || c.isExtendTypeLink(this.linkType)) {
                if (this.splitPercent < 0) {
                    this.splitPercent = twaver.Styles.getStyle("link.extend")
                }
                t.setStyle("link.extend", this.splitPercent)
            } else if (c.isSplitTypeLink(this.linkType)) {
                if (this.splitPercent < 0) {
                    this.splitPercent = twaver.Styles.getStyle(this.isSplitByPercent ? "link.split.percent" : "link.split.value")
                }
                if (this.isSplitByPercent) {
                    t.setStyle("link.split.percent", this.splitPercent)
                } else {
                    t.setStyle("link.split.value", this.splitPercent)
                }
            }
        }
        return t
    }, updateLine: function () {
        if (this.currentPoint) {
            if (!this.fromNode || this.currentNode === this.fromNode) {
                return
            }
            var t;
            var e = this.network.getElementUI(this.fromNode);
            if (!e) {
                return
            }
            t = e.getBodyRect();
            if (t == null) {
                return
            }
            var i;
            if (this.currentNode && this.currentNode !== this.fromNode) {
                var n = this.network.getElementUI(this.currentNode);
                if (!n) {
                    return
                }
                i = n.getBodyRect()
            } else {
                i = {x: this.currentPoint.x, y: this.currentPoint.y, width: 1, height: 1}
            }
            if (!i) {
                return
            }
            var s = c.calculateOrthogonalAndFlexionalLinkPoints(this.linkType, t, i, this.link);
            c.drawCorner(s, this.link);
            if (s.size() < 2) {
                return
            }
            if (!this.line) {
                this.line = l.createCanvas();
                this.network.getTopDiv().appendChild(this.line)
            }
            var r = l.setCanvas(this.line, d.getLineRect(s));
            r.lineWidth = this.network.getEditLineWidth();
            r.strokeStyle = this.network.getEditLineColor();
            r.beginPath();
            a.drawLinePoints(r, s);
            r.stroke()
        } else {
            if (this.line) {
                this.network.getTopDiv().removeChild(this.line);
                this.line = null
            }
        }
    }});
    twaver.network.interaction.MagnifyInteraction = function (t, e, i, n) {
        twaver.network.interaction.MagnifyInteraction.superClass.constructor.call(this, t);
        this.scale = e || 2;
        this.xRadius = i || 100;
        this.yRadius = n || 100;
        this.markCanvas = l.createCanvas();
        this.markCanvas._isIgnored = true
    };
    _twaver.ext("twaver.network.interaction.MagnifyInteraction", twaver.network.interaction.BaseInteraction, {setUp: function () {
        this.addListener("mousemove")
    }, tearDown: function () {
        this.removeListener("mousemove");
        this._clear()
    }, handle_mousemove: function (t) {
        var e = this.network.getLogicalPoint(t);
        if (!e) {
            return
        }
        if (!this.lastPoint) {
            this.network.getTopDiv().appendChild(this.markCanvas)
        }
        this.lastPoint = e;
        this.updateMark()
    }, updateMark: function () {
        var t = this.xRadius / this.scale / this.network._zoom;
        var e = this.yRadius / this.scale / this.network._zoom;
        var i = {x: this.lastPoint.x - t, y: this.lastPoint.y - e, width: t * 2, height: e * 2};
        l.setCanvas(this.markCanvas, this.lastPoint.x - this.xRadius / this.network._zoom, this.lastPoint.y - this.yRadius / this.network._zoom, this.xRadius / this.network._zoom * 2, this.yRadius / this.network._zoom * 2);
        this.network.toCanvasByRegion(i, this.scale, this.markCanvas)
    }, _clear: function (t) {
        if (this.lastPoint) {
            this.network.getTopDiv().removeChild(this.markCanvas);
            this.lastPoint = null
        }
    }});
    twaver.network.interaction.TouchInteraction = function (t) {
        twaver.network.interaction.TouchInteraction.superClass.constructor.call(this, t)
    };
    _twaver.ext("twaver.network.interaction.TouchInteraction", twaver.network.interaction.BaseInteraction, {setUp: function () {
        var t = this.network.getView();
        l.addEventListener("touchstart", "handleTouchstart", t, this);
        l.addEventListener("touchmove", "handleTouchmove", t, this);
        l.addEventListener("touchend", "handleTouchend", t, this);
        l.addEventListener("touchcancel", "handleTouchend", t, this)
    }, tearDown: function () {
        var t = this.network.getView();
        l.removeEventListener("touchstart", t, this);
        l.removeEventListener("touchmove", t, this);
        l.removeEventListener("touchend", t, this);
        l.removeEventListener("touchcancel", t, this)
    }, handleTouchstart: function (t) {
        l.preventDefault(t);
        if (t.touches && t.touches.length == 1) {
            var e = this.network.getLogicalPoint(t);
            var i = this.network.getElementAt(e);
            this._startTouchTime = new Date;
            this._startTouchPoint = e;
            if (i) {
                this._haveElementUnderTouch = true;
                this._startTouchElement = i
            } else {
                this._haveElementUnderTouch = false;
                this._startTouchElement = null
            }
        } else if (t.touches && t.touches.length == 2) {
            this._distance = g.getDistance(t);
            this._zoom = this.network.getZoom()
        }
        this._touchCount = t.touches.length
    }, handleTouchmove: function (t) {
        l.preventDefault(t);
        if (this._touchCount == 2 && t.touches && t.touches.length == 2) {
            var e = g.getDistance(t) / this._distance;
            this.network.setZoom(this._zoom * e, false)
        } else if (this._touchCount == 1 && t.touches && t.touches.length == 1) {
            if (this._haveElementUnderTouch || !this.network.isRectSelectEnabled()) {
                var i = this.network.getLogicalPoint(t);
                var n = this.network.getElementAt(i);
                if (this.network.isMovingElement() || this._startTouchElement != null && this._startTouchElement == n && this.network.getMovableSelectedElements().contains(n)) {
                    var s = i.x - this._startTouchPoint.x;
                    var r = i.y - this._startTouchPoint.y;
                    this._startTouchPoint = i;
                    this.network.moveSelectedElements(s, r);
                    if (this.network.isMovingElement()) {
                        this.network.fireInteractionEvent({kind: "liveMoveBetween", event: t})
                    } else {
                        this.network.setMovingElement(true);
                        this.network.fireInteractionEvent({kind: "liveMoveStart", event: t})
                    }
                } else {
                    var s = this._startTouchPoint.x - i.x;
                    var r = this._startTouchPoint.y - i.y;
                    var o = this.network.panByOffset(s, r);
                    this._startTouchPoint.x -= s - o.x;
                    this._startTouchPoint.y -= r - o.y
                }
            } else {
                this._moveTouchPoint = this.network.getLogicalPoint(t);
                if (this.mark) {
                    this.network.fireInteractionEvent({kind: "selectBetween", event: t})
                } else {
                    this.mark = l.createDiv();
                    this.network.getTopDiv().appendChild(this.mark);
                    this.network.setSelectingElement(true);
                    this.network.fireInteractionEvent({kind: "selectStart", event: t})
                }
                var a = d.getRect([this._startTouchPoint, this._moveTouchPoint]);
                l.setDiv(this.mark, a, this.getIntersectMode() ? this.network.getSelectFillColor() : null, this.network.getSelectOutlineWidth(), this.network.getSelectOutlineColor())
            }
        }
    }, handleTouchend: function (t) {
        l.preventDefault(t);
        if (this.network.isMovingElement()) {
            this.network.setMovingElement(false);
            this.network.fireInteractionEvent({kind: "liveMoveEnd", event: t})
        } else if (this.network.isSelectingElement()) {
            var e = this.network.getElementsAtRect(this.mark._viewRect, this.getIntersectMode(), this.network.getRectSelectFilter());
            if (e && e.size() > 0) {
                var i = this.network.getSelectionModel();
                var n = i.toSelection();
                e.forEach(function (t) {
                    if (i.contains(t)) {
                        n.remove(t)
                    } else {
                        n.add(t)
                    }
                }, this);
                i.setSelection(n)
            }
            this.network.fireInteractionEvent({kind: "selectEnd", event: t});
            this.network.getTopDiv().removeChild(this.mark);
            this.mark = null;
            this.network.setSelectingElement(false)
        } else if (this._startTouchPoint) {
            var s = new Date;
            var r = this.network.getLogicalPoint(t);
            var o = this.network.getElementAt(this._startTouchPoint);
            if (this._startTouchPoint && r && s.getTime() - this._startTouchTime.getTime() <= 500 && d.getDistance(this._startTouchPoint, r) <= 20) {
                if (o) {
                    if (!this.network.getSelectionModel().contains(o)) {
                        this.network.getSelectionModel().setSelection(o)
                    }
                } else {
                    this.network.getSelectionModel().clearSelection()
                }
                v.handleClicked(this.network, t, o);
                if (this._endTouchTime && s.getTime() - this._endTouchTime.getTime() <= 500 && d.getDistance(this._endTouchPoint, r) <= 20) {
                    delete this._endTouchTime;
                    delete this._endTouchPoint;
                    v.handleDoubleClicked(this.network, t, o)
                } else {
                    this._endTouchTime = s;
                    this._endTouchPoint = r
                }
            }
        }
    }, getIntersectMode: function () {
        if (this.network.getSelectMode() === "intersect") {
            return true
        }
        if (this.network.getSelectMode() === "contain") {
            return false
        }
        return this._startTouchPoint.x > this._moveTouchPoint.x && this._startTouchPoint.y > this._moveTouchPoint.y
    }});
    twaver.network.interaction.MSTouchInteraction = function (t) {
        twaver.network.interaction.MSTouchInteraction.superClass.constructor.call(this, t);
        this._pointerMap = {};
        this._pointerIdArray = []
    };
    _twaver.ext("twaver.network.interaction.MSTouchInteraction", twaver.network.interaction.BaseInteraction, {setUp: function () {
        var t = this.network.getView();
        l.addEventListener("MSPointerDown", "handleTouchstart", t, this);
        l.addEventListener("MSPointerMove", "handleTouchmove", t, this);
        l.addEventListener("MSPointerUp", "handleTouchend", t, this);
        l.addEventListener("MSPointerCancel", "handleTouchend", t, this)
    }, tearDown: function () {
        var t = this.network.getView();
        l.removeEventListener("MSPointerDown", t, this);
        l.removeEventListener("MSPointerMove", t, this);
        l.removeEventListener("MSPointerUp", t, this);
        l.removeEventListener("MSPointerCancel", t, this)
    }, handleTouchstart: function (t) {
        if (this.network.isFocusOnClick()) {
            twaver.Util.setFocus(this.network._view)
        }
        if (this.network.isSelectingElement() && t.pointerType == t.MSPOINTER_TYPE_MOUSE) {
            return
        }
        var e = this.network.getLogicalPoint(t);
        var i = new Date;
        if (t.isPrimary && this._pointerIdArray.length > 0) {
            this.handle_mouseup(t)
        }
        if (!this._pointerMap[t.pointerId]) {
            this._pointerIdArray.push(t.pointerId);
            this._pointerMap[t.pointerId] = t
        }
        if (this._pointerIdArray.length == 1) {
            var n = this.network.getElementAt(e);
            this._startTouchElement = n;
            this._startClientPoint = {x: t.clientX, y: t.clientY};
            v.handleClicked(this.network, t, n);
            if (this._startTouchTime && this._startTouchPoint && i.getTime() - this._startTouchTime.getTime() <= 500 && d.getDistance(this._startTouchPoint, e) <= 20) {
                v.handleDoubleClicked(this.network, t, n);
                this._doubleClick = true
            } else {
                l.handle_mousedown(this, t);
                this._startTouchPoint = e;
                this._startTouchTime = i
            }
            var s = this.network.getSelectionModel();
            if (n) {
                if (_twaver.isCtrlDown(t)) {
                    if (s.contains(n)) {
                        s.removeSelection(n)
                    } else {
                        s.appendSelection(n)
                    }
                } else {
                    if (!s.contains(n)) {
                        s.setSelection(n)
                    }
                }
            } else {
                if (!_twaver.isCtrlDown(t)) {
                    s.clearSelection()
                }
            }
        } else if (this._pointerIdArray.length == 2) {
            this._distance = this._getDistance();
            this._zoom = this.network.getZoom()
        }
    }, handleTouchmove: function (t) {
        if (this._startTouchPoint == null || this._pointerIdArray.length == 0 || !this._pointerMap[t.pointerId] || d.getDistance({x: this._pointerMap[t.pointerId].pageX, y: this._pointerMap[t.pointerId].pageY}, {x: t.pageX, y: t.pageY}) <= 10) {
            return
        }
        this._pointerMap[t.pointerId] = t;
        if (this._pointerIdArray.length == 2) {
            var e = this._getDistance() / this._distance;
            this.network.setZoom(this._zoom * e, false)
        }
    }, handleTouchend: function (t) {
        if (this.network.isMovingElement()) {
            this.network.setMovingElement(false);
            this.network.fireInteractionEvent({kind: "liveMoveEnd", event: t})
        }
        if (this.network.isSelectingElement()) {
            var e = this.network.getElementsAtRect(this.mark._viewRect, this.getIntersectMode(), this.network.getRectSelectFilter());
            if (e && e.size() > 0) {
                var i = this.network.getSelectionModel();
                var n = i.toSelection();
                e.forEach(function (t) {
                    if (i.contains(t)) {
                        n.remove(t)
                    } else {
                        n.add(t)
                    }
                }, this);
                i.setSelection(n)
            }
            this.network.fireInteractionEvent({kind: "selectEnd", event: t});
            this.network.getTopDiv().removeChild(this.mark);
            this.mark = null;
            this.network.setSelectingElement(false)
        }
        if (this._doubleClick) {
            delete this._doubleClick;
            delete this._startTouchPoint;
            delete this._startTouchTime
        }
        var s = -1;
        for (var r = 0; r < this._pointerIdArray.length; r++) {
            if (this._pointerIdArray[r] == t.pointerId) {
                s = r;
                break
            }
        }
        if (s >= 0)this._pointerIdArray.splice(s, 1);
        delete this._pointerMap[t.pointerId]
    }, _getDistance: function () {
        return d.getDistance({x: this._pointerMap[this._pointerIdArray[0]].pageX, y: this._pointerMap[this._pointerIdArray[0]].pageY}, {x: this._pointerMap[this._pointerIdArray[1]].pageX, y: this._pointerMap[this._pointerIdArray[1]].pageY})
    }, getIntersectMode: function () {
        if (this.network.getSelectMode() === "intersect") {
            return true
        }
        if (this.network.getSelectMode() === "contain") {
            return false
        }
        return this._startTouchPoint.x > this._moveTouchPoint.x && this._startTouchPoint.y > this._moveTouchPoint.y
    }, handle_mousemove: function (t) {
        if (this._startTouchPoint && this._pointerIdArray.length == 1) {
            this._moveTouchPoint = {x: this._startTouchPoint.x + (t.clientX - this._startClientPoint.x) / this.network.getZoom(), y: this._startTouchPoint.y + (t.clientY - this._startClientPoint.y) / this.network.getZoom()};
            if (d.getDistance(this._startTouchPoint, this._moveTouchPoint) < 3)return;
            if (this._startTouchElement == null && this.network.isRectSelectEnabled()) {
                if (this.mark) {
                    this.network.fireInteractionEvent({kind: "selectBetween", event: t})
                } else {
                    this.mark = l.createDiv();
                    this.network.getTopDiv().appendChild(this.mark);
                    this.network.setSelectingElement(true);
                    this.network.fireInteractionEvent({kind: "selectStart", event: t})
                }
                var e = d.getRect([this._startTouchPoint, this._moveTouchPoint]);
                l.setDiv(this.mark, e, this.getIntersectMode() ? this.network.getSelectFillColor() : null, this.network.getSelectOutlineWidth(), this.network.getSelectOutlineColor())
            } else {
                var i = this.network.getElementAt(this._moveTouchPoint);
                var n = this._moveTouchPoint.x - this._startTouchPoint.x;
                var s = this._moveTouchPoint.y - this._startTouchPoint.y;
                if (this._startTouchElement == null && !this.network.isRectSelectEnabled()) {
                    var r = this.network.panByOffset(-n, -s)
                } else if (this.network.isMovingElement() || this._startTouchElement != null && i == this._startTouchElement && this.network.getMovableSelectedElements().contains(i)) {
                    this.network.moveSelectedElements(n, s);
                    if (this.network.isMovingElement()) {
                        this.network.fireInteractionEvent({kind: "liveMoveBetween", event: t})
                    } else {
                        this.network.setMovingElement(true);
                        this.network.fireInteractionEvent({kind: "liveMoveStart", event: t})
                    }
                }
                this._startClientPoint.x = t.clientX;
                this._startClientPoint.y = t.clientY
            }
        }
    }, handle_mouseup: function (t) {
        this.handleTouchend(t);
        this._pointerIdArray = [];
        this._pointerMap = {}
    }})
})(window);
(function (e, t) {
    var i = twaver.List;
    var a = twaver.Node;
    var r = twaver.Group;
    twaver.XmlSerializer = function (e, t, i) {
        this.dataBox = e;
        this.settings = t ? t : new twaver.SerializationSettings;
        this.filterFunction = i;
        this.ref = 0;
        this.refMap = {};
        this.idMap = {};
        this.xmlString = ""
    };
    _twaver.ext("twaver.XmlSerializer", Object, {serialize: function () {
        this.xmlString = "<twaver version='" + twaver.Util.getVersion() + "' platform='html5'>\n";
        this.serializeBody();
        this.xmlString += "</twaver>\n";
        return this.xmlString
    }, serializeBody: function () {
        this.ref = 0;
        this.dataBox.getRoots().forEach(this.initRefs, this);
        if (this.settings.isDataBoxSerializable) {
            this.xmlString += "<dataBox class='" + this.dataBox.getClassName() + "'>\n";
            this.dataBox.serializeXml(this, this.dataBox.newInstance());
            this.xmlString += "</dataBox>\n"
        }
        this.dataBox.getRoots().forEach(this.serializeData, this)
    }, initRefs: function (e) {
        this.refMap[e.getId()] = this.ref++;
        e.getChildren().forEach(this.initRefs, this)
    }, isSerializable: function (e) {
        if (!this.dataBox.contains(e)) {
            return false
        }
        if (this.filterFunction && !this.filterFunction(e)) {
            return false
        }
        return true
    }, serializeData: function (e) {
        if (this.isSerializable(e)) {
            var t = e.newInstance();
            var i = this.refMap[e.getId()];
            this.xmlString += "<data class='" + e.getClassName() + "' ref='" + i + "'";
            if (this.settings.getPropertyType("id") != null) {
                this.xmlString += " id='" + e.getId() + "'"
            }
            this.xmlString += ">\n";
            e.serializeXml(this, t);
            this.xmlString += "</data>\n"
        }
        e.getChildren().forEach(this.serializeData, this)
    }, serializePropertyXml: function (e, t, i) {
        var a = this.settings.getPropertyType(t);
        if (a) {
            var r = _twaver.getValue(e, t, a);
            var l = _twaver.getValue(i, t, a);
            if (r !== l) {
                this.serializeValue("p", t, r, l, a)
            }
        }
    }, serializeStyleXml: function (e, t, i) {
        var a = this.settings.getStyleType(t);
        if (a) {
            var r = e.getStyle(t);
            var l = i.getStyle(t);
            if (r != l) {
                this.serializeValue("s", t, r, l, a)
            }
        }
    }, serializeClientXml: function (e, t, i) {
        var a = this.settings.getClientType(t);
        if (a != null) {
            var r = e.getClient(t);
            var l = i.getClient(t);
            if (r != l) {
                this.serializeValue("c", t, r, l, a)
            }
        }
    }, serializeValue: function (e, t, i, a, r) {
        if (i == null) {
            this.xmlString += "	<" + e + " n='" + t + "' none=''/>\n"
        } else if (r === "cdata") {
            this.xmlString += "	<" + e + " n='" + t + "'><![CDATA[" + i + "]]></" + e + ">\n"
        } else if (r === "data") {
            var l = this.refMap[i.getId()];
            if (l != null) {
                this.xmlString += "	<" + e + " n='" + t + "' ref='" + l + "'/>\n"
            }
        } else if (r === "point") {
            if (!a || i.x !== a.x || i.y !== a.y) {
                this.xmlString += "	<" + e + " n='" + t + "' x='" + i.x + "' y='" + i.y + "'/>\n"
            }
        } else if (r === "list.point") {
            this.xmlString += "	<" + e + " n='" + t + "'>\n";
            i.forEach(function (e) {
                this.xmlString += "		<p x='" + e.x + "' y='" + e.y + "'/>\n"
            }, this);
            this.xmlString += "	</" + e + ">\n"
        } else if (r === "list.string" || r === "list.number") {
            this.xmlString += "	<" + e + " n='" + t + "'>\n";
            i.forEach(function (e) {
                this.xmlString += "		<s>" + e + "</s>\n"
            }, this);
            this.xmlString += "	</" + e + ">\n"
        } else if (r === "rectangle") {
            this.xmlString += "	<" + e + " n='" + t + "' x='" + i.x + "' y='" + i.y + "' w='" + i.width + "' h='" + i.height + "'/>\n"
        } else {
            this.xmlString += "	<" + e + " n='" + t + "'>" + i + "</" + e + ">\n"
        }
    }, deserialize: function (e, t) {
        _twaver.isDeserializing = true;
        this.xmlString = e;
        var a = _twaver.xml(e).documentElement;
        this.refMap = {};
        this.idMap = {};
        var r = new i, l = new i, s, n, o, h = a.getElementsByTagName("data"), m = h.length;
        for (o = 0; o < m; o++) {
            n = h[o];
            var g = n.getAttribute("class");
            var f = this.settings.getPropertyType("id");
            if (f && n.hasAttribute("id")) {
                var u = null;
                if (f === "string") {
                    u = n.getAttribute("id")
                } else if (f === "int") {
                    u = parseInt(n.getAttribute("id"))
                } else if (f === "number") {
                    u = parseFloat(n.getAttribute("id"))
                } else {
                    throw"Unsupported id type '" + f + "'"
                }
                if (n.getAttribute("action") === "remove") {
                    this.dataBox.removeById(u);
                    continue
                }
                s = this.dataBox.getDataById(u);
                if (!s) {
                    s = _twaver.newInstance(g, u)
                }
            } else {
                s = _twaver.newInstance(g)
            }
            if (n.hasAttribute("ref")) {
                var d = n.getAttribute("ref");
                this.refMap[d] = s
            }
            r.add(s);
            l.add(n);
            this.idMap[s.getId()] = s
        }
        this.dataBox.forEach(function (e) {
            this.idMap[e.getId()] = e
        }, this);
        m = r.size();
        for (o = 0; o < m; o++) {
            s = r.get(o);
            n = l.get(o);
            s.deserializeXml(this, n)
        }
        for (o = 0; o < m; o++) {
            s = r.get(o);
            if (this.dataBox.containsById(s.getId())) {
                continue
            }
            if (t && !s.getParent()) {
                s.setParent(t)
            }
            this.dataBox.add(s)
        }
        if (this.settings.isDataBoxSerializable && a.getElementsByTagName("dataBox").length === 1) {
            this.dataBox.deserializeXml(this, a.getElementsByTagName("dataBox")[0])
        }
        _twaver.isDeserializing = false
    }, deserializePropertyXml: function (e, t, i) {
        var a = this.settings.getPropertyType(i);
        if (a) {
            _twaver.setValue(e, i, this.deserializeValue(t, a))
        }
    }, deserializeStyleXml: function (e, t, i) {
        var a = this.settings.getStyleType(i);
        if (a) {
            e.setStyle(i, this.deserializeValue(t, a))
        }
    }, deserializeClientXml: function (e, t, i) {
        var a = this.settings.getClientType(i);
        if (a) {
            e.setClient(i, this.deserializeValue(t, a))
        }
    }, deserializeValue: function (e, t) {
        if (e.hasAttribute("@none")) {
            return null
        }
        if (t === "string") {
            return e.textContent
        }
        if (t === "number") {
            return parseFloat(e.textContent)
        }
        if (t === "boolean") {
            return e.textContent === "true"
        }
        if (t === "int") {
            return parseInt(e.textContent)
        }
        if (t === "point") {
            return{x: parseFloat(e.getAttribute("x")), y: parseFloat(e.getAttribute("y"))}
        }
        if (t === "data") {
            var a = e.getAttribute("ref");
            var r = this.refMap[a];
            if (r) {
                return r
            } else {
                return this.idMap[a]
            }
        }
        var l, s, n, o;
        if (t === "list.point") {
            var h = new i;
            var m = e.getElementsByTagName("p");
            l = m.length;
            for (o = 0; o < l; o++) {
                var g = m[o];
                h.add({x: parseFloat(g.getAttribute("x")), y: parseFloat(g.getAttribute("y"))})
            }
            return h
        }
        if (t === "list.string") {
            var f = new i;
            n = e.getElementsByTagName("s");
            l = n.length;
            for (o = 0; o < l; o++) {
                f.add(n[o].textContent)
            }
            return f
        }
        if (t === "list.number") {
            s = new i;
            n = e.getElementsByTagName("s");
            l = n.length;
            for (o = 0; o < l; o++) {
                s.add(parseFloat(n[o].textContent))
            }
            return s
        }
        if (t === "array.string") {
            return e.textContent.split(",")
        }
        if (t === "array.number") {
            s = e.textContent.split(",");
            l = s.length;
            for (o = 0; o < l; o++) {
                s[o] = parseFloat(s[o])
            }
            return s
        }
        if (t === "rectangle") {
            return{x: parseFloat(e.getAttribute("x")), y: parseFloat(e.getAttribute("y")), width: parseFloat(e.getAttribute("w")), height: parseFloat(e.getAttribute("h"))}
        }
        return e.textContent
    }});
    _twaver.addMethod(twaver.Data, {serializeXml: function (e, t) {
        if (e.settings.isClientSerializable && this._clientMap) {
            for (var i in this._clientMap) {
                this.serializeClientXml(e, i, t)
            }
        }
        this.serializePropertyXml(e, "name", t);
        this.serializePropertyXml(e, "icon", t);
        this.serializePropertyXml(e, "toolTip", t);
        this.serializePropertyXml(e, "parent", t)
    }, serializePropertyXml: function (e, t, i) {
        e.serializePropertyXml(this, t, i)
    }, serializeClientXml: function (e, t, i) {
        e.serializeClientXml(this, t, i)
    }, deserializeXml: function (e, t) {
        var i = t.getElementsByTagName("p"), a = i.length, r, l, s, n;
        for (r = 0; r < a; r++) {
            l = i[r];
            if (l.hasAttribute("n")) {
                this.deserializePropertyXml(e, l, l.getAttribute("n"))
            }
        }
        if (e.settings.isClientSerializable) {
            s = t.getElementsByTagName("c");
            a = s.length;
            for (r = 0; r < a; r++) {
                n = s[r];
                if (n.hasAttribute("n")) {
                    this.deserializeClientXml(e, n, n.getAttribute("n"))
                }
            }
        }
    }, deserializePropertyXml: function (e, t, i) {
        e.deserializePropertyXml(this, t, i)
    }, deserializeClientXml: function (e, t, i) {
        e.deserializeClientXml(this, t, i)
    }});
    _twaver.addMethod(twaver.Element, {serializeXml: function (e, t) {
        if (e.settings.isStyleSerializable && this._styleMap) {
            for (var i in this._styleMap) {
                this.serializeStyleXml(e, i, t)
            }
        }
        twaver.Element.superClass.serializeXml.call(this, e, t);
        this.serializePropertyXml(e, "layerId", t);
        if (this._alarmState.getHighestNativeAlarmSeverity() && e.settings.getPropertyType("alarmState") === "alarmstate") {
            e.xmlString += "	<p n='alarmState'>\n";
            twaver.AlarmSeverity.forEach(function (t) {
                var i = this.getNewAlarmCount(t);
                if (i > 0) {
                    e.xmlString += "		<n n='" + t.name + "' c='" + i + "'/>\n"
                }
            }, this._alarmState);
            twaver.AlarmSeverity.forEach(function (t) {
                var i = this.getAcknowledgedAlarmCount(t);
                if (i > 0) {
                    e.xmlString += "		<a n='" + t.name + "' c='" + i + "'/>\n"
                }
            }, this._alarmState);
            e.xmlString += "	</p>\n"
        }
    }, serializeStyleXml: function (e, t, i) {
        e.serializeStyleXml(this, t, i)
    }, deserializeXml: function (e, t) {
        twaver.Element.superClass.deserializeXml.call(this, e, t);
        if (e.settings.isStyleSerializable) {
            var i = t.getElementsByTagName("s"), a = i.length, r, l;
            for (r = 0; r < a; r++) {
                l = i[r];
                if (l.hasAttribute("n")) {
                    this.deserializeStyleXml(e, l, l.getAttribute("n"))
                }
            }
        }
    }, deserializeStyleXml: function (e, t, i) {
        e.deserializeStyleXml(this, t, i)
    }, deserializePropertyXml: function (e, t, i) {
        if (i === "alarmState") {
            if (e.settings.getPropertyType("alarmState") === "alarmstate") {
                var a, r, l, s, n = t.getElementsByTagName("n");
                for (l = 0; l < n.length; l++) {
                    s = n[l];
                    r = twaver.AlarmSeverity.getByName(s.getAttribute("n"));
                    this._alarmState.setNewAlarmCount(r, parseInt(s.getAttribute("c")))
                }
                n = t.getElementsByTagName("a");
                for (l = 0; l < n.length; l++) {
                    s = n[l];
                    r = twaver.AlarmSeverity.getByName(s.getAttribute("n"));
                    this._alarmState.setAcknowledgedAlarmCount(r, parseInt(s.getAttribute("c")))
                }
            }
        } else {
            twaver.Element.superClass.deserializePropertyXml.call(this, e, t, i)
        }
    }});
    _twaver.addMethod(a, {serializeXml: function (e, t) {
        a.superClass.serializeXml.call(this, e, t);
        this.serializePropertyXml(e, "image", t);
        this.serializePropertyXml(e, "location", t);
        if (_twaver.num(this._width) && this._width >= 0) {
            this.serializePropertyXml(e, "width", t)
        }
        if (_twaver.num(this._height) && this._height >= 0) {
            this.serializePropertyXml(e, "height", t)
        }
    }});
    _twaver.addMethod(twaver.Link, {serializeXml: function (e, t) {
        twaver.Link.superClass.serializeXml.call(this, e, t);
        this.serializePropertyXml(e, "fromNode", t);
        this.serializePropertyXml(e, "toNode", t)
    }});
    _twaver.addMethod(twaver.Follower, {serializeXml: function (e, t) {
        twaver.Follower.superClass.serializeXml.call(this, e, t);
        this.serializePropertyXml(e, "host", t)
    }});
    _twaver.addMethod(r, {serializeXml: function (e, t) {
        r.superClass.serializeXml.call(this, e, t);
        this.serializePropertyXml(e, "expanded", t)
    }});
    _twaver.addMethod(twaver.ShapeNode, {serializeXml: function (e, t) {
        twaver.ShapeNode.superClass.serializeXml.call(this, e, t);
        this.serializePropertyXml(e, "points", t);
        this.serializePropertyXml(e, "segments", t)
    }});
    _twaver.addMethod(twaver.ShapeLink, {serializeXml: function (e, t) {
        twaver.ShapeLink.superClass.serializeXml.call(this, e, t);
        this.serializePropertyXml(e, "points", t)
    }});
    _twaver.addMethod(twaver.RotatableNode, {serializeXml: function (e, t) {
        twaver.RotatableNode.superClass.serializeXml.call(this, e, t);
        this.serializePropertyXml(e, "angle", t)
    }});
    _twaver.addMethod(twaver.DataBox, {serializeXml: function (e, t) {
        if (e.settings.isClientSerializable && this._clientMap) {
            for (var i in this._clientMap) {
                this.serializeClientXml(e, i, t)
            }
        }
        this.serializePropertyXml(e, "name", t);
        this.serializePropertyXml(e, "icon", t);
        this.serializePropertyXml(e, "toolTip", t)
    }, serializePropertyXml: function (e, t, i) {
        e.serializePropertyXml(this, t, i)
    }, serializeClientXml: function (e, t, i) {
        e.serializeClientXml(this, t, i)
    }, deserializeXml: function (e, t) {
        var i = t.getElementsByTagName("p"), a = i.length, r, l, s, n;
        for (r = 0; r < a; r++) {
            l = i[r];
            if (l.hasAttribute("n")) {
                this.deserializePropertyXml(e, l, l.getAttribute("n"))
            }
        }
        if (e.settings.isClientSerializable) {
            s = t.getElementsByTagName("c");
            a = s.length;
            for (r = 0; r < a; r++) {
                n = s[r];
                if (n.hasAttribute("n")) {
                    this.deserializeClientXml(e, n, n.getAttribute("n"))
                }
            }
        }
    }, deserializePropertyXml: function (e, t, i) {
        e.deserializePropertyXml(this, t, i)
    }, deserializeClientXml: function (e, t, i) {
        e.deserializeClientXml(this, t, i)
    }});
    _twaver.addMethod(twaver.ElementBox, {serializeXml: function (e, t) {
        if (e.settings.isLayerBoxSerializable) {
            e.xmlString += "	<layerBox>\n";
            this._layerBox.forEachByDepthFirst(function (t) {
                if (this._layerBox.getDefaultLayer() === t) {
                    e.xmlString += "		<layer "
                } else {
                    e.xmlString += "		<layer id='" + t.getId() + "' "
                }
                if (t.getName()) {
                    e.xmlString += "name='" + t.getName() + "' "
                }
                e.xmlString += "visible='" + t.isVisible() + "' editable='" + t.isEditable() + "' movable='" + t.isMovable() + "'/>\n"
            }, null, this);
            e.xmlString += "	</layerBox>\n"
        }
        if (e.settings.isStyleSerializable && this._styleMap) {
            for (var i in this._styleMap) {
                this.serializeStyleXml(e, i, t)
            }
        }
        twaver.ElementBox.superClass.serializeXml.call(this, e, t)
    }, serializeStyleXml: function (e, t, i) {
        e.serializeStyleXml(this, t, i)
    }, deserializeStyleXml: function (e, t, i) {
        e.deserializeStyleXml(this, t, i)
    }, deserializeXml: function (e, t) {
        twaver.ElementBox.superClass.deserializeXml.call(this, e, t);
        if (e.settings.isLayerBoxSerializable && t.getElementsByTagName("layerBox").length == 1) {
            this._layerBox.clear();
            var i = t.getElementsByTagName("layerBox")[0].getElementsByTagName("layer");
            for (var a = 0; a < i.length; a++) {
                var r = i[a];
                var l;
                if (r.hasAttribute("id")) {
                    var s = e.settings.getPropertyType("layerId");
                    if (s === "string") {
                        l = new twaver.Layer(r.getAttribute("id"))
                    } else if (s === "int") {
                        l = new twaver.Layer(parseInt(r.getAttribute("id")))
                    } else if (s === "number") {
                        l = new twaver.Layer(parseFloat(r.getAttribute("id")))
                    } else {
                        throw"Unsupported layer id type '" + s + "'"
                    }
                    this._layerBox.add(l)
                } else {
                    l = this._layerBox.getDefaultLayer();
                    this._layerBox.moveToBottom(l)
                }
                if (r.hasAttribute("name")) {
                    l.setName(r.getAttribute("name"))
                }
                if (r.hasAttribute("visible")) {
                    l.setVisible(r.getAttribute("visible") === "true")
                }
                if (r.hasAttribute("editable")) {
                    l.setEditable(r.getAttribute("editable") === "true")
                }
                if (r.hasAttribute("movable")) {
                    l.setMovable(r.getAttribute("movable") === "true")
                }
            }
        }
        if (e.settings.isStyleSerializable) {
            var n = t.getElementsByTagName("s");
            var o = n.length;
            for (var a = 0; a < o; a++) {
                var h = n[a];
                if (h.hasAttribute("n")) {
                    this.deserializeStyleXml(e, h, h.getAttribute("n"))
                }
            }
        }
    }})
})(window);